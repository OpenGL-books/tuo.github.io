
<!doctype html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> 	
<html lang="en"> 
<!--<![endif]-->
  <head>
    <meta charset="utf-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />	<!-- Force Latest IE rendering engine -->
    <title>selenium rc和webdriver</title>

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
    <link href="http://feeds2.feedburner.com/tu0huang" rel="alternate" title="Tuo" type="application/atom+xml" /> 
    <link rel="shortcut icon" href="/static/images/favicon.png" />

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 

    <link rel="stylesheet" href="/static/css/style.css">

    <!--[if IE 7]>
      <script src="/static/css/font-awesome-ie7.css"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">	
      <div id='mobile' class='two columns hidden'>
        <ul>
          <li><a href='/'>tuohuang</a></li>
          <li><span class="gray">Tuo Huang 黄拓</span></li>
          <li><a href="mailto:clarkhtse@gmail.com.com">clarkhtse@gmail.com.com</a></li>
          <li><a href="http://twitter.com/tu0huang">@tu0huang</a></li>
        </ul>
      </div>

      <div class="four columns sidebar">
        <section>
          <a id="avatar" href="/"></a>

          <ul id="social">
            <li>
              <a href="mailto:clarkhtse@gmail.com?subject=hi" class="icon-envelope-alt" title="Say hi"></a>
            </li>

            <li>
              <a href="http://twitter.com/tu0huang" class="icon-twitter" title="You should follow me" style="font-size: 28px;"></a>
            </li>

            <li>
              <a href="http://github.com/tuo" class="icon-github"  title="I share and fork code here"></a>
            </li>
            <li>
              <a href="http://feeds2.feedburner.com/tu0huang" class="icon-rss" onClick="_gaq.push(['_trackEvent', 'Link', 'Click', 'Sidebar RSS']);" title="RSS"></a>
            </li>
          </ul>

          <ul id="me">
            <li>Tuo Huang 黄拓</span><a href="http://weibo.com/tu0huang" style="display:inline-block;"><img src='/static/images/sinaweibo.png'/></a></li>
            <li class="gray">iOS and Android developer.</li>
          </ul>

        </section>
      </div>

      <article class='ten columns offset-by-four' id="article-content">
  <header class="ten columns" id="article-header">
    <h1>selenium rc和webdriver</h1>
  </header>

  <div class='ten columns gray' id="date-header">
    <p>
      Aug 17, 2011
  
    </p>

  </div>

  <div class="ten columns" id="article-content">
    前两天在跟结对的同事查看一段我之前写的自动化搭建初始数据的代码时,同事问我为什么需要起一个selenium server才能跑起来,而我们的本地跑的cucumber测试却没有需要你显示的跑一个selenium server.我一时其实也回答不上来,下班后仔细查了查selenium的文档,才豁然开朗.我之前用的是<a href="http://selenium-client.rubyforge.org/" target="_blank">selenium-client</a>, 因为我之前想用它来截取每个浏览器的屏幕, 而selenium-client提供了很好API来跟浏览器打交道(甚至内置的截图方法),  它是基于Selenium RC的.讲到这个先简要介绍一下selenium,它主要用来驱动和跟浏览器做交互,实现web应用程序的自动化测试. 所以意味着selenium必须有一套自己跟浏览器交互的API.

selenium根据实现形式的不同分为两种: selenium rc 和 webdriver.

<h4>Selenium RC</h4>

selenium rc 是比较早提出来的, 它的大概流程是这样:  selenium rc客户端先跟服务器端建立联系, 然后服务器端启动一个浏览器,将主要selenium核心的javascript注入到浏览器中. 然后客户端将不同语言编写的代码

比如在selenium-client ruby代码是这样
<pre lang="ruby">    require "rubygems"
    gem "selenium-client", "~=1.2.16"
    require "selenium/client"
    begin
      @browser = Selenium::Client::Driver.new 
          :host => "localhost",
          :port => 4444,
          :browser => "*firefox",
          :url => "http://www.google.com",
          :timeout_in_second => 60

      @browser.start_new_browser_session
        @browser.open "/"
        @browser.type "q", "Selenium seleniumhq.org"
        @browser.click "btnG", :wait_for => :page
        puts @browser.text?("seleniumhq.org")
    ensure
      @browser.close_current_browser_session
    end</pre>
转换为一种中间的指令<span class="Apple-style-span" style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px; white-space: normal;">Selenese,然后发给服务器端,服务器在浏览器中请求对应的URL,拿到页面后,再将Selenese转换成对应的javascript指令注射到浏览器当前页面中并执行,最后在关闭浏览器.</span>
<span class="Apple-style-span" style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px; white-space: normal;">所以selenium RC是使用javascript来跟浏览器进行交互的.</span></pre>

<h4>Selenium Webdriver</h4>
selenium webdriver采取的一条不同方式,它不是使用javascript来跟浏览器打交道,
而是实现了跟每一个不同浏览器特定相关的原生API来跟浏览器打交道.所以意味着它正对某种浏览器,都有一个对应的driver.

好处在于它绕过了selenium rc使用javascript跟浏览器交互的一些弊病,比如<a href="http://www.openqa.org/selenium-rc/tutorial.html" rel="nofollow">same origin</a>. 同时Selenium Webdriver旨在提供一套更加面向对象方式的API.因为它使用每个浏览器原生API来打交道,所以一方面它比selenium rc会更快更稳定,同时就意味着我们可以这么说"如果你使用的是selenium webdriver的话,你就可以直接抛弃selenium server." 因为你根本不需要启动一个服务器来处理跟浏览器交互.
<pre lang="ruby">
require 'rubygems'
require 'selenium-webdriver'

driver = Selenium::WebDriver.for :firefox
driver.get "http://google.com"

element = driver.find_element :name => "q"
element.send_keys "Selenium seleniumhq.org"
element.submit

puts "Page title is #{driver.title}"

wait = Selenium::WebDriver::Wait.new(:timeout => 10)
wait.until { driver.title.downcase.start_with? "Selenium seleniumhq.org" }
puts "Page title is #{driver.title}"
driver.quit
</pre>
之前提到每个浏览器都得有自己对应的driver,现在目前有支持:<a href="http://seleniumhq.org/docs/03_webdriver.html#firefox-driver" target="_blank">FirefoxDriver</a>, ChromeDriver, IEDriver和OperaDriver,甚至有<a href="http://code.google.com/p/selenium/wiki/IPhoneDriver" target="_blank">IPhoneDriver</a>.

但是相对selenium rc, webdriver它对alert/confirm框的支持还不是很好.

Capybara的selenium使用的是哪一种了 selenium RC 或 Webdriver?
你可以从<a href="https://github.com/jnicklas/capybara" target="_blank">Capybara</a>的github wiki说明上找到:
<em>  At the moment, Capybara supports Selenium 2.0 (Webdriver), not Selenium RC.</em>

在capybara中,你可以注册不同浏览器对应的driver:
<pre lang="ruby">
 Capybara.register_driver :selenium do |app|
   Capybara::Selenium::Driver.new(app, :browser =&gt; :chrome) 
 end
</pre>

<h4>Ruby Bindings</h4>
selenium webdriver 提供了非常好的ruby支持,可以参考<span class="Apple-style-span" style="font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px; white-space: normal;"><a href="http://code.google.com/p/selenium/wiki/RubyBindings" target="_blank">Selenium-webdriver Ruby</a>.</span>

<h4>References</h4>
For more information, pls refer to site docs: <ahref="http://seleniumhq.org/docs/">http://seleniumhq.org/docs/</a>

Official Blog:<a href="http://seleniumhq.wordpress.com/">http://seleniumhq.wordpress.com/</a>

  </div>
  <hr style="visibility:hidden;"/>
  
  <!--<footer class="ten columns">
    <p id='follow'>
       Follow me on <a href="http://twitter.com/tu0huang">Twitter</a> &
       <a href="http://weibo.com/tu0huang">Weibo</a>	   
    </p>
  </footer> -->
</article>

<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ten columns offset-by-four" style="margin-bottom: 11px;">
	<a class="addthis_counter addthis_pill_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-50f9651243f1723a"></script>
<!-- AddThis Button END -->
<div style="margin-bottom:10px;"/>
<div id="disqus_thread" class="ten columns offset-by-four"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'tuohuang'; // required: replace example with your forum shortname
  var disqus_identifier = '/tuohuangid';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </body>
</html> 
