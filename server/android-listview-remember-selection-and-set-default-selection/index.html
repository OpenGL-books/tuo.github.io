
<!doctype html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> 	
<html lang="en"> 
<!--<![endif]-->
  <head>
    <meta charset="utf-8" />
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />	<!-- Force Latest IE rendering engine -->
    <title>Android listview remember selection and set default selection</title>

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->


    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
    <link href="http://feeds2.feedburner.com/tu0huang" rel="alternate" title="Tuo" type="application/atom+xml" /> 
    <link rel="shortcut icon" href="/static/images/favicon.png" />

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> 

    <link rel="stylesheet" href="/static/css/style.css">

    <!--[if IE 7]>
      <script src="/static/css/font-awesome-ie7.css"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">	
      <div id='mobile' class='two columns hidden'>
        <ul>
          <li><a href='/'>tuohuang</a></li>
          <li><span class="gray">Tuo Huang 黄拓</span></li>
          <li><a href="mailto:clarkhtse@gmail.com.com">clarkhtse@gmail.com.com</a></li>
          <li><a href="http://twitter.com/tu0huang">@tu0huang</a></li>
        </ul>
      </div>

      <div class="four columns sidebar">
        <section>
          <a id="avatar" href="/"></a>

          <ul id="social">
            <li>
              <a href="mailto:clarkhtse@gmail.com?subject=hi" class="icon-envelope-alt" title="Say hi"></a>
            </li>

            <li>
              <a href="http://twitter.com/tu0huang" class="icon-twitter" title="You should follow me" style="font-size: 28px;"></a>
            </li>

            <li>
              <a href="http://github.com/tuo" class="icon-github"  title="I share and fork code here"></a>
            </li>
            <li>
              <a href="http://feeds2.feedburner.com/tu0huang" class="icon-rss" onClick="_gaq.push(['_trackEvent', 'Link', 'Click', 'Sidebar RSS']);" title="RSS"></a>
            </li>
          </ul>

          <ul id="me">
            <li>Tuo Huang 黄拓</span><a href="http://weibo.com/tu0huang" style="display:inline-block;"><img src='/static/images/sinaweibo.png'/></a></li>
            <li class="gray">iOS and Android developer.</li>
          </ul>

        </section>
      </div>

      <article class='ten columns offset-by-four' id="article-content">
  <header class="ten columns" id="article-header">
    <h1>Android listview remember selection and set default selection</h1>
  </header>

  <div class='ten columns gray' id="date-header">
    <p>
      Oct 28, 2012
  
    </p>

  </div>

  <div class="ten columns" id="article-content">
    <p>From an iOS developer’s perspective, I find that it is extremely hard to apply features like “<strong>set default selection when starting</strong>” and “<strong>remember selection status after user clicked row</strong>” to ListView. </p>

<p>So let’s start with <strong>“remember selection”</strong> first.The problem is that even if you know that 
you can use selector xml to define highlight/pressed/focus style.But that style will not 
be kept after user clicked that row. For instance, I have a highlighting selector xml (list_selector.xml under res/drawable folder) like this (but you may have other fields need to highlight like text color of textview in row):</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;selector</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/list_selector_pressed&quot;</span> 
		<span class="na">android:state_pressed=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;item</span> <span class="na">android:drawable=</span><span class="s">&quot;@drawable/list_selector_pressed&quot;</span> 
		<span class="na">android:state_selected=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/selector&gt;</span>    
</code></pre>
</div>

<p>and list_selector_pressed.xml which defined the highlighting style–set the background color
to a gray color :</p>

<div class="highlight"><pre><code class="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;layer-list</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;item&gt;</span>
        <span class="nt">&lt;shape</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;solid</span> <span class="na">android:color=</span><span class="s">&quot;@color/dark_gray&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/shape&gt;</span>
    <span class="nt">&lt;/item&gt;</span>
<span class="nt">&lt;/layer-list&gt;</span>
</code></pre>
</div>

<p>So as @David Hedlund suggested:</p>

<blockquote>
  <p>Rather, assign an OnItemClickListener, and have it store away the id of the selected item into some variable. </p>
</blockquote>

<p>you need to create a instance variable on top of your class:</p>

<div class="highlight"><pre><code class="java">        <span class="kd">private</span> <span class="n">View</span> <span class="n">currentSelectedView</span><span class="o">;</span>
</code></pre>
</div>

<p>then go to </p>

<div class="highlight"><pre><code class="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onListItemClick</span><span class="o">(</span><span class="n">ListView</span> <span class="n">l</span><span class="o">,</span> <span class="n">View</span> <span class="n">v</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
	<span class="k">if</span> <span class="o">(</span><span class="n">currentSelectedView</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">currentSelectedView</span> <span class="o">!=</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">unhighlightCurrentRow</span><span class="o">(</span><span class="n">currentSelectedView</span><span class="o">);</span>
    <span class="o">}</span>

	<span class="n">currentSelectedView</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
    <span class="n">highlightCurrentRow</span><span class="o">(</span><span class="n">currentSelectedView</span><span class="o">);</span>
    <span class="c1">//other codes </span>
    <span class="o">}</span>
</code></pre>
</div>

<p>Pretty simple: we check if currentSelectedView is null or current clicked view or not. we first to unhighlight any style by calling method unhighlightCurrentRow(currentSelectedView)—you may wonder why we pass instant variable currentSelectedView as parameter, I will explain it later.  Then we assign view to currentSelectedView and highlight current row; so that the style will persist after user’s clicking is done.</p>

<div class="highlight"><pre><code class="java"><span class="kd">private</span> <span class="kt">void</span> <span class="nf">unhighlightCurrentRow</span><span class="o">(</span><span class="n">View</span> <span class="n">rowView</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">rowView</span><span class="o">.</span><span class="na">setBackgroundColor</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">TRANSPARENT</span><span class="o">);</span>
    <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">rowView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menuTitle</span><span class="o">);</span>
    <span class="n">textView</span><span class="o">.</span><span class="na">setTextColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">white</span><span class="o">));</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">highlightCurrentRow</span><span class="o">(</span><span class="n">View</span> <span class="n">rowView</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">rowView</span><span class="o">.</span><span class="na">setBackgroundColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span>
            <span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">dark_gray</span><span class="o">));</span>
    <span class="n">TextView</span> <span class="n">textView</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">rowView</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menuTitle</span><span class="o">);</span>
    <span class="n">textView</span><span class="o">.</span><span class="na">setTextColor</span><span class="o">(</span><span class="n">getResources</span><span class="o">().</span><span class="na">getColor</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">color</span><span class="o">.</span><span class="na">yellow</span><span class="o">));</span>

<span class="o">}</span> 
</code></pre>
</div>

<p>Aha, that’s it. That is how we implement “remember selection” for list view. As you see, 
we have to duplicate the codes for styling both in xml and java code–pretty stupid :(</p>

<p><strong>Next about “set default selection”</strong>. You may think that you can do this </p>

<div class="highlight"><pre><code class="java">	<span class="n">listView</span><span class="o">.</span><span class="na">setAdapter</span><span class="o">(</span><span class="n">adatper</span><span class="o">)</span>
	<span class="n">listView</span><span class="o">.</span><span class="na">setSelection</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
	<span class="n">currentSelectedView</span> <span class="o">=</span> <span class="n">listView</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
	<span class="n">highlightCurrentRow</span><span class="o">(</span><span class="n">currentSelectedView</span><span class="o">);</span>
</code></pre>
</div>

<p>in onCreate() in activity or onActivityCreated() in fragment.   <br />
But if you run it , you will get NullPointer exception and why ?
because at this time, the listview is not rendered yet and Android doesn’t like iOS which have viewWillAppear. SO you have to create an instant variable to remember whether it is first time to render listview cell and in onListItemClick to unset that variable:</p>

<p>So under currentSelectedView declaration:</p>

<div class="highlight"><pre><code class="java">    <span class="kd">private</span> <span class="n">Boolean</span> <span class="n">firstTimeStartup</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</code></pre>
</div>

<p>then add methods : suppose we want to highlight the first row in list view:</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HomeAdapter</span> <span class="kd">extends</span> <span class="n">ArrayAdapter</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="o">{</span>
	<span class="kt">int</span> <span class="n">layoutResourceId</span><span class="o">;</span>

	<span class="kd">public</span> <span class="nf">HomeAdapter</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="kt">int</span> <span class="n">textViewResourceId</span><span class="o">,</span>
			<span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">objects</span><span class="o">)</span> <span class="o">{</span>
		<span class="kd">super</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">textViewResourceId</span><span class="o">,</span> <span class="n">objects</span><span class="o">);</span>
		<span class="n">layoutResourceId</span> <span class="o">=</span> <span class="n">textViewResourceId</span><span class="o">;</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="n">View</span> <span class="nf">getView</span><span class="o">(</span><span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="n">View</span> <span class="n">convertView</span><span class="o">,</span> <span class="n">ViewGroup</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">convertView</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">convertView</span> <span class="o">=</span> <span class="n">LayoutInflater</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">getContext</span><span class="o">()).</span><span class="na">inflate</span><span class="o">(</span>
					<span class="n">layoutResourceId</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="k">if</span> <span class="o">(</span><span class="n">firstTimeStartup</span> <span class="o">&amp;&amp;</span> <span class="n">postion</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">highlightCurrentRow</span><span class="o">(</span><span class="n">convertView</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">unhighlightCurrentRow</span><span class="o">(</span><span class="n">convertView</span><span class="o">);</span>
        <span class="o">}</span>

		<span class="n">TextView</span> <span class="n">title</span> <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span> <span class="n">convertView</span>
				<span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">menuTitle</span><span class="o">);</span>
		<span class="n">title</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">getItem</span><span class="o">(</span><span class="n">position</span><span class="o">));</span>
		<span class="k">return</span> <span class="n">convertView</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>Pretty simple.
But you need to make some changes in onListItemClick method:</p>

<div class="highlight"><pre><code class="java"><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">onListItemClick</span><span class="o">(</span><span class="n">ListView</span> <span class="n">l</span><span class="o">,</span> <span class="n">View</span> <span class="n">v</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="kt">long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>

	<span class="k">if</span> <span class="o">(</span><span class="n">firstTimeStartup</span><span class="o">)</span> <span class="o">{</span><span class="c1">// first time  highlight first row</span>
		<span class="n">currentSelectedView</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="na">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="n">firstTimeStartup</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> 
	<span class="k">if</span> <span class="o">(</span><span class="n">currentSelectedView</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">currentSelectedView</span> <span class="o">!=</span> <span class="n">v</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">unhighlightCurrentRow</span><span class="o">(</span><span class="n">currentSelectedView</span><span class="o">);</span>
    <span class="o">}</span>

	<span class="n">currentSelectedView</span> <span class="o">=</span> <span class="n">v</span><span class="o">;</span>
    <span class="n">highlightCurrentRow</span><span class="o">(</span><span class="n">currentSelectedView</span><span class="o">);</span>

     <span class="c1">//other codes</span>
<span class="o">}</span>
</code></pre>
</div>

<p>There you go! Enjoy Android :)</p>

  </div>
  <hr style="visibility:hidden;"/>
  
  <!--<footer class="ten columns">
    <p id='follow'>
       Follow me on <a href="http://twitter.com/tu0huang">Twitter</a> &
       <a href="http://weibo.com/tu0huang">Weibo</a>	   
    </p>
  </footer> -->
</article>

<!-- AddThis Button BEGIN -->
<div class="addthis_toolbox addthis_default_style ten columns offset-by-four" style="margin-bottom: 11px;">
	<a class="addthis_counter addthis_pill_style"></a>
</div>
<script type="text/javascript">var addthis_config = {"data_track_addressbar":true};</script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-50f9651243f1723a"></script>
<!-- AddThis Button END -->
<div style="margin-bottom:10px;"/>
<div id="disqus_thread" class="ten columns offset-by-four"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'tuohuang'; // required: replace example with your forum shortname
  var disqus_identifier = '/tuohuangid';
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    </div>
  </body>
</html> 
