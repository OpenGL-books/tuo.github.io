<!DOCTYPE html>
<html lang="en">
  <head>
   <meta charset="utf-8">
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <meta name="msvalidate.01" content="D44891873E3206AEFB1E30BD563E5E4B" />
   <title>Android listview remember selection and set default selection</title>
   <meta name="author" content="Tuo 拓" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
  

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />

   <!--google analytics -->
   <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-27864586-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>

</head>
<body>

<div class="site">
  <div class="title">
    <a href="/">Tuo 拓</a>
    <!-- <a class="extra" href="/">home</a>
    <a class="extra" href="/about.html">about</a> -->
  </div>
  
  
  <section id="main"><!-- #main content and sidebar area -->  
      <div id="content">
        <article class="articlecontent">
          <h1 style="color: #AA0000;">Android listview remember selection and set default selection</h1>
<div id="post">
<p>From an iOS developer's perspective, I find that it is extremely hard to apply features like "<strong>set default selection when starting</strong>" and "<strong>remember selection status after user clicked row</strong>" to ListView.</p>

<p>  So let's start with <strong>"remember selection"</strong> first.The problem is that even if you know that
you can use selector xml to define highlight/pressed/focus style.But that style will not
be kept after user clicked that row. For instance, I have a highlighting selector xml (list_selector.xml under res/drawable folder) like this (but you may have other fields need to highlight like text color of textview in row):</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;selector xmlns:android="http://schemas.android.com/apk/res/android"&gt;
    &lt;item android:drawable="@drawable/list_selector_pressed" 
        android:state_pressed="true" /&gt;
    &lt;item android:drawable="@drawable/list_selector_pressed" 
        android:state_selected="true" /&gt;
&lt;/selector&gt;    
</code></pre>

<p>and list_selector_pressed.xml which defined the highlighting style--set the background color
to a gray color :</p>

<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;layer-list xmlns:android="http://schemas.android.com/apk/res/android"&gt;
    &lt;item&gt;
        &lt;shape xmlns:android="http://schemas.android.com/apk/res/android"&gt;
            &lt;solid android:color="@color/dark_gray" /&gt;
        &lt;/shape&gt;
    &lt;/item&gt;
&lt;/layer-list&gt;
</code></pre>

<p>So as @David Hedlund suggested:</p>

<blockquote><p>Rather, assign an OnItemClickListener, and have it store away the id of the selected item into some variable.</p></blockquote>

<p>you need to create a instance variable on top of your class:</p>

<pre><code>    private View currentSelectedView;
</code></pre>

<p>then go to</p>

<pre><code>@Override
public void onListItemClick(ListView l, View v, int position, long id) {
    if (currentSelectedView != null &amp;&amp; currentSelectedView != v) {
        unhighlightCurrentRow(currentSelectedView);
    }

    currentSelectedView = v;
    highlightCurrentRow(currentSelectedView);
    //other codes 
    }
</code></pre>

<p>Pretty simple: we check if currentSelectedView is null or current clicked view or not. we first to unhighlight any style by calling method unhighlightCurrentRow(currentSelectedView)---you may wonder why we pass instant variable currentSelectedView as parameter, I will explain it later.  Then we assign view to currentSelectedView and highlight current row; so that the style will persist after user's clicking is done.</p>

<pre><code>private void unhighlightCurrentRow(View rowView) {
    rowView.setBackgroundColor(Color.TRANSPARENT);
    TextView textView = (TextView) rowView.findViewById(R.id.menuTitle);
    textView.setTextColor(getResources().getColor(R.color.white));
}

private void highlightCurrentRow(View rowView) {
    rowView.setBackgroundColor(getResources().getColor(
            R.color.dark_gray));
    TextView textView = (TextView) rowView.findViewById(R.id.menuTitle);
    textView.setTextColor(getResources().getColor(R.color.yellow));

} 
</code></pre>

<p> Aha, that's it. That is how we implement "remember selection" for list view. As you see,
we have to duplicate the codes for styling both in xml and java code--pretty stupid :(</p>

<p><strong>Next about "set default selection"</strong>. You may think that you can do this</p>

<pre><code>listView.setAdapter(adatper)
listView.setSelection(0);
currentSelectedView = listView.getChildAt(0);
highlightCurrentRow(currentSelectedView);
</code></pre>

<p>in onCreate() in activity or onActivityCreated() in fragment.   <br/>
But if you run it , you will get NullPointer exception and why ?
because at this time, the listview is not rendered yet and Android doesn't like iOS which have viewWillAppear. SO you have to create an instant variable to remember whether it is first time to render listview cell and in onListItemClick to unset that variable:</p>

<p>So under currentSelectedView declaration:</p>

<pre><code>private Boolean firstTimeStartup = true;
</code></pre>

<p>then add methods : suppose we want to highlight the first row in list view:</p>

<pre><code>public class HomeAdapter extends ArrayAdapter&lt;String&gt; {
    int layoutResourceId;

    public HomeAdapter(Context context, int textViewResourceId,
            ArrayList&lt;String&gt; objects) {
        super(context, textViewResourceId, objects);
        layoutResourceId = textViewResourceId;
    }

    @Override
    public View getView(int position, View convertView, ViewGroup parent) {
        if (convertView == null) {
            convertView = LayoutInflater.from(getContext()).inflate(
                    layoutResourceId, null);
        }

        if (firstTimeStartup &amp;&amp; postion == 0) {
            highlightCurrentRow(convertView);
        } else {
            unhighlightCurrentRow(convertView);
        }

        TextView title = (TextView) convertView
                .findViewById(R.id.menuTitle);
        title.setText(getItem(position));
        return convertView;
    }
}
</code></pre>

<p>Pretty simple.
But you need to make some changes in onListItemClick method:</p>

<pre><code>@Override
public void onListItemClick(ListView l, View v, int position, long id) {

    if (firstTimeStartup) {// first time  highlight first row
        currentSelectedView = l.getChildAt(0);
    }
    firstTimeStartup = false; 
    if (currentSelectedView != null &amp;&amp; currentSelectedView != v) {
        unhighlightCurrentRow(currentSelectedView);
    }

    currentSelectedView = v;
    highlightCurrentRow(currentSelectedView);

     //other codes
}
</code></pre>

<p>There you go! Enjoy Android :)</p>

</div>

<div id="share_post">
  <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  <!-- Place this tag where you want the +1 button to render -->
<div class="g-plusone" data-size="medium" data-annotation="inline"></div>

<!-- Place this render call where appropriate -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>

</div>

<!-- START: Livefyre Embed -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'tuohuang'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
<!-- END: Livefyre Embed -->

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>09 Oct 2012</span> &raquo; <a href="20.html">转： e络盟-2012树莓派-raspberry-pi发烧友见面会</a></li>
    
      <li><span>14 Jul 2012</span> &raquo; <a href="19.html">毕业两年记 （上）</a></li>
    
      <li><span>23 Apr 2012</span> &raquo; <a href="17.html">记江苏之行（二）</a></li>
    
  </ul>
</div>

        </article>
      </div>
	  
	  

	  <aside>
	  <section style="margin-top: 14px; margin-bottom: 20px">
	  <!-- <h3>Who's saberma</h3>
	  <img src="/images/saberma.jpeg"/>
	  <p>email(gtalk):<a href="mailto:mahb45@gmail.com">mahb45@gmail.com</a></p>
	  <p>twitter:<a href="http://twitter.com/saberma">twitter.com/saberma</a></p>
	  <p>
	    <a href="http://github.com/saberma">github</a>
	    <a href="http://www.douban.com/people/4034647/">douban</a>
	  </p> -->
	  <h1>About Me 关于我</h1>

<a href="http://tuohuang.thoughtworkers.org/wp-content/uploads/2010/08/my.png"><img class="alignnone size-full wp-image-26" title="my" src="http://tuohuang.thoughtworkers.org/wp-content/uploads/2010/08/my.png" alt="" width="138" height="182" /></a>
<br/>
Hi!<br/>
My name is Tuo Huang.<br/>
I'm a software engineer.<br/>
I like mobile development and agile.<br/>
<!-- Currently working in <a href="http://www.reigndesign.com" target="_blank">ReignDesign</a>.<br/> -->

	  </section>

	  <section>

	  <!-- Feedsky FEED发布代码结束 -->
	  </section>

	  <section>
	  <h3>Categories</h3>
<ul>
  
  <li><a href="/Life MiscellaneousProgramming.html">Life MiscellaneousProgramming (1)</a></li>
  
  <li><a href="/android.html">android (1)</a></li>
  
</ul>

	  </section>

	  </aside>
  </section><!-- end of #main content and sidebar-->
  
  <div class="footer">
    <div class="contact">
      <p>
        Tuo 拓<br />
       
		 <a href="mailto:clarkhtse@gmail.com?subject=hey">clarkhtse@gmail.com</a> 
      </p>
    </div>
    <div class="contact">
      <p>
      <a href="http://twitter.com/tu0huang/">twitter.com/tu0huang</a><br />      
      <a href="http://github.com/tuo/">github.com/tuo</a><br />
      <a href="http://weibo.com/1394253223">Tuo's sina weibo</a><br />
      </p>
    </div>
    <div class="rss">
      <a href="http://feeds.feedburner.com/tuo">
        <img src="/images/rss.png" alt="Subscribe to RSS Feed" />
      </a>
    </div>
  </div>
</div>

</body>
</html>
