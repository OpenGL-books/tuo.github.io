<!DOCTYPE html>
<html lang="en">
  <head>
   <meta charset="utf-8">
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <meta name="msvalidate.01" content="D44891873E3206AEFB1E30BD563E5E4B" />
   <title>A few thoughts on testing from the trench</title>
   <meta name="author" content="Tuo 拓" />

   <!-- syntax highlighting CSS -->
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
  

   <!-- Homepage CSS -->
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />

   <!--google analytics -->
   <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-27864586-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>

</head>
<body>

<div class="site">
  <div class="title">
    <a href="/">Tuo 拓</a>
    <!-- <a class="extra" href="/">home</a>
    <a class="extra" href="/about.html">about</a> -->
  </div>
  
  
  <section id="main"><!-- #main content and sidebar area -->  
      <div id="content">
        <article class="articlecontent">
          <h1 style="color: #AA0000;">A few thoughts on testing from the trench</h1>
<div id="post">
Yesterday ,in my coding process ,well,i run into a intricate problem . What i'm wanna do is to add a testcase for newly modified funcationality ,then verify whether it works or not. Since the functionality is not our concern , i'll leave out its nuts and bolts.The quick peek  on this is that it will read value of specific key from a web.config ,some sort of xml configuration file, then assemble that value to a legitimate datetime. So,quite simply,ha.
 
Here comes the testcase that i added:
<pre class="brush: csharp; ">[Test]
public void should_return_true_when_time_frame_is_Null_and_current_time_passed_it()
{
   var timeFrame = DateTimeHelper.NULL_DATE_TIME;
   Assert.IsTrue(DateTimeHelper.TimeFrameLateThan(timeFrame, DateTimeHelper.DEFAULT_TIME_FRAME.AddMinutes(-1)));
}</pre>
As u may infer from foregoing code list , the TimeFrameLateThan method is the dirty worker that encapsulate the details. To clearly express that my emphasis on this ,  the TimeFrameLateThan will read value of key ,like "LatestCalculationTime" or whatever, and if that key is not configured in xml file ,then it simply use the default value ,in this case  "NULL_DATE_TIME" .

To fully explain what's going on ,i need post a littile more context to u. Here is big picture:
<pre class="brush: csharp; ">[Test]
public void should_return_configed_timeframe_when_timeframe_in_app_setting_is_in_right_format()
{
   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, "17:00:00");
   actualReturned = DateTimeHelper.ReadTimeframeFromConfig();
   expectedReturn = CreateUtcDateTimeByHHMM(17, 0);
   Assert.AreEqual(DateTimeKind.Utc, actualReturned.Kind);
   Assert.AreEqual(expectedReturn, actualReturned);
}

public void should_return_configed_timeframe_when_timeframe_in_app_setting_is_in_bad_format()
{
   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, "15:70:00");
   actualReturned = DateTimeHelper.ReadTimeframeFromConfig();
   Assert.AreEqual(DateTimeKind.Utc, actualReturned.Kind);
   Assert.AreEqual(DateTimeHelper.DEFAULT_TIME_FRAME, actualReturned);

   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, null);
   var configedTime = ConfigurationManager.AppSettings.Get(DateTimeHelper.TRIGGER_TIMEFRAME_KEY);
   Assert.IsNull(configedTime);
}

[Test]
public void should_return_true_when_time_frame_is_Null_and_current_time_passed_it()
{
   var timeFrame = DateTimeHelper.NULL_DATE_TIME;
   Assert.IsTrue(DateTimeHelper.TimeFrameLateThan(timeFrame, DateTimeHelper.DEFAULT_TIME_FRAME.AddMinutes(-1)));
}</pre>
Maybe now ,u ,as acute and perceptive as always ,have already seen through the problem. Well , at the time i coded it , i just did not got it. When  i run this test in IDE , it just happily gave me a green bar,hoho ,not bad.

But when i run this from console (triggered by Nant ) , it just kept telling me that test--public void should_return_true_when_time_frame_is_Null_and_current_time_passed_it, failed.  Returned to the test codes,i just pondered why it just happened.  Here is how i spot the "tricky insect" in tests : first just remove all ,simply leave only failed testcase alone,then running the tests it passed.  Secondly pulled back testcase one by one ,simply follow the rhythm ---"add one  testcase,run the test ;if ok,repeat that" .  Finally  thing  that if i run  testcase 1 and test3 together ,it would break;but if i run test2 and test3 together ,it just passed. So i checked distinction between testcase1 and testcase 2 .Soon i figured that out , simply by some stupid mistake   , i forgot to set DateTimeHelper.TRIGGER_TIMEFRAME_KEY to null. It seems that i just forget do  some clean stuff,while what goes beyond the surface is that  I do not much grip test principle. When comes to test,it is so important to keep it self-stand and self-closed ,make sure it will not pollute and break other test case 's preconditions/assumptions.

<em>Here is the solution(I add some cleanup code between line 10 and line 13):</em>
<pre class="brush: csharp; ">[Test]
public void should_return_configed_timeframe_when_timeframe_in_app_setting_is_in_right_format()
{
   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, "17:00:00");
   actualReturned = DateTimeHelper.ReadTimeframeFromConfig();
   expectedReturn = CreateUtcDateTimeByHHMM(17, 0);
   Assert.AreEqual(DateTimeKind.Utc, actualReturned.Kind);
   Assert.AreEqual(expectedReturn, actualReturned);

   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, null);
   var configedTime = ConfigurationManager.AppSettings.Get(DateTimeHelper.TRIGGER_TIMEFRAME_KEY);
   Assert.IsNull(configedTime);
}

public void should_return_configed_timeframe_when_timeframe_in_app_setting_is_in_bad_format()
{
   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, "15:70:00");
   actualReturned = DateTimeHelper.ReadTimeframeFromConfig();
   Assert.AreEqual(DateTimeKind.Utc, actualReturned.Kind);
   Assert.AreEqual(DateTimeHelper.DEFAULT_TIME_FRAME, actualReturned);

   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, null);
   var configedTime = ConfigurationManager.AppSettings.Get(DateTimeHelper.TRIGGER_TIMEFRAME_KEY);
   Assert.IsNull(configedTime);
}

[Test]
public void should_return_true_when_time_frame_is_Null_and_current_time_passed_it()
{
   var timeFrame = DateTimeHelper.NULL_DATE_TIME;
   Assert.IsTrue(DateTimeHelper.TimeFrameLateThan(timeFrame,
DateTimeHelper.DEFAULT_TIME_FRAME.AddMinutes(-1)));
}</pre>
Keep test case responsible for what it has done and ensure the circumstance before and after is consistent. Sometime it is your duty, so you  account for restoring in the first place;well ,somehow the intellecture framework will take care it for u .Take Spring's AbstractTransactionalDbProviderSpringContextTests as an example ,Spring will automatically add  transaction support to your test case in Setup and Teardown,to rollback any changes made in your test case.

Anyway,it is aways a good habit to  let a test case account for cleaning what it has done.

</div>

<div id="share_post">
  <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

  <!-- Place this tag where you want the +1 button to render -->
<div class="g-plusone" data-size="medium" data-annotation="inline"></div>

<!-- Place this render call where appropriate -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>

</div>

<!-- START: Livefyre Embed -->
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'tuohuang'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
<!-- END: Livefyre Embed -->

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>28 Oct 2012</span> &raquo; <a href="/2012/10/28/android-listview-remember-selection-and-set-default-selection">Android listview remember selection and set default selection</a></li>
    
      <li><span>09 Oct 2012</span> &raquo; <a href="20.html">转： e络盟-2012树莓派-raspberry-pi发烧友见面会</a></li>
    
      <li><span>14 Jul 2012</span> &raquo; <a href="19.html">毕业两年记 （上）</a></li>
    
  </ul>
</div>

        </article>
      </div>
	  
	  

	  <aside>
	  <section style="margin-top: 14px; margin-bottom: 20px">
	  <!-- <h3>Who's saberma</h3>
	  <img src="/images/saberma.jpeg"/>
	  <p>email(gtalk):<a href="mailto:mahb45@gmail.com">mahb45@gmail.com</a></p>
	  <p>twitter:<a href="http://twitter.com/saberma">twitter.com/saberma</a></p>
	  <p>
	    <a href="http://github.com/saberma">github</a>
	    <a href="http://www.douban.com/people/4034647/">douban</a>
	  </p> -->
	  <h1>About Me 关于我</h1>

<a href="http://tuohuang.thoughtworkers.org/wp-content/uploads/2010/08/my.png"><img class="alignnone size-full wp-image-26" title="my" src="http://tuohuang.thoughtworkers.org/wp-content/uploads/2010/08/my.png" alt="" width="138" height="182" /></a>
<br/>
Hi!<br/>
My name is Tuo Huang.<br/>
I'm a software engineer.<br/>
I like mobile development and agile.<br/>
<!-- Currently working in <a href="http://www.reigndesign.com" target="_blank">ReignDesign</a>.<br/> -->

	  </section>

	  <section>

	  <!-- Feedsky FEED发布代码结束 -->
	  </section>

	  <section>
	  <h3>Categories</h3>
<ul>
  
  <li><a href="/Life MiscellaneousProgramming.html">Life MiscellaneousProgramming (1)</a></li>
  
  <li><a href="/android.html">android (1)</a></li>
  
</ul>

	  </section>

	  </aside>
  </section><!-- end of #main content and sidebar-->
  
  <div class="footer">
    <div class="contact">
      <p>
        Tuo 拓<br />
       
		 <a href="mailto:clarkhtse@gmail.com?subject=hey">clarkhtse@gmail.com</a> 
      </p>
    </div>
    <div class="contact">
      <p>
      <a href="http://twitter.com/tu0huang/">twitter.com/tu0huang</a><br />      
      <a href="http://github.com/tuo/">github.com/tuo</a><br />
      <a href="http://weibo.com/1394253223">Tuo's sina weibo</a><br />
      </p>
    </div>
    <div class="rss">
      <a href="http://feeds.feedburner.com/tuo">
        <img src="/images/rss.png" alt="Subscribe to RSS Feed" />
      </a>
    </div>
  </div>
</div>

</body>
</html>
