<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
 
 <title>Tuo</title>
 <link href="http://tuo.github.com/atom.xml" rel="self"/>
 <link href="http://tuo.github.com/"/>
 <updated>2013-01-10T23:27:27+08:00</updated>
 <id>http://tuo.github.com</id>
 <author>
   <name>Tuo</name>
   <email>clarkhtse@gmail.com</email>
 </author>

 
 <entry>
   <title>Android listview remember selection and set default selection</title>
   <link href="http://tuo.github.com/android-listview-remember-selection-and-set-default-selection"/>
   <updated>2012-10-28T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/android-listview-remember-selection-and-set-default-selection</id>
   <content type="html">&lt;p&gt;From an iOS developer’s perspective, I find that it is extremely hard to apply features like “&lt;strong&gt;set default selection when starting&lt;/strong&gt;” and “&lt;strong&gt;remember selection status after user clicked row&lt;/strong&gt;” to ListView. &lt;/p&gt;

&lt;p&gt;So let’s start with &lt;strong&gt;“remember selection”&lt;/strong&gt; first.The problem is that even if you know that 
you can use selector xml to define highlight/pressed/focus style.But that style will not 
be kept after user clicked that row. For instance, I have a highlighting selector xml (list_selector.xml under res/drawable folder) like this (but you may have other fields need to highlight like text color of textview in row):&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;
&amp;lt;selector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&amp;gt;
    &amp;lt;item android:drawable=&quot;@drawable/list_selector_pressed&quot; 
		android:state_pressed=&quot;true&quot; /&amp;gt;
    &amp;lt;item android:drawable=&quot;@drawable/list_selector_pressed&quot; 
		android:state_selected=&quot;true&quot; /&amp;gt;
&amp;lt;/selector&amp;gt;    
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;and list_selector_pressed.xml which defined the highlighting style–set the background color
to a gray color :&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&amp;gt;
&amp;lt;layer-list xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&amp;gt;
    &amp;lt;item&amp;gt;
        &amp;lt;shape xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&amp;gt;
            &amp;lt;solid android:color=&quot;@color/dark_gray&quot; /&amp;gt;
        &amp;lt;/shape&amp;gt;
    &amp;lt;/item&amp;gt;
&amp;lt;/layer-list&amp;gt;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So as @David Hedlund suggested:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Rather, assign an OnItemClickListener, and have it store away the id of the selected item into some variable. &lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;you need to create a instance variable on top of your class:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    private View currentSelectedView;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;then go to &lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@Override
public void onListItemClick(ListView l, View v, int position, long id) {
	if (currentSelectedView != null &amp;amp;&amp;amp; currentSelectedView != v) {
        unhighlightCurrentRow(currentSelectedView);
    }

	currentSelectedView = v;
    highlightCurrentRow(currentSelectedView);
    //other codes 
    }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Pretty simple: we check if currentSelectedView is null or current clicked view or not. we first to unhighlight any style by calling method unhighlightCurrentRow(currentSelectedView)—you may wonder why we pass instant variable currentSelectedView as parameter, I will explain it later.  Then we assign view to currentSelectedView and highlight current row; so that the style will persist after user’s clicking is done.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;private void unhighlightCurrentRow(View rowView) {
    rowView.setBackgroundColor(Color.TRANSPARENT);
    TextView textView = (TextView) rowView.findViewById(R.id.menuTitle);
    textView.setTextColor(getResources().getColor(R.color.white));
}

private void highlightCurrentRow(View rowView) {
    rowView.setBackgroundColor(getResources().getColor(
            R.color.dark_gray));
    TextView textView = (TextView) rowView.findViewById(R.id.menuTitle);
    textView.setTextColor(getResources().getColor(R.color.yellow));

} 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Aha, that’s it. That is how we implement “remember selection” for list view. As you see, 
we have to duplicate the codes for styling both in xml and java code–pretty stupid :(&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Next about “set default selection”&lt;/strong&gt;. You may think that you can do this &lt;/p&gt;

&lt;pre&gt;&lt;code&gt;listView.setAdapter(adatper)
listView.setSelection(0);
currentSelectedView = listView.getChildAt(0);
highlightCurrentRow(currentSelectedView); in onCreate() in activity or onActivityCreated() in fragment.      But if you run it , you will get NullPointer exception and why ? because at this time, the listview is not rendered yet and Android doesn't like iOS which have viewWillAppear. SO you have to create an instant variable to remember whether it is first time to render listview cell and in onListItemClick to unset that variable:
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;So under currentSelectedView declaration:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;private Boolean firstTimeStartup = true;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;then add methods : suppose we want to highlight the first row in list view:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;public class HomeAdapter extends ArrayAdapter&amp;lt;String&amp;gt; {
	int layoutResourceId;

	public HomeAdapter(Context context, int textViewResourceId,
			ArrayList&amp;lt;String&amp;gt; objects) {
		super(context, textViewResourceId, objects);
		layoutResourceId = textViewResourceId;
	}

	@Override
	public View getView(int position, View convertView, ViewGroup parent) {
		if (convertView == null) {
			convertView = LayoutInflater.from(getContext()).inflate(
					layoutResourceId, null);
		}

		if (firstTimeStartup &amp;amp;&amp;amp; postion == 0) {
            highlightCurrentRow(convertView);
        } else {
            unhighlightCurrentRow(convertView);
        }

		TextView title = (TextView) convertView
				.findViewById(R.id.menuTitle);
		title.setText(getItem(position));
		return convertView;
	}
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Pretty simple.
But you need to make some changes in onListItemClick method:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;@Override
public void onListItemClick(ListView l, View v, int position, long id) {

	if (firstTimeStartup) {// first time  highlight first row
		currentSelectedView = l.getChildAt(0);
	}
	firstTimeStartup = false; 
	if (currentSelectedView != null &amp;amp;&amp;amp; currentSelectedView != v) {
        unhighlightCurrentRow(currentSelectedView);
    }

	currentSelectedView = v;
    highlightCurrentRow(currentSelectedView);

     //other codes
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;There you go! Enjoy Android :)&lt;/p&gt;

</content>
 </entry>
 
 <entry>
   <title>转： e络盟-2012树莓派-raspberry-pi发烧友见面会</title>
   <link href="http://tuo.github.com20.html"/>
   <updated>2012-10-09T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e8%bd%ac%ef%bc%9a-e%e7%bb%9c%e7%9b%9f-2012%e6%a0%91%e8%8e%93%e6%b4%be-raspberry-pi%e5%8f%91%e7%83%a7%e5%8f%8b%e8%a7%81%e9%9d%a2%e4%bc%9a</id>
   <content type="html">&lt;a href=&quot;http://www.element14.com/community/blogs/cn_element14/2012/09/28/e%E7%BB%9C%E7%9B%9F-2012%E6%A0%91%E8%8E%93%E6%B4%BE-raspberry-pi%E5%8F%91%E7%83%A7%E5%8F%8B%E8%A7%81%E9%9D%A2%E4%BC%9A&quot; title=&quot;活动详细信息&quot; target=&quot;_blank&quot;&gt;&lt;/a&gt;
http://www.element14.com/community/blogs/cn_element14/2012/09/28/e%E7%BB%9C%E7%9B%9F-2012%E6%A0%91%E8%8E%93%E6%B4%BE-raspberry-pi%E5%8F%91%E7%83%A7%E5%8F%8B%E8%A7%81%E9%9D%A2%E4%BC%9A
玩过树莓派 Raspberry Pi ？
是树莓派 (Raspberry Pi) 应用高手？
如何更好的使用Raspberry Pi？10月17日，我们在上海一起追Raspberry Pi
 
顶尖ARM解决方案供应商英蓓特Embest专家将受邀出席与我们一起解析Raspberry Pi
 
也欢迎您展示您的Raspberry Pi应用，我们将为您提前准备投影仪等设备。
 
e络盟 2012树莓派 (Raspberry Pi)发烧友见面会
 
时间：2012年10月17日（周三）晚18:30 – 19:30

地点：上海浦东碧波路635号传奇广3楼 IC咖啡（馆）

 
如您确认参加本次活动，请email报名申请，确认后我们将给您发邀请函并为您安排简餐及饮用水一份，活动免费。
咨询电话：（021）6196 1388 - 1122


&lt;a href=&quot;http://www.element14.com/community/blogs/cn_element14/2012/09/28/e%E7%BB%9C%E7%9B%9F-2012%E6%A0%91%E8%8E%93%E6%B4%BE-raspberry-pi%E5%8F%91%E7%83%A7%E5%8F%8B%E8%A7%81%E9%9D%A2%E4%BC%9A&quot; title=&quot;活动详细信息&quot; target=&quot;_blank&quot;&gt;&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>毕业两年记 （上）</title>
   <link href="http://tuo.github.com19.html"/>
   <updated>2012-07-14T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e6%af%95%e4%b8%9a%e4%b8%a4%e5%b9%b4%e8%ae%b0-%ef%bc%88%e4%b8%8a%ef%bc%89</id>
   <content type="html">前几天看到西门大牛，在人人网上感叹，一晃毕业已经两年了。 是的，想一想确实毕业两年了，从2010年七月十二号参加工作到现在也刚好两年了。两年中，收获了很多，成长了很多，更多的是明白了自己更想要什么东西，中间有很多挑战，有很多心得，虽然不是每一个挑战完成的很漂亮，但是挑战的过程我都坚持过来了。 最重要的是感谢这两年中帮助和批评过的我人们。

 2010/06/28 -   2010/07/12
 刚刚毕业没几天吧，印象中，大学对“工作”这个词既有期待，也有未知的惶恐，惶恐以自己不羁张扬的个性能否和公司很好的取得同步，惶恐自己能否能即时调整自己，更加惶恐的是是否这个实际“工作”使我喜欢的。其实我想想当时自己的“惶恐”还是有几分自信的， 想起大学，想起袒胸露背喝着果啤一边看港剧的波哥，想起每晚都会准时跟老婆通电话的王维，想起踢实况的乔龙 想起搞程序的“土狗”大牛西门云，想起源大牛，想起晚上黑不溜秋的一起在篮球场打球的骚祥，这是生活和学习。身为班干部，确实带头跟老师唱反调，帮童鞋逃课，因为我内心很反感老师的上课方式，我很是怀疑他们教我们的思维方式，我们现实中有用到过吗？ 所教的知识老套的不行，跟工作中完全脱节，上课方式呆板，知识滞后，在这个日新月异的软件行业而言，老师们的脑壳子明显是停留在是几年前吧。守着陈芝麻烂谷子，却不去尝试了解现实中的前沿科技和变化。我无法忍受是缺乏激情。上次去太原，跟胡总见了一面，聊到说大一时法律政治课，叫大家上台发言，我很屌的上去说了一句“生活就是需要激情啊”。 我都不记得了。大二时我开始了逃课，课外自己努力逼迫自己看技术原版书，了解最新的技术，我知道可能一下子很痛苦，但是将来是会有帮助的。而且我现在回头看，确实很有帮助。 后来大学几年我的学习成绩直线下滑，但我却很高兴。 找工作时，我有明确的目标：敏捷，英语，结果就顺利的进入了Thoughtworks.
  2010/07/12 - 2010/09/30 : 西安
  这天和其他Thoughtworks应届生一起开始了“工作”的第一天。我依稀记得带着我现在还在手头的一个联想笔记本，就是呆呆的坐在一个角落，没有过多的寒暄。后来坐了一会，和几个新同事开始入职介绍。我属于一开始很闷骚的人，不熟的人很是拘谨，但是一聊开了，就是露出本色了。一开始是在凯哥所带的项目上面， 一个.NET平台。其实我在大学做的都是一些demo的小项目，说白话就是个人玩玩，所以其实对真正现实世界中的软件项目是什么样的，并没有很深入的了解。对于敏捷，大学时我是看过不少这方面的书，甚至给班上同学做过两次关于重构(Refactoring)，测试驱动开发（TDD)和面向对象设计原则（Robert C Martin那本3P书）的讲座。所以说理论大于实践，可以说一开始进去的第一个月，很多新的挑战，新的知识，我需要迅速学习消化并且应用到项目上。所以那一月，几乎每个晚上回家之后我仍会坚持课外学习，我有个习惯，先查阅很多东西，然后记下要点，等到周末然后系统的总结写成博客，这当然是也是非常感谢凯哥和熊节(gigix)的帮忙。这一点到现在我觉得非常感谢，等到八月份也就是入职后一个月，开始比较能顺心顺手的工作了，每周会和同事去电子正街人人乐旁边的学校打球。是的，在这期间，我大部分时间中午晚上都会做饭，而且还学会了掂锅，呵呵。在第一项目上我一直待到了九月底。
  2010/10/01 - 2010/11/16 : 印度，班加罗尔
 这一次是公司组织的应届生去印度班加罗尔的分公司进行一个关于敏捷课程的培训。学习之余体验了一把异国风情，体验了一把不同文化。
 待续
</content>
 </entry>
 
 <entry>
   <title>记江苏之行（二）</title>
   <link href="http://tuo.github.com17.html"/>
   <updated>2012-04-23T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e8%ae%b0%e6%b1%9f%e8%8b%8f%e4%b9%8b%e8%a1%8c%ef%bc%88%e4%ba%8c%ef%bc%89</id>
   <content type="html">从五点半一直捡到七点半，这时天色已经完完全全黑了下来，我还有一段路没有捡完，但是实在是没法继续下来，我提着桶开始往回走。然后在农家乐住了一晚，第二天又赶去了兴化市区，做大巴去了泰州。

去泰州，是因为我想在泰州逛逛之后直接做下午三点半从泰州到上海的大巴回去

是的，我逛了逛泰州老街，太水了，天气热的很，感觉没啥好看，商业化太浓了。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960562030/&quot; title=&quot;IMG_0936 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm9.staticflickr.com/8141/6960562030_bac9a40250_z.jpg&quot; width=&quot;480&quot; height=&quot;640&quot; alt=&quot;IMG_0936&quot;&gt;&lt;/a&gt;
于是我去了坡子街，买了双鞋子，因为之前的鞋子因为前一天在菜花里走来走去走得已经不成样了，确实也穿了好久了，平时也没什么时间去买什么鞋子，上海人太多了，压马路这种事太嘈杂了。结果逛来逛去买了一双2B的红黑配的鞋子，不过看起来还蛮有质感，红黑配这种色调我一直很喜欢，依稀记得大二时的实习我做了一个以红黑配色为主题的网站，结果被人说成了黄网，人家说黄网都是这种色调搭配的，其实我内心还是很纯洁的，根本没想那去。

玩的是蛮high。

但是。。。。。。

我在去泰州的路上上微博，突然看到新闻说上午十一点有一辆从扬州到上海的旅游团的大巴在沿江高速上因为爆胎穿过了防护墙跟对面的大货车迎面相撞，结果造成了几人死亡和几人重伤的事故。看到微博上得配图，非常惨，我顿时感觉后背一股凉气。刚才几分钟前还是活生生的高高兴兴的人们，下一秒却是阴阳相隔，而这个事故离我在的地方（我在泰州）也不是很远，那么近距离虽然不是几米而是上百公里，依然觉得非常震撼。 我也是旅游出来周末放松，或许他们也应该是的，而且应该是看完牡丹花蛮开心的返回上海，我也是刚刚看完油菜花也是蛮开心的正在返回途中，以前新闻上看到也不会特别留意没太多触动，但是这件事情跟我的情况是那么相似，我几乎能感受和他们出事前一样的感觉，生命何其珍贵，每个人的生命都只有一次，这些深深触动了我。想起之前我还对周一可能有可能要处理棘手的技术问题而有点烦，但是现在我觉得这都不是问题。


我决定改道，从泰州去了无锡。在路上，我还在想着拿起事故，也想起了乔布斯之前在斯坦福的毕业典礼上得演讲，生命留给我们的时间是那么宝贵，如果我们不听从内心的选择，做自己想做的事情，或许当你突然离世，你也许真的什么也没有给这个世界留下。




&lt;blockquote&gt; ”活着就是为了改变世界“。 &lt;/blockquote&gt;



我还很年轻，也许我的经历还是很嫩的，但是我觉得是的，人是应该在适当时候停下来，仔细想想到底自己喜欢这份工作吗，还有当初的那份激情吗？ 如果当你觉得回答不了自己，也许就是应该做出选择的时候了。我之前做的是互联网领域，技术做的还不错，但是到了一定时间，我觉得我已经找不到当初进公司的那份激情了，激情对于我有多重要？ 我想起了，当初刚进大一时第一次上思想政治课，老师要同学上去讲人生观，我当时上去直接说”生活就是要有激情啊“，看起来当时还满拽的。我认为这个激情就是做自己喜欢做的事情。



&lt;blockquote&gt;You've got to find what you love.   --steve jobs&lt;/blockquote&gt;



更重要的是：只要你想好了，年轻没有什么是不可以损失的，不要思前顾后太久太多。

我一哥们最近打算换工作，咨询我的意见，我说你如果自己现在不喜欢自己的工作，只是把他当成养活自己的工作，我觉得你看准了自己想干什么，直接去就好了，不管它大或小。你现在想最坏的情形是什么，即使三个月后你失业了，但是这个三个月的经历，有了激情的浇灌，再重新找工作或许还有更好更合适你的工作了。没什么可损失的嘛，看好了，就直接去试。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960565432/&quot; title=&quot;IMG_0945 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7266/6960565432_5947e37546_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0945&quot;&gt;&lt;/a&gt;

话说回来，去了一趟无锡，去了一趟了惠山老街。很安静，无锡给我的感觉是就是绿色，旁边好多树啊，感觉非常不错，:-( ， 可伶的DJN童鞋的合肥啊....
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960564592/&quot; title=&quot;IMG_0941 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7132/6960564592_5220eaa4ae_z.jpg&quot; width=&quot;480&quot; height=&quot;640&quot; alt=&quot;IMG_0941&quot;&gt;&lt;/a&gt;

&lt;strong&gt;做自己想做的事情，顾及别人的感受（不自私），不去理会别人的眼光和评论，坚持自己内心的选择。&lt;/strong&gt;

</content>
 </entry>
 
 <entry>
   <title>记江苏之行（一）</title>
   <link href="http://tuo.github.com16.html"/>
   <updated>2012-04-23T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e8%ae%b0%e6%b1%9f%e8%8b%8f%e4%b9%8b%e8%a1%8c%ef%bc%88%e4%b8%80%ef%bc%89</id>
   <content type="html">上个周末去了江苏一趟，这一趟确实是非常值得的。

距离这一次出行，我有大概接近一个月没有出去转转了，一直忙于很多事情，也确实让我感觉有点疲惫，于是趁着这个五一来之前，赶到非常热而且人多的五一之前，我决定出去一趟（后来证明我的决策是非常英明的，兴化撑船的大妈说上周几万人，连车都开不进来，这周明显人少了好多，到了下一周或者五一了，最佳看花的时间也就过了）。

本来我的想法是去嘉兴西塘的，然后准备在那住一晚上，但是我定的太晚了，所以没有任何的客栈有床铺了。刚刚好，也是看到了林逸欣的微博，想起来她原来当过旅游的外景主持，又看到了她在江苏的片段里面刚刚好讲到兴化剁田的万亩油菜花，而且油菜花在四月份看是最合适的，到了五月份花就开始了凋落了，而且五一人超多超热。所以我下定决心去兴化。

周五晚上坐动车去了镇江，等我下车时已经是晚上快10点了，而且下面下着瓢泼大雨，我打车来到了镇江的西津渡历史古街。整个古街都在淅淅沥沥的雨中显得非常朦胧，而且整个街上空无一人，这可是梦寐以求的画面，没有喧嚣，我一个人撑着伞瞎逛着，其实也蛮慎得慌的。刚好看到一家酒吧，于是我赶紧进去，要了瓶啤酒，喝着啤酒，听着风雨声，感觉卸下了所有的包袱和疲惫。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960064448/&quot; title=&quot;IMG_0783 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7107/6960064448_cc206542fd_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0783&quot;&gt;&lt;/a&gt;
第二天一大早，根据我的计划，是一大早又逛了逛西津渡古街，因为晚上太黑了，没怎么看清楚。早上很安静，雨也停了，我走在街上，慢慢悠悠的很快就逛完了，因为街实在是很短。

看了一个什么镇江英使馆的建筑，还有点意思，刚好旁边有一个镇江博物馆，顺手过去看了看。但是进去之后发现太令我失望了，整个博物馆喧嚣声一片，很多孩子在跑来跑去大声喧哗，家长则在旁边自己聊自己的，感觉已经把这当成了小学了。我跟保安说了一下，让他找老师说一下让他们安静一些，基本的公德也该是有教的吧，结果根本连老师也找不着。我看了看，实在是太吵了，没法看，也就走了去汽车站赶从镇江到兴化的班车。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960063976/&quot; title=&quot;IMG_0792 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7089/6960063976_b696633437_z.jpg&quot; width=&quot;480&quot; height=&quot;640&quot; alt=&quot;IMG_0792&quot;&gt;&lt;/a&gt;
镇江给我的感觉是非常安静节奏缓慢的一座城市，不错。

做从镇江到兴化的班车有了将近三个小时，终于在下午两点到了兴化市区，一路上给我的感觉就是水多树多花多，江苏真是好地方啊。到了兴化市区，急急忙忙赶着从兴化去缸顾乡的班车，因为兴化剁田其实不在市区，而且在离市区比较远的村子里。

到了下午四点，终于了到了缸顾乡的千岛菜田。一下车，放眼望去一片黄片的情景，真是蔚为壮观。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960073478/&quot; title=&quot;IMG_0928 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm9.staticflickr.com/8144/6960073478_9325faefb4_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0928&quot;&gt;&lt;/a&gt;
其实油菜花，还是很常见的，不管南北哪都有，我家里的镇子上也有，只不过是零零散散的种着，很少有大片大片连起来的。小时候，比较喜欢去油菜花田里捉蜜蜂，两只手各拿一张纸，然后看到油菜花上的蜜蜂，悄悄的靠上去，突然一下子把两个手掌合起来，就抓住了，屡试不爽。油菜花吃起来也有讲究，一般会把花去掉，但是油菜花茎秆顶部部分，吃起来比较苦，这个我是深有感受的。我跟我妈说我去看油菜花了，我妈说不就油菜花嘛，这有啥好看的，家里一大片不？ 其实我或因读书或因工作的缘故，几乎没有在四月份是在家的，油菜花的近距离接触已经好久没有过了，也是一种回味童年吧。

&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7106140747/&quot; title=&quot;IMG_0878 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm9.staticflickr.com/8151/7106140747_80465900b3_z.jpg&quot; width=&quot;480&quot; height=&quot;640&quot; alt=&quot;IMG_0878&quot;&gt;&lt;/a&gt;
下了车，我就迫不及待的检了票，然后去看菜花落。站上高台，放眼望去，整个充斥在眼中的全部都是黄油油的菜花，这是万亩连延不绝的菜花啊，感觉真是被震撼到了，非常漂亮的景色。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960070436/&quot; title=&quot;IMG_0926 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm9.staticflickr.com/8153/6960070436_ede13f66e9_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0926&quot;&gt;&lt;/a&gt;
整个黄色的世界，被青色的河水分成了一个个小方块，看起来好像“井/田”字。当然坐上小船，欣赏着两岸的菜花必然是必不可少的项目啦。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7106556651/&quot; title=&quot;IMG_0853 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm9.staticflickr.com/8008/7106556651_c524ce5551_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0853&quot;&gt;&lt;/a&gt;
黄油油的菜花中有一条小道供游人行走参观，顺着这条小道，仔细品味着两旁近在咫尺的菜花的香味，感觉非常奇妙。

其实这条小道不算很长，花了没多长时间，我就已经逛完了。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7106585077/&quot; title=&quot;IMG_0875 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm9.staticflickr.com/8142/7106585077_1a82f271b4_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0875&quot;&gt;&lt;/a&gt;
但是走在菜花包围的小道上，虽然两旁景色迷人，但是还是有很多很刹风景的地方：垃圾。道旁边两旁，到处到游人随意丢弃的冰淇淋盒子塑料袋子卫生纸矿泉水瓶等等，非常非常的刺眼和让人不舒服。当第一次走时，我还悄悄的捡起了一两个瓶子，然后给扔到了垃圾桶了。一边走，一边内心在想：“或许应该做些什么，也许我可以就这么走了，但是这一片风景在以后也会很快忘记；因为你没有真正融入它，你没有参与感，你得到的感觉或许不是最纯真的最原始的‘。一个奇怪的想法一直在心里盘旋着，我一直内心在激烈斗争着。
当我走回第一次路线的起点时，我看到旁边的警务台旁边有一个红色的塑料桶，我想到这可以是我可以用到的。这个时候天色开始变黑了，而且人慢慢变少了，我内心的斗争也稍微平复了。内心的斗争源自于我是一个人，我还是很怕周遭人的看法，我表示我虽然我有时候比较特立独行，但是无可否认我还是比较留意别人的看法的，任何人都是这样的。这个时候人少了一点点，我想到了如果别人问起我，我可以假意说我是挂名在景区做义工的；如果别人拿很怪异的眼神看我，我就故作镇定一定的装的很像一个真的。然后我迈出了第一步，我把卫衣的帽子翻了下来，盖在头上，在两旁弯着腰一路上捡着垃圾，真是什么垃圾都有，而且有些扔的非常隐蔽，我都不知道他们如何扔进去的，那得是练到了一定功力的“修养”极高才行，轻轻一抛，确是恰当好处，别人还真是难以看到。捡了一阵子，碰到游人，有得会说你是志愿者吗，我木有看他/她，我虚了，我说“是”；其实我在想“沃勒个去，我还能咋回答，我说我是冒牌的志愿者？”。一开始有些拘谨，看到别人怪异的眼神总觉得别人眼神好像在说“装B男”，是的，换做我，第一感觉必然是我也会这么看自己。但是有时候在想，我们看到一些人有些独特的地方或者干了一些别人没有勇气干出来的事情时，我们习惯打击他/她这种“独特”，因为我们无法承认我们自己是没有“特色”的，所以我们想把他拉下来到我们这个等级来，好维持我们仅有的自尊和自信。而缺少特点的人，缺少勇气干自己想干事情的人，缺少勇气听从自己内心深处呼呼的人，在现在的社会中太多了。而一个理想的社会是鼓励每个人的特殊，应为这是他在这个社会无法被替代的唯一性，他得价值。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960071180/&quot; title=&quot;IMG_0912 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7138/6960071180_b550ebba57_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0912&quot;&gt;&lt;/a&gt;
慢慢的，我在垃圾中忙碌开来，已经完全投入了，看到对面来的游人之类的，我都根本没有任何当初的拘谨和面子感，如果我带了一个红色的有义工标志的什么袖子，会让我感觉很体面点，更多是因为我觉得是冒牌的。哪有穿成这样，背着一个书包，当义工检垃圾的，我觉得我给他们丢脸了。捡了好一阵子，大概四分之一吧，累的不行，腰的提不起来，想我打篮球也算是腰力不错的了，各种滞空，哈哈，但是那个时候也是感觉不行了，于是我停下来，握住一把油菜花，把脸贴过去，狠狠吸了一把它的香味，感觉立马又有活力的感觉，而且这个时候路上几乎没有游人，天色也黑了不少，但是还是有点残晖，这个田野感觉顿时安静了下来，天地万物，万籁俱静，整个黄油油的一片包围着着我，放佛要将我吞噬，我顿时感觉这才是我真的追寻的那种似曾相识的感觉，那种安静和那种感觉真像我当年初中时下大雨我把雨衣给住的比我远多的童鞋后我一个人骑着单车在瓢泼大雨中享受着淋透逛哮的感觉，一种透彻心扉美好和原始的纯真。相比起第二天能有看花时可能能有更好感觉的游人们和我的初中童鞋，我觉得我收获的快乐和幸福比他们都要多得多。我开始明白消防战士的感觉，当你看到你抢救出来的财产或者人们，因为你看到因为你的存在，别人的生命能继续或者生活状态能有改变，你的内心会告诉你做了正确的事情，任何你经历的痛苦都会被巨大的幸福感吞噬，你内心的幸福感已经远远大于任何物质诉求，虽然这份工作很危险工资也不高。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960072456/&quot; title=&quot;IMG_0916 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7239/6960072456_76aa6f8caf_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0916&quot;&gt;&lt;/a&gt;
这却是一份意外的与心灵的对话。

&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6960066060/&quot; title=&quot;IMG_0874 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7200/6960066060_e792093d59_z.jpg&quot; width=&quot;480&quot; height=&quot;640&quot; alt=&quot;IMG_0874&quot;&gt;&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>合肥之行</title>
   <link href="http://tuo.github.com15.html"/>
   <updated>2012-04-14T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%90%88%e8%82%a5%e4%b9%8b%e8%a1%8c</id>
   <content type="html"> &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;距离上次去合肥也有两三周了，今天突然想起来可以记一笔流水账。
 想去合肥，是因为我之前读过梁启超的《李鸿章传》，里面详细描述他的生平主要是加入湘军曾国藩手下开始一步一步做到开创淮军，打败太平天国，直至真正入阁参与了洋务运动以及各种谈判。
 更重要的是张辽是我在三国中非常喜欢的人物，当年在逍遥津八百人打败孙权十万人，至今想想都是热血沸腾。
 在此之前，我对李鸿章的印象依然提留在初高中的课本上面，总觉得他是一个“卖国贼”非常懦弱的人。
 于是，做为一个2B青年，有时候为了美化自己也时常文艺一下。
 去过杭州，主要目的除了见同学之外，是想去拜访于谦，也顺便看了看龚自珍的故居。
 所以，去某个城市逛逛之前，我都会特别留意一些有人文特色的地方。
 
 
 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;h2&gt;合肥之行 March 2012&lt;/h2&gt;
 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 非常不错的是，一路上都有美女相伴，因为我大学童鞋的高中女童鞋刚刚好在安徽大学读研，于是我就麻烦她当我的导游了。
 安徽大学：
   &lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7076574565/&quot; title=&quot;IMG_0647 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm6.staticflickr.com/5335/7076574565_1709776380_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0647&quot;&gt;&lt;/a&gt; 

 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;h3&gt;第一站：三河古镇&lt;/h3&gt;
 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;  周六上午去了这个三河古镇，其实谈不上古镇，因为咋们都清楚哪有古镇啊，只不过近几年翻新而已；而我非不太欢喜大城市的喧嚣，我比较喜欢安静的地方，至少人少点的地方。
三河镇离合肥有点远吧，坐车也做了将近一个多小时才到。
  &lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6930498676/&quot; title=&quot;IMG_0649 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7260/6930498676_8c16bf6d1f_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0649&quot;&gt;&lt;/a&gt;
看起来还蛮安静的，整个镇子其实也就是一条河穿过，非常短。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7076577085/&quot; title=&quot;IMG_0651 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7097/7076577085_8286a2291b_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0651&quot;&gt;&lt;/a&gt;
 尝试了一下这边的米酒，还不错。
 &lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7076578301/&quot; title=&quot;IMG_0657 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7077/7076578301_6c0bd404ee_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0657&quot;&gt;&lt;/a&gt;
 然后就是来到了一个清代风格的小楼：
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7076619479/&quot; title=&quot;IMG_0685 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm6.staticflickr.com/5327/7076619479_7c0d8a4227_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0685&quot;&gt;&lt;/a&gt;
手贱的不断想拍出七彩：
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7076623053/&quot; title=&quot;IMG_0689 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7118/7076623053_c14c6b9799_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0689&quot;&gt;&lt;/a&gt;
然后就是玩啦，围着小镇转，非常不错的阳光，春天。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6930921404/&quot; title=&quot;照片 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm6.staticflickr.com/5324/6930921404_7cd534fa2b.jpg&quot; width=&quot;357&quot; height=&quot;366&quot; alt=&quot;照片&quot;&gt;&lt;/a&gt;
DJN童鞋你太高了。。。。。。。

 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;h3&gt;第二站:李府&lt;/h3&gt;
 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 下午匆匆从三河镇坐车回来，然后去了李鸿章府，是的， 我想不通的是李府居然在合肥最繁华的步行街，意味这我也加入了压马路的大军，
然后破解一切障碍，终于在一个不起眼的而且在一群现代化建筑中显得非常炸眼的古门牌地方找到了。
 &lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6930547594/&quot; title=&quot;IMG_0708 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7249/6930547594_86a38a8566_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0708&quot;&gt;&lt;/a&gt;
 话说其实也没啥好看的，只不过来缅怀一下。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7076628905/&quot; title=&quot;IMG_0714 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7198/7076628905_2e13854165_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0714&quot;&gt;&lt;/a&gt;

 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;h3&gt;逍遥公园&lt;/h3&gt;
 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;这本是我这次来合肥最大的一个目的之一，我想见见张辽当年大战的古战场,结果一进去公园，一开始就是什么各种儿童乐园，各种嘈杂，我这是吐槽了。
然后好不容易来到张辽的衣冠冢（谁知道了），结果牌子也没看到，就是光秃秃的一个坟头，旁边写着“请不用登上坟头各种践踏”，我当时就崩溃了。
好吧，来公园真是失败。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7076630745/&quot; title=&quot;IMG_0724 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7231/7076630745_fa3e8591f1_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0724&quot;&gt;&lt;/a&gt;

 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;h3&gt;庐州太太&lt;/h3&gt;
 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;  DJN童鞋说她作为东道主，然后有童鞋来合肥，吃的了，一定得去庐州太太，比较有合肥的特色。悲情的是，当我们如同《功夫足球》中周星驰在风沙漫天的足球场匍匐着像战士一样似的穿过合肥一条灰尘漫天的路，来到了庐州太太面前。
结果人爆满，我俩来了一个号，居然是90几，然后我两在旁边坐着玩手机，大概半个小时过去，依旧还是四十几号，吐槽了。然后我们就去旁边的一家XXX餐馆，吃了个牛蛙（这牛蛙真可伶，类似韩寒写的差不多，我们都是牛蛙，上面在闹的都是特权阶级的事情）。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6930554818/&quot; title=&quot;IMG_0727 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm6.staticflickr.com/5079/6930554818_ca24215948_z.jpg&quot; width=&quot;640&quot; height=&quot;480&quot; alt=&quot;IMG_0727&quot;&gt;&lt;/a&gt;
然后吃完差不多就是送DJN童鞋回安大了，怎么说这点绅士风度还是应该有的，特别是晚上。


 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;h3&gt;包公祠&lt;/h3&gt;
 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;如果这次中最坑爹的就是这个包公祠，简直就是坑爹爹爹。。。。。。。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6930589492/&quot; title=&quot;IMG_0734 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7222/6930589492_8c03e4abe0_z.jpg&quot; width=&quot;480&quot; height=&quot;640&quot; alt=&quot;IMG_0734&quot;&gt;&lt;/a&gt;
我不想说了。，。。。。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7076668895/&quot; title=&quot;IMG_0736 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7259/7076668895_3a8bfa3540_z.jpg&quot; width=&quot;480&quot; height=&quot;640&quot; alt=&quot;IMG_0736&quot;&gt;&lt;/a&gt;
真是看不到多少真的古迹了，完完全全就是一个仿造。吐槽！！！！ 伤不起，文艺青年！

 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;h3&gt;庐州太太&lt;/h3&gt;
是的，从包公祠回来，又去了昨晚的泸州太太，终于人品爆发，等上了。
这鱼真是超赞。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7076669933/&quot; title=&quot;IMG_0743 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7239/7076669933_7c3a245e87_z.jpg&quot; width=&quot;480&quot; height=&quot;640&quot; alt=&quot;IMG_0743&quot;&gt;&lt;/a&gt;

 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;h3&gt;晚秋&lt;/h3&gt;
 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;吃晚饭，去电影院看了晚秋，太坑爹了,&lt;strong&gt;有木有&lt;/strong&gt;。 我这种文艺青年表示看不懂，整片有点抑郁。 

 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;h3&gt;回程&lt;/h3&gt;


 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;整个过程，非常感谢DJN的陪同和导游，非常有亲和力，也是有点文艺范。。。。。
 &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;赞，你！
 
 
 
 
</content>
 </entry>
 
 <entry>
   <title>problem with adding custom font in Xcode 4.3.2</title>
   <link href="http://tuo.github.com/problem-with-adding-custom-font-in-xcode-4-3-2"/>
   <updated>2012-04-13T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/problem-with-adding-custom-font-in-xcode-4-3-2</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Well, I guess John Muchow's blog &lt;a href=&quot;http://iphonedevelopertips.com/user-interface/load-and-access-custom-fonts.html&quot; target=&quot;_blank&quot;&gt;Load and Access Custom Fonts&quot; &lt;/a&gt; pretty much said everything about adding custom font before xcode 4.3.2. Before Xcode 4.3.2, when you add custom font, you need to make sure name of font you use in following code snippet:

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;objectivec&quot;&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;label2&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;setFont:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UIFont&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;fontWithName:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;@&amp;quot;BlackBoard&amp;quot;&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;size:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;


&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;Where is my font ?&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;the &quot;BlarkBoard&quot; is the real name when you install it on mac. So the file name you just add to Resource and plist file , like &quot;BlackBoard.ttf&quot; is always the same the name of font that installed on mac.So you need to open that font file in FontBook, and write the name showing up down, like &quot;Black BoardSb&quot;.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Then when you want to refer to font in the code:
&lt;pre lang=&quot;c&quot;&gt;[label2 setFont: [UIFont fontWithName: @&quot;Black BoardSb&quot; size:18]];&lt;/pre&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;That is so important and it is always easy to forget about. Actually there is one way to debug it when the fonts doesn't show up as you expected by using:
&lt;pre lang=&quot;c&quot;&gt;NSLog(@&quot;Available fonts: %@&quot;, [UIFont familyNames]);&lt;/pre&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;So far, all is good. 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;But if you use Xcode 4.3.2......&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;But if you use Xcode 4.3.2, although you are very sure that every steps above are done properly, you still can't find the font you expected in
the log message of [UIFont familyNames].
Here is the reason:
&lt;em&gt;&lt;strong&gt;          You have to go to &quot;Copy Bundle Resources&quot; in &quot;Build Phases&quot; of your project, and add font file to that list.&lt;/strong&gt;&lt;/em&gt;


&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6927232622/&quot; title=&quot;Screen Shot 2012-04-13 at 6.24.59 PM by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm6.staticflickr.com/5197/6927232622_a5fefae380_z.jpg&quot; width=&quot;640&quot; height=&quot;114&quot; alt=&quot;Screen Shot 2012-04-13 at 6.24.59 PM&quot;&gt;&lt;/a&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Then run the project. Bang! It works now.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;I've no freaking idea what's going on.It seems there is a bug relating to custom font in Xcode 4.3.2.

</content>
 </entry>
 
 <entry>
   <title>IOS使用CAReplicatorLayer重建动态的倒影</title>
   <link href="http://tuo.github.com14.html"/>
   <updated>2012-03-31T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./ios%e4%bd%bf%e7%94%a8careplicatorlayer%e9%87%8d%e5%bb%ba%e5%8a%a8%e6%80%81%e7%9a%84%e5%80%92%e5%bd%b1</id>
   <content type="html">最近在看ios中关于core animation的一些东西,其中就有一个是任何创建倒影。 创建倒影应该是蛮常见的吧，比如你打开iphone中的音乐，这个时候如果你将你的手机横过来，就可以看到这个cover flow的效果了。仔细看的话，你会发现这个每张专辑图片下都有一个倒影。是的，这便是这篇文章的主题。我们会先讲一个普通且常见的创建倒影的方式，然后讲一讲它的缺点，最后讲讲新重建倒影的方式。
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/7031916839/&quot; title=&quot;coverflow by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7247/7031916839_273185ae61.jpg&quot; width=&quot;500&quot; height=&quot;333&quot; alt=&quot;coverflow&quot;&gt;&lt;/a&gt;
常见创建倒影的方式：
&lt;ol&gt;
	&lt;li&gt;   创建一个origin layer，然后将图片设置为它的contents&lt;/li&gt;
	&lt;li&gt;   重建一个跟origin layer大小一致的reflection layer,将origin layer赋值给reflection layer,并且将其位置定位到origin layer的下面&lt;/li&gt;
	&lt;li&gt;   如果可以，你可以设置一个什么半透明效果layer(optional) 让倒影看起来有点朦胧的感觉&lt;/li&gt;
	&lt;li&gt;   创建一个origin layer的mask,并且是一个带有gradient渐变效果的层，而且它的高度只有图片高度的一半&lt;/li&gt;
	&lt;li&gt;  将reflection layer加入到origin layer的sublayers中&lt;/li&gt;
&lt;/ol&gt;
直接上code snippet:
&lt;pre lang=&quot;c&quot;&gt;- (void)createReflection {

[self.view setBackgroundColor:[UIColor whiteColor]];
CALayer *contentLayer = [CALayer layer];
UIImage *flag = [UIImage imageNamed:@&quot;chuck-norris.png&quot;];
contentLayer.bounds = CGRectMake(0, 0, flag.size.width, flag.size.height);
contentLayer.contents = (id)flag.CGImage;
contentLayer.position = CGPointMake(self.view.center.x, 10);
contentLayer.anchorPoint = CGPointMake(0.5, 0);
contentLayer.backgroundColor = [UIColor blueColor].CGColor;
contentLayer.cornerRadius = 4.0;

CALayer *reflection = [CALayer layer];
reflection.bounds = contentLayer.bounds;
reflection.position = CGPointMake(contentLayer.bounds.size.width/2, contentLayer.bounds.size.height * 1.5);
reflection.contents = contentLayer.contents;
reflection.transform = CATransform3DMakeRotation(M_PI, 1, 0, 0);

CALayer *blackLayer = [CALayer layer];
blackLayer.backgroundColor = [UIColor blackColor].CGColor;
blackLayer.bounds = reflection.bounds;
blackLayer.position = CGPointMake(blackLayer.bounds.size.width/2, blackLayer.bounds.size.height/2);
blackLayer.opacity = 0.6;
[reflection addSublayer:blackLayer];

CAGradientLayer *mask = [CAGradientLayer layer];
mask.bounds = CGRectMake(0, 0, reflection.bounds.size.width, reflection.bounds.size.height /2 );
mask.position = CGPointMake(mask.bounds.size.width/2, mask.bounds.size.height);
mask.anchorPoint = CGPointMake(0.5, 0);
mask.colors = [NSArray arrayWithObjects:
(id)[UIColor clearColor].CGColor,
(id)[UIColor whiteColor].CGColor, nil
];

reflection.mask = mask;

[contentLayer addSublayer:reflection];

[self.view.layer addSublayer:contentLayer];
}&lt;/pre&gt;
代码看起来还是蛮直观的， 但是这里有几个重要的基本概念得弄清楚。

第一个坐标系(Geometry)：
&lt;pre lang=&quot;c&quot;&gt;CALayer *contentLayer = [CALayer layer];
UIImage *flag = [UIImage imageNamed:@&quot;chuck-norris.png&quot;];
contentLayer.bounds = CGRectMake(0, 0, flag.size.width, flag.size.height);
contentLayer.contents = (id)flag.CGImage;
contentLayer.position = CGPointMake(self.view.center.x, 10);
contentLayer.anchorPoint = CGPointMake(0.5, 0);
contentLayer.backgroundColor = [UIColor blueColor].CGColor;
contentLayer.cornerRadius = 4.0;&lt;/pre&gt;
这一段代码很简单就是将contentLayer定位到屏幕水平中间，竖直方向离顶端10个point的地方，然后设置了它的背景颜色和圆角效果（如果要对image做复杂的圆角处理，参考WWDC 2011 Practical Drawing中Bezier Path Drawing). 但是这里却体现core animation中看似最简单实际比较复杂的部分: Geometry. 它有几个常常出现的关键字: position, bounds, anchorpoint, 基本上它们是结对出现的。

如果你看过apple的developer documentation中关于&quot;&lt;a href=&quot;https://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CoreAnimation_guide/Articles/Layers.html &quot;&gt;Layer Geometry and Transforms&lt;/a&gt;“ 以为自己懂了，然后一看到实际代码却晕了的人，可以看看接下来这段解释。 ios的坐标系是这样: x轴往右是正，y轴往下是正。这根一般的坐标系不太一样。

bounds 很简单，它有origin 和size两个部分组成。 由于bounds是针对自己所在的layer,所以它的origin没有啥可以参考的。 所以设置bounds基本上主要目的是设置它的高度和宽度。 而position不一样，它是针对super layer而言的， 这一点跟frame一样。 而AnchorPoint却跟bounds和position又不一样，它是相对于bounds和position的比例而言，所以它是小数的方式表示。如果没有显示指明anchorpoint的值，默认是(0.5,0.5)；如果没有显示指明position的值,它的值是(0,0)。
&lt;a title=&quot;Screen Shot 2012-03-31 at 8.16.06 PM by Tuo Huang, on Flickr&quot; href=&quot;http://www.flickr.com/photos/54952827@N02/6885815358/&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7246/6885815358_509becca41.jpg&quot; alt=&quot;Screen Shot 2012-03-31 at 8.16.06 PM&quot; width=&quot;313&quot; height=&quot;168&quot; /&gt;&lt;/a&gt;
这一段描述还是过于抽象，这样从上面的例子来说吧。我们先设置bounds，那就是contentLayer的长和高。 然后设置它的position，它是在水平的中间和竖直方向的顶部。假图片的长高是200. 那么这里如果不设置anchorPoint的值，那么它默认是(0.5,0,5) ，那么你会看到图片前（200 - 100 - 10 = 90） 90像素超出了整个屏幕。因为它（0.5,0.5)定义了postion将是在bounds横轴宽的中间位置和数轴的中间位置。 如果我们想让图片在10像素时才开始显示，其实也是想让数轴上的position刚刚也是bounds的origin y轴起点，由于y轴往下是正，所以我们就是将anchorpoint设置为(0.5,0) .

&amp;nbsp;

那你再看如果设置mask层时，可能就相对容易了。我们先设置它的长高，长度是一样的，但是高度就只有一半了。然后接下来需要注意了：

&lt;em&gt;mask.position = CGPointMake(mask.bounds.size.width/2, mask.bounds.size.height);&lt;/em&gt;

你需要注意到position并不是CGPointMake(mask.bounds.size.width/2, 0),  因为我们需要做倒影，所以在

&lt;em&gt;reflection.transform = CATransform3DMakeRotation(M_PI, 1, 0, 0);&lt;/em&gt;

调用了CATrasnform3D来对空间做出调整。这里我们绕着x轴，顺时针旋转了180度，所以整个reflection层都倒过来了。但是它是按照哪个点进行旋转了,虽然我们知道它是按照x轴旋转的？ 所以这里的anchorpoint就是重要的，它作为任何改变层的geometry的轴心点。我们知道如果我们不指定anchorpoint，它默认是(0.5,0,5)就是在层的正中间。 所以图片才会正确的翻过来。但是因为这种transform赋值是会应用到所有的sublayer 包括自己的。 所以此时reflection包括所以它的子层的坐标系发了改变，y轴已经倒了过来，现在是指向了上面。试想一下，x轴不懂，顺时针转180度，此时是不是y轴就刚好倒了它的反面。所这正是mask的position.y 是mask.bounds.size.height而非0的原因。
&lt;a title=&quot;Screen Shot 2012-03-31 at 7.42.00 PM by Tuo Huang, on Flickr&quot; href=&quot;http://www.flickr.com/photos/54952827@N02/7031912077/&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7263/7031912077_d3567c53d0.jpg&quot; alt=&quot;Screen Shot 2012-03-31 at 7.42.00 PM&quot; width=&quot;338&quot; height=&quot;330&quot; /&gt;&lt;/a&gt;
所以这个代码还行，但是它有些缺点，其中最重要的是它是静态的。

&amp;nbsp;

假设我们此时我们现在在contentLayer上了加了一个文字层， 我现在想我点击这个文字增加一个animation动画,在contentlayer上上下活动，然后我想这个倒影层始终保持更新同步（文字也在倒影层中移动）？  这个该怎么做了?

所以这是当前做法的局限性，本质上，它是静态的，而且相比接下来的做法，它的性能也大大不如。

&amp;nbsp;
&lt;h2&gt;具有动态更新能力的CARepliatorLayer&lt;/h2&gt;
如果有看过&lt;a href=&quot;https://developer.apple.com/videos/wwdc/2011/&quot; target=&quot;_blank&quot;&gt;wwdc 2011&lt;/a&gt;中Session 421 Core Animation Essentials，你可能记得作者简要的描述了一下CAReplicatorLayer的原理，但是可能没有太实际的感受。所以私底下，我找了找，找到了一位大牛&lt;a href=&quot;http://briancoyner.github.com/&quot;&gt;Brian M. Coyner&lt;/a&gt;的&lt;a href=&quot;https://github.com/briancoyner/Core-Animation-Fun-House&quot;&gt;Core Animation Fun House&lt;/a&gt; ，这种就有一个关于如何使用CAReplicatorLayer作倒影的例子。虽然看起来很简单，但还是涉及到一些关于core animation很基础很重要的概念。有感兴趣的可以checkout他的项目，然后仔细看看.
&lt;a title=&quot;Screen Shot 2012-03-31 at 8.42.53 PM by Tuo Huang, on Flickr&quot; href=&quot;http://www.flickr.com/photos/54952827@N02/7031912549/&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7108/7031912549_f4db92db27.jpg&quot; alt=&quot;Screen Shot 2012-03-31 at 8.42.53 PM&quot; width=&quot;274&quot; height=&quot;345&quot; /&gt;&lt;/a&gt;

首先神马是CAReplicatorLayer:
&lt;blockquote&gt;The CAReplicatorLayer class creates a specified number of copies of its sublayers (the source layer), each copy potentially having geometric, temporal and color transformations applied to it.&lt;/blockquote&gt;
简要的说，它自己能够重建包括自己在内的n个copies，这些copies是原layer中的所有sublayers，并且任何对原layer的sublayers设置的transform是可以积累的(accumulative).

基本上这样的一个关系：我们首先会重建一个CAReplicatorLayer实例，作为我们的sourceLayer, 这个sourceLayer我们需要一份copy，那包括自己在内就是2; 所以我们设置了它的instantCount = 2;这个是包括自己在内总共为2. 然后我们将SourceLayer的宽度设置为image的宽度，但是将其高度设置为image.size.height * 1.5； 并且在sourcelayer上加上masksToBounds为true的属性，这样一来我们可以保证超出的倒影部分会cut调一半，加上sourceLayer上正常的image，刚刚好组成了我们的完整的倒影。我们sourceLayer的sublayer就是_imageLayer,。但是我们只是单纯设置instantCount = 2的话， 那个_imageReplicatorLayer(这个就指代的是copy过来的第一个变量）是会继承sourceLayers中_imagelayer的Geometry,所以它两是重合的。那么我们必须做出transform, CARepliatorLayer有一个属性叫做instantTransform，这个属性指定了除了原来copy之外所有replication layer的trasnform规则，重要的是它是递增的。比如我们这里需要将imageReplicatorLayer应该往下移动image的高度，这一样来可以保证它是刚刚好在原来imagelayer的正下方，就跟倒影一样。 但是不一样的地方是：这个复制的imageReplicatorLayer它不是正常的，它是需要倒过来的，所以我们在transform上使用了

&lt;em&gt;transform = CATransform3DScale(transform, 1.0, -1.0, 1.0);&lt;/em&gt;

这一个的意思是大小不变，但是y轴倒过来，这个应用到imageReplicatorLayer的坐标系是y轴朝上。

这样以来你就不能单纯是向原来一样移动image.height了， 因为y轴反了过来，所以你应该是 -2 * image.size.height 这样以来就搞定了。

最后我们给它加了一个渐变层，让它看起来更接近倒影的感觉。
&lt;pre lang=&quot;c&quot;&gt;[self.view setBackgroundColor:[UIColor whiteColor]];
[[self view] layer].borderColor = [UIColor blueColor].CGColor;
[[self view] layer].borderWidth = 2;

CAReplicatorLayer *layer = [CAReplicatorLayer layer];
[layer setContentsScale:[[UIScreen mainScreen] scale] ];

[layer setBounds:CGRectMake(0, 0, image.size.width, image.size.height * 1.5)];
layer.masksToBounds =  YES;
layer.anchorPoint = CGPointMake(0.5, 0.0);
layer.position = CGPointMake(self.view.frame.size.width/2, 10.0);
layer.borderColor = [UIColor redColor].CGColor;
layer.borderWidth = 0;

layer.instanceCount = 2;

CATransform3D transform = CATransform3DIdentity;

transform = CATransform3DScale(transform, 1.0, -1.0, 1.0);
transform = CATransform3DTranslate(transform, 0, -[image size].height * 2, 1.0);

layer.instanceTransform = transform;

_imageLayer = [CALayer layer];
[_imageLayer setContentsScale:[[UIScreen mainScreen] scale]];
[_imageLayer setContents:(__bridge id)image.CGImage];
[_imageLayer setBounds:CGRectMake(0.0, 0.0, [image size].width, [image size].height)];
[_imageLayer setAnchorPoint:CGPointMake(0, 0)];

[layer addSublayer:_imageLayer];

CAGradientLayer *gradientLayer = [CAGradientLayer layer];
[gradientLayer setColors:[NSArray arrayWithObjects:(__bridge id)[[UIColor whiteColor] colorWithAlphaComponent:0.25].CGColor, [UIColor whiteColor].CGColor, nil]];

[gradientLayer setBounds:CGRectMake(0, 0, layer.frame.size.width, [image size].height * 0.5 + 1.0)];
[gradientLayer setAnchorPoint:CGPointMake(0.5, 0)];
[gradientLayer setPosition:CGPointMake(self.view.frame.size.width/2, image.size.height + 10.0)];
[gradientLayer setZPosition:1];

[gradientLayer setContentsScale:[[UIScreen mainScreen] scale]];

[[[self view] layer] addSublayer:layer];
[[[self view] layer] addSublayer:gradientLayer];&lt;/pre&gt;
所以了，如果现在你想在图片层上加一个文字，而且想让文字也出现在倒影中，就是非常简单了。因为所有的replicator layer会监视source layer中sublayers的动作变化，一旦它发生变动，所有的replicator layers会对应的进行重画，而且性能看起来还不错。
&lt;pre lang=&quot;cpp&quot;&gt;//Final step to show it dynamic nature
CATextLayer *textLayer = [CATextLayer layer];
[textLayer setContentsScale:[[UIScreen mainScreen] scale] ];
[textLayer setString:@&quot;Chuck Norris&quot;];
[textLayer setFontSize:18];
[textLayer setAlignmentMode:kCAAlignmentCenter];
[textLayer setShadowColor:[UIColor blackColor].CGColor];
[textLayer setShadowOpacity:1.0];
[textLayer setShadowOffset:CGSizeMake(-4, -4)];
[textLayer setBounds:CGRectMake(0, 0, _imageLayer.frame.size.width, 30)];
[textLayer setPosition:CGPointMake(_imageLayer.frame.size.width/2, _imageLayer.frame.size.height - 20)];
//[textLayer setAnchorPoint:CGPointMake(0.5, 0.5)];
[_imageLayer addSublayer:textLayer];
[self.view setUserInteractionEnabled:YES];
[self.view setMultipleTouchEnabled:YES];
[self.view addGestureRecognizer:[[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(animateTextLayer:)]];

- (void)animateTextLayer:(id)animateTextLayer {
CALayer *textLayer = [[_imageLayer sublayers] objectAtIndex:0];
CABasicAnimation *animation = [CABasicAnimation animationWithKeyPath:@&quot;position.y&quot;];
CGFloat endPoint = [textLayer frame].size.height /2;

//textLayer.position.y
[animation setFromValue:[NSNumber numberWithFloat:textLayer.frame.origin.y + endPoint]];
[animation setToValue:[NSNumber numberWithFloat:endPoint]];
[animation setDuration:3.0];
[animation setRepeatCount:MAXFLOAT];
[animation setAutoreverses:YES];

[textLayer addAnimation:animation forKey:nil];

}&lt;/pre&gt;
非常酷，而且直观。 事实上CAReplicatorLayer可以做出很多经验的效果。

joericioppo 有一个结合CAReplicatorLayer和CATransform3D起来的demo，甚是强大，就是这3D中各种轴旋转，直接把我转晕了，但是透过它，你可以更好的理解CAReplicatorLayer以及如何更好的使用CAReplicatorLayer: &lt;a href=&quot;https://github.com/joericioppo/CAReplicatorLayer_Animation&quot; target=&quot;_blank&quot;&gt;https://github.com/joericioppo/CAReplicatorLayer_Animation&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>简结</title>
   <link href="http://tuo.github.com13.html"/>
   <updated>2011-12-29T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e7%ae%80%e7%bb%93</id>
   <content type="html">2011年马上就过去了.
    感激，丰富，新奇，不舍
2012展望
  练熟吉他
  读完刚刚买的一些书籍
   多多转转
......
</content>
 </entry>
 
 <entry>
   <title>墨尔本生活锁记</title>
   <link href="http://tuo.github.com12.html"/>
   <updated>2011-12-04T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%a2%a8%e5%b0%94%e6%9c%ac%e7%94%9f%e6%b4%bb%e9%94%81%e8%ae%b0</id>
   <content type="html"> 这次来墨尔本,已然是2011年中的第三次了, 显然已经是对墨尔本熟门熟路了, 刚刚接机的时候司机师傅还跟我介绍墨尔本.这次墨尔本之行,除了在工作上完成来之前定下来的目的之外, 在生活上这一次比前两次可要爽多了. 大概因为前两次来这边, 客户他们觉得并没有很好照顾好我们, 而他们觉得在西安时他们被照顾的很好, 所以这一次他们还是非常热情的. 刚刚好,也是时机碰对了,因为墨尔本正在举行&lt;a href=&quot;http://www.3aw.com.au/comp-acg&quot; target=&quot;_blank&quot;&gt;19th Australian Corporate Games &lt;/a&gt;比赛, 而客户所在的公司刚刚也报名参加了其中的很多项目, 当然就包括篮球. 因为之前在西安的时候, 我跟他们打过篮球, 他们觉得我这个技术不错, 于是非常强烈的要求我参加, Sam想了一个办法,让我顶替之前不能上场的球员.要是找我要照片地址等等信息,终于成功的注册上了. 我个人觉得也是蛮搞笑的, 我是TW的然后代表他们上场比赛, 有点外援的意思.
是的,这是我很2的入场证明,哈哈
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449567951/&quot; title=&quot;IMG_20111126_151330 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7028/6449567951_53ee42c34a.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;IMG_20111126_151330&quot;&gt;&lt;/a&gt;
于是我跟Sam约好十二点半,他开车来我住的hotel来接我, 然后周六来到了比赛的场馆, 一进去还是相当不错的, 这场地. 
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449571279/&quot; title=&quot;IMG_20111126_164729 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7026/6449571279_c22b370796.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;IMG_20111126_164729&quot;&gt;&lt;/a&gt;
不错, 下午我们将会有三场比赛, 每场比赛分上下两半场, 每半场12分钟.  悲剧的是我们等到快比赛时,然后只有四个人来了, 更悲剧的是这个球服上没有任何的号码和名字, Sam带了一根黑笔, 因为他是搞UI的嘛,所以随手一画就帮我们画了个数字,但跟人家其他队伍比起来还真是寒酸阿. 好在在比赛即将开始时,有一哥们赶到了, 凑齐了五个人比赛了. 第一场比赛, 把眼镜一取下来,发现模模糊糊,我才发现我也有一阵子没打球, 不过也没办法, 硬着上, 结果我老被吹走步, 传球都走步, 然后我带球上篮直接人家打我手了,裁判却不吹, 我觉得这裁判很业余. 比较搞笑的是,即使是知道参加比赛, 大家之前都没在一起练习过, 比赛时都是自己搞自己的.囧~
毫无疑问,我们连输三场, 对方这个头都是1.9几的, 我们这边缺少一个中锋去枪篮板.
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449524947/&quot; title=&quot;game in melbourne by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7149/6449524947_9fc6a9dfc1.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;game in melbourne&quot;&gt;&lt;/a&gt;
不过大家都玩的挺high的,比完之后大家互相在对方球衣上签名.

 上个周三Sam提议去吃&quot;泡馍&quot;, 我以为这边真有泡馍了,结果大家走之前一看, 我发现他说的泡馍不是我说的, 他说的是&quot;&lt;a href=&quot;http://www.mrsparmas.com.au/&quot; target=&quot;_blank&quot;&gt;parma&lt;/a&gt;&quot;. 囧了, 然后大家想这去哪吃, 整来整去的,大家决定去吃意大利的&lt;a href=&quot;http://www.docgroup.net/&quot; target=&quot;_blank&quot;&gt;doc pizza&lt;/a&gt;. 去了之后,发现那家店就是在一个意大利街区里,里面各种意大利的吃的, 这家批萨店非常火爆. 于是Mike,Simon,Sam骑自行车, 我跟Kalops和heather就做车去的. 店里的菜单各种意大利文字和地图, 英文的菜名也是各种意大利字, 搞的我晕头转向, 然后我就问了下Simon帮忙定了一个. 六个人,六分批萨, 每个人都轮换这分享吃, 味道确实非常不错. 
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449577355/&quot; title=&quot;IMG_20111201_200039 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7021/6449577355_b80790874d.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;IMG_20111201_200039&quot;&gt;&lt;/a&gt;
而且这个啤酒很给力,一开始以为没有问题,喝起来很甜, 结果后劲十足, 晚上回去之后感觉就头痛了.吃完正餐,大家点了一些什么点心,都是非常甜的东西. 吃得饱到不行
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449578371/&quot; title=&quot;IMG_20111201_204839 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7011/6449578371_0d3b4d68ee.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;IMG_20111201_204839&quot;&gt;&lt;/a&gt;
上周四,参加了&lt;a href=&quot;http://www.meetup.com/Agile-Melbourne/&quot; target=&quot;_blank&quot;&gt;Agile Melbourne&lt;/a&gt;, 来了几位大牛比如写&lt;Refactor to Pattern&gt;的Joshua Kerievsky和rebeccawb,主要讲了讲关于产品策略和如何在公司中推行敏捷等等.
 &lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449573863/&quot; title=&quot;IMG_20111129_191731 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7012/6449573863_b4f44e3165.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;IMG_20111129_191731&quot;&gt;&lt;/a&gt;
这周六, Simon提议去这边的一个地质公园: &lt;a href=&quot;http://parkweb.vic.gov.au/explore/parks/werribee-gorge-state-park&quot; target=&quot;_blank&quot;&gt;Werribee Gorge State Park&lt;/a&gt;. 我其实也是很好奇这边的地址公园会是什么样子, 跟华山有什么区别了.经过将近一个半小时的驾驶,终于来到了这个公园.

&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449525401/&quot; title=&quot;werribee gorge state park by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7155/6449525401_0df837c2f9.jpg&quot; width=&quot;375&quot; height=&quot;500&quot; alt=&quot;werribee gorge state park&quot;&gt;&lt;/a&gt;
进去之后,发现两边的树木很奇怪,他们的皮都剥落了, 非常瘦直, 而且路上人非常少,整个过程中就遇到了六个人. 路上的一个牌子上写着有可能出现鸭嘴兽,我顿时觉得这个很有意思, 因为之前只有在教科书上看到. 但是Simon这个基本上看不到,因为它们生活在非常难以看到的地方.
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449530721/&quot; title=&quot;IMG_20111203_141119 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7011/6449530721_faf2c1cff3.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;IMG_20111203_141119&quot;&gt;&lt;/a&gt;
很奇怪的是这边的基本上没有什么花, 我以为这个时节应该是漫山遍野都是花,结果不是. 而且两旁很多枯死的树木.
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449529355/&quot; title=&quot;IMG_20111203_134839 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7148/6449529355_85776620f8.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;IMG_20111203_134839&quot;&gt;&lt;/a&gt; 
走到中间还没有一段是需要沿着绳索攀岩过去的地方, 我觉得很有意思, 但是就是太短了.
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449532715/&quot; title=&quot;IMG_20111203_142954 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7175/6449532715_a972d46e7a.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;IMG_20111203_142954&quot;&gt;&lt;/a&gt;
快到路程终点时, 看到了Wallaby, 很小很可爱的动物,非常敏觉,听到我们的声音就藏了起来, 但是藏起来的方式就有点像鸵鸟把头埋在沙粒.但是它的伪装技术明显要高超的多,不仔细看,还看不出来.
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449539395/&quot; title=&quot;IMG_20111203_161101 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7160/6449539395_a6fd56c891.jpg&quot; width=&quot;374&quot; height=&quot;500&quot; alt=&quot;IMG_20111203_161101&quot;&gt;&lt;/a&gt;
走下来大概有六公里的山路, 花了将近三个小时, 路上非常崎岖,但是风景非常不错, 这么长的路, 一路上跟simon也聊了很多, 关于这边的地理环境, 甚至讲到了无政府主义跟敏捷的联系等等, 还是非常拓展了我的知识的.
&lt;a href=&quot;http://www.flickr.com/photos/54952827@N02/6449579079/&quot; title=&quot;IMG_20111203_134316 by Tuo Huang, on Flickr&quot;&gt;&lt;img src=&quot;http://farm8.staticflickr.com/7005/6449579079_184ab918f5.jpg&quot; width=&quot;500&quot; height=&quot;374&quot; alt=&quot;IMG_20111203_134316&quot;&gt;&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>跨域ajax请求</title>
   <link href="http://tuo.github.com11.html"/>
   <updated>2011-10-30T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e8%b7%a8%e5%9f%9fajax%e8%af%b7%e6%b1%82</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;之前写的&lt;a href=&quot;https://github.com/tuo/jenkins-dashboard&quot; target=&quot;_blank&quot;&gt;jenkins-dashboard&lt;/a&gt;在几个团队中都在用,效果不错, 但是就是搭建起来有点麻烦. 因为它目前工作原理是起一个ruby进程然后每次去轮训jenkins ci上的每个build的状态(通过jenkins暴露的api),然后写到本地的一个html中.接着在写一个主文件比如dashboard.html,它每隔几秒钟去装载刚才ruby生成的html文件,这样就可以在dashboard上及时显示和更新ci的状态.但是问题是这个太重量级了,你还得装ruby环境和几个gem包甚至可能需要rvm,WTF.于是同事准备只用一个html就搞定,就是说每个几秒钟去发ajax请求到jenkins上拿到最新的构建状态,并更新dom结构或者样式, 这样一来用户就可以主需要下个html文件,并配置下ci的地址和想监控的构建就好了.几天后,我问同事怎么样了,他说ajax请求其他域名出错了. 回头我想了想我是忘记这个事情了, 因为浏览器有&lt;a href=&quot;http://en.wikipedia.org/wiki/Same_origin_policy&quot; target=&quot;_blank&quot;&gt;Same Origin Policy&lt;/a&gt;的安全限制. 好比现在:

localhost ----ajax request ---&amp;gt; http://ci.jruby.org/view/Ruboto/api/json

不行, 因为虽然ci.jruby.org这个服务器是暴露了它的json/xml的api,但是这个请求不是在localhost下面,所以无法成功.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;怎么实现跨域的ajax?&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最简单的办法是将本地的服务器作为一个代理,将第三方的ajax请求都转发出去, 这样一来我在客户端,我基本无需改动.但是它的弊处是它扩展性和伸缩性差.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;第二种: 之前说过因为同源策略的限制,所以ajax请求无法跨域,但是还是hack的方法. 在浏览器中,对于script这个tag是一个例外,浏览器可以请求其他域的javascript数据源.那这么一来, 我可以在有一个script tag中定义好callback函数:
&lt;pre lang=&quot;javascript&quot;&gt;
 &lt;script type=&quot;text/javascript&quot;&gt;
    function doSth(data){
      alert(data.currency + ', ' + data.account);
    }
 &lt;/script&gt;
 &lt;script type=&quot;text/javascript&quot; src=&quot;http://another.domain.com/money?format=xml&amp;amp;callback=doSth&quot;&gt;&lt;/script&gt;
&lt;/pre&gt;
那怎么让服务器知道它需要组装数据然后调用你在本地服务器定义的callback函数了?(e.g.doSth()). 所以你看到下面的script tag中src属性指定了callback是doSth这个函数引用. 下面是服务器端的大概逻辑:
&lt;pre lang=&quot;java&quot;&gt;data=....
request.getParameter('callback');
callback(data)&lt;/pre&gt;
这个解决方案被称为&lt;a href=&quot;www.json-p.org&quot; target=&quot;_blank&quot;&gt;jsonp&lt;/a&gt;(JSON-with-padding),通常被请求的数据都是以json方式来交换.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;JSONP-jQuery支持&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;jQuery自从1.2开始在getJSON()中支持jsonp模式.如果你想请求远程的一个ajax请求,你需要做两件事情:
&lt;ul&gt;
	&lt;li&gt;在url中加上format=[json|xml]和callback=?&lt;/li&gt;
	&lt;li&gt;定义你的callback函数&lt;/li&gt;
&lt;/ul&gt;
这里的callback=? 这个?占位符会在jQuery执行时,替换成匿名函数的引用. 它会首先将匿名函数转换为一个全局函数同时挂到
window对象上. 然后当请求完成,那么它会自动将其删除. 如果你的请求不是跨域的请求,它会将其转换为一个正常的ajax请求.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;比如我想请求
&lt;pre lang=&quot;javascript&quot;&gt; jQuery.getJSON(&quot;http://another.domain.com/money?format=json&amp;amp;callback=?&quot;, function(data) {
    alert(data.currency + ', ' + data.account);
 });&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;但是......&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;到目前为止,jsonp看起来很不错, jquery对它的支持更是不错, 那么.......问题是?
它需要你在第三方的服务器暴露的服务进行修改,以便使其支持正确响应jsonp模式的请求.可以想象,对于another.domain.com/money?format=json这个功能而言,它不能只返回json对象,而是callback(json_data).我们知道
很多时候我们没有对第三方服务进行修改的权限.所以这个时候便是YQL来拯救.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;&lt;a href=&quot;http://developer.yahoo.com/yql/&quot; target=&quot;_blank&quot;&gt;YQL&lt;/a&gt;&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;YQL是Yahoo提供的一个第三方query平台和api, 用来抓取第三方的数据信息,而不需要关心第三方的具体协议(REST)和数据格式(RSS,ATOM,XML,JSON, etc).
引用YQL的一个示意图:
&lt;img class=&quot;alignnone&quot; title=&quot;YQL&quot; src=&quot;http://www.ibm.com/developerworks/web/library/wa-aj-jsonp2/yql.gif&quot; alt=&quot;&quot; width=&quot;563&quot; height=&quot;235&quot; /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;有兴趣的可以去&lt;a href=&quot;http://developer.yahoo.com/yql/console&quot; target=&quot;_blank&quot;&gt;YQL Console&lt;/a&gt;玩玩. 但是这里我们关注的是YQL它提供JSONP服务支持,也就是说你可以发送一个请求JSON数据的请求同时可以指定你的回调函数,相当于它给所以第三方的服务提供了自动化JSONP服务支持而不需要你对第三方服务做任何的修改,这就使得跨域的ajax修改不依赖于具体的第三方服务端的设置,完全只需要修改前端的javascript代码. yep~
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;YQL语法的大概格式是:
&lt;pre lang=&quot;javascript&quot;&gt;http://query.yahooapis.com/v1/public?q=[command]&amp;amp;format=json&amp;amp;callback=?&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;结合jQuery,比如你想拿到http://ci.jruby.org/view/Ruboto/api/json的结果:
&lt;pre lang=&quot;sql&quot;&gt;select * from json where url =&quot;http://ci.jruby.org/view/Ruboto/api/json&quot;&lt;/pre&gt;
但是你需要它对应的REST QUERY的地址(web service):
&lt;pre lang=&quot;javascript&quot;&gt;jQuery.getJSON(&quot;http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20json%20where%20url%20%3D%22http%3A%2F%2Fci.jruby.org%2Fview%2FRuboto%2Fapi%2Fjson%22&amp;amp;format=json&amp;amp;callback=?&quot;,function(data) {
     alert(&quot;view name : &quot;+ data.query.results.json.name);
});&lt;/pre&gt;
实际上你还可以简化一下jQuery和YQL的使用, 比如构造url的过程, 这里&lt;a href=&quot;http://james.padolsey.com/javascript/cross-domain-requests-with-jquery/&quot; target=&quot;_blank&quot;&gt;james padolsey&lt;/a&gt;就写了一个很方便的封装.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;Other Cross Domain Strageties&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ok,我们讲过跨域ajax请求的两种办法: 设置代理服务器转发, 使用YQL. 但是这两种并没有本质上解决问题,二者都是通过一些独特的方法绕过浏览器对于跨域请求的限制.实际上,在如今mashup急剧增加, 跨域之间的资源共享确实是非常重要, W3C推出了 &lt;a href=&quot;http://www.w3.org/TR/cors/&quot; target=&quot;_blank&quot;&gt;CORS&lt;/a&gt;(Cross-Origin Resource Sharing), 简要的说它是标准XMLHttpRequest(aka.XHR)的扩展,允许浏览器做出不同域之间的请求. 相比以往的普通的XMLHttpRequest对象的工作方式, CORS不同的是它会先向服务器端发出请求,询问是否其他域的请求是否被允许,如果不是,那么就会被拒绝;如果服务端根据预定规则(有点类似于ACL)去检查其权限为允许放行的话,那么它就会亮绿灯允许这个请求继而拿到第三方的数据.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;所以你可以看到在服务器端可能有定义如下的权限规则:
&lt;pre lang=&quot;javascript&quot;&gt;   Access-Control-Allow-Origin: http://www.another.domain.com&lt;/pre&gt;
&lt;a href=&quot;http://www.nczonline.net/blog/&quot; target=&quot;_blank&quot;&gt;Nicholas Zakas&lt;/a&gt;写了一篇关于&lt;a href=&quot;http://www.nczonline.net/blog/2010/05/25/cross-domain-ajax-with-cross-origin-resource-sharing/&quot; target=&quot;_blank&quot;&gt;CORS for cross-domain Ajax&lt;/a&gt;的文章.
但是CORS的未来还不清楚,浏览器的支持也不是非常好,而且要求权限验证逻辑写在服务端,对于OPS的人维护起来也确实是麻烦,特别是你有多个平台需要维护(qa/staging/production).
相比JSONP的方式,二者各有利弊, 还可以参考&lt;a href=&quot;http://easyxdm.net/wp/&quot; target=&quot;_blank&quot;&gt;easyXDM&lt;/a&gt;.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;引用&lt;/h3&gt;
&lt;a href=&quot;www.json-p.org&quot; target=&quot;_blank&quot;&gt;JSONP introduction&lt;/a&gt;

&lt;a href=&quot;http://developer.yahoo.com/yql/&quot; target=&quot;_blank&quot;&gt;Yahoo! Query Language&lt;/a&gt;

&lt;a href=&quot;http://developer.yahoo.com/yos/screencasts/yql_screencast.html&quot; target=&quot;_blank&quot;&gt; Screencast: Introducing YQL  from YQL Site&lt;/a&gt;

&lt;a href=&quot;http://www.youtube.com/watch?v=KareyTLxoXc&quot; target=&quot;_blank&quot;&gt;YQL: An Introduction on Youtube&lt;/a&gt;

&lt;a href=&quot;http://icant.co.uk/articles/crossdomain-ajax-with-jquery/&quot; target=&quot;_blank&quot;&gt;Loading external content with Ajax using jQuery and YQL&lt;/a&gt;

&lt;a href=&quot;http://www.ibm.com/developerworks/library/wa-aj-jsonp1/&quot; target=&quot;_blank&quot;&gt;Cross-domain communications with JSONP, Part 1: Combine JSONP and jQuery to quickly build powerful mashups&lt;/a&gt;

&lt;a href=&quot;http://www.ibm.com/developerworks/web/library/wa-aj-jsonp2/&quot; target=&quot;_blank&quot;&gt;Cross-domain communications with JSONP, Part 2: Building mashups with JSONP, jQuery, and Yahoo! Query Language
&lt;/a&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;address&gt;&lt;strong&gt;TODO List&lt;/strong&gt;:  Rewrite Jenkins-dashboard using purely html/javascript, no heavy-lifting ruby.   &lt;/address&gt;
</content>
 </entry>
 
 <entry>
   <title>Jasmine测试</title>
   <link href="http://tuo.github.com10.html"/>
   <updated>2011-10-22T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./jasmine%e6%b5%8b%e8%af%95</id>
   <content type="html">Jasmine作为一个javascript的测试框架, 借鉴了很多其他测试框架比如RSpec,JSpec的有点,包含了很多优秀的设计思想.结合最近的使用心得,它的主要优点有:
&lt;ol&gt;
	&lt;li&gt; 专心做assertion框架, 独立模块化的设计使其非常好的能和其他库进行集成.比如它可以和像提供非常强大健壮的持续集成支持的jsTestDriver(非常专业的non-headless test/spec runner)互相配合相得益彰; 根据jquery相应扩展出的下面会讲到的jasmine-jquery等.&lt;/li&gt;
	&lt;li&gt;idomatic的语法. Jasmine借鉴了RSpec的语法设计, 如果你是接触过并使用过rspec(当然除了像DHH这种rspec-offender),你发会发现jasmine的语法跟rspec会有惊人的类似,学习使用起来很快就会得心应手,似曾相识.&lt;/li&gt;
&lt;/ol&gt;
接下来Jasmine是如何简化javascript的测试了?
&lt;pre lang=&quot;javascript&quot;&gt; describe(&quot;Calculator&quot;, function() {
  it(&quot;adding algorithm&quot;, function() {
     expect(Calculator.add(1, 2)).toEqual(3);
  });
 });&lt;/pre&gt;
上面是一个简单的测试案例, 简单的测试Calculator的加法逻辑, 但是你看到Jasmine测试的语法确实非常简洁.jasmine这个对于纯javascript的测试,那是得心应手.
但是通常说javascript测试中两个难点:第一个是DOM的交互;第二个是ajax.
与DOM交互测试难处在于: 你需要准备测试对应的fixture也就是html代码片段, 然后让你想测试的javascript在html上执行, 最后在验证DOM上面元素的变化.另外一个方面这些与dom打交道的可能是第三方的库,比如最常见的jquery. 第一个问题其实也可以解决,那便是我们可以使用$('body').append(&quot;some test fixtures&quot;), 但它的可用性不好而且最重要的这个字符串型的html片段非常难看,同时你每次都得在测试最后手动删掉这些fixtures.当然你可以将这些fixture写到一些文件之中, 但是你不得不使用ajax去载入文件然后手动的将其append到body后面,代码非常繁琐而且你每次都得记得去DOM中清除掉这些fixtures. 总结处理html fixtures的两个要点是:
&lt;ol&gt;
	&lt;li&gt;如何更加简洁来处理html fixtures的读取加载. 避免需要硬编码的在&amp;lt;body&amp;gt;上面去添加字符串型的fixtures,; 也需要避免使用非常长的使用ajax来加载html fixtures文件的尴尬&lt;/li&gt;
	&lt;li&gt;在每个测试案例运行之后在DOM文件中清除掉fixtures,这个应该是默认的行为,而不是需要自己手动添加tear down的代码.&lt;/li&gt;
&lt;/ol&gt;
另外一个问题便是在assert的时候, 你要判断某一个元素的有没有class? 你可能需要写成:
&lt;pre lang=&quot;javascript&quot;&gt;    expect($(&quot;#market-summary&quot;).attr(&quot;class&quot;)).toEqual(&quot;no-margin-wrapper&quot;);&lt;/pre&gt;
因为jasmine内置的matcher并没有提供这些, 这也看出来它这些match并不是给断言DOM来设计的. 不过虽然jasmine提供了类似于rspec的个性化matcher的功能,但是这个没有理由让我们重新发明轮子.

这个时候便是Jasmine-jQuery大展伸手的时候了. 它给jasmine提供了两大支持:
&lt;blockquote&gt;
&lt;ul&gt;
	&lt;li&gt;a set of custom matchers for jQuery framework&lt;/li&gt;
	&lt;li&gt;an API for handling HTML fixtures in your specs&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;div&gt;第一个它提供了非常强大的个性化matcher, 简化对于DOM条件的断言. 比如上面的判断元素class name, 在集成jasmine-jquery之后, 我可以写成:&lt;/div&gt;
&lt;pre lang=&quot;javascript&quot;&gt;   expect($(&quot;#market-summary&quot;)).toHaveClass(&quot;no-margin-wrapper&quot;);&lt;/pre&gt;
这样一来,代码的可读性也跟着大大提供了. 更多的matcher可以参考jasmine-jquery的github主页.
第二是关于怎么简化处理html fixtures的.
&lt;pre lang=&quot;javascript&quot;&gt; loadFixtures('myfixture.html');&lt;/pre&gt;
如果你没有个性化fixture加载的地址, jasmine-jquery会默认去找到spec/javascript/fixtures目录下的myfixute.hml文件,本质上还是使用$.ajax去请求这个文件,然后在append到DOM中. 同时它还提供了一套非常完备的API来处理fixture相关的操作. 另外一个提到便是它每次会在测试案例跑完之后清除掉DOM中掉之前加载的fixture, 所以你不需要每次在之后手动加 $(&quot;xxxx).remove().
另外一个便是测试ajax.这里测试分为两种单元测试和集成测试.集成测试也就是真正会touch服务器端,请使用其他工具比如capybara等. 对于javascript单元测试,在测试时我们都必须注意不能真的让它touch到服务器端,也就是不能真正让它发出ajax请求, 如果发出来了,我们也要阻拦住然后替换它(有兴趣的可以看看sinonjs).  你可以使用jasmine有自己一套mock框架spy, 它可以用来mock, stub和fake你想测试协作者的功能.  假设你有一个ajax请求, 在success的回调函数中做很多事情,比如修改DOM阿等等.
&lt;pre lang=&quot;javascript&quot;&gt;var Validation = function(){
   var init = function(){
      $.ajax({
         url: url,
          // ....
         success: function(data) {
           $(&quot;#validation-result&quot;).text(data);
         }
     });
  }
  return init : init;
});
var Util = function(){
   var sendAjax = function(url, successCallback, errorCallback,...){
      $.ajax({
         url: url,
          // ....
         success: successCallback
     });
  }
  return sendAjax : sendAjax;
});&lt;/pre&gt;
在对应的测试中,我们就可以使用spy来mock这个ajax请求,使其并不会真得发出ajax.
&lt;pre lang=&quot;javascript&quot;&gt;describe(&quot;Validation&quot;, function () {
	it(&quot;when ajax request succeeded and callback get called&quot;, function () {
		loadFixtures('validation.html');
		expect($(&quot;#validation-result&quot;)).toBeEmpty();
		spyOn($, &quot;ajax&quot;);
		Valiation.init();
		expect($.ajax).toHaveBeenCalled();
		expect($.ajax.mostRecentCall.args[0].url).toEqual('some url');
		$.ajax.mostRecentCall.args[0].success(&quot;failed&quot;);
		expect($(&quot;#validation-result&quot;)).toHaveText(&quot;failed&quot;);
	 })
});&lt;/pre&gt;
&lt;pre&gt;相比之下如果我们将send ajax这段boilerplate放在一个单独的模块,而其他引用它的文件的测试就只需要spy这个模块就好了.&lt;/pre&gt;
&lt;pre lang=&quot;javascript&quot;&gt;var Validation = function(){
   var successCallback = function (data) {
     $(&quot;#validation-result&quot;).text(data);
   }
   var init = function(){
     Util.sendAjax(&quot;some url&quot;, &quot;GET&quot;, successCallback);
   }
	 return init : init;
 });&lt;/pre&gt;
以及测试:
&lt;pre lang=&quot;javascript&quot;&gt;describe(&quot;Validation&quot;, function () {
	it(&quot;when ajax request succeeded and callback get called&quot;, function () {
		loadFixtures('validation.html');
		expect($(&quot;#validation-result&quot;)).toBeEmpty();
		spyOn(Util, &quot;sendAjax&quot;);
		Valiation.init();
		expect(Util.sendAjax).toHaveBeenCalled();
		expect(Util.sendAjax.mostRecentCall.args[0]).toEqual('some url');
		Util.sendAjax.mostRecentCall.args[1](&quot;failed&quot;);
		expect($(&quot;#validation-result&quot;)).toHaveText(&quot;failed&quot;);
	 })
});&lt;/pre&gt;
而接着对于sendAjax的测试就非常简单了, 我们同样可以选择使用spyOn, 也可以使用sinonjs来mock ajax请求.
&lt;h2&gt;Jasmine的问题与注意事项:&lt;/h2&gt;
&lt;ol&gt;
	&lt;li&gt;基于jasmine的机制,它会将所有的引用包括报表包含在一个静态HMTL文件中(SpecRunner.html). 如果你使用jasmine-jquery,在浏览器中执行时如果你使用firebug进行inspect时,你会发现一个tag: &amp;lt;div class='jasmine-fixtures'&amp;gt;&amp;lt;div&amp;gt;, 所有的fixtures会默认加载到这个div下,然后测试案例跑完之后,它会去清空这个div的内容.但是问题是如果你有测试案例中代码会对比如&amp;lt;body&amp;gt;等在&amp;lt;div class='jasmine-fixtures'&amp;gt;&amp;lt;/div&amp;gt;之外的元素进行操作时,它的痕迹是不会在测试案例跑完之后自己清空, 这个时候需要你自己去手动写代码清空, 否则会影响到下面的测试案例.&lt;/li&gt;
	&lt;li&gt;因为所有的测试在浏览器中都跑一个窗口下, 所以代码跟浏览器相关的操作都需要仔细考虑. 比如你代码中有重新转向另一个url,
&lt;pre lang=&quot;javascript&quot;&gt;window.location.href= &quot;www.xxx.com&quot;&lt;/pre&gt;
然后你去assert它当前的url是不是&quot;www.xxx.com&quot;.你会发现这个你的jasmine runner的窗口也跟着跳转了, 然后后面测试也无法跑了.如果你理解了jasmine的工作方式之后,你就知道它为什么会这样了. 这个时候要求你需要划分模块了, 将这个转向的逻辑抽出来放在另一个模块中比如叫做NavigationHelper, 然后测试时,你不需要直接是去
&lt;pre lang=&quot;javascript&quot;&gt; expect(window.location.href).toEqual(&quot;www.xxx.com&quot;);&lt;/pre&gt;
而是可以spy这个NavigationHelper. 这也许是为什么javascript测试覆盖率很难达到100%的一个原因之一.
&lt;/li&gt;
&lt;li&gt;jasmine在测试全局变量时非常不给力.但是问题不在于jasmine不给力,问题在于为什么引入全局变量. 就像Douglas Crockford说的: global variables are evils. 但是问题是有一些是第三方库强迫的,而且因为商业上原因,你还不能把它去掉或者替换.这个时候你只能采用ad-hoc的方式了.&lt;/li&gt;
&lt;li&gt;jasmine有一个有意思的事情便是如果你的spec测试中, 有语法错误. 比如在calculator-spec.js中
&lt;pre lang=&quot;javascript&quot;&gt;  expect(1 + 1).toEqual(2);&lt;/pre&gt;
你给粗心写成了
&lt;pre lang=&quot;javascript&quot;&gt;  expect(1 + 1).toEqual(2))));&lt;/pre&gt;
然后你去跑jasmine测试, 你会发现spec runner依然是绿色. 但是如果你仔细看, 你会发现这个测试案例的数量却是减少了.在定睛一看,你会发现这个calculator-spec.js文件就没有被执行, 也就是它会忽视整个测试文件,但是它却可以心不惊肉不跳的执行下面的测试.
解决办法: 保持良好的观察力, 养成记住上次测试跑了多少个测试案例的数量, 这当然是开玩笑了. 这种情况下两种办法: 第一种可以使用jslint来进行语法格式检查. 比如这个它会提示:
&lt;pre lang=&quot;javascript&quot;&gt;  Lint at line 17 character 20: Expected ')' to have an indentation at 7 instead at 20.
          expect(1 + 1)).toEqual(2);&lt;/pre&gt;
当然一个良好的项目有javascript测试,但是却没有jslint检查,这个就不太专业了. 另外一个办法是:你可以跑javascript coverage,
一个好的项目的话,对于测试覆盖率是有要求的,如果没有达到一定的阈值,就会报错. 比如这里,一个语法问题导致整个测试文件都没跑,通常情况下,测试覆盖虑应该都会降,你这个时候跑CI应该都会错误.但是这个也是不一定的, 它没有jslint检查那么彻底.
&lt;/li&gt;&lt;/ol&gt;
&lt;h3&gt;引申:&lt;/h3&gt;
&lt;pre&gt;javascript单元测试是非常重要的,它写起来的容易与否跟我们是否合理的划分模块和依赖, 有很大的关系.&lt;/pre&gt;
就是之前提出的全局变量的事情, 你可以将参数的计算逻辑从第三方库中抽离出来, 这样可以独立测试并覆盖到, 最大限度地做到能测就测到. 另外一个case便是因为javascript测试需要的fixtures并不会随着产品代码的修改而及时更新,但是这个时候你跑jasmine测试它并不会失败.这个事情上次跟gigix聊了一会, 他建议是尽量将javascript划分成比较合理的模块,这样各个模块都可以独立测试,然后通过真正的集成测试比如jasmine来验证行为.比如有一个段逻辑是计算弹出盒子的位置,这个计算位置的逻辑可以抽离出来,然后在写一个cucumber测试,这个测试只要验证盒子出来就好,而不需要关心这个盒子在哪个位置,因为那部分逻辑已经在单元测试中覆盖到. 我后来想到包括你想前面提到的window.href.location这一段逻辑,它抽离出来的好处在于在集成测试上面,哪怕有非常多的地方掉了这个逻辑, 但是我只需要写一个覆盖到重定位的cucumber场景就好了. 其实我想了想这个问题是: 究竟得写多少cucumber测试才能确保产品html的改动同时及时反应在javascript的单元测试中fixtures上面,使得二者保持同步,确保javascript代码时刻能正确工作.&lt;span class=&quot;Apple-style-span&quot; style=&quot;font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px; white-space: normal;&quot;&gt;之前说到jasmine的设计非常巧妙, 其中之一便是体现在跟CI的集成上面. 简要的来说现在的spec runner的host分为两种: headless&amp;gt;和non-headless. 第一种就是不起显示的浏览器,也就是没有浏览器, 你可以使用java实现的js引擎rhino以及在模拟浏览器中DOM实现的Envjs,优势是速度上非常快.第二种使用浏览器的比如jsTestDriver, jasmine有跟其集成的&lt;a href=&quot;https://github.com/ibolmo/jasmine-jstd-adapter&quot;&gt;jasmine-jstd-adapter&lt;/a&gt; .&lt;/span&gt;
参考:
想简单体验一下: &lt;a href=&quot; http://try-jasmine.heroku.com/&quot; target=&quot;_blank&quot;&gt; http://try-jasmine.heroku.com/&lt;/a&gt;
railscast上面的介绍: &lt;a href=&quot;http://railscasts.com/episodes/261-testing-javascript-with-jasmine&quot; target=&quot;_blank&quot;&gt; http://railscasts.com/episodes/261-testing-javascript-with-jasmine&lt;/a&gt;
jasmine-jquery作者的博客: &lt;a href=&quot;http://testdrivenwebsites.com/2010/07/29/html-fixtures-in-jasmine-using-jasmine-jquery/&quot; target=&quot;_blank&quot;&gt; http://testdrivenwebsites.com/2010/07/29/html-fixtures-in-jasmine-using-jasmine-jquery/&lt;/a&gt;
SinonJS: &lt;a href=&quot;http://msdn.microsoft.com/en-us/scriptjunkie/gg649850.aspx&quot; target=&quot;_blank&quot;&gt;Planning, Cheating and Faking Your Way Through JavaScript Tests&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>古今笑</title>
   <link href="http://tuo.github.com9.html"/>
   <updated>2011-09-24T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%8f%a4%e4%bb%8a%e7%ac%91</id>
   <content type="html">最近读了节选部分的&amp;lt;古今笑&amp;gt;,清李渔给古今笑做的序有提到这本书&quot;雅俗并嗜,购之唯恨不早&quot;.&amp;lt;古今谭概&amp;gt;是冯梦龙收集的一些稗官野史中的记录,然后加入自己的一些品评,跟苏轼的有点类似.这类的笔记有意思的在于它提供了很多侧面的方式帮助我们了解古人的形象和生活,拉近了距离.

&lt;strong&gt;异服&lt;/strong&gt;
翟耆年好奇，巾服一如唐人，自名唐装。一日往见许彦周。彦周髽髻，著犊鼻裤，蹑高屐出迎。翟愕然。彦周徐曰：“吾晋装也，公何怪？”
&lt;em&gt; 梦龙注: 只容得你唐装！&lt;/em&gt;

ps:有点像司马相如跟卓文君私奔时&quot;自着犊鼻裤，与保庸杂作，涤器于市中&quot;的风范.  不知道这个&quot;犊鼻裤&quot;是啥样?看到了这篇&quot;&lt;a href=&quot;http://www.shurato.org/bbs/MINI/Default.asp?100-5868-0-0-0-0-0-a-.htm&quot; target=&quot;_blank&quot;&gt;[二十年二十题之]犊鼻裤 &lt;/a&gt;&quot; ,难道就是日本相扑中穿得那个丁字裤? oh no.

&lt;strong&gt;浴酒&lt;/strong&gt;

石裕造酒数斛，忽解衣入其中，恣沐浴而出，告子弟曰：“吾平生饮酒，恨毛发未识其味。今日聊以设之，庶无厚薄。”

ps:喝酒能喝道这个地步,叫我等只能喝两瓶啤酒的人情何以堪?
&lt;pre&gt;&lt;strong&gt;痴趣&lt;/strong&gt;
陶渊明日用铜钵煮粥为食，遇发火，则再拜曰：“非有是火，何以充腹？”
贾岛常以岁除，取一年所得诗，祭以酒，曰：“劳吾精神，以是补之。”
韩退之尝登华山巅，穷极幽险，心悸目眩，不能下，发狂号哭，投书与家人别。华阴令百计取之，方能下。
张旭大醉，以头濡墨而书。
ps:每当看到最后一句, &quot;狂草&quot;张旭这个举动,令人感叹,这个是痴迷到了何种地址,都叫人羡慕.
我们应该效仿贾岛,过年时,取一年所写代码,祭以酒，曰：“劳吾精神，以是补之。”&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;拙对&lt;/strong&gt;
《谐史》：河南一士夫延师教子，其子不慧。出对曰：“门前绿水流将去。”
子对云：“屋里青山跳出来。”士夫甚怒。
一日士夫偕馆宾诣一道观拜客。道士有号彭青山者，脚跛，闻士夫至，跳出相迎。
馆宾谓士夫曰：“昨令公子所谓‘屋里青山跳出来’，信有之矣。”士夫乃大笑。

ps:这学问可比还珠格格好多了&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;不知杜少陵&lt;/strong&gt;
宋乾道间，林谦之为司业，与正字彭仲举游天竺小饮。
论诗，谈到少陵妙处，仲举微醉，忽大呼曰；“杜少陵可杀！”
有俗子在邻壁，闻之，遍告人曰；“有一怪事，林司业与彭正字在天竺谋杀人。”
或问：“所谋杀为谁？”曰：“杜少陵也，但不知何处人。”闻者绝倒。

&lt;strong&gt;雪诗&lt;/strong&gt;&lt;/pre&gt;
&lt;pre&gt;陆诗伯《雪》诗云：“大雪洋洋下，柴米都长价。板凳当柴烧，吓得床儿怕。”又云：“玉皇大帝卖私盐，一个苏州拖面煎。”
又云：“不闻天上打罗橱，满地纷纷都是面。”又云：“昨夜玉皇哀诏到，万里江山都带孝。”

ps:很好的描述当前的物价水平下人民大众的生活&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;点金成铁&lt;/strong&gt;
梁王籍诗云：“蝉噪林愈静，鸟鸣山更幽。”王荆公改用其句曰：“一鸟不鸣山更幽。”
山谷笑曰：“此‘点金成铁’手也！”

ps:王安石悲剧了,这一改可是没有&quot;绿&quot;字那么传神&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;马上食饼&lt;/strong&gt;
张衡由令史至三品，已团甲，退朝，于路傍见蒸饼新熟，遂买得，于马上食之。为御史弹奏，竟落甲。
&lt;em&gt;梦龙注:向闻二卵弃将，今见一饼失官，若在晋人，反为任诞。

 &lt;/em&gt;ps:难得真性情 可以在唐代,而非晋朝&lt;em&gt; &lt;/em&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;鸣鹅&lt;/strong&gt;
会稽有姥，养一鹅，善鸣。右军求市不得，遂携亲友就观。姥闻羲之至，烹鹅以待。右军叹惜弥日。
ps:王羲之果然爱鹅,难道鹅跟书法之间有联系?

&lt;strong&gt;爱杜甫、贾浪仙诗&lt;/strong&gt;
张籍取杜甫诗一帙，焚取灰烬，副以膏蜜，顿饮之，曰：“令吾肝肠从此改易。”
李洞慕贾浪仙诗，铸铜像，事之如神，常念贾岛佛。

ps:张籍中晚年的诗句还真有杜甫的现实注意风范;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;石&lt;/strong&gt;
&lt;em&gt;梦龙注:袁石公曰：“陶之菊，林之梅，米之石。非爱菊、梅与石也。吾爱吾也。”&lt;/em&gt;
僧敄周有端州石，屹起成山，其麓受水可磨。米后得之，抱之眠三日。
ps:看到米芾看完&amp;lt;灌篮高手&amp;gt;之后的情形,抱着篮球睡&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;柳三变&lt;/strong&gt;
柳耆卿为屯田员外郎，初名三变。自作词云：“才子词人，自是白衣卿相。”
后有荐于朝者，仁宗曰：“此人风前月下且去填词！”
由是不得志，无复检率，自称“奉圣旨填词柳三变”。
&lt;em&gt;&lt;em&gt;梦龙注:&lt;/em&gt;按柳永死日，家无余财，群妓合金葬之郊外，每春月上冢，谓之“吊柳七”。 子犹曰：“生虽白衣贱，死得红裙怜。北邙冢累累，白杨风满天。卿相代有作，谁复追黄泉。呜乎柳三变，风流至今传。”&lt;/em&gt;
ps:霸气外漏&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;肉唾壶&lt;/strong&gt;
苻朗尝与朝士宴。时贤并用唾壶。朗欲夸之，使小儿跪而张口，唾而含出。
南宋谢景仁裕性整洁。每唾，辄唾左右人衣。事毕，即听一日浣濯。每欲唾，左右争来受之。
严世蕃吐唾，皆美婢以口承之。方发声，婢口已巧就。谓曰“香唾盂”。&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;张鹭鹚&lt;/strong&gt;
开宝中，神泉县令张某，外廉而内实贪。一日自榜县门云：“某月某日是知县生日。告示门内典级诸色人，不得辄有献送。”
有一曹吏与众议曰：“宰君明言生日，意令我辈知也。言不得献送，是谦也。”众曰：“然。”
至日各持缣献之，命曰“寿衣”。宰一无所拒，感领而已。复告之曰：“后月某日，是县君生日，更莫将来。”无不嗤者。
众进士以鹭鹚诗讽之云：“飞来疑似鹤，下处却寻鱼。”
ps:跟目前官场一样, 古今都一样&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;食人胆&lt;/strong&gt;
五代赵思绾反。尝言“食人胆至千，刚勇无敌”，每杀人，辄取胆以酒吞之。后为郭从义所擒。
&lt;strong&gt;生食人耳&lt;/strong&gt;
宋王彦升俘获胡人，置酒宴饮，以手裂其耳，咀嚼久之，徐引卮酒。俘者流血被面，痛楚叫号，彦升谈笑自如
ps:如此悍将给&lt;span&gt;赵匡胤守西北,不愧是心腹,但是这个太恐怖了把 &lt;/span&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;程师孟、张安国&lt;/strong&gt;
程师孟尝请于荆公曰：“公文章命世，某幸与公同时，愿得公为墓志，庶传不朽。”公问：“先正何官？”
程曰：“非也。某恐不得常侍左右，预求以俟异日。”
又王雱死，张安国披发籍草，突于柩前，曰：“公不幸未有子，今夫人有娠，某愿死，托生为公嗣。”
京师嘲曰：“程师孟生求速死，张安国死愿托生。”

 ps:难道此张安国正是被辛弃疾五十骑于万军中擒拿到的叛将?&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;不敢须&lt;/strong&gt;
少司徒王祐谄事太监王振。振一日问曰：“王侍郎何故无须？”曰：“老爷无须，儿子岂敢有须？”&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;车武子妇&lt;/strong&gt;
车武子妇妒。武子偶偕妇兄夜归，留宿外馆，取一绛裙挂屏上。妇出窥，疑有所私，拔刀径上床，发被，乃其兄也，惭而退。
ps:车胤(也就是车胤囊萤夜读)典故来由之人,居然有如此悍妇, 不得不唏嘘,不过也许他说不定是smart gay&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;头断复连&lt;/strong&gt;
正德时，济下一秀才遭流贼乱，奔避不及被贼砍，觉头落胸间而喉不断，亟以手捧头置之项上，热血凝结，痛极遂死。
久之稍苏，卧野田间。寇退，家人求尸舁归。旬日不死，颇能咽汤粥。百日痂脱，视其颈瘢痕如絙入腮下。
ps:坑爹阿,不可能把.不过说不定人的求生意识也有可能&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;爱东坡&lt;/strong&gt;
陆宅之善谐谑，每语人曰：“吾甚爱东坡。”时有问之者，曰：“东坡有文，有赋，有诗，有字，有东坡巾。君所爱何居？”
陆曰：“吾甚爱一味东坡肉！”闻者大笑。
ps:东坡要是生在现在,恐怕也只能望猪肉兴叹&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;解缙&lt;/strong&gt;
解缙尝从游内苑。上登桥，间缙：“当作何语？”对曰：“此谓‘一步高一步’。”及下桥，又问之。
对曰：“此谓‘后边又高似前边’。”上大悦。一日，上谓缙曰：“卿知宫中夜来有喜乎？可作一诗。”
方吟曰：“君王昨夜降金龙。”上遽曰：“是女儿。”即应曰：“化作嫦娥下九重。”上曰：“已死矣！”
又应曰：“料是世间留不住。”上曰：“投之水矣。“又应：”翻身跳入水晶宫。”上本欲诡言以困之，既得诗，深叹其敏。

解缙四岁出游市中，偶跌，众笑之。吟曰：“细雨落绸缪，砖街滑似油。凤凰跌在地，笑杀一群牛。”&lt;/pre&gt;
&lt;pre&gt;ps:这可可以跟纪晓岚有得一拼,不愧是明朝第一位大三元的人,才思敏捷, &amp;lt;永乐大典&amp;gt;的编辑者.&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;公猴&lt;/strong&gt;
三杨当国时，有一妓名齐雅秀，性极巧慧。一日命佐酒。众谓曰：“汝能使三阁老笑乎？”对曰：“我一入便令笑也。”
乃进见。问：“何来迟？”对曰：“看书。”问：“何书？”对曰：“《烈女传》。”三阁老大笑，曰；“母狗无礼！”
即答曰：“我是母狗，各位是公猴。”一时京中大传其妙。&lt;/pre&gt;
&lt;pre&gt;ps:妙不可言~  &quot;公猴&quot; 谐音似 &quot;公侯&quot;, 三杨都是公的爵位,这么位高权重的人,这么有名的三杨,却被一妓女调侃.佩服&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;苏小妹&lt;/strong&gt;
东坡有小妹，善词赋，敏慧多辩，其额广而如凸。东坡尝戏之曰：“莲步未离香阁下，梅妆先露画屏前。”
妹即应声云：“欲扣齿牙无觅处，忽闻毛里有声传。”以坡公多须髯，遂亦戏答。时年十岁耳。&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;李东阳&lt;/strong&gt;
焦阁老芳，面黑而长，如驴。尝谓西涯曰：“君善相，烦一看。
”李久之乃曰：“左相象马尚书，右相象卢侍郎，必至此地位。”“马”与“卢”合，乃一“驴”宇，始知其戏。

邃翁冬天气盛，而西涯怯寒。二公同坐，西涯屡以足顿地作声。
邃翁曰：“地冻马蹄声得得。”西涯见其吐气如蒸，戏云：“天寒驴嘴气腾腾。”&lt;/pre&gt;
&lt;pre&gt;李西涯居政府时，庶吉士进谒，有言“阁下李先生”者。公闻之，既相见，因曰；“请诸君属一对，云‘庭前花始放’。
”众疑其太易，转思未工。各沉吟间，公曰：“何不对‘阁下李先生’？”相赞而笑。&lt;/pre&gt;
&lt;pre&gt;ps:李东阳这位首辅果然是才气外漏,有意思,搞笑. 而杨一清跟李东阳两位明代诗歌的先驱者,私底下如此搞笑,读起来倍感亲切.&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;石学士&lt;/strong&gt;
石曼卿尝出游报宁寺，驭者失控。马惊走，曼卿堕地，戏曰：“幸是石学士，若瓦学士，岂不破碎！”
ps: &quot;天若有情天亦老，月如无恨月长圆&quot; 对得起下一句的石学士生活中也是宽容大气. 人品,才气哪一样能不让欧阳修,梅尧臣等诚服&lt;/pre&gt;
&lt;pre&gt;&lt;strong&gt;十七字诗&lt;/strong&gt;
正德间，有无赖子好作十七字诗，触目成咏。时天旱，府守祈雨未诚，神无感应。
其人作诗嘲之曰：“太守出祷雨，万民皆喜悦。昨夜推窗看，见月！”
守知，令人捕至，曰：“汝善作十七字诗耶？试再吟之，佳则释尔。”
即以别号“西坡”命题。其人应声曰：“古人号东坡，今人号西坡。若将两人较，差多。”守大怒，责之十八。
其人又吟曰：“作诗十七字，被责一十八。若上万言书，打杀！”守亦哂而逐之。

一说：守坐以诽谤律，发配郧阳。其母舅送之，相持而泣。
泣止，曰：“吾又有诗矣：发配在郧阳，见舅如见娘。两人齐下泪，三行。”盖舅乃眇一目者也。
ps:有创意&lt;/pre&gt;

&lt;h4&gt;有兴趣者可以去看看&lt;古今谭概&gt;这本书&lt;/h4&gt;
</content>
 </entry>
 
 <entry>
   <title>近期郑大晔校总结</title>
   <link href="http://tuo.github.com8.html"/>
   <updated>2011-09-17T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e8%bf%91%e6%9c%9f%e9%83%91%e5%a4%a7%e6%99%94%e6%a0%a1%e6%80%bb%e7%bb%93</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这两期的&lt;a href=&quot;http://dreamhead.blogbus.com/&quot; target=&quot;_blank&quot;&gt;郑大晔校&lt;/a&gt;,感觉收获很多.第一次讨论一个程序员应该具备的好的编程习惯;第二次像经验丰富的资深程序员发问.我总结了一下郑大晔校中自己感兴趣的话题和近期的工作碰到问题:
&lt;h3&gt;    1.熟悉编辑器的快捷键.&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这一点我去年进公司时印象深刻,那个时候是一个.NET项目使用Visual Studio,跟&lt;a href=&quot;http://www.iamhukai.com/&quot; target=&quot;_blank&quot;&gt;胡凯&lt;/a&gt;结对编程的时候,胡所一般都会把鼠标收起来,完全丢弃, 直接各种键盘流, 看得我惊叹.紧接着胡所就把Resharper的快捷键打印出来,让大家私底下回去记忆,顺便讲到了他记忆快捷键的方法(使用小卡片,在公交车上背阿). 这个的好处就是使你的大脑思维集中在你关注的事情上面,保持自己的编码节奏,提高开发的效率. 所以熟悉快捷键操作是非常重要的,公司里几乎每个人接触到新的编辑器,都会从先熟悉快捷键开始.
&lt;h3&gt;     2.Tasking任务划分.&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这里的Task指的不是评估story,而是程序员在编码中将story拆分成一个个小任务,这些任务可以以通过对应的测试为验收标准.之前&lt;a href=&quot;http://blog.vincentx.info/&quot; target=&quot;_blank&quot;&gt;徐昊&lt;/a&gt;去年在做OO bootcamp时,我记得印象深刻的是他强调了划分小任务的重要性.他问道读过&amp;lt;&amp;lt;Test Driven Development by exmaple&amp;gt;&amp;gt;的觉得里面重要的是啥? 最重要的是他每隔小节中都会提到的任务列表, 每次做完一个小任务,他会划掉,并且加上新的小任务,然后用TDD方式实现.同时另外一个感触是每次团队中有新人加入,我们的结对编程会是,有经验的人会跟新手一起过一遍story,然后划分为一个个的小任务列表,到后来就是直接让新手自己先写出任务表, 写完之后一起浏览过一遍, 这样做非常好在于当你在写task的时候, 你会发现很多时候你的问题的认识是不到位的.Tasking好处在于帮助大脑将复杂的事情拆分为简单可行的任务列表.任务的划分可以使用&lt;a href=&quot;http://www.energizedwork.com/weblog/2005/05/slicing-the-cake&quot; target=&quot;_blank&quot;&gt;垂直划分&lt;/a&gt;的方式.
&lt;h3&gt;      3. Timebox.&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这个Timbox不是说到Scrum中的迭代,而是在编码过程中对于某件事情固定一个时间范围约束.为什么会这样?我本人就犯错的经历.某次开发中接到一个技术任务,而后按照我认为我自己的理解开始干活,这个过程中碰到问题了,那好我就潜进去看为什么,结果吭哧吭哧搞了一天,最后发结果发出去了,人家说不对,你理解错了,结果就整个浪费了一天.我在想接到这件事情时,我自己很清楚这个东西应该只需要2个小时或者做多半天的.但是中间自己遇到问题却也没有及时跳出来问问题,自己仍在钻研,结果半天之后发现自己的理解错了.所以很多时候遇到事情,可以在开始干之前给自己一个时间范围,超过这个时间了,没有完成,你可以暂时停下来跟其他人交流确认你遇到的问题,毕竟自己一开始按照自己理解而设置的时间阈值不够,也许真是问题比自己了解的要复杂,或许其他时候是自己的理解不准确或者方向不正确.比如上次碰到的Apache SSL的配置问题, 因为大家都不是非常熟悉Apache的一些配置,吭哧吭哧在那里搞了半天,结果还是没有搞出来.后来跳出团队,问其他团队Apache经验比较的多的人,一解释立马就豁然开朗了.
&lt;h3&gt;      4.观察力.&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;公司很多项目中有用到故事墙来描述故事的状态,哪些是在In Dev,那些在In Dev Done, 哪些是In QA;也有大的电视投放jenkins上构建的状态(见前一篇博客);这些都是为了将项目的状态尽量的视觉化出来,让大家都在同一个上下文中.我注意到胡所貌似给admin也有应用类似的理念,公司入门口就有一个白板,上面标注着admin哪些工作正在做,哪些做完了等等, 这样即使是开发写代码的人也知道admin在做什么事情.比如admin谈到对技术不是特别懂,可能有时候比如招聘会有人问技术之类的,就不太好回答, 那我一个同事就有给admin做一个讲座,主要介绍当前办公室正在使用的技术(以至于有HR直接转成BA).目前有很热的为了消除开发人员与运维人员之间隔阂障碍的DevOps, 我觉得目前我们就有做DevAdmin, 这个就像设计模式源于建筑设计师Christopher Alexander.虽然之前写得&lt;a href=&quot;https://github.com/tuo/jenkins-dashboard&quot; target=&quot;_blank&quot;&gt;jenkins-dashboard&lt;/a&gt;写的很简单还有很多不足,但是看到有其他项目也有用到,效果还不错,这个也挺满足的.做一个有心人,观察生活或者工作中其他人是否有碰到不便或者麻烦的事情,想想以自己的知识和能力能否帮助到别人, 这是非常重要的.
&lt;h3&gt;      5.结对编程.&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;结对编程这件事情其实源自三哥的一个提问, 其实也是我自己的一个疑惑: 是否什么情况下都能结对?有什么情况是不适合结对? 其实反问自己, 尽管每天都在结对编程中, 但是对于最基本的问题,我却也是无法回答.但是近期看到前TWer Jay Fields的最新更新的文章&lt;a href=&quot;http://blog.jayfields.com/2011/08/life-after-pair-programming.html&quot; target=&quot;_blank&quot;&gt;Life after Pair Programming&lt;/a&gt;, 结合他自己实际一一&quot;驳斥&quot;了 &lt;a href=&quot;http://pragprog.com/magazines/2011-07/pair-programming-benefits&quot; target=&quot;_blank&quot;&gt;Pair Programming Benefits&lt;/a&gt;中提到的pair的优点,给人满多思考的.
&lt;h3&gt;      6.站立会议.&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最近的站立会议中我们发现客户的Product Owner,在我们这边发言时,不知道什么原因,可能是技术方面的东东她不太感冒,扭过头去跟旁边的UI设计人员讨论mockup去了.站立会议完了之后,同事提问到为什么product owner会提不起精神,我们要思考我们standup发的言,对于product owner或者说iteration manager有意义才行. 但是之后,我自己很有疑问: 我们是开发人员,更多的时候确实说的事情在商业价值不是非常明显能表达出来. 于是看了看&lt;a href=&quot;http://martinfowler.com/articles/itsNotJustStandingUp.html&quot; target=&quot;_blank&quot;&gt;It's Not Just Standing Up: Patterns for Daily Standup Meetings&lt;/a&gt;. 作者提到站立会议应该说: 昨天做了什么? 今天将要做什么? 有什么东西阻碍我们的进展?  并且提到不太好的站立会议的一个特征便是: &lt;a href=&quot;http://martinfowler.com/articles/itsNotJustStandingUp.html#ReportingToTheLeader&quot; target=&quot;_blank&quot;&gt;Reporting To The Leader&lt;/a&gt;. 更多的时候,站立会议的意义在于让团队知道对方在做什么,目前团队遇到的问题,使得大家能在同一个上下文中.

&amp;nbsp;
</content>
 </entry>
 
 <entry>
   <title>Jenkins的一些实践</title>
   <link href="http://tuo.github.com7.html"/>
   <updated>2011-09-11T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./jenkins%e7%9a%84%e4%b8%80%e4%ba%9b%e5%ae%9e%e8%b7%b5</id>
   <content type="html">持续集成已经是大家都非常熟悉的概念了,可以参考Martin的文章&lt;a href=&quot;http://martinfowler.com/articles/continuousIntegration.html&quot; target=&quot;_blank&quot;&gt;Continuous Integration&lt;/a&gt; .而Jenkins(原名hudson)正是业界最为流行的持续集成引擎.本文正是总结了近期工作之中一些使用jenkins的收获.
&lt;h3&gt;&lt;a href=&quot;http://martinfowler.com/articles/continuousIntegration.html#KeepTheBuildFast&quot;&gt;Keep the Build Fast&lt;/a&gt;&lt;/h3&gt;
保持CI(持续集成服务器)上的工作快速是一个非常重要的方面, 这样才能提供快速的反馈.没有人会忍受一个构建跑上一个小时,毕竟喝上一个小时的茶或者咖啡也还是真是蛮浪费时间的. 之前的持续集成构建都得跑上半个小时,因为这个构建的代码库非常大,不止一个项目.每次构建都会按照一下顺序逐一执行:

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/Sequential-Workflow-Build-Italic1.jpg&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-170&quot; title=&quot;Sequential Workflow Build Italic&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/Sequential-Workflow-Build-Italic1.jpg&quot; alt=&quot;&quot; width=&quot;582&quot; height=&quot;139&quot; /&gt;&lt;/a&gt;

可以看出这是一个具有完整构建阶段的流程. 但是每一个阶段都是按照顺序执行,是不是它们之间有严格的依赖了? 比如跑javascript单元测试得先跑quality检查了?   Quality Check大致使用metric_fu等质量检测的工具来进行,包括检查代码复杂度,重复度, 以及jslint语法的检查等等. 这就跟javascript单元测试这个阶段没有直接的耦合.同样的也可以对其他阶段进行分析. 所以能否将每个阶段都抽取出来了作为一个独立的构建, 然后触发时每个构建都同时执行, 而不是顺序执行了?  这里我们可以使用Jenkins的一个插件&lt;a href=&quot;https://wiki.jenkins-ci.org/display/JENKINS/Join+Plugin&quot; target=&quot;_blank&quot;&gt;Join&lt;/a&gt;.
&lt;blockquote&gt;This plugin allows a job to be run after all the immediate downstream jobs have completed.   In this way,  the execution can branch out and perform many steps in parallel, and then run a final aggregation step just once after all the parallel work is finished.&lt;/blockquote&gt;
Join适合于&quot;钻石&quot;依赖型的项目. 也就是我们上面的构建流程可以转换成:

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/Diamond-Shape3.jpg&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-168&quot; title=&quot;Diamond Shape&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/Diamond-Shape3.jpg&quot; alt=&quot;&quot; width=&quot;493&quot; height=&quot;280&quot; /&gt;&lt;/a&gt;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

可以看到上面的几个阶段之间没有什么依赖,同时它们却都有一个聚合的阶段,便是Build Artifact. 这样的好处在于位于钻石形状上方的构建job是可以并发的执行,相比顺序执行,时间可是节省不少.

对于一个代码库融合了多个项目的情况, 另外一件可以做得事情是, 对于每个特定的阶段按照不同项目或团队划分.比如cucumber构建,它可能是包括好几个项目的features.所以每一次测试失败, 首先是难以知道是哪个项目的feature挂了, 另外一个也是非常慢.  所以可以做得是将之前单独的一个cucumber构建, 按照不同项目进行划分, 比如projectA-cucumber , projectB-cucumber 等等. 对于这种情形,另外一个可以追踪的问题便是能不能把不同项目从同一代码库中抽离出来放在独立的代码库中, 或许上面提到的问题都不存在了.
&lt;h3&gt;&lt;a href=&quot;http://martinfowler.com/articles/continuousIntegration.html#EveryoneCanSeeWhatsHappening&quot;&gt;Everyone can see what's happening&lt;/a&gt;&lt;/h3&gt;
当每次准备好一个Jenkins,看到的构建状态与小球颜色的关系总是让人有点不习惯.为什么? 因为它用蓝色代表成功, 你可能想根据测试驱动开发我们熟悉的节奏&quot;red-refactor-green&quot;, 如果构建成功的话,应该是绿色阿.因为蓝色更容易被色盲的人识别.所以如果你们项目没有色盲的人,就非常推荐使用&lt;a href=&quot;https://wiki.jenkins-ci.org/display/JENKINS/Green+Balls&quot; target=&quot;_blank&quot;&gt;GreenBall&lt;/a&gt;这个插件, 这样一来所有构建成功都会显示绿色.

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/greenballview.jpg&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-173&quot; title=&quot;greenballview&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/greenballview.jpg&quot; alt=&quot;&quot; width=&quot;500&quot; height=&quot;177&quot; /&gt;&lt;/a&gt;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

对于团队中的个人而言,每次都得打开Jenkins的地址去查看构建状态,这个有时候太麻烦. 所以你可以尝试使用&lt;a href=&quot;http://ccmenu.sourceforge.net/&quot; target=&quot;_blank&quot;&gt;CCMenu&lt;/a&gt;,配合Growl, 你可以时时看到构建的状态.

对于个人,CCMenu可能已经满足了大部分需求. 但是如果团队稍微大一点, 比如4-5个人以上, 同时在一块地方,有没有更好的方式来显示构建的状态了?   我们通常会是有一个独立的显示器,放在大家抬头就能看到的位置, 这个显示器主要是显示构建的状态. 当然你可以是在显示器中打开Jenkins的地址,让大家自己查找想看的构建信息,但是就是噪音太大. 所以你可以尝试使用Jenkins的一个插件: &lt;a href=&quot;https://wiki.jenkins-ci.org/display/JENKINS/Radiator+View+Plugin&quot; target=&quot;_blank&quot;&gt;Radiator View Plugin&lt;/a&gt;. 你可以增加一个View,然后选择Radiator View,并配置你想监控构建的一些信息.

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/radiatorviewplugin1.jpg&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-172&quot; title=&quot;radiatorviewplugin&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/radiatorviewplugin1.jpg&quot; alt=&quot;&quot; width=&quot;380&quot; height=&quot;200&quot; /&gt;&lt;/a&gt;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

这个看起来还满不错的, 而且配置简单.

在工作中,客户有好几个专门的显示器,用来显示每个构建的状态.类似于下图, 它是用python写的, 因为我也没学过python,借鉴了用户的UI设计, 就用ruby重写了一下.它每一个构建是一个小方块, 绿色表示构建成功, 红色表示失败, 蓝色表示正在构建,同时在右下端有时间戳表示当前构建的时间.这个项目正在开发,应该马上就会放到github上面.你只要给定jenkins的地址,以及你想关注的job的名字就可以了.这个可以参考&lt;a href=&quot;https://github.com/tuo/jenkins-dashboard&quot; target=&quot;_blank&quot;&gt;jenkins-dashboard&lt;/a&gt;项目.

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/jenkins-dashboard.jpg&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-174&quot; title=&quot;jenkins-dashboard&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/jenkins-dashboard.jpg&quot; alt=&quot;&quot; width=&quot;500&quot; height=&quot;269&quot; /&gt;&lt;/a&gt;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

是的, 除了这个之外, 还有高级的一点的&lt;span&gt;&lt;a href=&quot;https://wiki.jenkins-ci.org/pages/viewpage.action?pageId=20250625&quot;&gt;The Hudson Bear Lamps&lt;/a&gt;. 用灯的颜色来表示当前构建的状态. 这个比上面的来得更加直观. 但是这个灯不知道国内能否买到.&lt;/span&gt;

&lt;img class=&quot;alignleft size-full wp-image-175&quot; style=&quot;border-style: initial; border-color: initial;&quot; title=&quot;traffic light&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/traffic-light.jpg&quot; alt=&quot;&quot; width=&quot;616&quot; height=&quot;246&quot; /&gt;

还有一点从工作中学到的便是,对于大型的而且是分布式的团队而言, 如何让信息交流更通畅. 对于构建而言, 如果某一次提交将构建弄费了, 首先那个弄费的人(当然不一定是那个弄费的人在修构建)赶紧修改代码让构建通过, 同时还得让其他人,那些跟你不在一地的人知道当前失败的构建有人在处理. 在项目实践中, 就有这样的构建,如果某人将构建弄费,他(她)可以通过加bookmarklet小书签的方式来声明&quot;是我将构建弄费,我正在修理中....&quot;, 这个小书签就是发出一个ajax请求,将当前声明人的名字,哪一个构建等信息发给服务器,服务器在修改html的结构在对应的构建上打上某人的名字的邮戳.

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/build-claim2.jpg&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-178&quot; title=&quot;build claim&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/09/build-claim2.jpg&quot; alt=&quot;&quot; width=&quot;500&quot; height=&quot;139&quot; /&gt;&lt;/a&gt;
当然这个问题我是有疑问的, 理论上如果某一次你将构建搞失败了,第一件事应该是在CI上反转你的提交,这样别人就可以提交,而不必等你修理构建之后才能提交,这个实在是浪费别人的时间.当然这个前提上,大家遵守约定,就是必须是在构建为绿色的情况下才提交,不能说在构建失败后还继续提交.
</content>
 </entry>
 
 <entry>
   <title>第一个RubyGem jenkins-remote-api</title>
   <link href="http://tuo.github.com/jenkins-remote-api-rubygem"/>
   <updated>2011-09-03T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/jenkins-remote-api-rubygem</id>
   <content type="html">这个Gem主要是用来消化Jenkins提供的API,方便查询CI的状态. 这个RubyGem开发主要用到了&lt;a href=&quot;http://yehudakatz.com/2010/04/02/using-gemspecs-as-intended/&quot; target=&quot;_blank&quot;&gt;bundler&lt;/a&gt;,而非&lt;a href=&quot;http://mlomnicki.com/ruby/rubygems/2011/01/22/jeweler-vs-bundler.html&quot; target=&quot;_blank&quot;&gt;jeweler&lt;/a&gt;,同时用到了&lt;a href=&quot;https://github.com/cucumber/aruba&quot; target=&quot;_blank&quot;&gt;Aruba&lt;/a&gt;提供了CLI支持,这样方便了用户使用.

&amp;nbsp;

更多信息,参考Github地址: &lt;a href=&quot;https://github.com/tuo/jenkins-remote-api/blob/master/README.md&quot; target=&quot;_blank&quot;&gt;https://github.com/tuo/jenkins-remote-api/blob/master/README.md&lt;/a&gt;

RubyGem上地址: &lt;a href=&quot;https://rubygems.org/gems/jenkins-remote-api&quot; target=&quot;_blank&quot;&gt;https://rubygems.org/gems/jenkins-remote-api&lt;/a&gt;
&lt;a href=&quot;https://github.com/radar/guides/blob/master/gem-development.md&quot; target=&quot;_blank&quot;&gt;Developing a RubyGem using Bundler&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>selenium rc和webdriver</title>
   <link href="http://tuo.github.com6.html"/>
   <updated>2011-08-17T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./selenium-rc%e5%92%8cwebdriver</id>
   <content type="html">前两天在跟结对的同事查看一段我之前写的自动化搭建初始数据的代码时,同事问我为什么需要起一个selenium server才能跑起来,而我们的本地跑的cucumber测试却没有需要你显示的跑一个selenium server.我一时其实也回答不上来,下班后仔细查了查selenium的文档,才豁然开朗.我之前用的是&lt;a href=&quot;http://selenium-client.rubyforge.org/&quot; target=&quot;_blank&quot;&gt;selenium-client&lt;/a&gt;, 因为我之前想用它来截取每个浏览器的屏幕, 而selenium-client提供了很好API来跟浏览器打交道(甚至内置的截图方法),  它是基于Selenium RC的.讲到这个先简要介绍一下selenium,它主要用来驱动和跟浏览器做交互,实现web应用程序的自动化测试. 所以意味着selenium必须有一套自己跟浏览器交互的API.

selenium根据实现形式的不同分为两种: selenium rc 和 webdriver.

&lt;h4&gt;Selenium RC&lt;/h4&gt;

selenium rc 是比较早提出来的, 它的大概流程是这样:  selenium rc客户端先跟服务器端建立联系, 然后服务器端启动一个浏览器,将主要selenium核心的javascript注入到浏览器中. 然后客户端将不同语言编写的代码

比如在selenium-client ruby代码是这样
&lt;pre lang=&quot;ruby&quot;&gt;    require &quot;rubygems&quot;
    gem &quot;selenium-client&quot;, &quot;~=1.2.16&quot;
    require &quot;selenium/client&quot;
    begin
      @browser = Selenium::Client::Driver.new 
          :host =&gt; &quot;localhost&quot;,
          :port =&gt; 4444,
          :browser =&gt; &quot;*firefox&quot;,
          :url =&gt; &quot;http://www.google.com&quot;,
          :timeout_in_second =&gt; 60

      @browser.start_new_browser_session
        @browser.open &quot;/&quot;
        @browser.type &quot;q&quot;, &quot;Selenium seleniumhq.org&quot;
        @browser.click &quot;btnG&quot;, :wait_for =&gt; :page
        puts @browser.text?(&quot;seleniumhq.org&quot;)
    ensure
      @browser.close_current_browser_session
    end&lt;/pre&gt;
转换为一种中间的指令&lt;span class=&quot;Apple-style-span&quot; style=&quot;font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px; white-space: normal;&quot;&gt;Selenese,然后发给服务器端,服务器在浏览器中请求对应的URL,拿到页面后,再将Selenese转换成对应的javascript指令注射到浏览器当前页面中并执行,最后在关闭浏览器.&lt;/span&gt;
&lt;span class=&quot;Apple-style-span&quot; style=&quot;font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px; white-space: normal;&quot;&gt;所以selenium RC是使用javascript来跟浏览器进行交互的.&lt;/span&gt;&lt;/pre&gt;

&lt;h4&gt;Selenium Webdriver&lt;/h4&gt;
selenium webdriver采取的一条不同方式,它不是使用javascript来跟浏览器打交道,
而是实现了跟每一个不同浏览器特定相关的原生API来跟浏览器打交道.所以意味着它正对某种浏览器,都有一个对应的driver.

好处在于它绕过了selenium rc使用javascript跟浏览器交互的一些弊病,比如&lt;a href=&quot;http://www.openqa.org/selenium-rc/tutorial.html&quot; rel=&quot;nofollow&quot;&gt;same origin&lt;/a&gt;. 同时Selenium Webdriver旨在提供一套更加面向对象方式的API.因为它使用每个浏览器原生API来打交道,所以一方面它比selenium rc会更快更稳定,同时就意味着我们可以这么说&quot;如果你使用的是selenium webdriver的话,你就可以直接抛弃selenium server.&quot; 因为你根本不需要启动一个服务器来处理跟浏览器交互.
&lt;pre lang=&quot;ruby&quot;&gt;
require 'rubygems'
require 'selenium-webdriver'

driver = Selenium::WebDriver.for :firefox
driver.get &quot;http://google.com&quot;

element = driver.find_element :name =&gt; &quot;q&quot;
element.send_keys &quot;Selenium seleniumhq.org&quot;
element.submit

puts &quot;Page title is #{driver.title}&quot;

wait = Selenium::WebDriver::Wait.new(:timeout =&gt; 10)
wait.until { driver.title.downcase.start_with? &quot;Selenium seleniumhq.org&quot; }
puts &quot;Page title is #{driver.title}&quot;
driver.quit
&lt;/pre&gt;
之前提到每个浏览器都得有自己对应的driver,现在目前有支持:&lt;a href=&quot;http://seleniumhq.org/docs/03_webdriver.html#firefox-driver&quot; target=&quot;_blank&quot;&gt;FirefoxDriver&lt;/a&gt;, ChromeDriver, IEDriver和OperaDriver,甚至有&lt;a href=&quot;http://code.google.com/p/selenium/wiki/IPhoneDriver&quot; target=&quot;_blank&quot;&gt;IPhoneDriver&lt;/a&gt;.

但是相对selenium rc, webdriver它对alert/confirm框的支持还不是很好.

Capybara的selenium使用的是哪一种了 selenium RC 或 Webdriver?
你可以从&lt;a href=&quot;https://github.com/jnicklas/capybara&quot; target=&quot;_blank&quot;&gt;Capybara&lt;/a&gt;的github wiki说明上找到:
&lt;em&gt;  At the moment, Capybara supports Selenium 2.0 (Webdriver), not Selenium RC.&lt;/em&gt;

在capybara中,你可以注册不同浏览器对应的driver:
&lt;pre lang=&quot;ruby&quot;&gt;
 Capybara.register_driver :selenium do |app|
   Capybara::Selenium::Driver.new(app, :browser =&amp;gt; :chrome) 
 end
&lt;/pre&gt;

&lt;h4&gt;Ruby Bindings&lt;/h4&gt;
selenium webdriver 提供了非常好的ruby支持,可以参考&lt;span class=&quot;Apple-style-span&quot; style=&quot;font-family: Georgia, 'Times New Roman', 'Bitstream Charter', Times, serif; font-size: 13px; line-height: 19px; white-space: normal;&quot;&gt;&lt;a href=&quot;http://code.google.com/p/selenium/wiki/RubyBindings&quot; target=&quot;_blank&quot;&gt;Selenium-webdriver Ruby&lt;/a&gt;.&lt;/span&gt;

&lt;h4&gt;References&lt;/h4&gt;
For more information, pls refer to site docs: &lt;ahref=&quot;http://seleniumhq.org/docs/&quot;&gt;http://seleniumhq.org/docs/&lt;/a&gt;

Official Blog:&lt;a href=&quot;http://seleniumhq.wordpress.com/&quot;&gt;http://seleniumhq.wordpress.com/&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>安装Puppet</title>
   <link href="http://tuo.github.com5.html"/>
   <updated>2011-07-16T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%ae%89%e8%a3%85puppet</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;近些年来出现了很多热词,其中有一个就是&lt;a title=&quot;infrastructure as code&quot; href=&quot;http://www.infoq.com/presentations/infrastructure-as-code&quot; target=&quot;_blank&quot;&gt;Infrastructure As Code&lt;/a&gt;,基本的想法是相比原来系统管理员手工运行什么ssh或者命令来管理和搭建不同的机子或者平台, 能否使用一种更加抽象级别的语言来描述这个过程, 将系统底层的东西隔离开来, 使他们能脱离出系统底层各种细节,更多关注自己想到做得事情.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;所以就出现这样一些工具: &lt;a title=&quot;puppet intro&quot; href=&quot;http://docs.puppetlabs.com/guides/introduction.html&quot; target=&quot;_blank&quot;&gt;puppet&lt;/a&gt;, &lt;a title=&quot;chef&quot; href=&quot;http://wiki.opscode.com/display/chef/Home&quot; target=&quot;_blank&quot;&gt;chef&lt;/a&gt;等等. 上周胡凯要我尝试给ThoughtWorks西安也搭建这样的一个平台,我觉得这个东西还蛮有意思的,尝试了下puppet,中间还是遇到了不少问题,不过最终都有调试通过.这篇文章将会简要的介绍怎么安装puppet和中间可能遇到的问题和解决办法.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;我的环境是puppet agent使用的是Ubuntu虚拟机(这样比较稳妥), 同时puppet master也用的是Ubuntu.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;第一步:安装. 在server上首先你的装上ruby, 然后安装puppet.  在Ubuntu上最简单的安装方式是apt拉, 你可以运行&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;&quot;sudo apt-get install puppet puppetmaster facter&quot;&lt;/span&gt;, 如果你现在运行puppet -V查看版本的话, 却发现它的版本是&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;&quot;0.25.0&quot;&lt;/span&gt;,然而主流的版本是&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;&quot;2.6.8&quot;&lt;/span&gt;.解决办法是:

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;修改你的&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;/etc/apt/sources.list&lt;/span&gt; 加入 运行aptitude update (是为了装上最新版本的puppet master 2.6.8, 如果你不修改这一行你装的就是0.25这个版本, 问题很多).
&lt;pre lang=&quot;javascript&quot;&gt; 
deb http://backports.debian.org/debian-backports lenny-backports main contrib non-free
aptitude update
aptitude show puppet
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这下你运行puppet -V应该可以看到你的版本已经是最近的版本.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;默认这个puppet会安装到/etc/puppet下面.这个时候你需要产生一个puppet.conf文件,木有这个文件,puppet master是启动不了的.你可以使用&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;&quot;puppet master --genconfig &amp;gt; puppet.conf&quot;&lt;/span&gt; 来产生这个配置文件.

然后你可以尝试启动puppet master,用如下命令&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;&quot;puppet master --debug --no-daemonize&quot;&lt;/span&gt; 你应该可以看到&quot;notice: Starting Puppet master version 2.6.8&quot;
--verbose表示的是这个日志输出的详细程度, --no-daemonize表示这个线程将不会转入后台, 你可以在console当中看到日志的输出.

如果出现&lt;span style=&quot;color:red; margin:0;padding:0;border:0;&quot;&gt;Could not run: Could not create PID file: /var/lib/puppet/run/master.pid&lt;/span&gt;, 就意味着很有可能你上次使用了daemonize的方式启动的, 所以现在这个进程还在后台, 你可以ps -ax | grep puppet ,然后杀死这个进程,在输入命令试试.

紧接着就是puppet agent了,也就是要配置客户端了.具体过程可以参考下面链接:&lt;a href=&quot;http://docs.puppetlabs.com/guides/installation.html&quot; target=&quot;_blank&quot;&gt;Installation Guide&lt;/a&gt;.
安装完成之后可以运行: &lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;puppet agent --server=puppet --no-daemonize --verbose&lt;/span&gt;那这个--server指的就是puppet master所在主机的地址.极力推荐使用域名而非简单的IP地址. 你也可以在/etc/hosts中加入如下映射:
&lt;pre lang=&quot;python&quot;&gt; 
10.29.2.50      puppet
&lt;/pre&gt;
然后在你的puppet master上配置:(这里的10.29.2.5也就是clark-laptop的ip)
&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/07/puppet-server-hosts.jpg&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-151&quot; title=&quot;puppet server hosts&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/07/puppet-server-hosts.jpg&quot; alt=&quot;&quot; width=&quot;593&quot; height=&quot;185&quot; /&gt;&lt;/a&gt;
Ok,搞定.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;运行puppet agent --server=puppet --no-daemonize --verbose, 就开始了puppet agent和puppet master之间的ssl过程, 这个过程是可能出现问题较多的地方.这个时候puppet agent会想server端发出确认certification的请求,所以在server端你可以运行&quot; puppet cert --list&quot; 来查看有多少agent的认证请求, 比如这里就有如下输出:
&lt;pre lang=&quot;css&quot;&gt; 
clarht-laptop
&lt;/pre&gt; 

上面代表的是agent所在主机的域名了,那这个域名是在puppet master主机上/etc/hosts中根据请求过来的agent的ip而对应找到的域名.

然后&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;puppet cert --sign clarht-laptop&lt;/span&gt;就可以确认认证了,握手完成.

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/07/puppet-mapping.jpg&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-155&quot; title=&quot;puppet mapping&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/07/puppet-mapping.jpg&quot; alt=&quot;&quot; width=&quot;610&quot; height=&quot;301&quot; /&gt;&lt;/a&gt;

如果这个过程中,你有碰到&quot;

&lt;span style=&quot;color:red; margin:0;padding:0;border:0;&quot;&gt;
err: Could not request certificate: Retrieved certificate does not match private key; please remove certificate from server and regenerate it with the current key&quot;
&lt;/span&gt;
&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/07/puppet-error.png&quot;&gt;&lt;img class=&quot;alignleft size-large wp-image-152&quot; title=&quot;puppet error&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/07/puppet-error-1024x146.png&quot; alt=&quot;&quot; width=&quot;684&quot; height=&quot;146&quot; /&gt;&lt;/a&gt;
&lt;i&gt;这个时候表示你可能将hostname, ip, domain之间的设置给搞错了.&lt;/i&gt;
首先确保你的puppet server的映射木有出错.在你的puppet master所在的机子上, 运行&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;&quot;less /ect/resolv.conf&quot;&lt;/span&gt; 查看到你的domain name.

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/07/Screen-shot-2011-07-16-at-8.51.44-PM1.png&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-154&quot; title=&quot;Screen shot 2011-07-16 at 8.51.44 PM&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/07/Screen-shot-2011-07-16-at-8.51.44-PM1.png&quot; alt=&quot;&quot; width=&quot;410&quot; height=&quot;132&quot; /&gt;&lt;/a&gt;
&amp;nbsp;
&amp;nbsp;
然后在你的&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;/etc/hosts&lt;/span&gt;中加入
&lt;pre lang=&quot;java&quot;&gt; 
10.29.2.50 puppet.corporate.thoughtworks.com puppet
&lt;/pre&gt;
也就是按照&quot;ip &amp;lt;hostname&amp;gt;.&amp;lt;domain name&amp;gt; &amp;lt;hostname&amp;gt;&quot;的方式.

对于agent的配置比较麻烦一点, 首先上到puppet agent所在机子上,命令行中调用&quot;hostname&quot;, 获取到agent所在主机的hostname,比如我这里就是&quot;clark-laptop&quot;, 同时less /etc/resolv.conf 查看agent所在主机的domain name. 这个domain name在这里刚好也是&quot;corporate.thoughtworks.com&quot;,但是它不一定跟puppet master上的domain name就是相同的.然后记下agent的ip地址10.29.2.5.

最后返回到puppet master所在主机上,修改/etc/hosts文件,加入如下映射:
&lt;pre lang=&quot;javascript&quot;&gt; 
 &lt;agent-ip&gt; &lt;agent-hostname&gt;.&lt;agent-domain-name&gt; &lt;agent-hostname&gt;
&lt;/pre&gt;
也就是10.29.2.5   clark-laptop.corporate.thoughtworks.com clark-laptop.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;由于上面的配置不正确而引出的问题, 在google下还真是每个人都有各自的说法, 试了不少方案, 也算是这个搞清楚了这个流程是怎么回事,希望这个能帮助到刚开始玩puppet的朋友.这样一来ssl握手也解决了, 你可以尝试写一两个catalog让agent请求下来玩玩, 比如安装openssh-server, git , mysql数据库. 另外其实puppet都有一些现有的公共的module,可以避免重新发明轮子, 可以参考&lt;a href=&quot;http://forge.puppetlabs.com/&quot;&gt;http://forge.puppetlabs.com/&lt;/a&gt;

&lt;h4&gt;Have fun~&lt;/h4&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;接下来应该会尝试下chef, 因为它的语言是使用ruby的, 相对puppet使用自己的DSL, 上手速度应该蛮快的.另外如何使用Chef和&lt;a title=&quot;vagrant&quot; href=&quot;http://vagrantup.com/&quot;&gt;Vagrant&lt;/a&gt;来测试,应该很有意思.
</content>
 </entry>
 
 <entry>
   <title>jit graph Forcedirected add label on edge</title>
   <link href="http://tuo.github.com/jit-graph-forcedirected-add-label-on-edge"/>
   <updated>2011-06-21T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/jit-graph-forcedirected-add-label-on-edge</id>
   <content type="html">jit graph(&lt;a href=&quot;http://thejit.org/demos/&quot; target=&quot;_blank&quot;&gt;JavaScript InfoVis Toolkit&lt;/a&gt; ) is an amazing javascript graph library. Here is the demo i use , the &lt;a href=&quot;http://thejit.org/static/v20/Jit/Examples/ForceDirected/example1.html&quot; target=&quot;_blank&quot;&gt;forcedirected&lt;/a&gt; graph. Well I just get stuck on how to add the label on the edges. I 've googled for a lot , but lots of doc are out of sync. So i just tweeted a little bit, and found the following solution.
&lt;h4&gt;1.modify the json data ,to add a relatedOn key/value&lt;/h4&gt;
&lt;pre lang=&quot;javascript&quot;&gt;    var json = [
        {
            &quot;adjacencies&quot;: [
                {
                    &quot;nodeTo&quot;: &quot;sky&quot;,
                    &quot;nodeFrom&quot;: &quot;earth&quot;,
                    &quot;data&quot;: {
                        &quot;$color&quot;:&quot;#dd99dd&quot;,
                        &quot;relatedOn&quot;: &quot;from sky to earth&quot;
                    }
                },
                {
                    &quot;nodeTo&quot;: &quot;ocean&quot;,
                    &quot;nodeFrom&quot;: &quot;earth&quot;,
                    &quot;data&quot;: {
                        &quot;relatedOn&quot;: &quot;from ocean to earth&quot;
                    }
                }],
            &quot;id&quot;: &quot;earth&quot;,
            &quot;name&quot;: &quot;earth&quot;
        }
  ]&lt;/pre&gt;
&lt;h4&gt;2.implement a customized edge type&lt;/h4&gt;
&lt;pre lang=&quot;javascript&quot;&gt;    // init ForceDirected
    var fd = new $jit.ForceDirected({
        Edge: {
            overridable: true,
            color: '#23A4FF',
            type: 'label-arrow-line'
        },&lt;/pre&gt;
&lt;h4&gt;3.specify the edge type to customized type in ForceDirected controller Edge configuration.&lt;/h4&gt;
&lt;pre lang=&quot;javascript&quot;&gt;    var fd = new $jit.ForceDirected({
        Edge: {
            overridable: true,
            color: '#23A4FF',
            type: 'label-arrow-line'
        },
       Label: {...}
    });&lt;/pre&gt;
There you go. Following is the result:

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/06/Screen-shot-2011-06-22-at-1.43.12-AM.png&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-149&quot; title=&quot;Screen shot 2011-06-22 at 1.43.12 AM&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/06/Screen-shot-2011-06-22-at-1.43.12-AM.png&quot; alt=&quot;&quot; width=&quot;609&quot; height=&quot;320&quot; /&gt;&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>Rspec hooks 配置</title>
   <link href="http://tuo.github.com4.html"/>
   <updated>2011-06-19T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./rspec-hooks-%e9%85%8d%e7%bd%ae</id>
   <content type="html">  &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最近项目中有碰到这样一个场景, 我们需要给测试中给每个测试案例置于事务之中,确保方法运行完后回滚所有的数据操作.于是最简单的,在spec_helper.rb中添加如下代码:
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;pre lang=&quot;ruby&quot;&gt;
  config.around(:each) do |example|
    WAREHOUSE_DB.transaction do
      example.run
      raise Sequel::Error::Rollback
    end
  end
 end
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;我们这里用的是Sequel来从数据库获取数据, 需要说明的是我们做得项目不是一个独立的,而是嵌在一个大项目中,我们工作的目录主要的是lib/warehouse/下, 而且也只有我们需要使用Sequel. 这样看起来目的是达到了, 后来项目在尝试加速测试的时间, 发现这个时间很多开销在打开事务和关闭事务,而其他项目根本不会用到sequel. 这样一来,也就是说,我们只想让这个事务开启回滚只发生在lib/warehouse/models目录中,而其他目录根本不需要. 那Rspec 有没有这样的功能能配置这个example(测试案例)的条件了?  有.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;pre lang=&quot;ruby&quot;&gt;
 #wrap transaction only to model layer of lib/warehouse
config.around(:each, :example_group =&gt; { :file_path =&gt; /\bspec\/lib\/warehouse\/models/ }) do |example|
    WAREHOUSE_DB.transaction do
       begin
         example.run
       ensure
        Sequel::Error::Rollback
       end
   end
end
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;其中关键的就是&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;&quot;:example_group =&gt; { :file_path =&gt; /\bspec\/lib\/warehouse\/models/ }&quot;&lt;/span&gt; , 这句话指定这个测试案例运行的条件,那就是这个spec文件的路径必须跟&quot;/\bspec\/lib\/warehouse\/models/&quot; 匹配上,才会开启和关闭事务,否则直接运行.
这个其实还满好用的,那现在我们只是用了:file_path这个过滤条件, 哪有没有更加强大的支持了? 
有.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;参考: &lt;a href=&quot;http://blog.lrdesign.com/2011/06/rspec-2-0-and-beforeafter-hooks/&quot; target=&quot;_blank&quot;&gt;RSpec 2.0 and before/after hooks&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>chronic自然语言来表达时间</title>
   <link href="http://tuo.github.com3.html"/>
   <updated>2011-05-07T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./chronic%e8%87%aa%e7%84%b6%e8%af%ad%e8%a8%80%e6%9d%a5%e8%a1%a8%e8%be%be%e6%97%b6%e9%97%b4</id>
   <content type="html">&lt;p style=&quot;font-family: Verdana,menlo,monaco&quot;&gt;
最近的Rails项目的cucumber测试中，经常会碰到需要处理时间。有意思的是，我们在cucumber测试中需要尽量用自然语言来表达时间，而在其对应的step definition中需要解析成为对应的时间。 比如我们需要在feature表达&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;“3个月以前”&lt;/span&gt;这个概念，原有的做法是 直接在feature中写成&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;&quot;3.months.ago&quot;&lt;/span&gt; ,而对应的步定义中则是用到eval()来解析成为对应的时间：&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;eval(time_literal || &quot;1.month.ago&quot;)&lt;/span&gt;.  也许这个&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;&quot;3.months.ago&quot;&lt;/span&gt;还不是非常接近自然语言，为什么中间有&quot;.&quot;了？ 所以我们可以进一步改进一下， 在feature中写成&quot;3 months ago&quot; ,然后在调用eval函数之前，先将空格替换成点。 嗯， 还不错，至少Rails自带支持的时间处理是够用的。 但是后来我们需要处理&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;“上个星期的周二”&lt;/span&gt;， 那这个Rails自带的时间支持无法很好的完成任务了。
&lt;/p&gt;
所以也就出现了chronic这个gem.
&lt;blockquote style=&quot;  font-size: 1.3em;
    font-style: normal;
    line-height: 1.6em;
    word-spacing: 0.15em;padding:15px&quot;&gt;&lt;a href=&quot;http://chronic.rubyforge.org/classes/Chronic.html&quot;&gt;Chronic&lt;/a&gt; is a natural language date/time parser written in pure Ruby. See below for the wide variety of formats &lt;a href=&quot;http://chronic.rubyforge.org/classes/Chronic.html&quot;&gt;Chronic&lt;/a&gt; will parse.&lt;/blockquote&gt;
Chronic能非常的适用于上述的情景。

下面摘抄了chronic上的一些例子：
&lt;pre style=&quot;background-color:#FFFFAA; -moz-border-radius: 10px 10px 10px 10px;
-webkit-border-radius:10px; 
    background-color: #FFFFAA;
    border: 4px solid #DDDDBB;
    color: #444400;
    padding: 10px;font-family: consolas,menlo,monaco;
    font-size: 0.95em;
    font-style: normal;
    line-height: 1.4em;
    word-spacing: 0.15em;&quot;&gt;  
  3 years ago
  5 months before now
  7 hours ago
  7 days from now
  1 week hence
  in 3 hours
  1 year ago tomorrow
  3 months ago saturday at 5:00 pm
  7 hours before tomorrow at noon
  3rd wednesday in november
  3rd month next year
  3rd thursday this september
  4th day last week
&lt;/pre&gt;
&lt;p style=&quot;font-family: Verdana,menlo,monaco&quot;&gt;我们可以直接在feature中写&lt;span style=&quot;background-color:#FFFFAA; margin:0;padding:0;border:0;&quot;&gt;“last week tuesday&quot;&lt;/span&gt; ，然后在步定义中直接调用 Chronic.parse(time_literal)就可以很方便的得到我们需要的时间。

参考：
&lt;a href=&quot;http://www.rubyinside.com/chronic-0-3-0-released-improved-natural-language-datetime-parsing-3938.html&quot; target=&quot;_blank&quot;&gt;Chronic 0.3.0 Released: Improved Natural Language Date/Time Parsing&lt;/a&gt;
&lt;/p&gt;

更新: 2010/06/19
 Chronic之前用的是2.0.3版本,存在一个问题, 比如说今天是2011/05/30,
使用Chronic.parse(&quot;3 months ago&quot;) 会得到2011/03/02( 简单的就是减去90天), 而不是像Rails内制的 3.months.ago得到2011/02/28. 我有在github isssue发过一个贴子&lt;a href=&quot;https://github.com/mojombo/chronic/issues/47&quot; target=&quot;_blank&quot;&gt;Parse n months ago problem&lt;/a&gt;,得到作者的回复是,在Chronic 0.4.0版本以后都统一使用了ruby自制的时间处理. Ruby 5也贴出了关于chronic更新的消息 &lt;a href=&quot;http://feedproxy.google.com/~r/Ruby5/~3/feD4n14B20I/185-episode-182-june-10-2011&quot; target=&quot;_blank&quot;&gt;chronic update&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>Mongodb</title>
   <link href="http://tuo.github.com/mongodb"/>
   <updated>2011-05-02T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/mongodb</id>
   <content type="html">之前数据存储方面接触最多还是Mysql,SQLserver, 用起来还不错, 也没有觉得很复杂, 或许人的思维习惯了复杂,后来慢慢听到了很多很热的词:NoSQL.开始觉得NoSQL == &quot;No SQL&quot;, 是表示我们不需要SQL了,放弃关系数据库了吗?   当时觉得这会不会只是一个很热的词了,过阵子就不了了之,就木有花很多时间在这上面.这次有这样一个机会可以好好看看.
很基本的疑问是:关系数据库是70年代产生的,问题是在觉得如何存储和获取数据(通过SQL这样的一个DSL), 而面向对象是在80年代兴起的,也许关系数据库使用了很多的场景,但是到了现在随着WEB大潮的到来,数据量的爆咋,关系数据库已经很吃力了.你实际上在要求70年代设计关系数据库的作者超前设计这样一个&quot;&lt;a href=&quot;http://www.cs.brown.edu/~ugur/fits_all.pdf&quot;&gt;one size fits all&lt;/a&gt;&quot;的数据存储系统,很明显这是不太可能的. 所以Not only SQL的数据存储方式就应运而生了.

主要包括4种:
&lt;ul&gt;
	&lt;li&gt; Key-Value store , 比如Memcached&lt;/li&gt;
	&lt;li&gt; Big-Table , Cassandra&lt;/li&gt;
	&lt;li&gt; Document-Oriented, MongoDB, CouchDB&lt;/li&gt;
	&lt;li&gt;Graph Database , Neo4j&lt;/li&gt;
&lt;/ul&gt;
本篇文章只简要的介绍MongoDB.
&lt;blockquote&gt;MongoDB (from &quot;hu&lt;strong&gt;mongo&lt;/strong&gt;us&quot;) is a scalable,     high-performance, &lt;a href=&quot;http://www.mongodb.org/display/DOCS/Source+Code&quot;&gt;open source&lt;/a&gt;,  document-oriented database.&lt;/blockquote&gt;
MongoDB是面向文档的数据库, 这个可以跟关系数据库对比起来.关系数据库我们可以认为是面向表格的,每一个表格都第一行是schema,其他的是对应的数据.一个post-user的例子:
在关系数据库中我们这么表示:
&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/05/2011-05-02_23-18-32.jpg&quot;&gt;&lt;img class=&quot;alignleft size-full  wp-image-139&quot; title=&quot;2011-05-02_23-18-32&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/05/2011-05-02_23-18-32.jpg&quot; alt=&quot;&quot; width=&quot;524&quot; height=&quot;231&quot; /&gt;&lt;/a&gt;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

而在mongoDB我们一个文档来表示:

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/05/Screen-shot-2011-05-02-at-11.22.23-PM.png&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-140&quot; title=&quot;Screen shot 2011-05-02 at 11.22.23 PM&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/05/Screen-shot-2011-05-02-at-11.22.23-PM.png&quot; alt=&quot;&quot; width=&quot;526&quot; height=&quot;228&quot; /&gt;&lt;/a&gt;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

看起来非常熟悉, 对,没错,key-value pair, 非常像JSON的格式.而实际上这个文档的存储方式就是以BSON来实现的.
&lt;blockquote&gt;MongoDB uses &lt;a href=&quot;http://bsonspec.org/&quot;&gt;BSON&lt;/a&gt; as the data storage  and network transfer format for &quot;documents&quot;.&lt;/blockquote&gt;
Schema设计:
MongoDB的哲学是:如果它是一个Aggregation Root的model,那么它应该值得有自己的Collection(这里对应关系数据库中的table), 将其它的model尽量内嵌到这个aggregation root中去.
&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/05/Screen-shot-2011-05-02-at-11.29.02-PM.png&quot;&gt;&lt;img class=&quot;alignleft size-large wp-image-141&quot; title=&quot;Screen shot 2011-05-02 at 11.29.02 PM&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/05/Screen-shot-2011-05-02-at-11.29.02-PM-1024x713.png&quot; alt=&quot;&quot; width=&quot;525&quot; height=&quot;283&quot; /&gt;&lt;/a&gt;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

传统的关系数据库很重要的一个概念是范式.我们强调在将Model映射到数据库设计时使用E-R图帮助设计,比如在上面的图中,我们传统是希望将post-user之间联系在设计数据库时划分为post表和user表,它们之间使用外键来创建这样的一个1对1的关系.

而在MongoDB中更强调去范式,尽量能内嵌的就内嵌,而不是去单独抽出来独立成为一个collection.内嵌的方式更加有效率.

MongoDB经常要问得是:
&lt;blockquote&gt;&quot;why would I not want to embed this object?&quot;&lt;/blockquote&gt;
更多的可以参考MongoDB的&lt;a href=&quot;http://www.mongodb.org/display/DOCS/Schema+Design&quot;&gt;Schema Design&lt;/a&gt;.

MongoDB的Query也是很方便的:

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/05/Screen-shot-2011-05-02-at-11.40.20-PM.png&quot;&gt;&lt;img class=&quot;alignleft size-full wp-image-142&quot; title=&quot;Screen shot 2011-05-02 at 11.40.20 PM&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/05/Screen-shot-2011-05-02-at-11.40.20-PM.png&quot; alt=&quot;&quot; width=&quot;534&quot; height=&quot;214&quot; /&gt;&lt;/a&gt;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

&amp;nbsp;

而比较复杂是Aggregation的操作,比如SQL中的group, avg,sum等等,这些操作在MongoDB中可以使用Map/Reduce来完成.

MongoDB差不多对主流的编程语言都有很多的支持,在ruby中就有MongoMapper和Mongoid两个很不错的封装框架.

Use Case:

我觉得很好的一个例子是日志.现在的方式是将debug的信息都写到文本文件中去.问题就是每当出现一个问题时我需要去那个日志文件中去搜查出错的地方,就非常痛苦.而这个时候使用MongoDB就是一个很好的候选人,它提供很强的查找查询功能,支持快速的读写.

更多参考:

http://www.mongodb.org/
</content>
 </entry>
 
 <entry>
   <title>cucumber 测试复杂UI</title>
   <link href="http://tuo.github.com2.html"/>
   <updated>2011-03-14T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./cucumber-%e6%b5%8b%e8%af%95%e5%a4%8d%e6%9d%82ui</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最近碰到的一个问题是:我们在controller层都有完备的单元测试,当然既然是单元测试,也就缺乏集成测试了.为什么会是这样了?因为项目要求测试覆盖率为100%,任何在controller层测试中写跟数据库打交道的测试都会通不过项目的质量检查.那既然controller层测试只有一些stub和mock测试的话,集成测试写在哪里了? 在cucumber测试中.那就写呗,难题在于哪了. 就在view层需要渲染一个复杂的报表,使用highcharts库来渲染的图表.通常一般的cucumber测试,在一个scenario中,准备一些数据,然后访问那个页面,查看是否元素或者数据存在.问题就在最后一步,怎么去页面中抓取到想要的元素或者数据,如果只是简单视图显示,可能就很简单,但是如果这个视图渲染出来之后非常复杂情况就难办了. 这就需要进一步分析报表的渲染模型了.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;highcharts是一个javascript库,你所要做的便是传入合适的数据(配置),然后渲染的事情就可以交给它了. 以这个&lt;a href=&quot;http://www.highcharts.com/demo/?example=line-basic&amp;amp;theme=default&quot;&gt;demo&lt;/a&gt;这个基本线条模式为例:
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;pre lang=&quot;javascript&quot;&gt;
var chart;
$(document).ready(function() {
chart = new Highcharts.Chart({
chart: {
renderTo: 'container',
defaultSeriesType: 'line',
marginRight: 130,
marginBottom: 25
}
..........
//个性化配置的数据
series: [{
name: 'Tokyo',
data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2, 26.5, 23.3, 18.3, 13.9, 9.6]
}, {
name: 'New York',
data: [-0.2, 0.8, 5.7, 11.3, 17.0, 22.0, 24.8, 24.1, 20.1, 14.1, 8.6, 2.5]
}, {
name: 'Berlin',
data: [-0.9, 0.6, 3.5, 8.4, 13.5, 17.0, 18.6, 17.9, 14.3, 9.0, 3.9, 1.0]
}, {
name: 'London',
data: [3.9, 4.2, 5.7, 8.5, 11.9, 15.2, 17.0, 16.6, 14.2, 10.3, 6.6, 4.8]
}]
});

});
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;所以结合整个流程就是:
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;databaset --&amp;gt; services --&amp;gt; controller --&amp;gt;取道合适的数据 --&amp;gt; view--&amp;gt; highcharts render --&amp;gt; 报表
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;相比一般普通的cucumber测试,现在的问题是highcharts渲染出来后的报表标签(是一个svg)实在是非常混乱,数据被打散了,不像表格一样有明确清晰的意义一目了然.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;怎么办了? 问题在哪?

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;测试对象.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;为什么需要测试highcharts它的渲染过程? 那就可以相信highcharts库,不去测试?

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;问题在于什么是可以自动化测试什么是必须得人工测试.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;自动化测试的过程可以在&quot;databaset --&amp;gt; services --&amp;gt; controller --&amp;gt;取道合适的数据&quot; 发生

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;但是关于highcharts渲染的过程,不能包含在自动化测试, 只能由人工测试来覆盖.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这个分解难处在怎么去测试从controller层传回的数据是正确的. 我的做法的一个依据是为什么highcharts渲染过的很难测,因为它数据展现形式缺乏语意性.所以我尝试用一个&amp;lt;table&amp;gt;表格来显示数据.但这个表格只能在测试和QA模式下才可以显示在页面上.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 具体做法是:在helper中加入这样一个方法
&lt;pre lang=&quot;ruby&quot;&gt;
      def cucumber_debug_print(data)
        return unless [&quot;test&quot;, &quot;cucumber&quot;].include?(Rails.env)
        raw_tag = &quot;&lt;table id='data_listing'&gt;&lt;thead&gt;&lt;tr&gt;&lt;th&gt; Name&lt;/th&gt;&quot;              

        raw_tag &lt;&lt;  &quot;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;
        transform_on(data).each do |data|
          raw_tag &lt;&lt; &quot;&lt;tr&gt;&lt;td&gt;#{data[:name]}&lt;/td&gt;&quot;
          raw_tag &lt;&lt; &quot;&lt;/tr&gt;&quot;
        end      
        raw_tag &lt;&lt;&quot;&lt;/tbody&gt;&lt;/table&gt;&quot;
        raw_tag.html_safe
      end
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这样的好处在于:最大限度地将测试包含到自动化测试中.同时提高了一种更有语意的数据表现形式(table),这样测试人员只要根据报表下面的表格中数据来检查报表是否渲染正确,而不需要去scenario中去推导准备数据.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;后来证明这个方案是非常重要的,因为后面scenario还涉及到跟其他部分联合的测试,如果采用一般的测试,无法想象这个测试会写成什么样子. 因为之前我跟客户之前的开发人员也有争论这件事情,一开始人家坚持认为cucumber测试丢给QA手工测试就好,结果写出来的测试什么事也没干,因为从controller层传来的数据是应该可以自动化测试的,但是这个时候就必须要QA手工去测试,大大加大的QA的负担,或许像小龙说的这边的开发人员更多的是思考将自己的事弄好就好了,至于QA是否容易测试,我不关心.我一开始无法说服他,人家有多年的经验,挣的面红耳赤也没有必要,那就让事实说话呗. 很高兴的是这个方案更好也更有效的覆盖到了很多单元测试无法测试的问题,给了我们非常即时的反馈. 也许不是一定要非常有侵略性的说服别人,而是让人家自己摸索之后回过头来觉说&quot;哇,你的想法不错阿,试试&quot;
</content>
 </entry>
 
 <entry>
   <title>Rails的一些实践</title>
   <link href="http://tuo.github.com1.html"/>
   <updated>2011-02-14T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./rails%e6%9c%80%e4%bd%b3%e5%af%a6%e8%b8%90</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这篇文章拖到过年之后才写,真是够拖拉的,厄,不过赶的早不如赶得巧，刚好Ryan Bates更新他的railscasts&lt;a href=&quot;http://railscasts.com/episodes/252-metrics-metrics-metrics&quot; target=&quot;_blank&quot;&gt;Metrics Metrics Metrics&lt;/a&gt;，而这集跟我要将的东东还蛮有联系的.过年之前我一直在一个公司内部的rails项目试手,因为之前我没有任何的ruby/rails经验,所以这个项目的过程也是有点点坎坷的.我一边在学习知识,同时又将刚刚学到的东西应用出来,就是一个不断学习不断改进的过程.整个学习过程中当然也参考了很多网站拉,比如railscasts阿等等.
那其实整个过程中我都有收获满多的心得,很多之前写的不是elegant的代码,随着后来对其识认识的进一步深入而
变的更加的干淨整洁了.我当时也有萌芽个想法去总结这个东西,因为那个时候整个办公室也是有满多跟我一样的rails/ruby新手,如果有这个总结性的东西,也更加有利于知识的分享,更重要的是一个抛砖引玉的效果,让大家的想法经验都能汇集起来.但是一直没有找到这样的一个方式能帮助我更好将心得给表达出来.直到我发现了ihower的rails best pratice这个ppt,这才让我找到了这样一个很不错的方式和参考。
&lt;div id=&quot;__ss_6915034&quot; style=&quot;width: 425px;&quot;&gt;&lt;strong style=&quot;display: block; margin: 12px 0 4px;&quot;&gt;&lt;a title=&quot;rails best pratice from feedback&quot; href=&quot;http://www.slideshare.net/clarkht/rails-best-pratice-from-feedback&quot;&gt;rails best pratice from feedback&lt;/a&gt;&lt;/strong&gt;&lt;object id=&quot;__sse6915034&quot; classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; width=&quot;425&quot; height=&quot;355&quot; codebase=&quot;http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0&quot;&gt;&lt;param name=&quot;allowFullScreen&quot; value=&quot;true&quot; /&gt;&lt;param name=&quot;allowScriptAccess&quot; value=&quot;always&quot; /&gt;&lt;param name=&quot;src&quot; value=&quot;http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=feedbackrailsbk-110213203623-phpapp01&amp;amp;stripped_title=rails-best-pratice-from-feedback&amp;amp;userName=clarkht&quot; /&gt;&lt;param name=&quot;name&quot; value=&quot;__sse6915034&quot; /&gt;&lt;param name=&quot;allowfullscreen&quot; value=&quot;true&quot; /&gt;&lt;embed id=&quot;__sse6915034&quot; type=&quot;application/x-shockwave-flash&quot; width=&quot;425&quot; height=&quot;355&quot; src=&quot;http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=feedbackrailsbk-110213203623-phpapp01&amp;amp;stripped_title=rails-best-pratice-from-feedback&amp;amp;userName=clarkht&quot; name=&quot;__sse6915034&quot; allowscriptaccess=&quot;always&quot; allowfullscreen=&quot;true&quot;&gt;&lt;/embed&gt;&lt;/object&gt;
&lt;div style=&quot;padding: 5px 0 12px;&quot;&gt;View more &lt;a href=&quot;http://www.slideshare.net/&quot;&gt;presentations&lt;/a&gt; from &lt;a href=&quot;http://www.slideshare.net/clarkht&quot;&gt;clarkht&lt;/a&gt;.&lt;/div&gt;
&lt;/div&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;实际上了，大部分上面的practice还都是蛮有用的，但是有些地方还真是不一定适用。比如上面提到的使用metaprogramming来减少一些重复，还有一段代码

def self.all_cmts
Person.all.select{|p| p.cmt?}
end

def self.all_hrs
Person.all.select{|p| p.hr?}
end
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;以开始我也想得是说使用metaprogramming来减少重复，但是发现写出来的代码实际上是蛮复杂的，考虑到代码的可读性和可维护性，在这个桉例上我们并没有使用这个practice.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;那其实还有另外一点值得提到的就是，在session过程进行到permission check这一块时，我其实是没有特别好的注意或办法的，因为这一块我也不是非常熟，所以我想的是把这个问题抛出来，果然徐昊有提出了更好的方桉。相对于我将权限检查这一块扔到模型层（原因是因为需要权限检查将会是在一个非常细粒度的级别上，比如字段，当然我也参考过那个&lt;a href=&quot;https://github.com/stffn/declarative_authorization&quot;  target=&quot;_blank&quot;&gt;declarative authorization&lt;/a&gt;，它应该是能够在字段级别进行检查，或许不是很大问题，但是如何垮字段的检查，不是特别清楚，但是那是一个不同的故事了） ， 而是将权限检查提取到控制层，从而保持模型层的干淨整洁，pretty cool。

&lt;a href=&quot; http://ihower.tw/blog/archives/3075&quot; target=&quot;_blank&quot;&gt;Rails Best Practices 投影片&lt;/a&gt;

&lt;a href=&quot;http://railscasts.com/episodes/252-metrics-metrics-metrics&quot; target=&quot;_blank&quot;&gt;Railscasts  Metric Fu&lt;/a&gt;

&lt;a href=&quot;https://github.com/flyerhzm/rails_best_practices&quot; target=&quot;_blank&quot;&gt;Rails Best Practice Gem&lt;/a&gt;

&lt;a href=&quot;http://rails-bestpractices.com/&quot; target=&quot;_blank&quot;&gt;Rails Best Practice Website&lt;/a&gt;


&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;下面是我订阅的關於rails的一些博客.
&lt;script src=&quot;https://www.google.com/reader/ui/publisher-en.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt; &lt;script src=&quot;https://www.google.com/reader/public/javascript/user/01832955315015118142/label/Rails?n=5&amp;amp;callback=GRC_p(%7Bc%3A%22blue%22%2Ct%3A%22%5C%22Rails%5C%22%20via%20Clarkht%22%2Cs%3A%22false%22%2Cn%3A%22true%22%2Cb%3A%22false%22%7D)%3Bnew%20GRC&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;

Update:  
&lt;a href=&quot;http://ihower.tw/blog/archives/1691&quot; target=&quot;_blank&quot;&gt;
如何寫出有效率的 Ruby Code
by ihower &lt;/a&gt;

&lt;a href=&quot;http://www.informit.com/store/product.aspx?isbn=0321540034&quot; target=&quot;_blank&quot;&gt;Writing Efficient Ruby Code&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>关于bundler</title>
   <link href="http://tuo.github.combundler.html"/>
   <updated>2011-01-17T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%85%b3%e4%ba%8ebundler</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;在rails项目在生产环境中使用的是mysql,而开发和测试环境中使用是sqlite,这种方案使用起来还真是很方便.生产环境是 在一台Ubuntu虚拟机上面,而开发和测试环境都是在Mac上面.
在SCM仓库中的Gemfile是这样的:
&lt;pre&gt;source 'http://rubygems.org'&lt;/pre&gt;
&lt;pre&gt;gem 'rails', '3.0.3'
 gem 'haml', &quot;3.0.24&quot;
 gem 'ruby-mysql','2.9.3'
 gem 'paperclip', '2.3.6'
 gem 'acts-as-taggable-on', '2.0.6'
 gem 'rdiscount', '1.6.5'&lt;/pre&gt;
&lt;pre&gt;group :test, :development do
 gem 'hirb' , '0.3.5'
 gem 'sqlite3-ruby', '1.3.2'
 gem 'rspec-rails', '2.2.1'
 gem 'mongrel', '1.1.5'
 ....
 end&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;然后运行bundle install,首先会抛出错误,ruby-mysql gem需要安装Mysql数据库. 然后你需要安装mysql数据库,我使用了很简单的方式 ,详情请看此文&lt;a href=&quot;http://2tbsp.com/content/install_and_configure_mysql_5_macports&quot; target=&quot;_blank&quot;&gt;Install and configure MySQL 5  with MacPorts&lt;/a&gt;
&lt;pre&gt;&lt;code&gt;sudo port install mysql5 +server&lt;/code&gt;&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;默认会将其安装到/usr/local/mysql目录下.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;然后再次运行bundle install 一切顺利,然后可以干活了.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;事情很顺利直到有一天下午下班第二天早上上班时发现生产环境崩溃了,然后就每天都有发生这样的问题.顺便提到生产环境使用的是Passenger+Ngnix作为部署方案. 查看了一下错误日志, 发现里面只有反复的出现一句话
&lt;blockquote&gt;&quot;Broken pipe&quot;&lt;/blockquote&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;,大家google半天,实在是一是因为大家都是rails新手,没有太多经验;二是这个错误信息太模糊了,搜索了半天也没搞清楚,各种说法的都有, 最后实在是没辙了,就去问米高,米高说这是mysql driver的问题,需要将ruby-mysql gem 换成mysql gem,换过来之后问题解决了.所以这个问题给我的想法是在Ubuntu上安装ruby-mysql时一切顺利,没有出现任何的问题,而在运行过程中却反复出现问题,而且错误信息给的还真是对新手而言不知所云.但一阵沮丧之后,大家要开始编码了,后来发现系统都崩溃了,原来是上次没有将开发过程中也将Gemfile中的ruby-mysql改过来. 那就改过来呗,但却发现安装mysql gem还真是有点麻烦.mysql-gem它因要引用Mysql的lib和headers,使用ruby进行编译和安装mysql驱动.当然你得首先安装了Mysql才行,这样它才行知道Mysql的库(lib)和头部文件(headers)在哪. 安装mysql gem ,如果你在Ubuntu上,
&lt;pre&gt;gem install mysql -- --with-mysql-config=/usr/local/mysql/bin/mysql_config&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;你可能看到很多&quot;Building native extensions.  This could take a while...
ERROR:  While executing gem ... (Gem::Installer::ExtensionBuildError)

ERROR: Failed to build gem native extension.&quot;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;因为在Ubuntu上面,出现这种情况就表示有一些lib或者lib-dev缺失.你可能需要通过sudo apt-get来额外安装这些依赖.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;可以尝试:
&lt;pre&gt;sudo apt-get install libmysqlclient15-dev&lt;/pre&gt;
现在运行应该就OK了.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;在Mac上面安装其实貌似也不是很困难,至少我感觉比Ubuntu上要简单很多.简单运行
&lt;pre&gt;gem install mysql -- --with-mysql-config=/usr/local/mysql/bin/mysql_config&lt;/pre&gt;
就搞定.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;但是我在想能不能有其他的办法了,在生产环境下要求安装mysql gem和Mysql,但是在开发和测试环境中不需要去安装Mysql gem 甚至不用安装Mysql了? 因为在目前这个项目中,我们几乎没有碰到过说要在开发的机子上以production的方式起起来. 那因为Mysql的安装是要在装mysql gem的时候必须要求的,所以能不能在bundler装gem包的时候,在生产环境中装mysql gem而在开发测试环境中装sqlite?

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;结果是有的.这个答案可以很简单两句话能搞定,但是我想讲讲bundler的工作方式,算是抛砖引入把~~

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;一切都很好,就是在Ubuntu上面安装mysql gem貌似有点小小的麻烦,你需要装另外其他的一些本地的依赖.但是它却是又不是非常明确告诉你需要装那些本地依赖,给出的错误信息有点模糊.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;关于Bundler&lt;/h3&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;在Gemfile中来描述所需要的一些依赖,然后运行bundle install,下载和安装所需要的依赖,同时将其所安装的gem文件加入$LOAD_PATH路径.同时,你可能也注意到了Gemfile.lock这个文件.那这两个文件的关系就是每次运行bundle install时,bundler会将Gemfile中指定的依赖进行解析,比如在Gemfile中有定义&lt;code&gt;gem 'rails' ,'3.0.0.rc' 那实际上&lt;/code&gt;&lt;code&gt;rails 3.0.0.rc还会依赖&lt;/code&gt;&lt;code&gt;rack ~&amp;gt; 1.2.1,而这个依赖的解析和完全展开之后都会写到Gemfile.lock文件中.所以当下次你再次运行bundle install,它会先解析Gemfile的依赖,并检查当前的Gemfile.lock中时候已有这个依赖的解析.如果有,直接使用;如果没有,更改Gemfile.lock,并下载安装对应的gem.&lt;/code&gt;

&lt;img class=&quot;alignnone&quot; title=&quot;gem and gemfile.lock&quot; src=&quot;http://lh4.ggpht.com/_i1xQ-NrcTdU/TTQTOMCDryI/AAAAAAAAAGs/2JK3laycHGw/Screen%20shot%202011-01-17%20at%205.56.36%20PM.png&quot; alt=&quot;&quot; width=&quot;500&quot; height=&quot;108&quot; /&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Gemfile语法中还可以指定group,比如上面我的Gemfile,在group :test, :development do *** end 之外的都是属于default这个群.那这里就有三个group,而bundle install会默认执行default group(当然你可以配置), 然后让它选择性的执行某一个group.
&lt;pre&gt;source 'http://rubygems.org'

gem 'rails', '3.0.3'

gem 'haml', &quot;3.0.24&quot;
gem 'paperclip', '2.3.6'
gem 'acts-as-taggable-on', '2.0.6'
gem  'roo','1.3.11' 

group :production do
 gem 'mysql','2.8.1'
end

group :test, :development do
 gem 'hirb' , '0.3.5'
 gem 'sqlite3-ruby', '1.3.2'
 gem 'rspec-rails', '2.2.1'
 gem 'mongrel', '1.1.5'
 gem 'cucumber-rails', '0.3.2'
 gem 'cucumber', '0.9.3'
 gem 'spork','0.8.4'
end&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;你可以看到我现在有将mysql gem单独仍在了:production这个group中的,这个好处是我可以显示的指示我想运行某一个group与否
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;在开发环境中,不希望使用mysql gem ,所以可以调用:
&lt;pre&gt;&quot;bundle install --without production&quot;&lt;/pre&gt;
在产品环境中,不希望使用test/developement中的gem文件,可以使用
&lt;pre&gt;&quot;bundle install --without development test&quot;&lt;/pre&gt;
( 使用bundle install  --deployment也许更适合)
其实不就是安装个mysql gem吗? 用bundle install 的不行的原因是因为它需要安装native extention吗? 那能不能在bundler中有一种方式指定了?
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;答案有两个: 首先,如果你安装的是&lt;code&gt;mysql2&lt;/code&gt; gem的话,它的依赖都会通过它的头部信息而发现,就不需要第二个答案了.
第二个答案是:在bundle config命令尾部加油一个mysql的extention标记:
&lt;pre&gt;bundle config build.mysql --with-mysql-config=/usr/local/mysql/bin/mysql_config&lt;/pre&gt;
以后你运行bundle install都会去使用同一个配置,而这个配置在第一次运行此命令之后保持在#{RAILS_ROOT}/.bundle/config文件记录下来.

References:

&lt;a href=&quot;http://gembundler.com/rationale.html&quot; target=&quot;_blank&quot;&gt;Understanding Bundler&lt;/a&gt;

&lt;a href=&quot;http://yehudakatz.com/2009/11/03/using-the-new-gem-bundler-today/&quot; target=&quot;_blank&quot;&gt;Using the New Gem Bundler Today&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>Using Mootools with Rails</title>
   <link href="http://tuo.github.com/using-mootools-with-rails"/>
   <updated>2011-01-12T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/using-mootools-with-rails</id>
   <content type="html">最近项目中有需要在Rails中使用&lt;a href=&quot;http://mootools.net/&quot; target=&quot;_blank&quot;&gt;mootools&lt;/a&gt;，

&lt;img class=&quot;alignnone&quot; title=&quot;mootools&quot; src=&quot;http://tutorialdog.com/wp-content/uploads/2008/01/mootools.gif&quot; alt=&quot;&quot; width=&quot;180&quot; height=&quot;60&quot; /&gt;

而我们之前使用的是JQuery(ps:是想有什么工作是JQuery办不到了？),这个迁移的过程中遇到了一点问题。
过程很简单，网上一搜，找到了与Rails对应的&lt;a href=&quot;http://mootools.net/forge/p/rails_3_driver&quot; target=&quot;_blank&quot;&gt;ujs driver&lt;/a&gt; ,

&lt;img class=&quot;alignnone&quot; title=&quot;rails ujs driver&quot; src=&quot;http://mootools.net/forge/uploads/screenshots/198/2437/thumbs/d23ba2c60d978d2b38f713683b32be67.png&quot; alt=&quot;&quot; width=&quot;185&quot; height=&quot;78&quot; /&gt;

下载解压后，找到Source目录下的rails.js和Test下的mootools-1.2-core.js，拷贝到项目目录public/javascript/下覆盖掉原来的rails.js(这个是原来JQuery的driver）。最后在application.html.erb文件中的javascript_include_tag中声明上述几个文件。

然后。。。。

问题出现了，所有按钮无法响应用户的单击操作，同时所有

link_to &quot;My Review&quot;, reviews_path  都有解释成POST方法的请求，整个就是一片混乱。

思索了良久，还以为是这个框架就是这么设计的，虽然感觉很奇怪，但是也还好，也想出了临时方案。因为你去搜索这个答案还真是蛮恶心的。 后来仔仔细细一看，果然有在它在github的issues列表中，提到了这个问题：&lt;a href=&quot;https://github.com/kevinvaldek/mootools-ujs/issues/closed#issue/3&quot; target=&quot;_blank&quot;&gt; MooTools 1.3 compatibility &lt;/a&gt;

但问题是你不仔细看你还真是不知道，因为它的文档上写的是mootools1.3，但下下来的文件却是1.2的版本，让人有点晕。令人不解的是它却不把1.3放到release中。
</content>
 </entry>
 
 <entry>
   <title>rails开发工具的一些tips</title>
   <link href="http://tuo.github.comrails-tips.html"/>
   <updated>2011-01-09T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./rails%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7%e7%9a%84%e4%b8%80%e4%ba%9btips</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;在这阵子的也不是很长的Rails开发过程中,零星的记录了一些开发过程中使用工具的点滴.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h2&gt;Tip 1:&lt;/h2&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;是对于Rails Console而言,每当我们输入比如Review.all时,它打印出来的总是挤成一团的数据信息.

&lt;img class=&quot;alignleft size-full wp-image-117&quot; title=&quot;Screen shot 2011-01-09 at 8.48.23 PM&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/01/Screen-shot-2011-01-09-at-8.48.23-PM2.png&quot; alt=&quot;&quot; width=&quot;504&quot; height=&quot;123&quot; /&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;首先它没有打出SQL语句,而SQL信息有时候对于调试还是蛮重要的. 打开的打印SQL的设置很简单,可以敲rails console之后,输入
&lt;pre class=&quot;brush: rails&quot;&gt;
ActiveRecord::Base.logger = Logger.new(STDOUT)
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;紧随其后所有的操作都回打印出查询的SQL语句,很方便.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;当然只打印SQL语句也是不够的,为了阅读容易,你可以更希望Review.all不是打印出一团的很难阅读的信息,而是以表格的方式打印出来. 我刚好有看&lt;a href=&quot;http://asciicasts.com/episodes/176-searchlogic&quot; target=&quot;_blank&quot;&gt;Railscasts&lt;/a&gt;有接触到&lt;a href=&quot;https://github.com/cldwalker/hirb&quot; target=&quot;_blank&quot;&gt;Hirb&lt;/a&gt;.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;首先gem install hirb一下,然后可以创建一个~/.irbrc的文件中输入
&lt;pre class=&quot;brush: rails&quot;&gt;
require  'rubygems'
require 'hirb'
require 'active_record'
Hirb.enable
ActiveRecord::Base.logger = Logger.new(STDOUT)
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;完成两件事,设置logger输出SQL语句,同时打开hirb在窗口中以表格显示. 当然这是全局的设置,如果在某个console中觉得不爽,可以调用Hirb.disable来关闭这个表格输出.

&lt;img class=&quot;alignleft size-large wp-image-119&quot; title=&quot;Screen shot 2011-01-09 at 8.49.57 PM&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/01/Screen-shot-2011-01-09-at-8.49.57-PM1-1024x168.png&quot; alt=&quot;&quot; width=&quot;504&quot; height=&quot;99&quot; /&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;看起来满不错的.(如果你觉得这个屏幕太小,有记录都省略掉了,你当然可以查Hirb的文档,还有办法是进rails console前将你的窗口调大点.这样它的表格的大小也会相应变大.顺便说说iTerm的Command+Enter进入全屏的方式非常爽.)

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h2&gt;Tip 2:&lt;/h2&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;每次写完测试,都要跑到窗口中去看rspec spec或者rake spec ,当然你也可以装一个rspec的textmate bundle,从那里面Command+R跑当前文件的测试(ps:我用得最多的还是Rspec Book中作者提到Ctr+Shift+Down来快速地在应用代码和测试代码之间快速切换). 但是每次都有涉及到一些会影响面很大的测试时(这可能会是一个代码坏味),你所想的便是跑rspec spec,但是测试代码一多,这个时间耗费实在太大,一定程度上影响了开发的节奏.

&lt;img class=&quot;alignleft  size-full wp-image-120&quot; title=&quot;Screen shot 2011-01-09 at 9.10.34 PM&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/01/Screen-shot-2011-01-09-at-9.10.34-PM.png&quot; alt=&quot;&quot; width=&quot;504&quot; height=&quot;188&quot; /&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;上网搜了搜,发现了这篇文章&lt;a href=&quot;http://upstre.am/blog/2009/07/kickstart-rspec-with-spork/&quot; target=&quot;_blank&quot;&gt;Kickstart Rspec with Spork&lt;/a&gt;,就有谈到使用Spork来加快Rails开发过程中的运行测试的周期.你可以去&lt;a href=&quot;https://github.com/timcharper/spork&quot; target=&quot;_blank&quot;&gt;Spork&lt;/a&gt;的github中找到如何配置等等. 如果这其中你碰到有问题,你可以详细的查看它的Issue列表,在这里我先列举出我遇到的一些问题. 我暂时用的是 Spork 0.8.4 + Rails 3.0.3

&lt;img class=&quot;alignleft  size-full wp-image-123&quot; title=&quot;Screen shot 2011-01-09 at 9.12.08 PM&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/01/Screen-shot-2011-01-09-at-9.12.08-PM.png&quot; alt=&quot;&quot; width=&quot;503&quot; height=&quot;210&quot; /&gt;

spork (0.8.4)
Authors: Tim Harper, Donald Parish
Rubyforge: http://rubyforge.org/projects/spork
Homepage: http://github.com/timcharper/spork
Installed at: /Users/twer/.rvm/gems/ruby-1.8.7-p302@rails3.0.3

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;一开始我都是按照Github的配置的来的,基本上没有什么需要个性化的地方.如果你使用过程中发现这个你修改了某个Controller层或者Model层的东西,但是测试仍然失败,而你认为它应该是成功的.那么可能解决的办法是你需要找到environments/test.rb 然后设置cache_classes为false:
&lt;pre class=&quot;brush: rails&quot;&gt;
config.cache_classes = false
&lt;/pre&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;需要注意的是:
&lt;blockquote&gt;It’s important to disable class caching in your test environment otherwise spork will preload all your models and controllers.&lt;/blockquote&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;关于这个问题,可以查看Issue列表上已经解决的一个问题:&lt;a href=&quot;https://github.com/timcharper/spork/issues/closed#issue/44&quot; target=&quot;_blank&quot;&gt;gotcha for the docs: rails3 defaults environment/test.rb to preload models via cache_classes setting&lt;/a&gt; 而Spork的作者timcharper提到
&lt;blockquote&gt;I've decide that spork 0.9.0 will disable eager loading, regardless of this variable. I may change my mind if enough people are angry about the decision.&lt;/blockquote&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;但是我暂时使用0.8.4这个版本是没有任何问题的,即它并没有预加载model和controller层的类. (spork -d可以列举出所以已经预加载的类).

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;现在用起来还真是满爽的,要跑所有测试速度也相对原来快了满多的.爽到BIANG BIANG声之后,遭遇了另外一个问题,同事有碰到一个问题是他在routes里的增加了对应的url到action的映射后,这个测试还是跑不过,提示没有对应的route有定义.我挣扎了半天,突然想到两个星期前原来Xia姐也有问过我,但当时我也没搞清楚,只能关了Spork,重启才行.额,联系到Spork的原理,我想先看看Spork会预加载哪些类了?  运行&quot;spork -d&quot;  一看:
&lt;img src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2011/01/Screen-shot-2011-01-09-at-9.37.55-PM.png&quot; alt=&quot;&quot; title=&quot;Screen shot 2011-01-09 at 9.37.55 PM&quot; width=&quot;554&quot; height=&quot;250&quot; class=&quot;alignleft size-full wp-image-124&quot; /&gt;


&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;p&gt;果然有routes.rb被预加载了,所以每一次运行rspec 命令,都不会去重新加载routes.rb这个文件,哪怕你在里面做了惊天地泣鬼神的变化. 所以问题是如何手动的指定了让Spork每次都重载这个文件了? 夷,可以参考Issue列表,说不定有人也有这样的问题.一看,没有找到跟我问题一样的,但是却发现有点类似的,那便是&lt;a href=&quot;https://github.com/thoughtbot/factory_girl/issuesearch?state=closed&amp;amp;q=spork#issue/55&quot; target=&quot;_blank&quot;&gt;Factory girl with bundler and spork - no reloading of classes.&lt;/a&gt; 那我知道我应该去spec_helper.rb中的Spork.each_run 方法(默认是空)中require我门需要的文件config/routes.rb, 所以下面便是修改之后的:&lt;/p&gt;
&lt;pre class=&quot;brush:rails&quot;&gt;
Spork.each_run do
#make sure each time running rspec , it will reload routes.rb file.mod
require File.expand_path(&quot;../../config/routes&quot;, __FILE__)
end
&lt;/pre&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;启动Spork,运行rspec,改动routes.rb文件,立马就能在测试中显示出效果,赞! 所以基本上以后的开发都不会需要改动Spork了,也不会有问题跟它有联系了,因为它预加载就是下面几个文件:

config/application.rb
config/boot.rb
config/environment.rb
config/initializers/backtrace_silencers.rb
config/initializers/inflections.rb
config/initializers/mime_types.rb
config/initializers/secret_token.rb
config/initializers/session_store.rb
spec/spec_helper.rb

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;一般来说,对于开发,基本上改动的范围无外乎route, model ,view 和 controller等,上面列举的文件不需要去改动它们.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;那如果以后你发现了诡异的问题,测试应该过,却要是没有过,那就按照上面的方法来办吧.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最后,在Textmate中Ctrl+Command+Alt+V可以跳出剪贴板的所有历史记录,直接输入前几个字母就能定位,这个很实用. esc可以有一定程度的补全,也很酷

&amp;nbsp;&amp;nbsp;看一个这个链接: &lt;a href=&quot;http://adventuresincoding.com/2010/05/10-textmate-bundlesplugins-to-boost-your-ruby-on-rails-development-productivity&quot; target=&quot;_blank&quot;&gt;10  TextMate bundles/plugins to boost your Ruby on Rails&lt;/a&gt; Code Beautifier 格式化代码满好使的,AckMate搜索很方便等等

&lt;hr/&gt;
&lt;b&gt;Update @2011/02/11 : &lt;a href=&quot;http://www.rubyinside.com/how-to-rails-3-and-rspec-2-4336.html&quot;   target=&quot;_blank&quot;&gt;How To Get Rails 3 and RSpec 2 Running Specs Fast (From Scratch)&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>减少HTTP请求</title>
   <link href="http://tuo.github.comreduce-http-requests.html"/>
   <updated>2010-12-25T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%87%8f%e5%b0%91http%e8%af%b7%e6%b1%82</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这篇文章的一个基调是根据&lt;a href=&quot;http://developer.yahoo.com/performance/rules.html&quot;&gt;Yahoo! Exceptional Performance Best Practices&lt;/a&gt;中第一条规则&quot;减少HTTP请求&quot;.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;为什么需要减少HTTP请求次数?&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;当你打开一个网页时,浏览器就会向服务器端发送请求,这些请求包括有图片,CSS,Javascript和Flash等等,然后服务器对这些请求做出响应,将对应的资源发回给客户端.这个过程中用户需要等待这些响应,而服务器需要分配资源来处理请求,对于一些小型的网站,浏览的人少,那么对应的服务器的压力也不会太大,响应速度也不至于太慢(当然这也跟网速有关).但是对于大型的网站,每秒中浏览人的量是非常大的,那么服务器的所承受的压力也会变大,到了一定程度,就会出现处理不过来的情况,对于用户而言,就是看到一张空白的网页,难以提供良好的用户体验.这里可以参考

&quot;&lt;a href=&quot;http://yuiblog.com/blog/2006/11/28/performance-research-part-1/&quot;&gt;Performance Research, Part 1: What the 80/20 Rule Tells Us about Reducing HTTP Requests&lt;/a&gt;&quot; by Tenni Theurer on the Yahoo! User Interface Blog.
&lt;blockquote&gt;Table 1 shows popular web sites spending between 5% and 38% of the time downloading the HTML document. The other 62% to 95% of the time is spent making HTTP requests to fetch all the components in that HTML document (i.e. images, scripts, and stylesheets). The impact of having many components in the page is exacerbated by the fact that browsers download only two or four components in parallel per hostname, depending on the HTTP version of the response and the user's browser. Our experience shows that &lt;strong&gt;reducing the number of HTTP requests has the biggest impact on reducing response time and is often the easiest performance improvement to make&lt;/strong&gt;.&lt;/blockquote&gt;
&lt;div style=&quot;margin:0 auto;width:400px;&quot;&gt;
&lt;table id=&quot;time-spent-loading-popular-web-sites&quot;&gt;&lt;caption&gt;Table 1. Time spent loading popular web sites&lt;/caption&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;th&gt;Time Retrieving HTML&lt;/th&gt;
&lt;th&gt;Time Elsewhere&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Yahoo!&lt;/th&gt;
&lt;td&gt;10%&lt;/td&gt;
&lt;td&gt;90%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Google&lt;/th&gt;
&lt;td&gt;25%&lt;/td&gt;
&lt;td&gt;75%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;MySpace&lt;/th&gt;
&lt;td&gt;9%&lt;/td&gt;
&lt;td&gt;91%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;MSN&lt;/th&gt;
&lt;td&gt;5%&lt;/td&gt;
&lt;td&gt;95%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;ebay&lt;/th&gt;
&lt;td&gt;5%&lt;/td&gt;
&lt;td&gt;95%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;Amazon&lt;/th&gt;
&lt;td&gt;38%&lt;/td&gt;
&lt;td&gt;62%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;YouTube&lt;/th&gt;
&lt;td&gt;9%&lt;/td&gt;
&lt;td&gt;91%&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th&gt;CNN&lt;/th&gt;
&lt;td&gt;15%&lt;/td&gt;
&lt;td&gt;85%&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;既然关键提高性能的关键之一是在于减少HTTP请求次数,那么什么东西会引起这些请求了? 常见的便是下面几个方面:CSS文件,Javascript文件和图片.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;对于CSS文件,我们可以使用将很多零散的CSS文件合并并且压缩(比如使用Gzip,经过压缩之后大小只有原来文件的70%-80%,相当客观的成绩),然后在传送到浏览器端.在Rails中,注意到在application.html的title标签中
&lt;pre class=&quot;default prettyprint&quot;&gt;&lt;code&gt;&lt;span class=&quot;pln&quot;&gt;           stylesheet_link_tag :all,&lt;/span&gt;&lt;span class=&quot;pln&quot;&gt; &lt;/span&gt;&lt;span class=&quot;pun&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;pln&quot;&gt;cache &lt;/span&gt;&lt;span class=&quot;pun&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;pln&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kwd&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;pln&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
米高说这个这个all的属性使得Rails在产品环境下将所有位于public/stylesheets目录的css文件进行合并成一个叫all.css文件,可以减少HTTP请求的次数,很有用的一个功能
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;对于Javascript文件,同样的也可以对其进行压缩,比如常见的JQuery就有压缩之后的版本jquery.min.js.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;对于上面二者之前,大概可以归纳出减少HTTP请求次数可以通过合并压缩的办法来达到.对于图片是不是也可以借鉴了?
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;CSS Sprite&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;减少HTTP请求次数中有一条:
&lt;blockquote&gt;&lt;a href=&quot;http://alistapart.com/articles/sprites&quot;&gt;&lt;strong&gt;CSS Sprites&lt;/strong&gt;&lt;/a&gt; are the preferred method for reducing the number of image requests. Combine your background images into a single image and use the CSS &lt;code&gt;background-image&lt;/code&gt; and &lt;code&gt;background-position&lt;/code&gt; properties to display the desired image segment.&lt;/blockquote&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CSS sprite的想法很简单,就是将零零碎碎的图片合并为一张图片,并通过background-position来在大图片中定位到自己需要显示的区域.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;对于下面实现一个简单的 一般的我们习惯将弄十张这样的小图片：
&lt;img class=&quot;alignnone&quot; title=&quot;css&quot; src=&quot;http://lh6.ggpht.com/_i1xQ-NrcTdU/TRYnv_a8PDI/AAAAAAAAAFg/Thnw4DvDyeQ/css.png&quot; alt=&quot;&quot; width=&quot;68&quot; height=&quot;68&quot; /&gt;
&lt;pre class=&quot;brush: css&quot;&gt;ul li a#doc_link{
background-image:url(&quot;../images/doc_grey.png&quot;);
}
ul li a#doc_link:hover{
background-image:url(&quot;../images/doc.png&quot;);
}
...
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;但是我如果使用CSS Sprite的话,就是简单一张“大”图片:
&lt;img class=&quot;alignnone&quot; title=&quot;Sprite&quot; src=&quot;http://lh6.ggpht.com/_i1xQ-NrcTdU/TRYnv83EuoI/AAAAAAAAAFs/YQf5F6mddj0/sprite.png&quot; alt=&quot;&quot; width=&quot;361&quot; height=&quot;152&quot; /&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;在这个过程中,我发现合并这些图片对于我这样一个photoshop盲来说,很吃力,所以我很明智请求别人帮忙.而且合并完成之后还需要一张一张图片计算这偏差,更是显示的有点&quot;得不偿失&quot;. 所以大牛Steve Souders在这篇&lt;a href=&quot;http://www.stevesouders.com/blog/2009/09/14/spriteme/&quot; target=&quot;_blank&quot;&gt;SpriteMe makes spriting easy&lt;/a&gt;中宣布了&lt;a href=&quot;http://spriteme.org/&quot; target=&quot;_blank&quot;&gt;SpriteMe,&lt;/a&gt;而且他此文中把SpriteMe和另一个制作图片精灵的工具&lt;a href=&quot;http://spritegen.website-performance.org/&quot; target=&quot;_blank&quot;&gt;CSS Sprite Generator&lt;/a&gt;做了一个比较. 个人感觉SpriteMe非常强大,特别是它有一个选项&quot;Share your savings&quot;能提交你使用Sprite之后数据的变化,包括文件大小,请求的次数浮动等等. 但是有一个问题是当你的页面没有出现&quot;suggestions&quot;时,这个&quot;new sprite&quot;根本不工作,这时只能使用CSS Sprite Generator了.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;那这个时候我想到能否将css sprite跟rails集成起来了,一搜果然有人提供了这样的支持.黄志敏在其博客&lt;a href=&quot;http://www.huangzhimin.com/entries/190-css-sprite-best-practices&quot; target=&quot;_blank&quot;&gt;CSS Sprite Best Practice&lt;/a&gt;中就有提到他自己写的一个支持.你可以在这里了解到更多关于使用和安装的细节:&lt;a href=&quot;http://rails-bestpractices.com/posts/43-use-css-sprite-automatically&quot; target=&quot;_blank&quot;&gt;Use css sprite automatically&lt;/a&gt;.经过半个小时的摸索,我发现它的好处在于它提供了更小粒度对图片操控的能力,同时接管了很多繁琐的任务,比如如何合并图片,按照哪种方式来产生对应的CSS等等. 但是也有问题在首先它的安装过程过于纠结,它需要依赖rmagick,但是rmagick装起来有点麻烦(MacPorts is the devil, and shouldn’t be installed just for installing ImageMagick).另外一个是对于png图片的生成出现了透明度丢失的现象,对于JPG图片却是正常的.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ps:Dave Shea在&lt;a title=&quot;Permanent link for this article&quot; href=&quot;http://mezzoblue.com/archives/2009/01/27/sprite_optim/&quot;&gt;Sprite Optimization&lt;/a&gt;中提到了他在拼接png图片时,并不会使用Adobe compressor,而是其他的压缩工具&lt;a href=&quot;http://pmt.sourceforge.net/pngcrush/&quot;&gt;Pngcrush&lt;/a&gt; 或者 &lt;a href=&quot;http://www.leveltendesign.com/blog/nickc/pngthing-v11-previously-pngoptimizer&quot;&gt;PngThing&lt;/a&gt; ,我不太清楚黄志敏在实现css_sprite插件用得是什么样的压缩工具.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;那是不是CSS Sprite没有负面效应了? 你肯能想到了,如果这张Sprite图片太大了,那么浏览器所需要的内存会爆了?

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;确有,Andy King在&lt;a href=&quot;http://www.websiteoptimization.com/speed/tweak/css-sprites/&quot; target=&quot;_blank&quot;&gt;CSS Sprites: How Yahoo.com and AOL.com Improve Web Performance&lt;/a&gt;提到在iphone上,过大的图片会占用手机本不是很大的内存,可能导致一些问题,并指出:
&lt;blockquote&gt;To maximize accessibility and usability, CSS sprites are best used for icons or decorative effects.&lt;/blockquote&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Firefox工程师Vladimir就在&lt;a href=&quot;http://blog.vlad1.com/2009/06/22/to-sprite-or-not-to-sprite/&quot;&gt;To Or Not To Sprite&lt;/a&gt; 文章提到了使用CSS Sprite有可能会显示大图片时肯能产生的内存问题. 这里也顺便引用他关于使用CSS Sprite应该注意什么时的一段话:
&lt;blockquote&gt;There are cases where CSS sprites are clearly beneficial; the main example is combining a bunch of small similarily-sized images into a single one.  For example, a bunch of 16×16 icons used as indicators for various things on your site, or a bunch of 32×32 icons used as category headers or similar.  But combining images with vastly different dimensions, especially when there are skinny and tall images in the same sprite as wide and short ones is almost never a good idea.&lt;/blockquote&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;Inline Images&lt;/h3&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;减少HTTP请求次数中还有有一条:
&lt;strong&gt;Inline images&lt;/strong&gt; use the &lt;a href=&quot;http://tools.ietf.org/html/rfc2397&quot;&gt;&lt;code&gt;data:&lt;/code&gt; URL scheme&lt;/a&gt; to embed the image data in the actual page. This can increase the size of your HTML document. Combining inline images into your (cached) stylesheets is a way to reduce HTTP requests and avoid increasing the size of your pages. Inline images are not yet supported across all major browsers.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h5&gt;base64-Encoded Data URIs&lt;/h5&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;对于这个我的理解是使用一中更高效的encode方式将图片(或者其他东西,比如HTML)的内容字节转换成一种更精短的字节,这些转换后的字节足够小以致于我们可以直接在CSS文件中描述出来,同时定义相应的条约让浏览器在解析的时候能根据这个条约将字节反向还原过来. 要理解这个,得弄清楚URL跟URI的区别,在Nicholas C. Zakas的文章&lt;a href=&quot;http://www.nczonline.net/blog/2009/10/27/data-uris-explained/&quot;&gt;Data URIs explained&lt;/a&gt;中有详细说明它的工作原理,强力推荐. 想象一下在一个图片非常多网页中,这个HTTP请求的次数将会减少多少,因为每一张图片都不需要发送任何请求了.这样以来相对CSS Sprite ,Nicholas都甚至喊出来&quot;&lt;a title=&quot;Data URIs make CSS sprites obsolete&quot; href=&quot;http://www.nczonline.net/blog/2010/07/06/data-uris-make-css-sprites-obsolete/&quot;&gt;Data URIs make CSS sprites obsolete&lt;/a&gt;&quot; 的口号. 但是你会疑问说,那么你也看到了CSS文件会变得越大阿?不会得不偿失吗?

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;那这个确实你可以通过Gzip对CSS文件进行压缩,压缩之后大小就跟你原来写图片引用的CSS文件是差不多的,所以这个不是一个问题.但是它的浏览器兼容怎么样了?
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h5&gt;Web Browser Support&lt;/h5&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Data URIs are supported in:
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	Firefox 2+
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	Safari – all versions
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	Google Chrome – all versions
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	Opera 7.2+
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;	Internet Explorer 8+
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;你有可能看到了,它并不支持浏览器(MOSG都还是很不错的),特别是IE8之前的系列.IE是一个怪胎,所以如果你想在IE8之前的ie浏览器中支持URI的话,可以参考&lt;a href=&quot;http://www.phpied.com/mhtml-when-you-need-data-uris-in-ie7-and-under/&quot;&gt;MHTML – when you need data: URIs in IE7 and under&lt;/a&gt;.
 当然Data URI依然面临一些问题,最突出的便是相对于原来图片可以在客户端被缓存,而现在描述图片的内容都在CSS文件中,一旦对于CSS文件有最微小的改变,也会导致整个代码需要重新下载,比较麻烦.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;strong&gt;使用&lt;/strong&gt;:

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;IE本来就不应该成为你忌讳某个工具的原因,所以及时你不得不这样,Nicolas其实已经设计好了这样一个工具&lt;span style=&quot;font-weight: normal;&quot;&gt;&lt;a href=&quot;https://github.com/nzakas/cssembed&quot;&gt;cssembed&lt;/a&gt;&lt;/span&gt;,它可以让你选择输入的CSS文件,然后遍历文件讲图片引用转码成Base64.你完全不用担心IE的问题,它都有处理好了.

下载好JAR文件后,你可以通过这样的调用
&lt;pre class=&quot;brush: java&quot;&gt;java -jar cssembed-0.3.2.jar styles.css &amp;gt; styles-base64.css
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这样以来就可以将style.css文件中所有的图片引用转码成为base64格式,并输出到style-base64.css文件夹中,就那么简单.

&lt;img class=&quot;alignnone&quot; title=&quot;css&quot; src=&quot;http://lh6.ggpht.com/_i1xQ-NrcTdU/TRYnv_a8PDI/AAAAAAAAAFg/Thnw4DvDyeQ/css.png&quot; alt=&quot;&quot; width=&quot;68&quot; height=&quot;68&quot; /&gt;
&lt;pre class=&quot;brush: css&quot;&gt;ul li a#css_link{
   background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAA..省略...)
}&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;使用传统方式:  Style.css 大小没有压缩:4kb 加上10张小图片的大小:137KB ,总共是141KB,10次请求图片

&lt;img class=&quot;alignnone&quot; title=&quot;ten&quot; src=&quot;http://lh6.ggpht.com/_i1xQ-NrcTdU/TRYrzrCd_KI/AAAAAAAAAGE/8MKoAEs98vs/ten-requests.png&quot; alt=&quot;&quot; width=&quot;812&quot; height=&quot;458&quot; /&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;使用CSS sprite: Style.css大小:4kb 加上Sprite图片大小:85kb ,总共是89KB, 1次请求图片

&lt;img class=&quot;alignnone&quot; title=&quot;one&quot; src=&quot;http://lh6.ggpht.com/_i1xQ-NrcTdU/TRYrzhz9QuI/AAAAAAAAAGM/-pA2jtsXqgU/one-request.png&quot; alt=&quot;&quot; width=&quot;819&quot; height=&quot;290&quot; /&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;使用Data-URI Base64没有压缩:194kb 使用&lt;a href=&quot;http://developer.yahoo.com/yui/compressor/&quot; target=&quot;_blank&quot;&gt;YUI Compressor&lt;/a&gt;压缩之后貌似仍然是185kb,0次请求图片.

&lt;img class=&quot;alignnone&quot; title=&quot;zero&quot; src=&quot;http://lh6.ggpht.com/_i1xQ-NrcTdU/TRYrzr7ZcRI/AAAAAAAAAGI/ilPUgj4lNE0/zero-request.png&quot; alt=&quot;&quot; width=&quot;819&quot; height=&quot;233&quot; /&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;strong&gt;CSS Sprite和Data-URI:&lt;/strong&gt;
&lt;blockquote&gt;CSS sprites were a solution to the problem of multiple HTTP requests to download multiple images. Data URIs allow you to embed images directly into your CSS files, solving the same problem in a much more elegant and maintainable way.&lt;/blockquote&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最后介绍一下Rails下强大的库&lt;a href=&quot;http://documentcloud.github.com/jammit/&quot; target=&quot;_blank&quot;&gt;Jammit&lt;/a&gt;,它不仅支持对CSS和Javascript的像YUI compressor类似的压缩功能,同时它还支持Data-URI / MHTML image and font embedding.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h3&gt;引用&lt;/h3&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a href=&quot;http://www.mezzoblue.com/&quot; target=&quot;_blank&quot;&gt;Dave Shea&lt;/a&gt;在A List Apart的博客: &lt;a href=&quot;http://www.alistapart.com/articles/sprites&quot; target=&quot;_blank&quot;&gt;CSS Sprites: Image Slicing’s Kiss of Death&lt;/a&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;在09年的跟进CSS Sprite更新了一篇博客:&lt;a title=&quot;Permanent link for this article&quot; href=&quot;http://mezzoblue.com/archives/2009/01/27/sprite_optim/&quot;&gt;Sprite Optimization&lt;/a&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Chris Coyier在CSS Tricks的非常棒的一篇文章 &lt;a href=&quot;http://css-tricks.com/css-sprites/&quot; target=&quot;_blank&quot;&gt;CSS Sprites: What They Are, Why They’re Cool, and How To Use Them&lt;/a&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;CSS-Tricks CSS Sprite Screencast: &lt;a href=&quot;http://css-tricks.com/video-screencasts/43-how-to-use-css-sprites/&quot; target=&quot;_blank&quot;&gt;How to Use CSS Sprites&lt;/a&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Robert Nyman;&lt;a href=&quot;http://robertnyman.com/2010/01/15/how-to-reduce-the-number-of-http-requests/&quot; target=&quot;_blank&quot;&gt;How To Reduce The Number Of HTTP Requests&lt;/a&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Rob Larsen的文章: &lt;a href=&quot;http://htmlcssjavascript.com/web/why-front-end-performance-matters-to-everyone/&quot; target=&quot;_blank&quot;&gt;Why Front End Performance Matters to Everyone, Not Just the High Traffic Giants&lt;/a&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;黄志敏(&lt;a href=&quot;https://github.com/flyerhzm&quot; target=&quot;_blank&quot;&gt;flyerhzm&lt;/a&gt;)关于CSS sprite best practice 的PPT: &lt;a href=&quot;http://www.slideshare.net/flyerhzm/css-sprite-best-practices&quot; target=&quot;_blank&quot;&gt;Css sprite best practices&lt;/a&gt;


&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;提高性能另外一个关键在于异步加载提高并发,绕过传统的阻塞模型,实现网页的迅速加载.以后会继续提到&quot;&lt;a title=&quot;What is a non-blocking script?&quot; href=&quot;http://www.nczonline.net/blog/2010/08/10/what-is-a-non-blocking-script/&quot; target=&quot;_blank&quot;&gt;non-blocking script&lt;/a&gt;&quot;,有意者请看Steve Souders的&lt;a href=&quot;http://www.stevesouders.com/blog/2010/12/15/controljs-part-1/&quot; target=&quot;_blank&quot;&gt;ControlJS&lt;/a&gt;系列和Nicolas的&lt;span style=&quot;font-weight: normal;&quot;&gt;&lt;a class=&quot;entry-title-link&quot; href=&quot;http://feedproxy.google.com/%7Er/nczonline/%7E3/Wje5TDBxQ7g/&quot; target=&quot;_blank&quot;&gt;Thoughts on script loaders&lt;/a&gt;.&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;嗨,这一天我的Reader可是多了不少的订阅阿~~

&lt;strong&gt;Update&lt;/strong&gt;:关于更多DataURI的内容可以参考:Wiki的&lt;a href=&quot;http://en.wikipedia.org/wiki/Data_URI_scheme&quot; target=&quot;_blank&quot;&gt;data URI scheme&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>Follow Your Hunch</title>
   <link href="http://tuo.github.com/follow-your-hunch"/>
   <updated>2010-12-17T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/follow-your-hunch</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这篇博客的起由是前阵子在了解GWT(Google Web Toolkit)的时候,因为GWT内置了一个Java到Javascript的编译器,所以你可以在Java平台上进行开发,好处在于你并需要有对Javascript,跨浏览器等等很深的认识,甚至你可以是个文盲.当然这种好处的代价在于你以Java语言来开发客户端,这个过程极其貌似原来开发Swing的过程.所以下面是一段很常见的代码,给一个按钮添加一个点击事件:
&lt;pre class=&quot;brush: java&quot;&gt;final Button closeButton = new Button(&quot;Close&quot;);
   // Add a click handler to close button
   closeButton.addClickHandler(new ClickHandler() {
        public void onClick(ClickEvent event) {
           dialogBox.hide();
           sendButton.setEnabled(true);
           sendButton.setFocus(true);
        }
});
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;看起来很简单的过程,当用户单击&quot;Close&quot;按钮时,事件就会出发,在处理体中就会隐藏掉对话框,发送按钮聚焦等,看起来就是我们写SWING的风格阿,多熟悉. 那但是当我跟着GWT官网的一些例子走时,我愈来愈发现当项目稍微大点(哪怕这还只是一个演示项目),这种添加事件的场景随处可见,漫天飞舞. 哪怕有时候我的事件处理简单到只是显示一个对话框,
&lt;pre class=&quot;brush: java&quot;&gt; someButton().addClickHandler(new ClickHandler() {
   public void onClick(ClickEvent event) {
         //do sth
   }
});
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h4&gt;Why Bother?&lt;/h4&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;我依然还得将这个模板写一遍,非常单调无聊.写多了,除了麻木,就会想想了,感觉这个太不直观了,简直就是要让你得大脑大圈,有没有更好的主意了?

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;鉴于自己经验不是很多,然后就问了问了JP,在Ruby中怎么弄的.讨论着讨论着,突然灵光一闪,想到一个极佳的案例,这个案例来自&lt;a href=&quot;http://njbartlett.name/osgibook.html&quot; target=&quot;_blank&quot;&gt;OSGi in Practice&lt;/a&gt;这本书, 简要的描述一下这个问题:
现代Java GUI编程大部分是单线程的,比如SWING和SWT,那么每当我们更新界面的某一个组件,而这个组件或者库是来自于GUI的库,比如更新一个label的信息: label.setText(newMsg) ,那么我们必须确保这个调用是发生在GUI的那个线程上面,也就是默认的&lt;a href=&quot;http://en.wikipedia.org/wiki/Event_dispatching_thread&quot; target=&quot;_blank&quot;&gt;&quot;Event dispatch thread&quot;&lt;/a&gt;之上. 所以如果这个调用在其他线程上,解决方安就是将这段代码传给GUI库支持的一个工具类SwingUtilities.在Swing中,需要做得就是将这段代码扔到一个Runnable的实例中的run方法体中,调用SwingUtitlies.invokeLater方法来执行.当然,我们可以先通过EventQueue.isDispatchThread来确认一下是否我们现在就是在GUI这个单线程上,如果在就不需要SwingUtilties,直接调用就好.


&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;那如何在Java中实现对这一段模板的封装了(可以想象在SWING中有地方会需要这个处理)? 联想到刚才的按钮的一些单击事件的处理,你可以想到使用实现了Runnable接口的&quot;匿名类&quot;
&lt;pre class=&quot;brush: java&quot;&gt; private void updateDisplay(Runnable action){
   if(EventQueue.isDispatchThread){
      action.run();
   }else{
      SwingUtitlies.invokeLater(action);
   }
}
&lt;/pre&gt;
那么以后我可以讲更新标签的动作就可以这么做了:
&lt;pre class=&quot;brush: java&quot;&gt;updateDisplay(new Runnable(){
  public void run(){
    label.setText(&quot;this way is just too CUMBERSOME!!!!!!!!!!!!!!!&quot;);
  }
});
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;看起来还不错,那么以后其他的更新界面的东东都可以这么做. 但是写了几次了,还是感觉这个有点太笨拙了,就一行代码的动作都得写一些什么new Runnable ..... 看起来好分心阿. 那能不能这样了?
&lt;pre class=&quot;brush: java&quot;&gt;  private void updateDisplay(Expression expre){
     if(EventQueue.isDispatchThread){
         expr
     }else{
         SwingUtitlies.invokeLater(new Runnable(){
                  public  void run(){
                        expre;
                  }
         );
     }
}
&lt;/pre&gt;
&lt;pre class=&quot;brush: java&quot;&gt;    updateDisplay(lable.setText(&quot;this way is just what we wanted!&quot;));
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;那这个在Java中可以实现吗?  答案是在Java语言上是不行的,你无法阻止这条expression被立即执行,所以在进入updateDisplay方法体之前,这个expression也就是更新标签的调用是会立即被触发的.那使用匿名函数实际上让这个方法的调用者承担了更多责任,你得负责实例化这个匿名函数,然后讲你真正想执行的代码片段仍到里面,非常不可取.但问题是Java语言它没有将这个复杂性囊括到自己本身的库中,结果就是我们得写很多的匿名函数的&lt;a href=&quot;http://en.wikipedia.org/wiki/Boilerplate_%28text%29#In_object-oriented_programming&quot; target=&quot;_blank&quot;&gt;Boilerplate code&lt;/a&gt;. 那你可以说我可以写个什么插件让IDE像自动产生getter和setters一样产生匿名类的插件不久可以了? 这个确实是一个很好的workaround,同时这个行为很符合insanity的定义,
&lt;blockquote&gt;&lt;em&gt;Insanity: doing the same thing over and over again  and expecting different results.&lt;/em&gt;&lt;/blockquote&gt;
真正的问题还是Java语言不够强大,为什么我需要这么做,为什么将这些笨拙转嫁给了我们? 拜托,好歹你也遮遮丑嘛!

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;strong&gt;关键:&lt;/strong&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;strong&gt;其实问题的关键在于我们能否在推迟方法参数中表达式的evaluation,让我们能操控表达式在何时被解析,而不是像Java语言中你没法做到,因为表达式在进入方法体之前就被解析了.&lt;/strong&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;所以下面将介绍使用Scala和Clojure两种现在赤手可热的语言来实现我们所想要的方式.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h5&gt;Scala Way&lt;/h5&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;首先我们来定义updateDisplay这个方法:
&lt;pre class=&quot;brush: scala&quot;&gt;def  updateDisplay(action: =&amp;gt; passedInAction) =
     if(EventQueue.isDispatchThread){
          action
      }else{
          SwingUtitlies.invokeLater(new Runnable(){def run = action});
      }
&lt;/pre&gt;
那现在你可以很随意的使用:
&lt;pre class=&quot;brush: scala&quot;&gt;   updateDisplay(lable.setText(&quot;this way is the AWESOME Scala way!&quot;));
&lt;/pre&gt;
简单到一行搞定,可读性也提高了,更重要的是你看到调用者都需要关心什么匿名函数.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Scala是怎么做到作为方法参数中表达式的这样一个延迟解析或者执行了?

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;关键在于updateDisplay定义方法参数的片段,我们使用action : =&amp;gt; passedInAction .那在Scala中,前一个action实际上定义了别名,它指向了后面传入方法体的真正参数. 为什么不是action : passedInAction?因为在Scala中这种方式表达的效果跟Java语言的解析是一样的,passedInAction会在进入方法体之前被执行,在Scala中称为&quot;Call-by-value&quot;.而action: =&amp;gt; passedInAction 相对前者增加了一个' =&amp;gt; ' 符号,魔力在于,它使得passInAction不会被立即解析,而是当你在方法体中真正调用action这个别名时,它才会被触发执行,这种方式在Scala中称为&quot;Call-by-name&quot;.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;这样在看起来代码就非常简洁明了,非常棒!
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h5&gt;Clojure Way&lt;/h5&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;相对于Scala,Clojure作为一门Lisp的方言,自然而然拥有Macro系统.尽管Scala没有macro的概念,但是它拥有很好非好强大的facilitators,就像前面看到的&quot;cally-by-name&quot;,来避免使用Macro.Macro有些时候就是怪兽,(当然我不知道是不是Scala的作者也正有此意),因此怎么去写好Macro就需要 一定的规则或指导&lt;a href=&quot;http://www.mail-archive.com/clojure@googlegroups.com/msg07675.html&quot;&gt;Rules for writing macro&lt;/a&gt;.  使用Macro有几个要注意的地方,我选取其中一个
&lt;blockquote&gt;you can write any macro that makes life
easier for your callers when compared with an equivalent function&lt;/blockquote&gt;
在Clojure中,下面便是Macro的实现
&lt;pre class=&quot;brush: groovy&quot;&gt;(defmacro update_display [expr]
   `(let [is_on_dispatch_thread?  (EventQueue/isDispatchThread)]
        if is_on_dispatch_thread?
            ~expr
           (. SwingUtitlies invokelate
              (proxy [Runnable] [] (run [] ~expr)))))
&lt;/pre&gt;
调用:
&lt;pre class=&quot;brush: groovy&quot;&gt;    (. update_display (. label setText &quot;this is the BRILLIANT Clojure way!&quot;))
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;乍看起来还不习惯了,那么多括号来括号去的,这些括号便是Lisp的风格.读起来的话,如果你熟悉LISP的风格,那么读起来也还是蛮直白的,let用语绑定前面一个别名到后面的那个值,我们首先调用(EventQueue/isDispatchThread),实际上因为Clojure跟Java这样一个interoper*,它实际是调用EventQueue.isDispatchThread()其中/表示静态方法调用.如果is_on_dispatch_thread?为真,也就是在GUI的线程上,那么直接调用expr,也就是(. label setText &quot;this is the BRILLIANT Clojure way!&quot;), 如果不为真,则将此段代码封装到一个实现Runnable的接口的类中,也就是proxy关键字的作用.(ps:我现在对Clojure也不是非常熟,可能有更简洁的写法.)
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;同样的,Clojure实现的方式也是很简直明了的. 
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h4&gt;Follow Your Hunch&lt;/h4&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;我记得原来郑晔有讲过他学习新语言的时候的一个感受,就是Scala里发现根本就需要有Visitor模式的存在.为什么了?因为它强大的平台已经讲这些 额外的复杂性都考虑进去了,让你--作为一个调用者Caller更加专注于你的领域,简化你的使用.谈到这个,在Java中如果你发现一些重复出现的模 式,然后你想去封装这些模式,你所能操控的最小粒度只能在方法级别上.比如,&lt;strong&gt;if&lt;/strong&gt; 是Java中一个关键字,它定义有自己的语法,当你发现有关于&lt;strong&gt;if&lt;/strong&gt;使用的重复出现的模式时,你是没有任何办法去封装这个模式,因为&lt;strong&gt;if&lt;/strong&gt; 它不是一个方法,更不是一个数据.你不能创建一个&lt;strong&gt;unless&lt;/strong&gt; 关键字,相反你只能通过
instead of using

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;unless (tickExpired())

你所能做得便是:

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(!tickExpired())

或者 写一个相反的方法来提高刻可读性

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;if(tickNotExpired())

的方式来绕过这个问题. 也就是你不可能给Java语言添加新的功能,而这正是Clojure中Macro可以做到的,因为一切的关键字都是Clojure数据 &quot;Code as data&quot;.迫使你的大脑做从if(!foo)到unless(foo)的转换,看起来是一个很微小的问题,但是它隐藏的真正的问题是:
&lt;blockquote&gt;Every distinct syntactic form
in the language inhibits your ability to encapsulate recurring patterns
involving that form.&lt;/blockquote&gt;
我想引用Stuart Halloway在Programming Clojure 中的关于macro的一段总结:
&lt;blockquote&gt;The Wikipedia defines a design pattern to be a “general reusable solution to a commonly occurring problem in software design.” It goes on to state that a “design pattern is not a finished design that can be transformed directly (emphasis added) into code.”&lt;/blockquote&gt;
他继而说道:
&lt;blockquote&gt;That is where macros fit in. Macros provide a layer of indirection so that you can automate the common parts of any recurring pattern. Macros and code-as-data work together, enabling you to reprogram your language on the fly to encapsulate patterns.&lt;/blockquote&gt;
这个也使我想起来米高原来做过一个讲座有提到&quot;跟着直觉&quot;走,如果你感觉很不爽,你应该问问有是不是什么地方不对,有没有提高的地方.同时也使我想起了Twitter的创始人Evan Williams在TED大会坐的一个讲座&lt;a href=&quot;http://www.ted.com/talks/evan_williams_on_listening_to_twitter_users.html&quot; target=&quot;_blank&quot;&gt;Listening to Twitter users&lt;/a&gt;中提到的&quot;Follow your hunch&quot;.
&lt;blockquote&gt;跟着直觉走&lt;/blockquote&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;PS: 我本人对于Scala并不是很了解,对于Clojure的了解程度尽在于读了读&amp;lt;Programming Clojure&amp;gt;,所以这里如果有解释不是非常清楚的地方,请各位帮忙指出来.
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;h4&gt;引用&lt;/h4&gt;
关于Scala:
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;郑晔翻译的 : &lt;a href=&quot;http://www.china-pub.com/196931&quot; target=&quot;_blank&quot;&gt;Scala程序设计：Java虚拟机多核编程实战&lt;/a&gt;

Scala 'Call-by-name' and 'Call-by-value'
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a href=&quot;http://scala.sygneca.com/faqs/language#what-s-the-difference-between-a-lazy-argument-a-no-arg-function-argument-and-a-lazy-value&quot; target=&quot;_blank&quot;&gt;What's the difference between a lazy argument, a no-arg function argument, and a lazy value?&lt;/a&gt;

关于Clojure:
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a href=&quot;http://pragprog.com/titles/shcloj/programming-clojure&quot; target=&quot;_blank&quot;&gt;Programming Clojure&lt;/a&gt;, by: Stuart Halloway

Rich Hockey 的讲座
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a href=&quot;http://blip.tv/file/982823&quot; target=&quot;_blank&quot;&gt;Clojure for Java programmer&lt;/a&gt;

Uncle Bob关于为什么选择Clojure的文章:
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a href=&quot;http://thecleancoder.blogspot.com/2010/08/why-clojure.html&quot; target=&quot;_blank&quot;&gt; The Clean Coder: Why Clojure?&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>将UI和领域模型隔离开来 (二)</title>
   <link href="http://tuo.github.comseparate-ui-and-domain-model-part-2.html"/>
   <updated>2010-11-30T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%b0%86ui%e5%92%8c%e9%a2%86%e5%9f%9f%e6%a8%a1%e5%9e%8b%e9%9a%94%e7%a6%bb%e5%bc%80%e6%9d%a5-%e4%ba%8c</id>
   <content type="html">&lt;h2&gt;目的:&lt;/h2&gt;
那我们现在要做得便是要借助Hibernate Validator的支持,将整个判断逻辑从客户端移植到服务端.
&lt;h2&gt;解决方案:&lt;/h2&gt;
关于这个问题,我记得当时有跟Kai讨论过,提出了两种方案.
第一种,Kai的方案,扩展Spring MVC的WebDataBinding功能,但是我们发现这样我们能操控的行为,只能在发生数据绑定这个过程之后. 也就是说如果我想在数据绑定之前,将请求中的month和year字段合并为一个字段storyDate,这样Story这个对象仍然能保持与UI的隔离.这就要求我们能控制数据绑定之前的行为,Kai说他先去SPIKE下,我现在接着把这个STORY继续下去,因为时间很紧张,如果完成了这个之后有时间就采用Kai的办法. 等他搞完,我跑过去一看,他说搜遍了文档,也没发现Spring MVC提供这个钩,所以这个Story里面还是得有month和year字段,只是说扩展了Spring的Validator,实际上就是一个Proxy模式.请看代码:
&lt;pre class=&quot;brush:java&quot;&gt;@InitBinder
protected void initBinder(WebDataBinder binder) {
     binder.setValidator(new StoryPostBindingValidatorProxy(binder.getValidator()));  //这个动作发生在绑定之后,迫使我们依然得保留month和year字段
}&lt;/pre&gt;
在StoryPostBindingValidatorProxy中是这样的:
&lt;pre class=&quot;brush:java&quot;&gt;@Override
public void validate(Object o, Errors errors) {
 if (o instanceof Story) {
   Story story = (Story) o;
   if(story.getYear().isEmpty()){
    Calendar calendar = Calendar.getInstance();
    story.setStoryDate(calendar.getTime());
    errors.rejectValue(&quot;storyDate&quot; ,null ,&quot;Year cannot be empty.&quot;);
   }else if(doesYearContainsNumbers(story.getYear())){
     Calendar calendar = Calendar.getInstance();
     story.setStoryDate(calendar.getTime());
     errors.rejectValue(&quot;storyDate&quot; ,null ,&quot;Year should only contain numbers.&quot;);
   }else{
     DateTime date = story.getMonth().equals(&quot;-1&quot;) ?
      new DateTime(Integer.parseInt(story.getYear()),
      DateTimeConstants.JANUARY, 1, 0,0,0,0) :
      new DateTime(Integer.parseInt(story.getYear()),
      Integer.parseInt(story.getMonth()), 2, 0,0,0,0);
     story.setStoryDate(date.toDate());
     }
   }
   springValidator.validate(o, errors);
}

private boolean doesYearContainsNumbers(String year) {
     return !(year.trim().matches(&quot;[0-9]{4}&quot;));
}&lt;/pre&gt;
可以看到在进入springValidator.validate(o, errors);之前,我们有检查year和month字段,填入合适具体的错误信息,同时将storyDate设置一个正确的时间.这样的话,好处在将如何组合成正确storyDate的逻辑提取了出来,减少了Story模型的污染,同时也提高了代码的可测性.
在Story中StoryDate的描述:
&lt;pre class=&quot;brush:java&quot;&gt;@Column(name = &quot;story_date&quot;, nullable = false)
@NotNull
@Past(message = &quot;Did you invent time travel?  Please enter a date in the past.&quot;)
@NotBeforeMay1954(message = &quot;Date cannot be earlier than May,1954.&quot;)
public Date getStoryDate() {
     return storyDate;
}&lt;/pre&gt;
前三个annotation都是Hibernate内嵌支持的,后面一个是我自己实现的,所代表的意思非常明了,StoryDate不能早于1954年5月,这样以来的好处在于StoryDate在它上面只需关心它自己的逻辑,跟UI都无关,同时代码的可读性也大大增强.
下面是NotBeforeMay1954的实现图,详细的可以参考Hibernate Validation Annotation中的Customization

面临的一个实际问题是: 当用户浏览某一个故事,并单击Edit时,此时进入edit_story页面,它需要显示故事的内容,标题,年和月等,来等待用户编辑.
&lt;pre class=&quot;brush:java&quot;&gt;@Transient
public String getMonthOfStoryDate() {
  if (storyDate == null)
       return &quot;&quot;;
  if (new DateTime(storyDate).getDayOfMonth() == 31) {
     return &quot;0&quot;;
   } else
   return String.valueOf(new DateTime(storyDate).getMonthOfYear());
 }
@Transient
public String getMonth() {
     return month;
}&lt;/pre&gt;
那如果你页面中绑定到month这个字段,此时页面就无法显示真实的月份,因为month被标记为@Transient; 如果绑定到monthOfStoryDate字段的,当你编辑完成准备提交时,页面上month字段的值却要无法绑定到Story模型上的monthOfStoryDate字段上,因为Story只有month这个字段.
为了解决这个问题,最终的结果是:
在StoryController中,
&lt;pre class=&quot;brush:java&quot;&gt;@RequestMapping(value = &quot;story/{storyId}/edit&quot;, method = RequestMethod.GET)
public ModelAndView edit(@PathVariable int storyId, @CurrentUser User currentUser) {
     Story story = storyService.findById(storyId);
     //.....
     modelAndView.setViewName(&quot;edit_story&quot;);
     story.setMonth(story.getMonthOfStoryDate());
     modelAndView.addObject(&quot;story&quot;, story);
     //....
}&lt;/pre&gt;
这看起来很tricky阿!

仔细思考,为什么会有这个问题了?

原因还是在于Story作为一个领域模型,它有自己的biz rules,它本应该不受到UI层的影响或者耦合的,但是在这里Story却是跟UI紧密相结合.
你可以想象,写代码者当时拿到这个故事时,先弄了页面,发现需要year和month两个输入,于是自然而然在Story中也添加了对应的两个字段,也许当时他却是很方便,但是却给现在尤其是维护或者扩展时带来极大的麻烦.
为什么领域模型模型需要关心你的UI 了? 为什么不从模型本身所要承载的biz rules出发了思考问题了? 为什么要倒过来先写UI然后说看看模型层应该相应的怎么变化,这个不应该是模型层相对稳定且独立,而UI层比较趋于变化不?
本末倒置.

在这里思考的是从Story出发,我需要的就是一个StoryDate,我不关心你是怎么是构成这个日期的,而且我也不能去关心那个,不然别人怎么能够放心大胆的重用我了?  举个例子,可以方便你看出Story模型跟UI有多么高的耦合,如果将来页面UI需要引入day,那岂不是我要得改Story模型,可能我需要引入day这个字段,同时想一想那个它怎么判断用户是否输入月份的逻辑,在想想它在页面如何判断取出的Story是否有month需要显示出来(那个&quot;-1&quot;,&quot;0&quot; 和&quot;31&quot;), 不可思议的恐怖,真得是牵一发动全身,这个rippling effect实在是无法承受滴,试问你如何去维护这样的代码.

从OO的角度来说,它的一个原则似乎也可以应用到这里:DIP.

所以也可以看到即使你应用到了MVP模式,也并不一定代表你能很好地掌握它的应用场景和上下文.
&lt;h2&gt;Polishing the design&lt;/h2&gt;
我提出的第二个方案是,为什么要在数据绑定的时候,直接使用模型来作为绑定的载体了? 如果说UI 很简单,能与模型一一对应,比如在这里如果没有year和month,那用直接使用模型作为数据绑定的载体很OK,如果将来UI变更了,我再做以下的事情就好:创建一个于表格对应的ViewModel(或者说Presenter). 这样做的想法很简单,每一个页面都代表这当前模型或者系统的一个状态,而这些状态不一定跟真实的模型能一一匹配上,正如表格中month和year字段,此时在Story模型并没有相应的字段与之对应.这个问题就非常像ORM中的Impedance Mismatch,也就是说正如面向对象和平面的关系数据库之间有鸿沟,因而你有看到了什么RowMapper之类的,而在这里它正相当于Presenter或ViewModel,它来负责信息的一些转换. 这个问题使我想到我原来做过一个关于PRG模式的讲座,当时准备材料,我看了一篇文章 &lt;a href=&quot;http://www.theserverside.com/news/1365146/Redirect-After-Post&quot; target=&quot;_blank&quot;&gt;Redirect After Post&lt;/a&gt;,其中有一段,当时我不是很懂,但现在想想貌似还蛮有道理的.
所以了,我门将会在Story模型中去掉month和year字段,我只关心给我一个日期格式的storyDate,我拿过来用就好,我不care它怎么得来滴,所以这个使我想到了&quot;&lt;a href=&quot;http://pragprog.com/articles/tell-dont-ask&quot; target=&quot;_blank&quot;&gt;Ask don't tell&lt;/a&gt;&quot;的原则,在这里真是很好的fit in阿.除此之外所以的判断逻辑都将从Story模型中移除出去,去哪了?   正是NewStoryViewModel.
这里我们将创建一个NewStoryViewModel对象,并使用它作为数据绑定的载体,那么它肯定会包含
&lt;pre class=&quot;brush:java&quot;&gt;public class NewStoryViewModel {

     private String title;
     private String content;
     private String city;
     private String month;
     private String year;

     public Story toStory(){
          Story story = new Story();
           story.setTitle(title);
          story.setContent(content);
          story.setCity(city);
          story.setStoryDate(getRightStoryDate());
          return story;
     }

     private  Date getRightStoryDate() {
          return getMonth().equals(&quot;-1&quot;) ?
               new DateTime(Integer.parseInt(getYear()),
               DateTimeConstants.JANUARY, 1, 0, 0, 0, 0).toDate() :
               new DateTime(Integer.parseInt(getYear()),
               Integer.parseInt(getMonth()), 2, 0, 0, 0, 0).toDate();
     }

     //...getters and setts&lt;/pre&gt;
在StoryPostValidationProxy中:
&lt;pre class=&quot;brush:java&quot;&gt;@Override
public void validate(Object o, Errors errors) {
     NewStoryViewModel newStoryViewModel = (NewStoryViewModel) o;
     if (newStoryViewModel.isYearFieldEmpty()) {
          createRightStoryForValidation(newStoryViewModel);
           errors.rejectValue(&quot;storyDate&quot;, null, &quot;Year cannot be empty.&quot;);
     } else if (newStoryViewModel.doesYearContainsNumbers()) {
          createRightStoryForValidation(newStoryViewModel);
          errors.rejectValue(&quot;storyDate&quot;, null, &quot;Year should only contain numbers.&quot;);
     }
     springValidator.validate(newStoryViewModel.toStory(), errors);
}
public void createRightStoryForValidation(NewStoryViewModel newStoryViewModel) {
     Calendar calendar = Calendar.getInstance();
     newStoryViewModel.setYear(calendar.get(Calendar.YEAR));
     newStoryViewModel.setMonth(calendar.get(Calendar.MONTH));
}&lt;/pre&gt;
这样的话,我们就得到了一个非常清晰明了的设计和实现.现在的Story模型,完全不受到UI的影响,这些原来的耦合都被封装到了NewStoryViewModel之中,同时也大大提高了Story模型的可重用性和NewStoryViewModel以及验证逻辑的可测性.那你现在还可以进一步将NewStoryViewModel类中方法getRightStoryDate()做进一步的改进,你可以封装这些有意义的字段,你甚至可以将其移动到一个类似Constants的类中,这将极大方便你日后显示或者其他的. 比如在显示故事的时候,原来的代码是
在StoryViewModel中
&lt;pre class=&quot;brush:java&quot;&gt;public EscapedString getDateOccurred() {
     if (story.getMonth().equals(&quot;0&quot;))
          return escape(story.getYear());
     else
          return escape(new DateTime(story.getStoryDate()).monthOfYear().getAsShortText() + &quot; &quot; +                               story.getYear());
     }&lt;/pre&gt;
你可以该进为:
&lt;pre class=&quot;brush:java&quot;&gt;public EscapedString getDateOccurred() {
     if (StoryViewModelUtil.isYearOnly(story.getStoryDate())
          return escape(story.getYear());
     else
          return escape(new DateTime(story.getStoryDate()).monthOfYear().getAsShortText() + &quot; &quot; +      story.getYear());
}&lt;/pre&gt;
等等有很多可以提高的地方.

总结: 很多问题有时候不是浅层次的问题,而有可能是设计问题. 如果当初写此代码之人写完之后仔细一看,(当然拉,感觉也不会,因为一个测试也没有,代码都成这样了),感觉这个看起来很不爽,继而能通过询问他人或者其他方式来思考这个问题,恐怕也不会造成现在我门维护代码如此之困难的窘境.所以Bob的&lt;a href=&quot;http://manifesto.softwarecraftsmanship.org/&quot; target=&quot;_blank&quot;&gt;Craftsmanship&lt;/a&gt;宣言很有道理.
&lt;blockquote&gt;
&lt;h2&gt;&lt;em&gt;Not only working software,&lt;/em&gt;&lt;/h2&gt;
&lt;h2&gt;&lt;em&gt; but also &lt;span style=&quot;color: #ff0000;&quot;&gt;&lt;strong&gt;well-crafted software&lt;/strong&gt;&lt;/span&gt;&lt;/em&gt;&lt;/h2&gt;
&lt;/blockquote&gt;
</content>
 </entry>
 
 <entry>
   <title>将UI和领域模型隔离开来 (一)</title>
   <link href="http://tuo.github.comseparate-ui-and-domain-model-part-1.html"/>
   <updated>2010-11-30T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%b0%86ui%e5%92%8c%e9%a2%86%e5%9f%9f%e6%a8%a1%e5%9e%8b%e9%9a%94%e7%a6%bb%e5%bc%80%e6%9d%a5-%e4%b8%80</id>
   <content type="html">有将近一个月没有更新博客了,这阵子确实比较忙,必须淡定,克己轩. 不过这期间我有在Evernote中记录了一些零星的想法和感触,今天刚好有时间,于是拿出来仔细瞧了瞧.其中有一篇是关于我在TWU即将结束的时候记下来的日记,记得当时有一个故事,需要将浏览器端的javascript验证逻辑移植到服务器端.在完成这个故事的过程中给我留下了很深的印象,遇到了很多有意思的问题,我觉得我有必要写出来,否则时间过久了就会忘了.TWU这个项目比较有意思,它历经了几届TWU学员的蹂躏,很好的完成了试验品这个角色赋予的任务,你可以猜到当我们拿到这个项目时,并不是推到原有的而从新开始开发,而是在既有的代码库上进行开发.
我会选取我在完成这个故事中的一个情景入手,这个情景是用户可以跳到&quot;创建新故事&quot;页面,然后可以输入title(文本框,必须填写),city(文本框,必须填写),content(文本框,必须填写),month(下拉框,非必须选择)和year(文本框,必须填写)这几个选项,然后单击&quot;Publish&quot;按钮进行发布,发布之后会跳到 显示故事的页面,它会显示刚刚创建的故事的一些信息. 其中值得注意的是 用户在&quot;创建新故事&quot; 页面的表格中,如果用户跳过month字段,因为它是非必须的,那么在显示故事的页面的&quot;Event Date: &quot;后面只会显示年份,而没有月份.

&lt;img class=&quot;alignleft&quot; title=&quot;Input Form&quot; src=&quot;http://lh5.ggpht.com/_i1xQ-NrcTdU/TPRU1Qf7CvI/AAAAAAAAAEo/3BkrDkgJv8Y/Screen%20shot%202010-11-29%20at%203.35.35%20PM.png&quot; alt=&quot;&quot; width=&quot;500&quot; height=&quot;70&quot; /&gt;

显示故事的页面:

&lt;img class=&quot;aligncenter&quot; title=&quot;Show Story Page&quot; src=&quot;http://lh3.ggpht.com/_i1xQ-NrcTdU/TPRpsOTC3oI/AAAAAAAAAEw/OU2HyQdpZ3w/Screen%20shot%202010-11-30%20at%2011.03.50%20AM.png&quot; alt=&quot;&quot; width=&quot;365&quot; height=&quot;26&quot; /&gt;

现有实现
首先用户填写表格,并单击&quot;Publish&quot;,javascript会拦截请求,进行验证,这里我们只关心年和月的验证:
&lt;pre class=&quot;brush:js&quot;&gt;function validTWYear(year,month) {
     if(year == &quot;&quot;) return false;//for year empty
     if(!isNumeric(year)) return false;
     var date = new Date();
     var curr_date = date.getDate();
     var curr_month = date.getMonth()+1;
     var curr_year = date.getFullYear();
     if(year&amp;gt;curr_year)
          return false;
     if(year&amp;lt;1954)
          return false;
     if(year==1954 &amp;amp;&amp;amp; month&amp;lt;5)
          return false;     
     return true; 
 }
 function validTWMonth(month,year) {      
     var date = new Date(); 
     var curr_date = date.getDate();
     var curr_month = date.getMonth()+1;
     var curr_year = date.getFullYear(); 
     if(year==curr_year)
           if(month&amp;gt;curr_month &amp;amp;&amp;amp; month!=-1)
                   return false;
     if(year==1954 &amp;amp;&amp;amp; month&amp;lt;5)
          return false;
     return true;
}&lt;/pre&gt;
这段代码的意思是对于年字段的值而言,它不能为空,不能包含非数字的字符,不能比今年还大且不能早于1954年,如果是年份是1954,那么对应的月份应该早于5月份.
对于月字段的值而言,如果输入年份是今年,那么输入的月份的值不能大于当前的月份.

这段代码它没有任何测试案例可以寻找,另外代码的抽象程度太低,读起来很费劲,为后来的将这段逻辑移植到服务器端带来很大的不便.
关于javascript测试:&lt;a href=&quot;http://twoguysarguing.wordpress.com/2010/11/02/make-javascript-tests-part-of-your-build-qunit-rhino/&quot; target=&quot;_blank&quot;&gt;Make JavaScript tests part of your build: QUnit &amp;amp; Rhino&lt;/a&gt;

如果验证都有通过,下一步就是在Controller层处理请求,这个方法是
&lt;pre class=&quot;brush:java&quot;&gt;@RequestMapping(value = &quot;/story/new&quot;, method = RequestMethod.POST)
public ModelAndView create(@Valid Story story, BindingResult bindingResult, @CurrentUser User) {
     ModelAndView modelAndView =  new ModelAndView(&quot;new_story&quot;, &quot;story&quot;, story);
     if(bindingResult.hasErrors()) {
          return modelAndView;
     }
     if (storyService.save(story, currentUser,request.getContextPath())){
          return new ModelAndView(String.format(&quot;redirect:/story/%s&quot;, story.getId()));
     }
     return new ModelAndView(&quot;redirect:/error.jsp&quot;);
}&lt;/pre&gt;
这段还是很清楚的,做完数据绑定之后,调用Spring内嵌支持的Validator对Story对象上所有标记Annotation的字段进行验证,并将结果保持到bindResult中,如果出现错误返回到原页面,并将错误信息一并带回.
这个过程是发生在数据绑定之后的,所以你可以猜到Story对象中一定有month和year字段. 这里必须提到&lt;a href=&quot;http://docs.jboss.org/hibernate/validator/4.0.1/reference/en/html_single/&quot; target=&quot;_blank&quot;&gt;Hibernate Validation Annotation&lt;/a&gt; , 好处在于它使得模型能够拥有自己 的判断逻辑,而不需要跟其他比如UI层发生紧密的耦合,提高可重用性的同时保持自己的纯洁.但是现在Story里面的判断逻辑都是非常简单的,比如像是
&lt;pre class=&quot;brush:java&quot;&gt;@Column(name = &quot;story_date&quot;, nullable = false)
public Date getStoryDate() {
     return storyDate;
}&lt;/pre&gt;
然后便是storyService存储故事的代码
&lt;pre class=&quot;brush:java&quot;&gt;@Transactional
public Boolean save(Story story, User currentUser,String contextPath) {
     story.generateStoryDate();
     if (!story.valid()) {
          return false;
     }
     story.setUnformattedContent(HTMLTagsRemover.removeTagsIn(story.getContent()));
     story.generateStoryDate();
     inlineTagProcessor.updateTags(story, contextPath);
     story.setLastModifiedBy(currentUser);
     story.setAuthor(currentUser);
     return storyRepository.save(story);
}&lt;/pre&gt;
首先,它调用story.generateStoryDate(). 这个方法是能从它的名字推出,因为story里此时记录的时间不是storyDate而是month和year,所以它需要将其转换成一个storyDate.
&lt;pre class=&quot;brush:java&quot;&gt;     private Date storyDate;
     private String month;
     private String year;

     private Date convertToDateObject(String month, String year) {
        DateTime date = month.equals(&quot;-1&quot;) ?
         new DateTime(Integer.parseInt(year),DateTimeConstants.DECEMBER, 31 ,0,0,0,0) :
         new DateTime(Integer.parseInt(year),Integer.parseInt(month), 1, 0,0,0,0);
        return date.toDate();
     }
     public void generateStoryDate() {
          setStoryDate(convertToDateObject(this.month, this.year));
     }&lt;/pre&gt;
忘了交代,如果用户在&quot;创建新故事&quot;的表格中没有选取month字段,那么默认会给一个值: &lt;span style=&quot;color: #ff0000;&quot;&gt;-1&lt;/span&gt;.
所以为什么在convertToDateObject会是这个样子了?  因为显示这个故事的时候,需要知道是否用户当初有没有填入month,如果没有,只显示年份;如果填了,那么显示年月.这两种情况都没有跟天有什么关系,
所以此时的这段代码作者便是这样处理的: 如果用户没有在表格中填month字段,那么此时在Story对象中month的值就是-1,那就设置它的DayOfMonth是&lt;span style=&quot;color: #ff0000;&quot;&gt;31&lt;/span&gt;号;如果用户有填了,那么将其DayOfMonth设置为&lt;span style=&quot;color: #ff0000;&quot;&gt;1&lt;/span&gt;号. 所以你可以思考那他在显示此故事的逻辑是怎样处理的了?
&lt;pre class=&quot;brush:html&quot;&gt;     &lt;span class=&quot;field_names&quot;&gt;Event date:&lt;/span&gt; ${story_view_model.dateOccurred}&lt;/pre&gt;
在StoryViewModel中
&lt;pre class=&quot;brush:java&quot;&gt;public EscapedString getDateOccurred() {
     if (story.getMonth().equals(&quot;0&quot;))
          return escape(story.getYear());
     else
          return escape(new DateTime(story.getStoryDate()).monthOfYear().getAsShortText() + &quot; &quot; +                                  story.getYear());
     }&lt;/pre&gt;
这段逻辑也很简单,如果getMonth()是&lt;span style=&quot;color: #ff0000;&quot;&gt;&quot;0&quot;&lt;/span&gt;,则只返回年份;如果不是则讲二则组合起来返回.
那这个&lt;span style=&quot;color: #ff0000;&quot;&gt;&quot;0&quot;&lt;/span&gt;是从何而来了, 准备好别吐血,且看在Story中getMonth()的代码:
&lt;pre class=&quot;brush:java&quot;&gt;@Transient
 public String getMonth() {
     if(storyDate == null)
          return &quot;&quot;;
     if(new DateTime(storyDate).getDayOfMonth() == 31) {
          return &quot;0&quot;;
     }
     else
        return String.valueOf(new DateTime(storyDate).getMonthOfYear());
}&lt;/pre&gt;
如果你将整个联合起来一想,就知道写此代码之人是如何思考的拉,如果在显示故事的时候知道是应该显示年份了还是年月一起来, 他很聪明,想到这个东西跟天
没有关系,于是用天作为一个mark,同时即使在model层知道了天是否正确,那么如何让UI知道了,于是有了&quot;&lt;span style=&quot;color: #ff0000;&quot;&gt;0&lt;/span&gt;&quot;.
两个MAGIC NUMBER ,好歹你也封装下如此底层的实现细节,花了不少时间在揣测它想表达意思,后来发现是用&quot;&lt;span style=&quot;color: #ff0000;&quot;&gt;0&lt;/span&gt;&quot;和&lt;span style=&quot;color: #ff0000;&quot;&gt;31&lt;/span&gt;来串联整个流程,把我可是看吐血了.
别急还有,在Service层,调用完generateStoryDate()之后,紧接着的是:
&lt;pre class=&quot;brush:java&quot;&gt;if (!story.valid()) {
     return false;
}&lt;/pre&gt;
在Story中代码是:
&lt;pre class=&quot;brush:java&quot;&gt;public boolean valid() {
     boolean validator=checkValidYearAndTextFields();
     boolean monthInFuture=checkMonthInFuture();
     return (validator &amp;amp;&amp;amp; !monthInFuture);
 }
 private boolean checkValidYearAndTextFields() {
      Validator validator = Validation.buildDefaultValidatorFactory() .getValidator();
      Set&amp;gt; constraintViolations = validator .validate(this);
      return constraintViolations.isEmpty();
 }
 public boolean checkMonthInFuture() {
     if (Integer.parseInt(getYear()) == currentYear()) {
     DateTime today = new DateTime();
     if(getMonth().equals(&quot;0&quot;)) return false;
          return Integer.parseInt(getMonth()) &amp;gt; today.monthOfYear().get();
     }
     return false;
 }&lt;/pre&gt;
看起来,貌似抽象程度还可以,但是如果看checkValidYearAndTextFields()方法中,居然要一次调用Validator来验证,不知道为啥,因为CONTROLLER层已经有使用Spring内嵌提供的validator验证过了,这里再来一遍,实在是不解. 再看看checkMonthInFuture(),要检查了一遍如果输入年份是现在的年份,是否月份超出当前的月份. 于是你要可以看到神奇的数字&lt;span style=&quot;color: #ff0000;&quot;&gt;&quot;0&quot;&lt;/span&gt;,而且没有测试.
&lt;p style=&quot;text-align: center;&quot;&gt;&lt;span style=&quot;font-size: xx-large;&quot;&gt;&lt;span&gt;&lt;strong&gt;
&lt;/strong&gt;&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>Thoughts on Preparing Test Data</title>
   <link href="http://tuo.github.com/thoughts-on-preparing-test-data"/>
   <updated>2010-10-30T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/thoughts-on-preparing-test-data</id>
   <content type="html">As a developer ,testing is already a part of life.Every day we write tests ,follow the &quot;Red-Green-Refactoring&quot; rhythm,yeah life is a thing of  beauty.Recently i am on a project in TWU,while,things are going well.This week ,i have paired with &lt;a href=&quot;http://jawspeak.com/&quot; target=&quot;_blank&quot;&gt;Jonathan&lt;/a&gt;,and there are lots of fun along with many insights gained from him. One of those is about how to prepare test data.
&lt;h5&gt;A Traditional Way&lt;/h5&gt;
It reminds me that ,on previous project,i also ran into that scenario that there is an object called &quot;Alarm&quot;,whose constructor receive three parameters:a &quot;Timezone&quot;  representing the timezone that alarm is in, a &quot;Date&quot; carrying out time but without timezone info,a &quot;String&quot; showing the name of user who holds this alarm.  The thing is that when writing test either unit- or integration- , some guy need a local timezone alarm ,so he/she just wrote this line :
&lt;pre class=&quot;brush: csharp&quot;&gt;Alarm alarm  = new Alarm(TimezoneInfo.Local , Datetime.Now , &quot;Tina&quot;);&lt;/pre&gt;
this is pretty simple ,while another coder said &quot;hey Tina need a alarm with Beijing time&quot; ,so she/he just wrote this in his/her test code:
&lt;pre class=&quot;brush: csharp&quot;&gt;Alarm alarm  = new Alarm(timezoneOfBeiJing ,DateTime.Now ,  &quot;Tina&quot;);&lt;/pre&gt;
At that time ,things just accumulated but  went smoothly.
&lt;h5&gt;Potential Problem&lt;/h5&gt;
Well ,life is always up-and-down.There is a requirement saying alarm need a create time to show when this alarm is created. You probably said &quot;this is easy ,just add a new constructor that take four pararmeters.&quot; Yeah,not bad, it wouldn't break your unit-tests &quot;.Thinking about this:alarm is an entity ,which gotta be saved to database and hibernate wouldn't allow map null createDatetime to database. And that is the real-world case in previous project.

And all the integration-tests are broken,because  create datetime is need and it can't be null.

So what you gotta do ?  how about adding setCreatedTime(Datetime time) to alarm and call this method below alarm instantiation in all tests?  Again,not bad ,except coming at price of nightmare.  This thing can be overwhelming, because you got ,first, find all places that needed , then  manually add this line. That is not good,dude!

I have been through that nightmare before , and there is no doubt that it is like torturing.So let's unveil that monster.The first point is that ,like forementioned .

1. it is very painful when you change the signature of constructor or change sth of that object ,which possibly caused a butter-fly effect. Yeah ,a chain of pain.

2. it is not straightforward. What that means is that you must infer what it does from navigating into constructor and checking the parameters , definitely not intention-revealing.

3.duplication.  You can see  that  instantiation codes have to declare &quot;Tina&quot;  and &quot;Datetime.Now&quot; twice.

So there must be some way to handle this .Here it is ,the&lt;a href=&quot;http://martinfowler.com/bliki/ObjectMother.html&quot; target=&quot;_blank&quot;&gt; Object Mother.&lt;/a&gt;
&lt;h5&gt;Solution One:  Object Mother&lt;/h5&gt;
What basically Object Mother does is that it encapsulates all the creation code in one place.It is full of Factory Method ,which is very self-explanatory. What is really good about this is that it centralizes all the creation logics and make tests more manageable. Here is what it looks like when applying Object Mother to Alarm:
&lt;pre class=&quot;brush: csharp&quot;&gt;Alarm alarm = AlarmMother.createLocalNowAlarmToTina();&lt;/pre&gt;
the second one is :
&lt;pre class=&quot;brush: csharp&quot;&gt;Alarm alarm = AlarmMother.createBeiJingNowAlarmToTina();&lt;/pre&gt;
As you can see , it is more intention-revealing and you don't even need go to constructor of alarm to guess what it really does-----that is what tests really care. The tests just say &quot;I need what kinda of data and just give me ,and i don't care how it got constructed&quot;. Object Mother uses an approach that stands on a higher-level point.It is more abstract and it fits to what tests should serve for perfectly. Test is a document,it should be clear,straightforward and should not be too detailed that confuse people or let them spend time inferring what test means.

Well the downside of Object Mother is that it is slightly rigid and it is easy to get it bloated. It can't deal with variations of tests very well.What that means  is that ,if you need slightly  different test data ,it turns out you just keep adding method to Object Mother.
&lt;pre class=&quot;brush: csharp&quot;&gt;Alarm alarm = AlarmMother.createLocalNowAlarmToTina();

Alarm alarm = AlarmMother.createLocalMidNightAlarmToTina();&lt;/pre&gt;
See , as time goes by ,the AlarmMother could easily get out of controll and unmanageable.And there are more and more fine-grained little methods flying around.

There is another situation you may encounter:(i quote from &lt;a href=&quot;www.chrisrichardson.net&quot; target=&quot;_blank&quot;&gt;Chris Richardson&lt;/a&gt;'s slide &lt;a href=&quot;http://www.slideshare.net/chris.e.richardson/improving-tests-with-object-mothers-and-internal-dsls-presentation&quot; target=&quot;_blank&quot;&gt;&quot;Improving Tests With Object Mothers And Internal Dsls&quot;&lt;/a&gt;)

&lt;img class=&quot;alignnone&quot; title=&quot;Strike a balance&quot; src=&quot;http://lh4.ggpht.com/_i1xQ-NrcTdU/TMxEJxlQ9DI/AAAAAAAAAD0/IQixG4rwkpk/s720/Screen%20shot%202010-10-30%20at%209.42.46%20PM.png&quot; alt=&quot;&quot; width=&quot;520&quot; height=&quot;374&quot; /&gt;

But overall, the shinning side of Object Mother way far weigh over the downsides.
&lt;h5&gt;Solution Two: Test Data Builder&lt;/h5&gt;
Here it is:&lt;a href=&quot;http://c2.com/cgi/wiki?TestDataBuilder&quot; target=&quot;_blank&quot;&gt;Test Data Builder.&lt;/a&gt;

Every time you want use a class in tests ,create a Builder for that:(Quote from &quot;&lt;a href=&quot;http://nat.truemesh.com/archives/000714.html&quot; target=&quot;_blank&quot;&gt;Test Data Builders: an alternative to the Object Mother pattern&lt;/a&gt;&quot;)
&lt;blockquote&gt;1.Has an instance variable for each constructor parameter
2.Initialises its instance variables to commonly used or safe values
3.Has a `build` method that creates a new object using the values in its instance variables
4.Has &quot;chainable&quot; public methods for overriding the values in its instance variables&lt;/blockquote&gt;
Following code is builder for alarm:
&lt;pre class=&quot;brush: java&quot;&gt;public class AlarmBuilder {
Timezone timezone ;
Datetime time ;
String username ;
Datetime createdTime = Datetime.now;

public AlarmBuilder withTimezone(Timezone timezone) {
this.timezone = timezone;
return this;
}

public AlarmBuilder withTime(Datetime time) {
this.time = time;
return this;
}

public AlarmBuilder withUsername(String username) {
this.username = username;
return this;
}

public AlarmBuilder withCreatedTime(Datetime createTime) {
this.createdTime = createdTime;
return this;
}

public Alarm build() {
return new Alarm(timezone , time , username ,createdTime);
}
}&lt;/pre&gt;
So the instantiation process could be :
&lt;pre class=&quot;brush: csharp&quot;&gt;Alarm alarm = new AlarmBuilder().withTimezone(TimezoneInfo.Local)
.withTime(Datetime.Now).withUsername(&quot;Tina&quot;).build();

Alarm alarm = new  AlarmBuilder().withTimezone(beijingTimezone).withTime(Datetime.Now)
.withUsername(&quot;Tina&quot;).build();&lt;/pre&gt;
As you can see ,it is pretty easy and manageable.To some extent ,it is not more intention-revealing than Object Mother. Consider this: suppose you wanna control all the parameters on object ,in object mother ,you probably can't use a very long method name to handle that ,because it is very easy to get Object Mother bloated:
&lt;pre class=&quot;brush: csharp&quot;&gt;alarm = AlarmMother.createAlarm(bangaloreTimezone,
DateTimeHelper.convert(&quot;2010-10-30 21:03:03&quot;) , &quot;TuoHuang&quot; ,
DateTimeHelper.convert(&quot;2010-09-30 21:03:03&quot;));&lt;/pre&gt;
And look at it under Builder :
&lt;pre class=&quot;brush: csharp&quot;&gt;Alarm alarm = new AlarmBuilder().withTimezone(bangaloreTimezone)
.withTime( DateTimeHelper.convert(&quot;2010-10-3021:03:03&quot;))
.withUsername(&quot;TuoHuang&quot;)
.withCreatedTime(DateTimeHelper.convert(&quot;2010-09-30 21:03:03&quot;)).build();&lt;/pre&gt;
The transcendence of builder is that you can distinguish that the later datetime is for created time and the former is for alarm time . But you can't get that info from using Object Mother.

But Test Data Builder sometimes focus  on lower-level detail that it probably can't show the real meanings behind those data ,instead Object Mother handles this very well.
&lt;h5&gt;An Interesting Case&lt;/h5&gt;
Put it more concrete , let's take an example from &lt;a href=&quot;http://www.iamhukai.com/?p=24&quot; target=&quot;_blank&quot;&gt;HuKai&lt;/a&gt;'s blog .

Suppose KungFuPanda must have following features simultaneously :
&lt;blockquote&gt;createPanda()

matureAnimal()

heavyWeight()

animalLivesInUSA()

animalAcrobat()&lt;/blockquote&gt;
To create an KungFuPanda , if you use Test Data Builder to do this ,it probably looks like following :
&lt;pre class=&quot;brush: java&quot;&gt;new PandaBuilder().withMature().withHeavyWeight()
.withCountry(&quot;USA&quot;).withAcrobat();&lt;/pre&gt;
When you first look at the code , you maybe can't figure out that that code is to create a &quot;KungFu&quot; panda,because its code is too low-level detail,which force you to infer from those code---probably not good idea.

But instead  ,if look at the code implemented by Object Mother
&lt;pre class=&quot;brush: java&quot;&gt;PandaMother.createKungFuPanda();&lt;/pre&gt;
It takes just one line to let you know &quot;what it is&quot;  without inferring it from &quot;How it does&quot;.  This way is probably is more favorable for tests:straightforward , clear. More importantly ,it offers you a way to unaware the twisted implementation details behind the scene,which means a lot when you review the code.
&lt;h5&gt;Go Beyond the Surface&lt;/h5&gt;
Here is another philosophy behind that: you shouldn't scatter the &quot;new&quot; keyword on your production code ,instead you need to either let Dependency Injection framework handles this or centralizes those creation logic to one place like &quot;Factory&quot; or sth. Yeah ,it is also true for test code. Centralized creation logic for tests is also important,for more info check out  Misko Hevery 's blog &lt;a href=&quot;http://misko.hevery.com/2008/09/30/to-new-or-not-to-new/?utm_source=feedburner&amp;amp;utm_medium=feed&amp;amp;utm_campaign=Feed%3A+TestabilityExplorerBlogFeed+%28Testability+Explorer+Blog+Feed%29&quot; target=&quot;_blank&quot;&gt;How to Think About the “new” Operator with Respect to Unit Testing&lt;/a&gt;
&lt;h5&gt;Which approach i should take?&lt;/h5&gt;
In this blog ,probaActually, it is up to you. One thing i learned from software  is that there is no specific way belongs to  sovereign remedy. You should consider the context ,and adopt the way that best fits to that situation.What is really important is that you really gain deep insights behind the scene ,so you can tweak it to apply to different cases.
</content>
 </entry>
 
 <entry>
   <title>JRebel实践  part2 behind the scene</title>
   <link href="http://tuo.github.comjrebel-part-2.html"/>
   <updated>2010-10-26T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./jrebel%e5%ae%9e%e8%b7%b5-part2-behind-the-scene</id>
   <content type="html">这篇BLOG很大程度还得感谢Coach &lt;a href=&quot;http://jawspeak.com/&quot; target=&quot;_blank&quot;&gt;Jonathan&lt;/a&gt; ,我跑过去跟他讨论了一会,他说你可以继续在测测看看在controller层和repository层是否工作, 然后尝试着做一个关于这个的Session,让大家都了解了解,有很大可能会在这个项目中应用.他说了之后,我就开始着手查阅更多资料,然后直接促成了这篇文章,因为经验和认识的原因,里面有些观点可能不太准确.

实际上我们关心的是如何能在运行时实现重新装载类,而不需要去关闭整个程序.当整个程序跑起来了,特别指明WEB程序,每一次我改动了.java文件,然后编译,但是我想回到页面看到改动后的效果,但是我不想重复一下步骤

&lt;img class=&quot;alignnone&quot; title=&quot;Typical cycle&quot; src=&quot;http://lh5.ggpht.com/_i1xQ-NrcTdU/TMalgPH6HpI/AAAAAAAAAC0/lIjzuTdbIfA/s640/Screen%20shot%202010-10-26%20at%202.58.25%20PM.png&quot; alt=&quot;&quot; width=&quot;540&quot; height=&quot;297&quot; /&gt;

尽管这个流程可能只需要在命令行里敲一个简单的Ant命令,但是可能你需要重新登录,然后作一大堆敲击或者什么的,回到你上一次想看到变化的地方,这样一个重复量,就这样,时间,大把时间,白白流逝,更重要的是正如前一篇文章所言,节奏被打乱了.

所以我们想的是需要这样:

&lt;img class=&quot;alignnone&quot; title=&quot;cycle we want&quot; src=&quot;http://lh3.ggpht.com/_i1xQ-NrcTdU/TMaorOPk6PI/AAAAAAAAAC8/-c5vcpW9AME/s800/Screen%20shot%202010-10-26%20at%203.38.15%20PM.png&quot; alt=&quot;&quot; width=&quot;540&quot; height=&quot;300&quot; /&gt;

所以问题是这是怎么工作的?
&lt;h2&gt;答案是:class reloading.&lt;/h2&gt;
什么是类重载了?
&lt;blockquote&gt;Whenever class bytecode was changed , all objects refered to an old class now refer to updated class and execute new code when their methods were called, preventing the need to reload a container or application.&lt;/blockquote&gt;
也就是说它能允许你在运行时动态的改变某一个类的字节码,而且应用程序不需要重新启动却可以使用更新过得字节码的功能.

要理解这一句话,我们需要先大致了解Java中实例,类和类装载器之间的关系.

&lt;img class=&quot;alignnone&quot; title=&quot;A bird' eye on object ,class and classloader&quot; src=&quot;http://lh3.ggpht.com/_i1xQ-NrcTdU/TMarpjkiSnI/AAAAAAAAADE/0ifvHA8ymfg/s512/Screen%20shot%202010-10-26%20at%203.48.31%20PM.png&quot; alt=&quot;&quot; width=&quot;512&quot; height=&quot;457&quot; /&gt;

在Java中每一个对象都有对应这一样的一个class.这个class你可以简单的看成是拥有一系列方法的一个集合,它所有的方法的参数列表都是接受一个this.当它被加载到内存中时它会获得唯一的一个身份IDENTIY.这个类对象都是继承自java.lang.Class,所以你可以通过MyObject.getClass()来获得它的身份. 所以如果你调用myObject.method()

实际上JVM会间接的调用myObject.getClass().getDeclaredMethod(&quot;method).invoke(myObject).

那接下来就是ClassLoader拉,ClassLoader扮演着非常重要的角色,每一个Class对象都与之相关联,它的主要作用是定义Scope,也就是定义这个类是否可见.你可以认为每一个ClassLoader就相当于一个盒子,由这个ClassLoader加载的类,只有在这个盒子才可见,其他的ClassLoader不可见.所以这就给与你这样一种能力,由不同的Classloader来加载这个类更新后的版本. 所以判断两个类Class是否相同,除了名字之外,还需要考虑它所在的作用域.

所以你可以知道如果用两个Classloader来装载Class,但是其中一个装载较新的Class,你可以知道这两个CLass文件的Identity 是完全不相同的,问题就在于此时所有已有的对象都指向的是旧的那一个class,所以你无法看到更新后的Class文件的被调用.

举一个例子,假设你有一个手机,然后你把想换新号码,那么会有两个步骤:第一,讲原有SIM卡上已存的号码拷贝到新的SIM卡上;第二步:挨个通知你的朋友,叫他们更新他们的手机上你的号码.

所以这种事情如果要应用到对象和类上面,操作起来,就是首先拷贝原来实例的状态,然后开始将所以引用到原来Class上的指针指向新的Class上面.

&lt;img class=&quot;alignnone&quot; title=&quot;How Sun deals with that ?&quot; src=&quot;http://lh3.ggpht.com/_i1xQ-NrcTdU/TMa2FCk41YI/AAAAAAAAADM/3rDdwLFrZuY/Screen%20shot%202010-10-26%20at%204.35.23%20PM.png&quot; alt=&quot;&quot; width=&quot;168&quot; height=&quot;58&quot; /&gt;Sun怎么处理?

SUN提出了HotSwap的概念,什么是HotSwap?

HotSwap:简单的说,就是允许你在Debug模式下从IDE中修改更新类的字节码,但是使用一样的类标志.也就是说无论什么时候类的字节码变化的时候,所有对象都能引用到更新过的类然后执行新的代码,而不需要去重新转载整个容器.Java5 已经加入这样的支持,你也可以使用&lt;a href=&quot;http://download.oracle.com/javase/6/docs/technotes/guides/instrumentation/index.html&quot; target=&quot;_blank&quot;&gt;Instrumentation API&lt;/a&gt;来实现. 以下是Instrument

&lt;span style=&quot;color: #ff0000;&quot;&gt; &lt;img class=&quot;alignnone&quot; title=&quot;Hotswap illustrated&quot; src=&quot;http://lh3.ggpht.com/_i1xQ-NrcTdU/TMbDPHswDjI/AAAAAAAAADg/ggxfBZttIYA/s800/Screen%20shot%202010-10-26%20at%204.40.34%20PM.png&quot; alt=&quot;&quot; width=&quot;500&quot; height=&quot;312&quot; /&gt;&lt;/span&gt;

但是它有非常显著的不足,严重的影响了它的应用:

1.它只能修改方法的内容,而不能对增加方法或者字段其作用.

2.只能运行在Debug模式下会使整个应用程序变慢并可能带来其他问题.

在引出JRebel的办法之前,我们需要在引入下一个概念HotDeploy

什么是HotDeploy?

在某些WEB容器中通常有一个特殊的目录,比如在Tomcat和Jetty中的webapps目录,而这些容器

会周期性的扫描这个目录查看是否有新的web程序或者已有的程序有了修改.如果有,那么它会自动触发部署.

HotDeploy在某种程度上减少了开发者的手动干预,但是从本质上没有很大的提高.什么本质了?就是它仍然会

做出部署,所谓的&quot;重新部署&quot;,实际上它会将原来的丢掉原来的Classloader,并且销毁所有其中的class,具体点

就是包含其中Servlets, 然后会创建一个新的classloader,重新装载Servlets,并在其上面调用初始方法.

为什么更详细点,这里将简要介绍一下J2EE常见的classloader结构,这里以Tomcat容器为例.

&lt;img class=&quot;alignnone&quot; title=&quot;Tomcat Classloader Hierarchy&quot; src=&quot;http://lh5.ggpht.com/_i1xQ-NrcTdU/TMbDNp2IWiI/AAAAAAAAADY/fmbTABycIIY/s800/Screen%20shot%202010-10-26%20at%204.57.48%20PM.png&quot; alt=&quot;&quot; width=&quot;500&quot; height=&quot;332&quot; /&gt;

那你可以看到每一个WebApplicationLoader负责一个Web应用程序,更具体点,它负责装载你在WEB-INF/classes和WEB-INF/lib下的文件.所以每一次TOMCAT或者JETTY进行热部署,实际上它会跑掉原来的WebApplicationLoader,然后创建一个新的WebApplicationLoader,然后重新装载所有的类,这样的问题之一是所以(应该是大部分)的状态都要让用户重新来创建. 这是一个小问题,差不多你就是多输几次密码,或者多点击几次页面等等,这是可以控制的,但是你没法控制却是OutOfMemory.

为什么会在一个带有热部署支持的容器中容易发生这样的事情?

问题就在于每次热部署都回抛掉原有的classloader,然后创建新的classloader, 如果每次创建的代价不大,也就是每一次需要重新装载的类不是很多,那可能问题不是那么明显.但是如果热部署比较平凡,而且每一次classloader需要装载的类或资源非常多,对于一个WEB项目,这是非常有可能的,可能几次过后,你的资源或者内存就会被挤爆,也就会跑出OutOfMemory异常,而这种异常是非常intricate,难以追踪的(你可以使用一些Profile的工具,如&lt;a href=&quot;http://java.sun.com/javase/6/docs/technotes/tools/share/jhat.html&quot;&gt;jhat&lt;/a&gt;来查看堆中的信息).

所以JRebel怎么去解决这个问题了?

&lt;img class=&quot;alignnone&quot; title=&quot;JRebel tackling &quot; src=&quot;http://lh3.ggpht.com/_i1xQ-NrcTdU/TMbDOIgQg_I/AAAAAAAAADc/mq84lGcL208/s800/Screen%20shot%202010-10-26%20at%205.08.19%20PM.png&quot; alt=&quot;&quot; width=&quot;500&quot; height=&quot;330&quot; /&gt;

在看看JRebel的处理,它通过引入-javaagent来在classloader级别进行操作.什么是-javaagent? 简要的来说,就是能允许你在classloader链接之后在装载之前做一些字节码上的操作,比如常见的日志记录功能(你不用在写代码时候去给每个类都去写,可以在装载之前时修改它的字节码给每一个类都添加日志记录声明等等),还有一些AOP的实现.

基于我现在的知识,我还不能给出一个非常明确的解释,也希望了解的能给点提示.

JRebel正是借用这个功能,在装载之前,继承并扩展了WebApplicationClassLoader,每一次重新装载都不会创建新的CLASSLOADER 而是重用这样一个扩展的classloader来装载,至于怎么样的,这个.....在我知识范围之外,不过那个&lt;a title=&quot;Posts by  Jevgeni Kabanov&quot; href=&quot;http://www.zeroturnaround.com/author/ekabanov/&quot;&gt;Jevgeni Kabanov&lt;/a&gt; 在这篇博客&lt;a href=&quot;http://www.zeroturnaround.com/blog/reloading_java_classes_401_hotswap_jrebel/&quot; target=&quot;_blank&quot;&gt;Reloading Java Classes 401: HotSwap and JRebel — Behind the Scenes&lt;/a&gt;中有讲到这个话题时,以JRuby作为比较,讲了它是怎么弄的,但是我这个....似懂非懂,其实还是没搞不懂.

JRebel跟Hotswap不同的是它还支持其他的修改,比如增加方法等等,更贴近于现实生活中的需要.

下面是引用自&lt;a href=&quot;http://javabyexample.wisdomplug.com/java-concepts/34-core-java/58-javarebel-says-no-to-restart-really.html &quot; target=&quot;_blank&quot;&gt;JavaRebel says no to restart– Really??&lt;/a&gt;的关于两者对比的图:

&lt;img class=&quot;alignnone&quot; title=&quot;Comparison between JRebel and Hotswap&quot; src=&quot;http://lh5.ggpht.com/_i1xQ-NrcTdU/TMbDPhSws0I/AAAAAAAAADk/BlN6OCLDiF4/s576/Screen%20shot%202010-10-26%20at%205.31.10%20PM.png&quot; alt=&quot;&quot; width=&quot;576&quot; height=&quot;470&quot; /&gt;

同时这篇文章还例举出了JR的一些限制和不足的地方,有兴趣的可以看看,但是这篇文章是2008年的,我不太清楚现在是否有解决,我现在也没有充分的实验过,所以不过我发现一个问题是:

当我改动文件跑出一个异常之后,跳到页面,页面提示错误,这当然是我想要的.但是如果我返回到代码,去掉这些异常,然后返回到页面,却发现没有一个页面能工作,全部打不开.诡异的是,过了个半分钟样子,它要可以了. 不知道是不是页面缓存的问题,有待研究下.

下面是一些引用和有趣的链接:

这次SESSION的PPT: &lt;a href=&quot;https://docs.google.com/leaf?id=0B6o1WtyuFjd4ZGM2NWFhMGMtNzgwZS00MDdmLWI4OTYtMjczMjRiZWJiNDlh&amp;amp;sort=name&amp;amp;layout=list&amp;amp;num=50&quot; target=&quot;_blank&quot;&gt;JRebel on Chronicles&lt;/a&gt; (SlideShare搞了半天没传上去,压成ZIP也传不上)

&lt;a title=&quot;Posts by Jevgeni Kabanov&quot; href=&quot;http://www.zeroturnaround.com/author/ekabanov/&quot;&gt;Jevgeni Kabanov&lt;/a&gt; 关于JRebel工作原理介绍的一系列blog:

&lt;a title=&quot;Permalink&quot; rel=&quot;bookmark&quot; href=&quot;http://www.zeroturnaround.com/blog/reloading-objects-classes-classloaders/&quot;&gt;Reloading Java Classes 101: Objects, Classes and ClassLoaders&lt;/a&gt;

介绍classloading机制的文章:&lt;a href=&quot;http://onjava.com/pub/a/onjava/2005/01/26/classloading.html&quot;&gt;Internals of Java Class Loading&lt;/a&gt;

Tomcat类结构的文章:&lt;a href=&quot;http://www.jajakarta.org/tomcat/tomcat3.2-4.0/tomcat-4.0b5/src/catalina/docs/dev/classloaders.html&quot; target=&quot;_blank&quot;&gt;Catalina Class Loader Hierarchy&lt;/a&gt;

JRebel和HotSwap比较: &lt;script src=&quot;http://javabyexample.wisdomplug.com/components/com_alphacontent/js/behavior.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&lt;script src=&quot;http://javabyexample.wisdomplug.com/components/com_alphacontent/js/rating.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;&lt;a href=&quot;http://javabyexample.wisdomplug.com/java-concepts/34-core-java/58-javarebel-says-no-to-restart-really.html&quot;&gt;JavaRebel says no to restart– Really??&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>JRebel实践  part1 configuration</title>
   <link href="http://tuo.github.comjrebel-part-1.html"/>
   <updated>2010-10-23T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./jrebel%e5%ae%9e%e8%b7%b5-part1-configuration</id>
   <content type="html">在这个星期开始了兴奋的编码,之前的每周都是session讲座,一天到晚都是坐着听讲座还真的是困到不行,这周终于开始了编码. 这一周开始了在Chronicle项目编码,在实现第一个story的时候,发现这个每一次我更改了.java的文件,比如我改动了一下controller层或者service层抑或是DAO层的代码,我不得不重重新编译,部署,然后重新启动jetty ,这个过程有时候非常的令人烦恼,严重影响了你的编码节奏,更加于公司的价值观之一&quot;rapid feedback&quot;相冲突. 于是我搜索了一下,想起来过去在大学的时候也有一个项目,项目特别大,以至于你只改了.java文件的一行代码,但是需要发费十几分钟时间来部署重启服务器,那是相当的痛苦,于是当时搜索了一下,发现了JavaRebel,那时候还不是叫&lt;a href=&quot;http://www.zeroturnaround.com/jrebel/&quot; target=&quot;_blank&quot;&gt;JRebel&lt;/a&gt;,而且当时是免费的 ,我当时试着配置了一下但是仅仅局限于小小demo案例,并没有成功的应用到项目中,依稀记得配置不是特别清楚. 下面是引用自&lt;a href=&quot;http://www.zeroturnaround.com/jrebel/&quot; target=&quot;_blank&quot;&gt;zeroturnaround&lt;/a&gt;官网的一个视频,非常有趣:

&lt;a href=&quot;http://www.zeroturnaround.com/cartoon/javarebel_cartoon.swf&quot;&gt;&lt;object style=&quot;width: 500px; height: 396px;&quot; classid=&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000&quot; width=&quot;500&quot; height=&quot;396&quot; codebase=&quot;http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0&quot;&gt;&lt;param name=&quot;loop&quot; value=&quot;false&quot; /&gt;&lt;param name=&quot;swliveconnect&quot; value=&quot;true&quot; /&gt;&lt;param name=&quot;wmode&quot; value=&quot;window&quot; /&gt;&lt;param name=&quot;src&quot; value=&quot;http://www.zeroturnaround.com/cartoon/javarebel_cartoon.swf&quot; /&gt;&lt;embed style=&quot;width: 500px; height: 396px;&quot; type=&quot;application/x-shockwave-flash&quot; width=&quot;500&quot; height=&quot;396&quot; src=&quot;http://www.zeroturnaround.com/cartoon/javarebel_cartoon.swf&quot; wmode=&quot;window&quot; swliveconnect=&quot;true&quot; loop=&quot;false&quot;&gt;&lt;/embed&gt;&lt;/object&gt;&lt;/a&gt;

顺便提到JavaRebel因其显著的节省了开发人员的时间来获得&lt;a href=&quot;http://www.joltawards.com/&quot; target=&quot;_blank&quot;&gt;Jolt Award &lt;/a&gt;生产力大奖.Jolt Award这个奖可是说是一个标杆,每年都会评选一些奖项,比如书籍工具等等,几乎代表着行业的方向,比如Programming Scala(我最近在看&lt;a href=&quot;http://clojure.org/&quot; target=&quot;_blank&quot;&gt;Clojure&lt;/a&gt;,我很好奇为什么没有将Clojure算进去) ,还有一本&amp;lt;&amp;lt;Emergent Design: The Evolutionary Nature of Professional Software Development&amp;gt;&amp;gt; 也是Jolt大奖的获奖图书.所以每年花点时间在上面是非常值得的,可以帮助你了解前沿的技术和工具,帮助提高效率,强烈推荐.

回到主题,这一次我决定使用JRebel,这一次我花了比较多的时间来摆弄配置.现在的环境是Mac上面使用IntelliJ作为IDE,同时使用Jetty作为服务器,Ant作为构建工具.整个流程是,

第一步:找到build.xml中启动Jetty的代码,添加JVM参数.(现不讨论它的工作机制)
&lt;pre class=&quot;brush: xml; ruler: true;&quot;&gt;&amp;lt;jvmarg line=&quot;-noverify -javaagent:/Users/twer/jrebel.jar&quot; /&amp;gt;
&lt;/pre&gt;
你需要设定-javaagent到你的jrebel.jar所在的路径,我这里只是做测试spike.

第二步:你需要给你的IDE按照JRebel的插件,用来产生rebel.xml的描述,来描述你想监视的目录.我想说得显然的是JRebel插件在我的电脑上不管用,产生的rebel.xml文件都是空的,需要自己来写. 你需要将rebel.xml放在你平常放.properties文件的目录,也就是src目录下.下面是我的描述文件:
&lt;pre class=&quot;brush: xml; ruler: true;&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;application
xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
xmlns=&quot;http://www.zeroturnaround.com&quot;
xsi:schemaLocation=&quot;http://www.zeroturnaround.com http://www.zeroturnaround.com/alderaan/rebel-2_0.xsd&quot;&amp;gt;
&amp;lt;classpath&amp;gt;
&amp;lt;dir name=&quot;/Users/twer/Workspace/TWU/chronicles/web/WEB-INF/classes&quot;&amp;gt;
&amp;lt;!-- Only include package1 and its subpackages --&amp;gt;
&amp;lt;include name=&quot;chronicles/**&quot;/&amp;gt;
&amp;lt;/dir&amp;gt;
&amp;lt;/classpath&amp;gt;
&amp;lt;/application&amp;gt;
&lt;/pre&gt;
显然dir也就是你想监视的目录显然不应该像上面一样硬编码,而且我只想监视WEB-INF/classes下的chronicles目录下的文件.

第三步: 实现到现在后,你还需要首先开启&quot;编译时同时编译所依赖的文件&quot; 选项,这个选项在&quot;Preference&quot;.

Make sure all dependent files are also compiled.

Settings--&amp;gt;Project Setting--&amp;gt; Compiler --&amp;gt;Honor dependencies on  command

第四步:你还需要修改你项目的编译的输出路径,

change the output of compile on Module Settings &quot;Module&quot;-&amp;gt;&quot;Paths&quot;-&amp;gt;check &quot;Use module compile output path&quot;  将其输出路径指向你在rebel.xml所监视的目录.

第五步:到这一步,你基本上基本配置完成了,但是每次你修改完.java文件,你本能按下&quot;CTR+S&quot;保存,但是更多的时候希望当你保存时它会自动编译,所以你需要配置你的快捷键,

Overwrite default Save to Compile

Start using the default compile shortcut Ctrl-Shift-f9 or map it to Ctrl-s (files get still saved).

Steps: “File” --&amp;gt;”Settigns” --&amp;gt;”Keymap”  --&amp;gt;in the right window click ”Copy ”--&amp;gt; then find “Main Menu”  and click “File” below it--&amp;gt;Change “Save” to another key --&amp;gt; back to”Main Menu” and click “Build” --&amp;gt;find “Compile” and change key to “Ctr+S”

我有测试发现在controller或者service或是repository层的变化都能在页面上得到显示,现在你可以享受这个快速反馈的乐趣了.

下一部分将潜入进去探讨工作原理.
</content>
 </entry>
 
 <entry>
   <title>西游记 第三季</title>
   <link href="http://tuo.github.comjourney-to-west-part-3.html"/>
   <updated>2010-10-17T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e8%a5%bf%e6%b8%b8%e8%ae%b0-%e7%ac%ac%e4%b8%89%e5%ad%a3</id>
   <content type="html">这周非常的累,整个一周下来天天都是坐在教室里听SESSION,尽管总的来说并不是非常深入,但是却给了我很多想法,同时也帮助及时的&quot;反刍&quot;,联系原来学习到的知识.这篇日志本来是准备写一下MOCK和SELENIUM测试的,我准备好是在周末时花时间多多查点资料,形成一个系统的概念,但是这个来得比较迟,刚刚才有查找资料才发现这篇日志需要比较多的时间消化知识,整理思路, 而且整个周末参与集体活动,在野外呆了一天一夜,非常的累,上一篇日志花了将近8个小时的时间,自己感觉质量还可以,所以决定推迟一下,更好的整理思路.

下一周开始正式的编码,终于到了提起精神的时刻了,希望这个印度口音不会成为一个非常大的障碍.

&lt;img class=&quot;alignnone&quot; title=&quot;Arm is services&quot; src=&quot;http://lh4.ggpht.com/_i1xQ-NrcTdU/TLsg4Uvf29I/AAAAAAAAACY/I2TcmrtO7h4/s640/IMG_0447.JPG&quot; alt=&quot;&quot; width=&quot;538&quot; height=&quot;403&quot; /&gt;

&lt;img class=&quot;alignnone&quot; title=&quot;Cross the bush&quot; src=&quot;http://lh4.ggpht.com/_i1xQ-NrcTdU/TLsf-LMYfbI/AAAAAAAAACQ/kamHRuigJaw/s640/IMG_0469.JPG&quot; alt=&quot;&quot; width=&quot;543&quot; height=&quot;407&quot; /&gt;
</content>
 </entry>
 
 <entry>
   <title>关于做卓越的讲座 Part 3 排练</title>
   <link href="http://tuo.github.comeffective-presentation-part-3.html"/>
   <updated>2010-10-10T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%85%b3%e4%ba%8e%e5%81%9a%e5%8d%93%e8%b6%8a%e7%9a%84%e8%ae%b2%e5%ba%a7-part-3-%e6%8e%92%e7%bb%83</id>
   <content type="html">&lt;strong&gt;第三部分&lt;/strong&gt;&lt;strong&gt;: 排练.&lt;/strong&gt;

那现在已经到了排练的时候了.当我们已经构思好了整个主题,有了不错的PPT设计,接下来就是排练的时候.

有几点需要注意:声音,语言的使用,动作和肢体语言.

第一部分:掌控声音.试着尝试使观众听起来很自然,你的语调和节奏需要跟你想表达的信息想协调.同时需要注意音量,听起来比较大,但是又不会使离你近的人感觉很刺耳或者压抑.语调,这个很重要,尽量避免使用一个语调,将你的感觉和情绪带入到声音中使其更加的生动.节奏,尽量显的比较自然,除非你激动或者紧张.

第二部分:语言使用.讲的时候要表达出你的自信和你对自己话题的兴趣.尽量使用短句子,简单有力.讲的时候足够慢和清楚,使听众能听清楚每个词.

第三部分:移动动作.做到有目的的移动,不要简单因为紧张而移动,这会是观众感到疑惑.你的动作需要自然并且能够支撑你所表达的内容.不要经常的移动,这不是跑步,停下来做阐述一个要点.

第四部分:肢体语言.站直但是不要僵硬,你需要辐射你的能量.放轻松,随意,使用你的手和手势,就是简单的使你的身体反射出你的感情.眼神交流,经验是每一个人不超过5秒钟.另外不要把你手放在口袋里,拜托,我不枪你的钱;不要把手放在背后,感觉你被逮捕了;不要把手放在胸前交叉,这个很没型.

然后就是在讲座之前,充分练习.不要仅仅停留在想象中,而是应该对着家人和朋友等等面前练习.这能帮助你掌握整个的一个状况.正如我之前在MVC整个讲座前,没有做任何的排练,导致讲的时候对于时间把握不好,同时语言组织也不是很清楚.

正如凯哥提到他在比利时参加什么大会之前,为了达到更好的效果,决定将原来静态的东西改写成一个动态的程序一样,练习使得整个讲座更加生动.

排练之所以那么重要,是因为这个时候你可以联系你的声调语速和肢体语言等等并做出一个调整,达到一个最佳的辐射信息的状态.思科的研究表明,在如何使观众印象深刻上面,肢体语言和声音的音调会占到65%.所以你不能提高你的肢体语言和声调,除非你充分联系. 乔布斯的每一个讲座之前都回发上非常多的时间进行排练,并收集同事的反馈,力争达到一个将苹果理念最佳融合的状态.
&lt;blockquote&gt;His sense of informality comes after grueling hours of practice.

–BusinessWeek&lt;/blockquote&gt;
当然你需要注意你的着装是否合适,记住最重要的事请就是HAVE FUN.你需要向观众表明这件事情的趣味,并且让他们感觉到你在其中非常的享受.

最后你进入房间的时候,保持微笑,然后就是BE YOURSELF,讲得时候记住&quot;&lt;strong&gt;Point , Turn  and Talk&lt;/strong&gt;&quot;原则就好.
&lt;h1&gt;&lt;strong&gt;&lt;strong&gt;总结&lt;/strong&gt;&lt;/strong&gt;&lt;/h1&gt;
其实还有一部分是关于如何处理在现场的一些棘手问题的部分,比如如果有个观众觉得自己比你知道得还多,而且发问非常尖锐,你该怎么办等等, 鉴于这篇文章过于长,并没有详细列举,你可以参考后面引用的” Presentation Skills For Managers”. 这一篇文章的很多图片都有参考自下面的引用.

这次的博客受到了Sumeet讲座&lt;a href=&quot;http://www.slideshare.net/sumeet.moghe/tips-for-effective-presentations-4462308&quot; target=&quot;_blank&quot;&gt;Tips for Effective Presentations&lt;/a&gt;的启发,然后结合&lt;a href=&quot;http://michael.nona.name/&quot; target=&quot;_blank&quot;&gt;米高&lt;/a&gt;和&lt;a href=&quot;http://www.iamhukai.com/&quot; target=&quot;_blank&quot;&gt;凯哥&lt;/a&gt;之前给我讲座提出反馈,再在网上搜索资料,完成了这个话题.有很多地方都有不足.

http://www.brainrules.net/

&lt;a href=&quot;http://brainrules.blogspot.com/&quot;&gt;http://brainrules.blogspot.com/&lt;/a&gt;

这是这篇文章的一个意外收获,

Brain Rule 是由JOHN MEDINA创建的一个关于研究大脑认知行为的一个网站,他的书&amp;lt;&amp;lt;&lt;a href=&quot;http://www.amazon.com/gp/product/0979777704?ie=UTF8&amp;amp;tag=brarul-20&amp;amp;linkCode=as2&amp;amp;camp=1789&amp;amp;creative=9325&amp;amp;creativeASIN=0979777704&quot; target=&quot;_blank&quot;&gt;Brain Rules&lt;/a&gt;&amp;gt;&amp;gt;是New York Times 畅销书

&lt;img class=&quot;alignnone&quot; title=&quot;Brain Rules Cover&quot; src=&quot;http://www.brainrules.net/images/brain_rules_cover_3d_white.jpg&quot; alt=&quot;&quot; width=&quot;345&quot; height=&quot;345&quot; /&gt;

&lt;a href=&quot;http://www.presentationzen.com/presentationzen/  &quot; target=&quot;_blank&quot;&gt;Presentation Zen&lt;/a&gt;有很多有用的知识 关于如何做好PPT等 ZEN禅道  应该跟我当初学CSS时候的网站&lt;a title=&quot;Beauty of CSS design&quot; href=&quot;http://www.csszengarden.com/&quot; target=&quot;_blank&quot;&gt;CSS Zen Garden &lt;/a&gt;取名的想法差不多

下面是三篇我所引用到关于做出好的PPT的引用:

&lt;a href=&quot;http://www.slideshare.net/nusantara99/presentation-skills-for-managers-52150&quot; target=&quot;_blank&quot;&gt;&lt;strong&gt;Presentation Skills For Managers&lt;/strong&gt;&lt;/a&gt;

&lt;a href=&quot;http://www.slideshare.net/satyajeet_02/how-to-make-effective-presentation&quot; target=&quot;_blank&quot;&gt;&lt;strong&gt;How to make effective presentation&lt;/strong&gt;&lt;/a&gt;

&lt;a href=&quot;http://www.slideshare.net/prwalker/the-presentation-secrets-of-steve-jobs-2814996#&quot; target=&quot;_blank&quot;&gt;&lt;strong&gt;The Presentation Secrets Of Steve Jobs&lt;/strong&gt;&lt;/a&gt;

&lt;strong&gt;&lt;a href=&quot;http://www.slideshare.net/sumeet.moghe/tips-for-effective-presentations-4462308&quot; target=&quot;_blank&quot;&gt;Tips  for Effective Presentations&lt;/a&gt;&lt;/strong&gt;

&lt;a href=&quot;http://www.iamhukai.com/?p=12&quot; target=&quot;_blank&quot;&gt;讲演培训中学到的&lt;/a&gt;

一些软件:Keynote  , &lt;a title=&quot;Create astonishing presentations live and on the web&quot; href=&quot;http://prezi.com/&quot; target=&quot;_blank&quot;&gt;Prezi&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>关于做卓越的讲座 Part 2 设计页面</title>
   <link href="http://tuo.github.comeffective-presentation-part-2.html"/>
   <updated>2010-10-10T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%85%b3%e4%ba%8e%e5%81%9a%e5%8d%93%e8%b6%8a%e7%9a%84%e8%ae%b2%e5%ba%a7-part-2-%e8%ae%be%e8%ae%a1%e9%a1%b5%e9%9d%a2</id>
   <content type="html">&lt;strong&gt;第二部分&lt;/strong&gt;&lt;strong&gt;: 设计PPT.&lt;/strong&gt;

这一步是整个过程中非常重要的一环,有很多细节需要注意.昨天Sumeet有做过讲座&lt;a href=&quot;http://www.slideshare.net/sumeet.moghe/tips-for-effective-presentations-4462308&quot; target=&quot;_blank&quot;&gt;Tips  for Effective Presentations&lt;/a&gt;,列举出了很多需要注意的要点.我简要的总结一下:

1.  对比(Contrast)
这个主要强调是你的背景色和文字,色调等等的这样的一个搭配一定要能突出你想重点表达的

2.  全屏显示(Full-Bleed Page)  印刷图象超出纸张四边的部分

3.  局部显示(Bleed  Off Edges)
这个有很好的例子便是对于KFC而言,它的广告的图片看起来非常大,但是实际上你去吃的时候会发现分量非常小.

4.  图片比例(Aspect Ratio)

5.  低分辨率图片(Low Resolution Image)
如何处理低分辨率的图片了,当你拿到的图片非常小或者没有办法能拿到更大更清楚的图片了?  其中的一个解决方案是你可以在小图片周围加上一些具有艺术效果的边框或者什么的. &lt;a href=&quot;http://www.flauntr.com&quot; target=&quot;_blank&quot;&gt;Flauntr&lt;/a&gt;这个网站就可以在线处理一些图片.

6.  保持主题一致(Be Consistent)
保持风格主题一致非常重要,因为不一致的风格会吸引观众的注意力,不一致有可能是暗示或者强调重要性,应该用不一致来吸引观众而不是分散他们的注意力.

7.  大总是好的(Big is Good)
字体或者图片尽量要大的为好,首先你讲座所在的地方可能会有很多排,那么使得后排的人也能清晰看到文字或图片是非常重要的.同样它也能使得每一张页面的文字量尽可能少.

8.  透明(Alpah Trasparency)
合理的使用透明是比较重要的,比如你在把一个图片想PS到另一张图片上,那么如果能PS一下使其边缘因素能透明从而使整个页面都很好嵌入也很重要.最后你可以在放大图片使其不至于很突兀.那么你可能需要了解什么图片是可以应用透明效果的,比如PNG格式的.

9.  去除分心的因素(De-Noising)
比如你有一张图片,想介绍某一个人,但是这张图片上还有其他非常会使观众分心的背景或者什么的,你可以是使其背景模糊,从而突出你想表达的部分.

10.三点定律? (Rule of Thirds)

11.跟随观众(Follow People)

12.内嵌视频(Embedded Video)
那这一步分主要是你尽量把视频内嵌到PPT中,而不是讲的时候跳出PPT,然后去本地硬盘或者什么地方去找.更进一步你可以将内嵌视频上加一个电视机的框框,怎么做可以网上参考参考.

13.字体(Typography)
这一部分需要注意的是:首先,SERIF字体在屏幕上读起来很困难,SANSERIF相对更清楚.其次,&lt;em&gt; &lt;/em&gt;&lt;em&gt;Italics在屏幕上读起来很费劲.&lt;/em&gt;最后,使用粗体或者颜色来强调而非下划线.

除了Sumeet提到的之外,还有一些需要注意的.首先便是简洁.

简洁在这里的所指的是文字非常简单但是却要有高度的视觉效果. 你可以看到有两个因素:文字和图片.对于文字,推荐一个大概每一个PPT页面的文字不能超过40个字.对于图片,有研究显示用图片来表达想法比用文字来表达更能够被观众所记住.心理学上称之为: &lt;a href=&quot;http://en.wikipedia.org/wiki/Picture_superiority_effect&quot; target=&quot;_blank&quot;&gt;Picture Superiority Effect (PSE)&lt;/a&gt;.另外一件有趣的事情是如果信息是以口音的方式表达出来,那么72小时,只有10%的东西会被观众记住,而如果是以图片的方式呈现,那么会有65%的信息会被观众记住.以下图片引用在&lt;a href=&quot;http://www.slideshare.net/prwalker/the-presentation-secrets-of-steve-jobs-2814996#&quot; target=&quot;_blank&quot;&gt;The Presentation Secrets Of Steve Jobs&lt;/a&gt;

&lt;img class=&quot;alignnone&quot; src=&quot;http://lh6.ggpht.com/_i1xQ-NrcTdU/TLGlw1XBLmI/AAAAAAAAABw/iLV817TLcd0/Screen%20shot%202010-10-10%20at%205.07.54%20PM.png&quot; alt=&quot;&quot; width=&quot;311&quot; height=&quot;264&quot; /&gt;

根据&lt;a href=&quot;http://www.johnmedina.com/&quot; target=&quot;_blank&quot;&gt;John Medina&lt;/a&gt;,你的大脑会把每一个字解释转换成一个图片,所以充满字的PPT就会阻塞你的大脑,因为大量文字的需要解释成图片.

我们可以参考一下乔布斯如何将复杂的信息进行简化.比如他在介绍MACBOOK AIR时,并没像我们平时那样劈里啪啦将很多文字比如它有多薄等等贴上SLIDE,而是用了一个公司的信封来装MACBOOK AIR这样一个很有视觉震撼力的场景,使得整个都不言而喻.以下图片引用在&lt;a href=&quot;http://www.slideshare.net/prwalker/the-presentation-secrets-of-steve-jobs-2814996#&quot; target=&quot;_blank&quot;&gt;The  Presentation Secrets Of Steve Jobs&lt;/a&gt;

&lt;img class=&quot;alignnone&quot; title=&quot;Jobs show Macbook Air in an envelop&quot; src=&quot;http://lh5.ggpht.com/_i1xQ-NrcTdU/TLGlxDcDAjI/AAAAAAAAAB0/HsEU26SfPM4/Screen%20shot%202010-10-10%20at%202.55.37%20PM.png&quot; alt=&quot;&quot; width=&quot;525&quot; height=&quot;341&quot; /&gt;

接下来就是包装你的数字,使其更有意思.数字并会使观众产生Resonate共鸣,除非你把它放在一个大家能听懂的上下文中.帮助他们理解的最佳方式就是讲这些数字和观众平时熟悉的事情东西联系起来.正如乔布斯2001年介绍iPod说它有5G的空间,然后紧接着进一步更加明确阐述到”你能在你的口袋中携带1000首歌”.以下图片引用在&lt;a href=&quot;http://www.slideshare.net/prwalker/the-presentation-secrets-of-steve-jobs-2814996#&quot; target=&quot;_blank&quot;&gt;The  Presentation Secrets Of Steve Jobs&lt;/a&gt;

&lt;img class=&quot;alignnone&quot; title=&quot;Jobs Metaphor&quot; src=&quot;http://lh4.ggpht.com/_i1xQ-NrcTdU/TLGnttNg1yI/AAAAAAAAAB8/PD-hvk0-g6c/Screen%20shot%202010-10-10%20at%205.16.37%20PM.png&quot; alt=&quot;&quot; width=&quot;510&quot; height=&quot;184&quot; /&gt;

最后就是展示你亮点hightlight的时刻.正如乔布斯介绍MACBOOK AIR ,他并没有文字性的叙述,而是从信封中取出了MACBOOK AIR,这一刻绝对是整个讲座中最抓住人的时刻,以后若干年后,大家可能会忘记很多细节,但是那一刻,绝对会是记忆深刻,记忆犹新.根据&lt;a href=&quot;http://www.johnmedina.com/&quot; target=&quot;_blank&quot;&gt;John Medina&lt;/a&gt;,大脑并不会注意无聊的事情.当大脑注意到一件很有情感Emotional的事件时,它会释放多巴胺,而多巴胺会帮助大脑记忆和信息处理,” It’s like a mental post-it note that tells your brain, remember this.”. 另外一个例子是关于Randy Pausch的最后一堂演讲&lt;a href=&quot;http://www.youtube.com/watch?v=ji5_MqicxSo&quot; target=&quot;_blank&quot;&gt;Achieving Your Childhood Dreams,&lt;/a&gt;他此时已经身患癌症,距离他去世只有四个月,整个讲座有一幕记忆深刻.当时他跟纵人说我比你们还要健康,体型保持的更好,然后他开始做起了俯卧撑,非常难的俯卧撑.

这里推荐你可以在构思的时候,在旁边放很多的便利贴,然后将每一个便利贴作为一个SLIDE,然后可以先写下你这个SLIDE想要表达的东西和主题.然后你可以在创作PPT的时候,去想怎么把这个主题如何有效的更好的表达出来,这可能会发点时间都是效果肯定是值得的.

举一下我前两次PPT作为一个负面案例把,第一个关于MVC的话题,当时的PPT是非常乱,文字特别多,重点不突出,有些时候我甚至就是照着文字读.第二个关于PRG的,文字不多,但是图片过于小,以致都看不清楚.
&lt;blockquote&gt;Every slide was written like a piece of poetry –Paul Vais&lt;/blockquote&gt;
</content>
 </entry>
 
 <entry>
   <title>关于做卓越的讲座 Part 1 构思</title>
   <link href="http://tuo.github.comeffective-presentation-part-1.html"/>
   <updated>2010-10-10T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%85%b3%e4%ba%8e%e5%81%9a%e5%8d%93%e8%b6%8a%e7%9a%84%e8%ae%b2%e5%ba%a7-part-1-%e6%9e%84%e6%80%9d</id>
   <content type="html">做一个有效的讲座对于我来说一直都是非常重要的,因为对于咨询人员而言,如何让你的知识得到有效的分享和交换是一个非常重要的部分.如果你有很强的能力和很渊博的知识,但是没有一个很有的交流和分享的能力,那么你的价值实惠大大的打折扣的.
&lt;blockquote&gt;A person can have the greatest idea in the world.  But if that person can’t convince enough other people,  it doesn’t matter.                                                                                                 –Gregory Berns&lt;/blockquote&gt;
尽管我也有意识到它的重要性,但是缺乏这样的机会来系统的整理和总结这样一个话题:如何做出有效的讲座(How To Make Effective Presentation).刚刚好上周五的Open Space上,Sumeet有做了关于这个话题的一个讲座,给了我很多启示,然后我上网也搜了艘这方面的资料,下面便是我的一些心得.

做一个好的讲座需要有三部分,如下图以下图片引用在&lt;a href=&quot;http://www.slideshare.net/prwalker/the-presentation-secrets-of-steve-jobs-2814996#&quot; target=&quot;_blank&quot;&gt;The Presentation Secrets Of Steve Jobs&lt;/a&gt;:

&lt;img class=&quot;alignnone&quot; title=&quot;Three Stages Of Presentation&quot; src=&quot;http://lh5.ggpht.com/_i1xQ-NrcTdU/TLGYK_hs_RI/AAAAAAAAABY/hSsrQQfcv-w/Screen%20shot%202010-10-10%20at%204.02.22%20PM.png&quot; alt=&quot;&quot; width=&quot;489&quot; height=&quot;210&quot; /&gt;
&lt;h3&gt;第一部分:构思.&lt;/h3&gt;
&lt;strong&gt; &lt;/strong&gt;这一部分的意思 ,我们可以从一个我经常干的一个场景来引出.我原来的做PPT之前,首先我会去查资料,这个过程通常比较久,查完差不多的资料的时候,我就开始把Keynote或者PPT等等软件打开,然后对着电脑想着每个页面我应该怎么怎么弄,然后就是一顿搔头弄脑.我不知道其他人是怎么做得,但是貌似我这种做法还是蛮常见的:搜索资料完之后,打开软件一顿狂敲,然后苦苦思索怎么排版和穿连等等.

这种做法不是非常好,为什么了? 因为一旦你打开软件,对着屏幕,你就非常容易分心到,比如如何排版,如何去搞个图片,然后就开始去搜索图片等等,甚至有时候都不知道自己原来是要想干什么,非常容易分心走神,特别是对于我这种思维比较离奇飘忽的人,非常难以集中注意力到整个PPT的逻辑和想表达的实质内容,更加难以去把整个思维想法都串联起来.一个关于乔布斯的:
&lt;blockquote&gt;Truly great presenters like Steve Jobs visualize, plan and create ideas on paper (or whiteboards) well before they open the presentation software&lt;/blockquote&gt;
那这个应该如何做了?  可以参考敏捷开发中的经常用到的白板和卡片或者是草稿纸.你可以先把所有的电子设备都丢一边,当然这不是必然,想表达的意思是尽量创造一个安静的不容易分心走神的环境,比如我把所有电子设备都抛开了,但是我女友老叫我陪她写代码或者老叫我扫地做饭等等,尽管我现在是和尚,那这种环境下你也无法专心,此时可能需要抽出一些自己的时间,比如上咖啡厅或者茶厅,当然如果你觉得厕所的味道很提神,也可以去北京,但可能没有卫生纸,只有树叶,所以….重点是你需要找一个你能静下心来思考整理的地方,如果你的东西思维不够集中或者比较浮躁,你简直是在浪费别人的时间,如果你浪费了半个小时假设你有30个观众,那就是15个小时,那你还不如集中精力好好弄好这半个小时,正如凯哥原来说过的.
&lt;blockquote&gt;The single most important thing you can do to  dramatically improve your presentations is to &lt;strong&gt;have a story to tell &lt;/strong&gt;before  you work on your PowerPoint file.

– Cliff Atkinson, Beyond Bullet Points&lt;/blockquote&gt;
这一部分重要之处在于你在为你的整个讲座做一个铺垫,你需要去搜索资料,整理思维,提炼出要点,最后需要去勾勒出你大致的一个故事.而更细节的步骤是:

首先,你需要分析你的观众,需要思考你的目标观众,对他们做些一个基本的定位,有三个问题值得思考:
&lt;p style=&quot;text-align: left;&quot;&gt;第一,你想让你的观众获得什么;&lt;/p&gt;
&lt;p style=&quot;text-align: left;&quot;&gt;第二,观众可能知道了什么关于这个话题;&lt;/p&gt;
&lt;p style=&quot;text-align: left;&quot;&gt;第三,这个讲座的目的目标.&lt;/p&gt;
比如在我上次的一个讲座,关于HTTP(&lt;a href=&quot;http://en.wikipedia.org/wiki/Post/Redirect/Get&quot; target=&quot;_blank&quot;&gt;&lt;strong&gt;PRG模式&lt;/strong&gt;&lt;/a&gt;),我就完全没搞清楚我的目标观众,当时完全没有这种概念,然后可以看到整个的PP过程中很大一部分篇幅是介绍一些HTTP的基本概念,然后开始讲PRG模式,实质上我花那么大的篇幅去介绍HTTP的基本概念是为了后面的重点PRG模式,但是我没有思考我的目标观众的情况,其实我的目标观众对于这些HTTP基本概念已经是很熟悉了,所以,也就是说,我前面一大段的基本概念都是在浪费大家的时间,正如凯哥说得,这个时间大家都是处于Billable的一个时间,而且这个失误也是最后导致此次讲座超时的一个重要原因.现在,从这个负面案例中,我想到了如果我提前对于目标观众做一些基本的分类或者调查,那是不是会更有利于我组织整个话题了. 比如 这个分类 (这个是一个假设可能不太准确):

&lt;img class=&quot;alignnone&quot; title=&quot;PRG Survey&quot; src=&quot;http://lh5.ggpht.com/_i1xQ-NrcTdU/TLGdbhUxVnI/AAAAAAAAABo/emUf-BaftM4/PRG%20Survey.jpg&quot; alt=&quot;&quot; width=&quot;420&quot; height=&quot;324&quot; /&gt;

上面的这样这样一个调查或许不是非常准确,但是有了这样一个对于目标观众的基本的了解,可以帮助我们如何组织整理思路和主题.比如对于上面的一个情况,我可能会重点想表达两点:第一,介绍PRG模式是一个什么东东;第二:它的工作原理和利弊等等.至于HTTP的一些基本概念,我会选取一些对于PRG理解比较关键的一些基本概念,因为它即可以帮助那些不熟悉HTTP基本概念的观众,也可以帮助已经了解HTTP基本原理的更好地理解PRG模式的原理.

然后,就是将你信息做一些整理形成一个大致脉络或者轮廓.

这一部分需要思考你的脉络或者轮廓的方式,然后组织已有的初步的数据资料,最后形成一个基本的轮廓模式.

组织轮廓有三个部分,第一是引入,是否需要阐述一下当前的状况或者回忆一下历史,是否可以使用名人名言或者问题或者一个故事作为吸引观众的一种策略,甚至可以像乔布斯一样使用对比来强调自己的优势或进步等等.稍微更加细化一点你的主题,和如何串联你的这些内容.对于引入,你可以使用对比手法,问题式的,比如对于PRG模式,如果我们不应用PRG之下,会遇到什么问题,这个时候可以将这些问题抛给观众,然后可以紧着导出有解决方案,当然这个过程观众可以有非好的互动参与,然后可以比较这些方案的利弊,导出PRG模式,并说明的它的优势(当然你可以使用对比),适时地向听众抛出问题,比如它是怎么工作的等等.这种问题式的串联方式是一个具有非常好的互动的方式,观众可以感觉到它们有被参与进来.所以这种组织思路的方式非常好.在这个过程中,不止问题式,还可以按照事情发生的时间顺序等等,最终目的在于串联起你的整个故事.在引入之后便是内容主体了,比如对于PRG模式,采用的便是问题/解决方案的模式,当然还有很多其他的方式.最后便是总结,你可以总结你的主要论点,或者提出精要,比如像是PRG中最后便是以三条最佳实践作为结尾,这一点是我整个糟糕讲座中非常少的闪光点之一.

这一部分的最后一步便是反复修改,润色,所以有可能你的草稿会很乱,但是只要这个思维,这个故事串联好了,做到心中有数,能帮助你抓住主要脉络,你就可以进行下一部分的 工作了.

你可以看到我为这篇日志写一个草稿,记录了一下写这篇日志的一个基本思路: (虽然比较乱,但是能非常有效的帮助我知道自己再做PPT时要干的是什么)

&lt;span style=&quot;color: #ff0000;&quot;&gt;单击查看完整的大图,你可以放大很多倍&lt;/span&gt;

&lt;a href=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2010/10/IMG_0439.jpg&quot;&gt;&lt;img class=&quot;alignnone size-medium wp-image-64&quot; title=&quot;关于此篇日志的草稿&quot; src=&quot;http://tuohuang.thoughtworkers.org/wp-content/uploads/2010/10/IMG_0439-300x225.jpg&quot; alt=&quot;&quot; width=&quot;421&quot; height=&quot;315&quot; /&gt;&lt;/a&gt;
</content>
 </entry>
 
 <entry>
   <title>西游记 第二季</title>
   <link href="http://tuo.github.comjourney-to-west-part-2.html"/>
   <updated>2010-10-04T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e8%a5%bf%e6%b8%b8%e8%ae%b0-%e7%ac%ac%e4%ba%8c%e5%ad%a3</id>
   <content type="html">昨天有进行传统的寻宝活动,这个天气真是热死的,然后在甘地路和商业街上有如无头苍蝇般的乱跑乱去,感觉街上有点挤,而且这个摩托车非常彪悍,令人发指.我的感觉是跟着印度本人跑就好,尽管我非常想参与,但是这个话没听懂,拜托,您讲慢点,有点晕.
今天主要是听了几个SESSION,主要是关于个公司文化的一些简介.还有一些关于我们将要做得项目的一些技术介绍等等.不得不说,这个咖啡还不错,食物还可以把.感觉有点麻烦的是这个中午困的太厉害了,下午听SESSION的时候差不多快睡着了,而且下课后还没有篮球,太令人发指了.顺便说下,那个SUMEET用的PPT的软件&lt;a href=&quot;http://prezi.com/&quot; target=&quot;_blank&quot;&gt;PREZI&lt;/a&gt;非常酷,可以学习下.
我问了SAM,他没有搞到球,又问了几个印度同事都没搞到球,大家打球的积极性都很高,就是找不到球.
还好,我有碰到华为的人,太好了,他们有球.

&lt;img class=&quot;alignnone&quot; title=&quot;TU&quot; src=&quot;http://lh6.ggpht.com/_i1xQ-NrcTdU/TKoMG5pQrsI/AAAAAAAAABI/6Lo7o2zy_rU/s640/IMG_0150.JPG&quot; alt=&quot;&quot; width=&quot;554&quot; height=&quot;415&quot; /&gt;
</content>
 </entry>
 
 <entry>
   <title>西游记 第一季</title>
   <link href="http://tuo.github.comjourney-to-west-part-1.html"/>
   <updated>2010-10-02T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e8%a5%bf%e6%b8%b8%e8%ae%b0-%e7%ac%ac%e4%b8%80%e5%ad%a3</id>
   <content type="html">昨天应该满有趣的,首先是过马路,这个太惊险了,我的天.没有任何人行横道的概念,道路上都是摩托车,三轮车和各种乱七八糟的车,而且它们的速度都超快,完全不理会你这里有什么人.所以场面看起来相当的危险.所以有经验的人总结说:首先,你需要结伴而过,因为撞死十个人远比撞死一个人来得难 或者说他需要付出的代价更高;第二便是要锹准时机,有空隙就立马过去.下午有跟教练见面,教练是ERROL,一个看起来是本地人,但实际却是一个非常地道的旧金山人,口音非常好,我很感谢,是因为我们组有一个印度本地人,这口音,令人发指,我记得昨晚跟新西兰的LOUIS聊天时,遇到了很多有有趣的事情,比如发音方面,有几个单词他们发音的感觉UK的口音非常严重,得仔细辨别才行,其他都OK. 教练大概就讲了一下这次他需要做的事情更像一个领路人,他原本是一个QA,但是经验非常多,所以即使是DEV,有问题也可以问他.晚上去喝酒时,我感觉我这的说笑话的能力还是满全球化的,嘿嘿,聊到笑到不行,很有趣.(拜托 如果换作是印度人,估计我的笑话就不起作用了).
今天是一个休息日,几个人去附近超市买了点东西,下午回来准备去打球.当我换好衣服来到下面,结果却下雨了,等了一会雨停了,但是球场上积水还是很多.我打电话问了问吴少,看看能不能搞个球,因为他的室友SAM说他想打球,结果他却睡着了......  等了一会借不到球,然后我就跟吴少跟印度本地人打起了球,场地上都是水,鞋子都湿透了.你别说,印度小孩打球还真的可以啊,还有一个长的高点的,投篮比校准,没办法,场地上都是水,超滑,而且那个篮筐简直令人发指,好吧,我承认这是一个场地问题.就这么打了一会,SAM有下来了,额,非常高,使我们之一批中最高的一个,大概一米九五,令人发指,不过他以前是打冰球的,所以打起篮球来有点僵硬,缺乏灵活性,投篮真是水到不行,好几个要么是蓝外空心,要么是用户过猛,令人疑惑的是人家还要跟我们比投篮,我当时想&quot;大姐,你这是自取欺辱阿,呵呵&quot;. 结果可想而知,被我们玩爆,呵呵.过了一会,那个印度人说要球走了,结果就没球了.大家都觉得非常不爽,拜托,打到一半就没了,这还不SUCKS,然后我们商量了一下要么去买个球或者是租个球,但此时要下雨了,就约定去搞个球下次打.
晚上会住处的时候,DAMON正有在看电视,跟他聊了下晚上的篮球和LEBRON JAMES等等的话题,看来看NBA有个好处就是跟他们聊这个很有话题,呵呵,准备搞到球后下次一起打,看起来他还是应该会比较蹦达把,很期待.
昨天吃站立早餐时有跟茱丽叶聊了会,很明显,只要是个美国人,跟她们说起NBA篮球之类的,都会有很多话题,顺便还聊到了音乐,我顺手说了个什么乡村音乐,她很差异,你连这个都有喜好,看不出来阿.然后又讲到了嘻哈音乐,我说JAY_Z,EMINEM很酷,没想到人家觉得,恩....我觉得是年纪问题把,但是我觉得这个笑话不太好,然后要收回了,看起来还不错.

&lt;img class=&quot;alignnone&quot; title=&quot;TWU&quot; src=&quot;http://lh3.ggpht.com/_i1xQ-NrcTdU/TLdLyvtdkpI/AAAAAAAAACE/SQr79m5SAds/s640/IMG_0328.JPG&quot; alt=&quot;&quot; width=&quot;534&quot; height=&quot;400&quot; /&gt;
</content>
 </entry>
 
 <entry>
   <title>TWU计划</title>
   <link href="http://tuo.github.comtwu-plans.html"/>
   <updated>2010-09-30T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./twu%e8%ae%a1%e5%88%92</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;今天有去TWU,正在航途上,非常的累,不过还好旁边一个印度大叔还不错,聊了满多的,感觉还不错.我.现在在离班加罗尔还有两个小时的路上的,我也可以仔细想想这个TWU的一些计划和目标.正如凯哥提示我这个你需要了解你的目的,要去干什么,想要达到什么目的,然后在整个过程中保持一个比较集中的精力,而不至于偏离主航线主目标太多. 仔细想想,下面是我罗列的这样一个目标表:

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;需要加强点 1 ---加强表达能力和交际能力,,语言应该是个问题,重要的是你在这个过程中如何让其他人明白无误或者清楚的了解你要干什么,你要表达什么意思,在说之前先整理好思路.所以这个是将会是我非常会注意的.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;期望达到点 1 ---收集跟我结对编程或者说教练的一些反馈,关于比如说肢体语言是否合适,表意是否清楚,交流是否吃力这几个方面.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;需要加强点 2 ---扩展交际圈,了解更多的同事,特别是将来非常有可能会再次见面或者工作的同事,多多交流,当然我觉得打篮球会帮助我很多,我也会一如既往发挥不怕丢脸的能力.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;期望达到点 2 ---这需要大胆,我觉得还OK,那希望回来时能够首先认识很多新同事,争取有或多或少的了解和沟通,特别是交换思维,比如说我的笑话能力.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;然后便是需要特别留意或者说跟近期或将来可能会一起工作的人混熟.还有一点是打篮球横扫整个办公室,你看我这敏捷性,这球性,这滞空,呵呵,我乐观的觉得没问题拉.选择打球是因为打篮球是因为这种活动很容易,而且也很有团队的意思,当然尽管我打球的时候纳什的天赋是被隐藏着的,不过能够很容易跟其他人混熟,我非常希望那边有个别篮球迷,如果没有,一样拖着人也去打.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;需要加强点 3 ---系统的了解敏捷的整套东东.尽管到现在,我有了解了一部分,但都是零零散散的,比如XP,看了几本书,然后了在实践中有接触,但是仍然不够深刻和系统;再比如SCRUM,更是,我对于它的了解之前仅仅停留在读了一本INFOQ上面的一本MINI BOOK &amp;lt;&amp;lt;SCRUM FROM THE TRENCH&amp;gt;&amp;gt;,其他的就是在项目中有实践知道一点点是怎么回事.所以关于敏捷的方法论或者实践将会是我在TWU一个重要的关注点. 往细里说,XP和SCRUM,一个是关于项目实践中的BEST PRACTICE,一个是注重于管理.我之前看到在官方网站上有看到SCRUM和XP一般都结合一起使用,但是在项目实践中好像没有特别说将二者泾渭分明,我想这也应该是实践的意义,没有任何东西是完全能照搬的,必须适合这样的一个环境或者说情景而做出一些折衷.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;期望达到点 3 --- 理论跟实践一样重要,更多时候需要的是定期的系统的整理知识,比如将项目中碰到的问题和别人接近问题的思路.尽管这次更加会偏理论性,但是并不意味着它不重要.我需要系统的整理自己过去零碎的关于敏捷的知识.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;鉴于实在是太困,先……
</content>
 </entry>
 
 <entry>
   <title>黑白名单和复合</title>
   <link href="http://tuo.github.comblackwhitelistandcomposition.html"/>
   <updated>2010-09-22T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e9%bb%91%e7%99%bd%e5%90%8d%e5%8d%95%e5%92%8c%e5%a4%8d%e5%90%88</id>
   <content type="html">上周编程中有碰到需要处理这个用户权限逻辑的重构,因为首先我们一开始写代码时是很简单的,没有新的超复杂的需求或者变化出现,所以权限这一块基本上比较简单.但是当我们后来遇到一个新情况,某个用户现在有个动作是被禁止的,但是现在需要可以允许,这样就得需要去给某个角色添加允许某一个动作的逻辑,但实际中发现这很困难,为什么? 因为这个角色维护是一个黑名单,而其他角色维护的是白名单.所以这个你的思维得在这两个HAT中不停的转换,有时候很晕,即使有测试,我们觉得仍然非常痛苦.因为这个问题的出现,觉得说这个时候是不是应该达到来某一个阀值THRESHOLD,可以对它进行重构,改成维护一个白名单了.然后就根据测试和规则,对其进行重构.
第二个比较棘手的问题是一个动作可能需要多个用户一起参与,比如CopyAsNewCurve需要判读当前用户是否同时具有CREATOR和SYSADMIN的角色,而我们当前只有处理每个用户之间是没有任何的知情权的,听凯哥说UNIX也有这样的用户管理机制.那这个问题如何是好了? 我当时的想法是就像STRUTS2有它一系列的拦截器或者像ACEGI一样的拦截器等等(尽管两个我都不是很熟悉),但是感觉很接近.将四个角色按照一定的顺序链起来,然后讲动作等信息作为一个&lt;a href=&quot;http://www.industriallogic.com/xp/refactoring/accumulationToCollection.html&quot; target=&quot;_blank&quot;&gt;COLLECTING PARAMETER&lt;/a&gt; 来收集每一个用户对此动作或者用户的许可情况,如果允许那么直接返回;如果不允许,并修改COLLECTING PARAMETER并将其传至下一层,如果到了最后一层没有人处理得了,那就返回FALSE. 然后凯哥说了一个想法,那就是CopyAsNewCurve其实是两个动作,一个是CREATOR可以Create 并且SYSADMIN可以Read的权限,这样的好处还是明了的,实现起来非常简单.方案是使用COMPOSITE模式,将复合动作和原子动作一视同仁(对外).对于复合动作中的每一个动作如果有一个失败,那么就说验证是失败,没有权限;如果都OK,那就是用户有这个权限.
</content>
 </entry>
 
 <entry>
   <title>关于小步前进</title>
   <link href="http://tuo.github.comsmall-steps.html"/>
   <updated>2010-09-20T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e5%85%b3%e4%ba%8e%e5%b0%8f%e6%ad%a5%e5%89%8d%e8%bf%9b</id>
   <content type="html">在过去的一周中,主要是跟凯哥一起做CurveBuilder这边的性能测试,同时修复已经测试出来的bug和不完善的地方.对于性能测试这一块,测试的计划是这样子,首先准备好数据(后面会讲到测试数据的这样一个台阶或者说分水岭),然后对于几个主要页面,使用Apache Benchmark来测试这几个页面的响应的时间.首先需要面对的问题是如何比较合理的划分前提准备数据的层次,在项目中我们有表EventSource它的数据量是比较稳定同时也比较接近用户真实环境中情况,同时也有Favorites,Alarms和FormulaVersions这三个表,他们的数据的层次就显得很有必要, 势必要按照这样一个基本阶梯来 : 一开始是数据量基本符合用户的正常使用的通常情况;第二是数据量是用户可能会达到,但是相对所占比列不是很大 ;最后便是认为用户基本上不会达到,或者很少很少的情况下达到,可以认为这是极限测试. 通过凯哥跟客户的交流 ,进一步确定了测试数据阶梯的这样一个划分,分别是500,1000和2000. 然后使用Apache Benchmark进行对服务器能处理请求容量或者速度的一个测试,分别有三个类似的阶梯划分,一个是50个用户30个并发程度,100个请求50个并发程度和500个请求100个并发程度.那使用ab的话,因为我们使用的是本地认证,所以我们必须绕过它的限制,所以需要有针对性的进行配置. 紧接着写了一个Ruby脚本来请求每一个页面,并对返回的结果做一个简单的处理.

一开始的时候我们并没有直接上ab ,而是现在本地上跑看看速度处理怎么样, 在Firefox下速度显示超快，但是在IE8发现显示Favorite 的页面速度超慢,不知道为什么,然后凯哥就开始一步步检查这个瓶颈在哪里出现的(你可以能会问题为什么用什么IE，不以MOSe为标准或者怎么样，我得提示说这个是客户的要求，人家就是要求说IE8，所以客户是G .O .D).首先想到的是在&quot;&quot; 层下的从数据库取出数据的速度很慢,然后写了测试发现速度还是可以的,证明取出数据是非常快,然后我们想说那应该就是View层render的非常慢,然后我们一点一点将显示的东西去掉，看看速度有没有提.果然我们发现这一段代码
&lt;pre class=&quot;brush: csharp; &quot;&gt;
&amp;lt;% bool oddEven = true;
foreach (var item in presenters) {
%&amp;gt;
&amp;lt;tr&quot; : &quot;odd&quot;%&amp;gt;&quot;&amp;gt;
.....
&amp;lt;td&amp;gt;
&amp;lt;%using (Html.BeginForm(&quot;Delete&quot;, &quot;Favorite&quot;, FormMethod.Post, new { @id = &quot;favorite_form_&quot; + item.SourceId }))
{ %&amp;gt;
&amp;lt;%=Html.ActionLink(&quot;Remove from favorites&quot;, &quot;#&quot;, &quot;Curve&quot;, new { @id = &quot;favorite_link_&quot; + item.SourceId })%&amp;gt;
&amp;lt;%=Html.Hidden(&quot;curveSourceId&quot;, item.SourceId)%&amp;gt;
&amp;lt;%} %&amp;gt;
&amp;lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot;&amp;gt;
$('#favorite_link_&amp;lt;%= item.SourceId %&amp;gt;').click(function() {
$('#favorite_form_&amp;lt;%= item.SourceId %&amp;gt;').submit();
return false;
});
&amp;lt;/script&amp;gt;
&amp;lt;/td&amp;gt;
&amp;lt;/tr&amp;gt;
&amp;lt;%}%&amp;gt;
&lt;/pre&gt;
从代码中知道这段Javascript是会将Get方法的请求转换成为一个Post的请求，但是它是位于一个大的的foreach的循环中，有问题没? 在速度上对于Firefox完全是没问题的，但是对于IE8确实非常大的问题。凯哥通过google发现说IE8的Javascript Engine是非常慢的，直接导致整个一直都处于白板状态，因为它没有解析Javascript完，所以整个文档也都没有渲染。所以改进方案是将这段javascript抽取出这样一个foreach循环，同时使用JQuery的ready函数在文档装载完成之后去把此段脚本所在函数注册到其之上。
&lt;pre class=&quot;brush: javascript; &quot;&gt;
$(document).ready(function() {
$('.rm_fav_link').each(
function(elem, value) {
var id = $(value).attr('id')
var sourceId = id.split('_')[2]
$('#favorite_link_' + sourceId).click(function() {
$('#favorite_form_' + sourceId).submit();
return false;
})
}
);
});
&lt;/pre&gt;
紧接着将其他有这样问题的页面都有做一些改动，速度有了一定的改观。

接下来的遇到的问题是当我使用ab去测试（中间还有使用JMeter有测试）时，发现这个即使是一个请求没有并发时这个速度也是超慢，一个页面的响应时间在四五秒左右，有时候更高，而且ab运行的结果非常不稳定，落差非常大，可能你是上次得到是非常短的一个响应时间，但这次你在尝试时可能时间却相当的夸张。单问题是我们从本地的浏览器中访问，它的速度是不错的，所以这很困扰。于是便猜想说是不是每一个请求过来都有一个单独的session在Hibernate中了？ 如果是，接下来的请求应该是越来越慢的这个事实也符合这个猜想，因为它们之间没有共享或者什么互动。如果使用二级缓存，是不是能在多个请求中共享或者cache了，这样不就可以加快响应时间。 于是就马不蹄停的开始查关于二级缓存的一些资料，这一篇文章很不错&lt;a href=&quot;http://blogs.hibernatingrhinos.com/nhibernate/archive/2008/11/09/first-and-second-level-caching-in-nhibernate.aspx&quot; target=&quot;_blank&quot;&gt; First and Second Level caching in NHibernate&lt;/a&gt; , 因为我很久没有使用过hibernate，有些东西都有些生疏。 看过这些资料，接着开始加入二级缓存的这样一个支持，但是加入过程中却发现了点问题，比如NamedQuery无法被Cache，更重要的是从ab的数据来看它的效果没有多大，几乎没有。从本地测试来看，二级缓存确实有作用，因为第二个请求过来确实是比第一个节省了一百多毫秒，但是相对显示的所需要的时间，这个节省简直微不足道，而且引用了新的复杂因素，有些测试都已经失败了。权衡利弊，决定放弃使用二级缓存。

今天可算是一个突破，原来经过优化的代码，当我使用ab去测试时，这个结果都有点令人不敢相信的荒谬。然后凯哥说不可能啊，然后跑到他的机子上去试，结果发现结果比我这边可是要快很多。结果一比较，凯哥说我使用的是局域内部的无线，而且经过加密，所以这个传输中损耗有点大，但是他使用的是有线，明显快的非常多，而且客户使用是光纤，那么可以乐观的表示那个时候得测试数据比现在可是还要好。

解决这个令人头痛的问题后，便开始了使用ruby脚本来将ab测试结果进行一些格式化和处理，弄了一上午，在将近吃中午饭时搞定了。但是在我即将提交代码时，我犯了很大的低级错误。我首先看到它的名字可以取得更好点，然后我就重名了下；然后看hg st看到很多打问号的，很多都是临时数据是需要删除的，然后我稀里糊涂地运行了下hg purge. 悲剧啊，一上午的心血全空气了。只能在下午发了点时间去回想重新弄好，这个过程花了很多时间。 下午在处理数据的时候，我冒失的跑到curvebuilder那边又是改文件又是卸掉安装包又是重新打安装包，弄了好久，结果凯哥跑过来说为什么不直接修改数据库了，一两条sql就搞定了啊。我只能是发出一些&quot;WOW&quot;，然后三两下就完成了，但是因为这两件事使得快下班时我们的性能测试报告不得不延时了。

所以这个细心很重要，下手之前先动脑，像我这种靠直觉来删除的方式是不对的。同时思维方式有时候也需要去改变，确保下手之前你的方案是简洁明了是非常重要的。
</content>
 </entry>
 
 <entry>
   <title>一将功成万骨枯-屠城</title>
   <link href="http://tuo.github.comliterature.html"/>
   <updated>2010-09-17T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e4%b8%80%e5%b0%86%e5%8a%9f%e6%88%90%e4%b8%87%e9%aa%a8%e6%9e%af-%e5%b1%a0%e5%9f%8e</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最近有读过柏杨先生的读三国一些文章 ， 还有关于明末清初的一些历史，突然有点感触。历来中国历史的上历朝历代屠城的作为一个“扭曲”的默认的传统被流传出来，每一个王朝的没落很新王朝兴起的中间，总是充满了血腥。 哪怕你是最明智的君王，你也不能禁止你底下的将领屠城，甚至你自己本身也可能回去屠城。 我原来有读过柏杨先生翻译过来的《资治通鉴》（因为我古文没达到那种可以直接就看的能力，所以只能借助像柏杨老先生翻译现代文的作品） ， 柏杨先生有特别在其中的部分加上自己的评述，,当时我有从战国开始一直读到东汉开国部分，印象中记得他的评论对于人民互相残食以及将领或者帝王屠城有特别的突出自己的愤慨，我印象非常深刻。譬如秦朝士兵有计人头数来衡量战功的传统，所以秦朝士兵作战可是非常生猛，引用《史记》中的一段描述：“山东之士被甲蒙胄以会战，秦人捐甲徒裼以趋敌，左挈人头，右挟生虏。” 那是相当彪悍，所以秦朝是始作俑者，我觉得很有可能。白起在长平之战中坑杀40万人，几乎将整个赵国青年人都消灭干净了，后来赵国也没有真正能缓过气来。尽管这算不上是准确的“屠城”，但是这坑杀跟屠城有何区别，稍微不同时屠城更加可恶，因为面对的都是平民。战争来临时他们没有选择站在那一边的权利，你想远离战事是不肯能的。西汉之前的我记不太清，但是东汉开国这一段我记忆深刻，刘秀算是一个历史上少有的温和派，对将领如此，对百姓也如此，但是他却没有管理他手底下的将领。像是吴汉，攻城犀利，屠城也不手软，比如成都的大屠杀，连光武帝都责骂他。对于耿弇，《后汉书》记载“弇为将，凡所平郡四十六，屠城三百，未尝挫折焉“ 而且后面评论还提到”将其用兵欲以杀止杀乎？何其独能隆也” 前面你可以认为‘屠’做攻克解，但是对于后面一句的评论了? 我不是专家我不清楚，不过我觉得也是有可能的，以刘秀的性格如果耿屠城三百座，那刘秀还不发飙，但是当时刘秀非常需要耿，我觉得很有可能是真的，我不记得柏杨先生怎么写的了。
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;就连曹操，也是如此，曹操应该说很理性吧，但是也有留下曹操屠徐州是“鸡犬亦尽，墟邑无复行人”的评语，曹操屠徐州是因为陶谦的手下杀害了曹操的父亲曹嵩，当时曹操准备屠城，荀彧劝阻，但是曹操估计是被仇恨冲昏了头。尽管我对曹操非常推崇，我也不得不说这种事情他也是不能避免的，就像东吴孙家也不能避免，战争的带来的影响便是曹操的诗中描述的“白骨露于野，千里无鸡鸣”，一篇惨淡。
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;至于南北朝和五代十国那样的动荡年代就更别说了。
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;至于最近我读到的明末清初，李自成和张献忠更是流氓，简称“流寇”，作为农民起义的本身（张献忠政治不纯），对于同样的深处乱世的老百姓，攻破城池之后，一样的，屠城，没有任何的作为同样乱世农民出身该有的同情。 可笑的是李自成居然有&lt;a href=&quot;http://club.sohu.com/read_elite.php?b=travel&amp;amp;a=7736340&quot; target=&quot;_blank&quot;&gt;昌平西关闯王铜像&lt;/a&gt;，你配人家仰望吗？我 F***啦， 我们是应该表扬你奴性觉醒，还是膜拜你那觉醒的杀人不眨眼的奴性冷漠， 有多少惨遭他荼毒的百姓 ，上千百万了吧。很奇怪，人家本来农民出身，反过来有了权力确实对自己同等出身的农民一样下手超狠，权力真好啊，那个年代。

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最后以张养浩和王安石这两首词曲结束，无意中想到这两词曲居然如此强烈对比：

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;峰峦如聚，波涛如怒，山河表里潼关路。
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;望西都，意踌蹰，伤心秦汉经行处，宫阙万间都做了土。兴，百姓苦；亡，百姓苦！
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;-张养浩 《山坡羊·潼关怀古》

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;伊吕两衰翁，历遍穷通。一为钓叟一耕佣。若使当时身不遇，老了英雄。

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;汤武偶相逢，风虎云龙。兴亡只在笑谈中。直至如今千载  后，谁与争功！

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;-王安石《浪淘沙令·伊吕两衰翁》
</content>
 </entry>
 
 <entry>
   <title>打球有感</title>
   <link href="http://tuo.github.combasketball.html"/>
   <updated>2010-09-12T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e6%89%93%e7%90%83%e6%9c%89%e6%84%9f-4</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;今天天气很不错，阳光明媚，有去学校准备找同学打球，结果不在，幸亏我自己有带球过来，然后准备去篮球场一个人去打会，结果篮球场爆满，人超多，正在举行什么新生杯篮球赛，我拿着球观摩了会感觉还不错，比我当年进大学球技好多了，不过即使他们过了四年后我想我还能一样的kick their asses，呵呵（貌似有点嚣张啊）。然后我想说那交大人那么多，要不去建大吧，那就打电话给凯歌没想到他说那个今天他打过了把肩给弄伤了，打不了球。然后我就换了条短裤，背起包搭公交到了空军医院，结果找不到门，刚好对面来了三个娃，我问他们怎么走，人家说你可以钻也可以翻，你选哪种. 当场就被震精了，望着铁栏，想了想自己大庭广众之下爬栏杆，还不如找个不显眼的地方钻进去。进去后，那个场地有地令人发指，一进去那个场中间都不平，坑坑洼洼的，入乡随俗了啦。于是跟三个高中生组成一对加了一拨，场上貌似打得很激烈，轮到我们上的时候，手感比较硬，投了两个没进，被打了个五比零，有点小尴尬啊。那个我们这边两个高中生貌似也忒矮了点吧，而且体型还有胖，防人起来真是囧。不过这两个手感很不错，出手很快，打了一会就来感觉了，投进了几个。打了一会又来了一拨，有一个比较高点的貌似是几个高中生的同学，后来聊天是在读高三，这个在底下等的够呛。等到天色慢慢变黑，饿突然爆发了，找到了感觉，各种crossover ,fadeaway和特别是几个高难度的突破啊~~呵呵，可能是动作有点花，人家问我是不是打街球的。打到最后天是在是黑了，我们几个在打散的，有个初三的娃，貌似打球很不错，节奏啊，后撤步还蛮不错的，然后我就过去给他指点指点，哈哈，人家问我怎么练，我说你很不错啦，我初三的时候可是没你那么厉害，适当的自谦是必要的，而且人家基本功还蛮不错的。接下来就是几个人轮着斗牛，呵呵，他们斗牛的时候，我就跟他们聊天，比如建大的初高中怎么样啊；人家总问我你怎么练球感等等。特别是那个高三的，跟我聊得很起劲，一定要我去理工大打球，说那里的水平很不错，看不出来他居然是读文科的，然后就一起聊聊高三的事情，人家老问这个学习该如何如何，蛮有趣的。就这样一直打到快八点才离开。打球很有趣的地方在于你可以认识很多不同的人有听到很多不同的事情。今天感觉不错的是自己的左手运球有点增长。

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;下赛季NBA我非常期待热火，湖人和凯尔特人。咱目前想知道 Allen Iverson将会去哪，有没有球打；也希望TMAC在底特律能找回自己，重现辉煌，记得他当年的跳投这个飘逸的。同时也希望姚明不要受伤，易建联能强势起来，联合大将军和沃尔有一番不错的表现

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;最近两天关于日本拘留中国渔船的事件可是掀起了共同的愤慨，正如菲律宾人质事件一样，没有强大的国力，就没有外交，与其在网上各种愤青还不如踏实的干好本质工作来的实际

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;很多人说过我讲故事的本领很不错，主要是这个故事被我说的很离散很跳跃很不知所云，我觉得很有道理，正如这篇文章，Awesome !  困!。

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;还有一件趣事在建大打球旁边可是有不少女同学经过，但是无一另外都是背影杀手，没看到美女有点遗憾。
</content>
 </entry>
 
 <entry>
   <title>A few thoughts on testing from the trench 续</title>
   <link href="http://tuo.github.comtrench.html"/>
   <updated>2010-09-11T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./a-few-thoughts-on-testing-from-the-trench-%e7%bb%ad</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;In my last blog ”&lt;a href=&quot;http://tuohuang.thoughtworkers.org/?p=28&quot; target=&quot;_blank&quot;&gt;A few thoughts on testing from the trench&lt;/a&gt;“ , i have described a  scenario i  gotta stumbled in . The situation  is  that i forgot to add cleanup method to former testcase   ,which sets the tone for some intricate failures of newly added testcases.Way too nitty-gritty,let's ,say, put simply ,i just broke the prerequisites or presumptions  that later test case relies on due to my carelessness. And i just come up with a solution,which just adds the cleanup to former testcases , as illustrated in following code :
&lt;pre class=&quot;brush: csharp; &quot;&gt;[Test]
public void should_return_configed_timeframe_when_timeframe_in_app_setting_is_in_right_format()
{
 ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, &quot;17:00:00&quot;);
 actualReturned = DateTimeHelper.ReadTimeframeFromConfig();
 expectedReturn = CreateUtcDateTimeByHHMM(17, 0);
 Assert.AreEqual(DateTimeKind.Utc, actualReturned.Kind);
 Assert.AreEqual(expectedReturn, actualReturned);

 ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, null);
 var configedTime = ConfigurationManager.AppSettings.Get(DateTimeHelper.TRIGGER_TIMEFRAME_KEY);
 Assert.IsNull(configedTime);
}&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Code between line 10 and  13 is what i thought of as a ,ah ,not bad remedy at that time. Well, it turns out that i just add more woods to &quot;evil&quot; fire. How can i say to myself? Man , What a miserable guy!  So when&lt;a href=&quot;http://www.iamhukai.com/&quot; target=&quot;_blank&quot;&gt; Kai Ge&lt;/a&gt; reviews my codes  ,a quick glance at those testcases , as u probably know ,the following conversation definitely blow my mind. He said ,&quot;hey,why not put those cleanup code to TearDown() method derived from NUnit? &quot; I said&quot;Ah,ah,ah.....&quot; and i just gotta stuck ,period .  With a astonishingly fast follow-up question ,he said,&quot;What if any exception thrown out from your test code before your cleanup? So u just leave the testcase's &quot;Crime Scene&quot; ,again, uncleaned? &quot;  So that question just blows my mind with a big &quot;Wow&quot; from bottom of my heart.  Yes ,definitely,i just write the codes without too much mediation.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;But what really reveals is that it shows that how unfamiliar i am with  the framework i use. So did i even know the architecture or the design philosophy behind its surface ?  No , i just use it blindly and shitly , without resorting to any documentations or any tips for using that framework.  Lack of specific or ,how to say ,background or backbone of tools u use may significantly slow u down and encumber your productivity dramatically.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Well ,it reminds me that &lt;a href=&quot;http://www.iamhukai.com/&quot; target=&quot;_blank&quot;&gt;Kai Ge&lt;/a&gt; has already talked about JUnit's design,well ,a little long ago , and i may have certain sorts of impression on that , admittedly, at that time ,not so impressive enough to let me get big &quot;WOW&quot;  at the time i write testcases in the first place. So, i just forget it when i coded it plainly. It seems that i need to practice more to get that kinda of familiarity.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;I also remember that i just see a fabulous article about how JUnit gotta be shaped by using patterns by Kent Beck. Although JUnit is simple for seasoned engineer like Kai Ge ,for me --a rookie , 'Ma Que Sui Xiao ,Wu Zang Ju Quan!(Read this in PinYin拼音) ,i think i have that kinda of need to learn .   This article&lt;span style=&quot;color: #33ff33;&quot;&gt; &lt;a href=&quot;http://junit.sourceforge.net/doc/cookstour/cookstour.htm&quot; target=&quot;_blank&quot;&gt;J&lt;/a&gt;&lt;/span&gt;&lt;a href=&quot;http://junit.sourceforge.net/doc/cookstour/cookstour.htm&quot; target=&quot;_blank&quot;&gt;&lt;span style=&quot;color: #cc0000;&quot;&gt;U&lt;/span&gt;nit A Cook's Tour&lt;/a&gt; suits my appetite.Likewise, there is a big chapter about realizing a mini test framework like JUnit in Perl  step by step  in  Kent Beck 's book &amp;lt;&amp;lt;&lt;a href=&quot;http://www.amazon.com/Test-Driven-Development-Kent-Beck/dp/0321146530&quot; target=&quot;_blank&quot;&gt;Test Driven Development: By Example&lt;/a&gt; &amp;gt;&amp;gt;.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;In &lt;span style=&quot;color: #33ff33;&quot;&gt;&lt;a href=&quot;http://junit.sourceforge.net/doc/cookstour/cookstour.htm&quot; target=&quot;_blank&quot;&gt;J&lt;/a&gt;&lt;/span&gt;&lt;a href=&quot;http://junit.sourceforge.net/doc/cookstour/cookstour.htm&quot; target=&quot;_blank&quot;&gt;&lt;span style=&quot;color: #cc0000;&quot;&gt;U&lt;/span&gt;nit A Cook's Tour&lt;/a&gt; Kent Beck and Erich Gamma(who is also a big cow大牛)  mainly emphasize on how patterns come together to shape the whole design ,like Composite Pattern ,Template Pattern  and so on. Here is a figure i referred from this article ,  talking about how Template Pattern gotta applied  to     &lt;span&gt;TestCase.run() --the core method in JUnit.&lt;/span&gt;

&lt;span&gt; &lt;img class=&quot;alignnone&quot; title=&quot;TestCase.run() applies Template Method&quot; src=&quot;http://junit.sourceforge.net/doc/cookstour/Image2.gif&quot; alt=&quot;&quot; width=&quot;270&quot; height=&quot;142&quot; /&gt;&lt;/span&gt;

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;span&gt; Here comes the code  quoted from that article: &lt;/span&gt;
&lt;pre class=&quot;brush: java; &quot;&gt;public void run(){
setUp();
try {
runTest();
}
catch (AssertionFailedError e) { //1

//collection test result

}
finally {
tearDown();
}

}&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;This is pretty straightforward .So we know that TearDown() is put into finally block in case that when any exception thrown from runTest() method or not ,the tearDown() method is always kept committed that it will be executed.  After we grasped nitty-gritty ,we ,now,are completely confident how to handle cleanup because we know how it works behind the scene.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;The final solution is that we move those cleanup method to TearDown() method , so that we 're always promised the &quot;Crime Scene&quot; is gonna be cleaned and no messy.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;So ,truth is that we need to keep informed about the tools that we use ,to some extent. Spending a little time  on it ,we're probably gonna be more productive and less prone to get stumbled.

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;And thanks for patience and tips from &lt;a href=&quot;http://www.iamhukai.com/&quot; target=&quot;_blank&quot;&gt;Kai Ge&lt;/a&gt; ,i really appreciate it.
</content>
 </entry>
 
 <entry>
   <title>粗心和学习</title>
   <link href="http://tuo.github.comcareless-and-learning.html"/>
   <updated>2010-09-08T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./%e7%b2%97%e5%bf%83%e5%92%8c%e5%ad%a6%e4%b9%a0</id>
   <content type="html">&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;下午快下班时结果CruiseControll上显示Installer的测试没有通过，这一看原来是我提交的东东出现了问题，但是我并没有改Installer的东西，只是另一个项目做了一些修改，看起来关系比较奇怪，看起来好像没有关联。但是无可否认问题是出现我提交的那个changeset上面，然后张姐在去产看问题的时候发现其中一个领域对象居然有引用到测试的一个帮助类，然后Installer是不会包含测试项目的引用的，ah......~~~~  超尴尬，我仔细一看确实啊，这个看起来不可思议啊，我想了想当时确实有好像在测试有多处地方需要实例后，然后我说好，那我将这些东东给塞到一个测试帮助类中，这样原来测试看起来会相对明了点，下面抽取之前的代码：
&lt;pre class=&quot;brush: csharp; &quot;&gt;
[Test]
public void should_contain_remove_from_my_favorite_link_if_current_curve_has_favorites()
{
presenter = new CurveActionPanelPresenter(formulaVersion, UserMother.Trader(), true,true);
var actions = presenter.RightSideActions(htmlHelper);
Assert.IsTrue(CurveActionPanelPresenterTestHelper.Contains(actions, CurveActionPanelPresenter.REMOVE_FROM_FAVORITES));
}
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;下面是CurveActionPanelPresenter的构造函数声明：
&lt;pre class=&quot;brush: csharp; &quot;&gt;
public CurveActionPanelPresenter(FormulaVersion version, IUser user, bool hasMDEPermission, bool hasFavorites)
{
this.version = version;
this.user = user;
this.hasMDEPermission = hasMDEPermission;
this.hasFavorites = hasFavorites;
}
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;实际上在测试中我们在构造这个presenter的测试数据的时候，我们只关心说FormulaVersion和hasFavorites这两个参数，其他的是我们所关心的。 所以这里你可以说我可以在里面写一个构造函数，只接受这个参数不就可以了吗？  答案是：不够直白，更重要的是你测试的所表达的或者说所处的层次过于细节，我在前面写过文章“Why it matters ?” 中提到了测试的所在抽象层次，你迫使用户去关注测试数据的准备细节，而这个细节不是他应该关心的，或者说你迫使用户从测试底层(细节）来推导你想表达的意思（intention--这里实例化其实是想说准备了这样一个Curve它没有Favorites），这样一个思维角度是不必要的，也是很烦人的，如果我需要去看它的构造函数怎么实现来推导说这个初始化是要干些什么工作，这是不太好的。 鉴于这个实例化测试数据有在多个测试中有用到，所以我有想到说将它抽到一个测试的帮助类中，结果就有了以下代码：
&lt;pre class=&quot;brush: csharp; &quot;&gt;
[Test]
public void should_contain_remove_from_my_favorite_link_if_has_favorites()
{
presenter = PresenterUtil.CreateActionPanelWithoutCorrespondingFavoriteAttached(version);
var actions = presenter.RightSideActions(htmlHelper);
Assert.IsTrue(CurveActionPanelPresenterTestHelper.Contains(actions, CurveActionPanelPresenter.REMOVE_FROM_FAVORITES));
}
&lt;/pre&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;一开始看上去来正常的，但是问题在于我在PresenterUtil中居然有引用到了初始化用户的测试帮助类(也就是构造User这样一个帮助类），而且这个CreateActionPanelWithoutCorrespondingFavoriteAttached也不应该是在PresenterUtil中啊，原来问题是我当时准备移动这个方法时，心中想的是这样一个***PresenterHelper的类，但是鬼使神差输成了PresenterUtil，oh my lady Gaga ! 而且问题的诡异性在于你如果不运用Installer测试它是不会报错的，可以想象如果没有自动化测试，那么以后修改这个bug将会有多么棘手。

&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;但是问题并没有就此结束，随即而来的问题出现了，因为我当时修改FormulaList 这样一个枚举出所有Formula的页面给抽离出来成多个，因为原来是很多功能都有公用这一个显示Formula的逻辑，但是这些显示都会有根据Formula 的状态来决定显示内容，所以你可以看到在在下面这个公共的枚举页面中有很多这样或那样的判断if else，当然这些都不是很麻烦，但是当我们说有做压力测试，比如枚举出测试有1000条Formula的时间，时间会有很慢，但是如果我们将这些if /else去掉后，它的速度会提高很多，也就是说我们知道它状态就可以去掉这些跟状态相关的逻辑，将这样一个twisted显示功能页面抽离出来，就显得很有价值。所以你可以看到DRY也是说有它一定的上下文的，有时候的不是说看到代码重复就一定要怎么怎么样，这都是必须根据一定的上下文才能进行的，如果仅仅是盲目是去执行，这个时候best practice 就是会有起到反作用。
 
   &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; 努力加强这种直觉吧，在实践中尽记。
 &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;重新回到正题，这个问题是我想把FormulaList这个文件先保留在那里，然后去创建其他特定状态需要的XXXlist文件（这种方式应该是比较谨慎的），然后跑测试都有通过，几个跟枚举Formula的页面也没有问题，我觉得有说那现在我可以很安全的删掉这个文件吧，然后我就在VS中删掉了，然后去命令行中hg addremove 一下，一把提交，当时当然觉得很ok啊，应该没有问题的啊。结果是在Installer中，这个FormulaList页面标记为缺失的记号，并不是完全没有，一看原来是项目描述中还保留着对FormulaList文件的记录，这个尴尬啊，原来我当时删除文件之后，并没有进行过编译或者其他什么的，问题是它就不自动给你检测说你有删除文件，而且是从IDE中有删除，那应该是自己很清楚的行为，那我就将项目描述文件更新。 这个如果有在Lunix下估计可能会好点，Windows下没有文件的这种Notification的机制，导致文件的操作很多都是被动的，比如说poll，你不是去poll，就不清楚文件的状态。这个时候如果我没有显示的说告诉VS去重新编译或者什么的，那它就会呆呆在那里看《大长今》，完全搞不清楚状况嘛。

所以今天出现这两个问题，我完全有说付全部责任。第一个问题自己太过粗心；第二个是自己的知识不到位。一个是习惯问题，一个是学习问题，严格要求，努力学习，才可以去知道说它原来在看《大长今》。
</content>
 </entry>
 
 <entry>
   <title>A few thoughts on testing from the trench</title>
   <link href="http://tuo.github.com/a-few-thoughts-on-testing-from-the-trench"/>
   <updated>2010-09-07T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/a-few-thoughts-on-testing-from-the-trench</id>
   <content type="html">Yesterday ,in my coding process ,well,i run into a intricate problem . What i'm wanna do is to add a testcase for newly modified funcationality ,then verify whether it works or not. Since the functionality is not our concern , i'll leave out its nuts and bolts.The quick peek  on this is that it will read value of specific key from a web.config ,some sort of xml configuration file, then assemble that value to a legitimate datetime. So,quite simply,ha.
 
Here comes the testcase that i added:
&lt;pre class=&quot;brush: csharp; &quot;&gt;[Test]
public void should_return_true_when_time_frame_is_Null_and_current_time_passed_it()
{
   var timeFrame = DateTimeHelper.NULL_DATE_TIME;
   Assert.IsTrue(DateTimeHelper.TimeFrameLateThan(timeFrame, DateTimeHelper.DEFAULT_TIME_FRAME.AddMinutes(-1)));
}&lt;/pre&gt;
As u may infer from foregoing code list , the TimeFrameLateThan method is the dirty worker that encapsulate the details. To clearly express that my emphasis on this ,  the TimeFrameLateThan will read value of key ,like &quot;LatestCalculationTime&quot; or whatever, and if that key is not configured in xml file ,then it simply use the default value ,in this case  &quot;NULL_DATE_TIME&quot; .

To fully explain what's going on ,i need post a littile more context to u. Here is big picture:
&lt;pre class=&quot;brush: csharp; &quot;&gt;[Test]
public void should_return_configed_timeframe_when_timeframe_in_app_setting_is_in_right_format()
{
   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, &quot;17:00:00&quot;);
   actualReturned = DateTimeHelper.ReadTimeframeFromConfig();
   expectedReturn = CreateUtcDateTimeByHHMM(17, 0);
   Assert.AreEqual(DateTimeKind.Utc, actualReturned.Kind);
   Assert.AreEqual(expectedReturn, actualReturned);
}

public void should_return_configed_timeframe_when_timeframe_in_app_setting_is_in_bad_format()
{
   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, &quot;15:70:00&quot;);
   actualReturned = DateTimeHelper.ReadTimeframeFromConfig();
   Assert.AreEqual(DateTimeKind.Utc, actualReturned.Kind);
   Assert.AreEqual(DateTimeHelper.DEFAULT_TIME_FRAME, actualReturned);

   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, null);
   var configedTime = ConfigurationManager.AppSettings.Get(DateTimeHelper.TRIGGER_TIMEFRAME_KEY);
   Assert.IsNull(configedTime);
}

[Test]
public void should_return_true_when_time_frame_is_Null_and_current_time_passed_it()
{
   var timeFrame = DateTimeHelper.NULL_DATE_TIME;
   Assert.IsTrue(DateTimeHelper.TimeFrameLateThan(timeFrame, DateTimeHelper.DEFAULT_TIME_FRAME.AddMinutes(-1)));
}&lt;/pre&gt;
Maybe now ,u ,as acute and perceptive as always ,have already seen through the problem. Well , at the time i coded it , i just did not got it. When  i run this test in IDE , it just happily gave me a green bar,hoho ,not bad.

But when i run this from console (triggered by Nant ) , it just kept telling me that test--public void should_return_true_when_time_frame_is_Null_and_current_time_passed_it, failed.  Returned to the test codes,i just pondered why it just happened.  Here is how i spot the &quot;tricky insect&quot; in tests : first just remove all ,simply leave only failed testcase alone,then running the tests it passed.  Secondly pulled back testcase one by one ,simply follow the rhythm ---&quot;add one  testcase,run the test ;if ok,repeat that&quot; .  Finally  thing  that if i run  testcase 1 and test3 together ,it would break;but if i run test2 and test3 together ,it just passed. So i checked distinction between testcase1 and testcase 2 .Soon i figured that out , simply by some stupid mistake   , i forgot to set DateTimeHelper.TRIGGER_TIMEFRAME_KEY to null. It seems that i just forget do  some clean stuff,while what goes beyond the surface is that  I do not much grip test principle. When comes to test,it is so important to keep it self-stand and self-closed ,make sure it will not pollute and break other test case 's preconditions/assumptions.

&lt;em&gt;Here is the solution(I add some cleanup code between line 10 and line 13):&lt;/em&gt;
&lt;pre class=&quot;brush: csharp; &quot;&gt;[Test]
public void should_return_configed_timeframe_when_timeframe_in_app_setting_is_in_right_format()
{
   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, &quot;17:00:00&quot;);
   actualReturned = DateTimeHelper.ReadTimeframeFromConfig();
   expectedReturn = CreateUtcDateTimeByHHMM(17, 0);
   Assert.AreEqual(DateTimeKind.Utc, actualReturned.Kind);
   Assert.AreEqual(expectedReturn, actualReturned);

   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, null);
   var configedTime = ConfigurationManager.AppSettings.Get(DateTimeHelper.TRIGGER_TIMEFRAME_KEY);
   Assert.IsNull(configedTime);
}

public void should_return_configed_timeframe_when_timeframe_in_app_setting_is_in_bad_format()
{
   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, &quot;15:70:00&quot;);
   actualReturned = DateTimeHelper.ReadTimeframeFromConfig();
   Assert.AreEqual(DateTimeKind.Utc, actualReturned.Kind);
   Assert.AreEqual(DateTimeHelper.DEFAULT_TIME_FRAME, actualReturned);

   ConfigurationManager.AppSettings.Set(DateTimeHelper.TRIGGER_TIMEFRAME_KEY, null);
   var configedTime = ConfigurationManager.AppSettings.Get(DateTimeHelper.TRIGGER_TIMEFRAME_KEY);
   Assert.IsNull(configedTime);
}

[Test]
public void should_return_true_when_time_frame_is_Null_and_current_time_passed_it()
{
   var timeFrame = DateTimeHelper.NULL_DATE_TIME;
   Assert.IsTrue(DateTimeHelper.TimeFrameLateThan(timeFrame,
DateTimeHelper.DEFAULT_TIME_FRAME.AddMinutes(-1)));
}&lt;/pre&gt;
Keep test case responsible for what it has done and ensure the circumstance before and after is consistent. Sometime it is your duty, so you  account for restoring in the first place;well ,somehow the intellecture framework will take care it for u .Take Spring's AbstractTransactionalDbProviderSpringContextTests as an example ,Spring will automatically add  transaction support to your test case in Setup and Teardown,to rollback any changes made in your test case.

Anyway,it is aways a good habit to  let a test case account for cleaning what it has done.
</content>
 </entry>
 
 <entry>
   <title>一周总结</title>
   <link href="http://tuo.github.com/2010/09/05/week-summary.html"/>
   <updated>2010-09-05T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/2010/09/05/week-summary</id>
   <content type="html">           上一周在开发过程中明显感觉到这个差距啊。。。很多东西，有些时候就是在你平时看书你可能觉得没有什么，然而到了实践却要忘记了，以前在学校读的书不少，当时就有怀疑说自己真实有掌握多少，是不是太缺实践了，果然啊。
           在跟凯哥pair继续完成实现将整个系统中DateTime的实现策略改为将所有UI上获得时间以local或者相应的时区来显示，在数据库中一律以Utc的格式存储。同时在完成一个Alarm设置时凯哥发现很多地方的都会有创建不同Alarm对象的声明，但是有很多重复确是没有将它们可以以一种更好的方式来管理，赋予更具意义更直观的名字，于是便有创建一个AlarmMother专门用来说当成一个工厂，你可以在里面声明你想要的测试数据，并且可以更加易于阅读的方式命名，比如说 new Alarm(alarmtime,TimezoneInfo.Local.Id,UserMother.Trader()) 你所能从这个测试数据的准备中看出来它要干什么是很难的，所以它没有AlarmMother.CreateLocalAlarmFor(UserMother.Trader() ,alarmtime );这样更加直观，它明确的告诉它创建的是一个本地时区的alarmtime，而且AlarmMother将所以对象的实例化都放置一个地方，大大方便了测试数据的准备，这样你的实例化不是散落(scatter)在测试中，而是集中在一个地方，如果你这个实例化的地方有很多，那么这样带来的便利是不言而喻的。这次要将所有散落在测试中直接实例化Alarm的地方全部替换成使用AlarmMother，一搜才发现，真的有蛮多啦，所以这个改动过程非常无聊，纯体力活。试想如果当初发现这个这个创建ALarm的地方有点多，而且对于不同的测试创建Alarm的方式也会是有不同（比如不同的参数代表不同意思），如果有及时的做一个抽象，那么会给后面的测试带来多大的便利。不过我想还是缺乏一种直觉吧，像凯歌有过很多的经验，自然有形成一种reflection反射和intuition直觉，当他有写到一个地方或者一个点，就会有知道说会不会应该先跳出来，看看这样重复有没有可以改进的地方，正如凯歌有说，这个需要时间，我这经验还很少，慢慢来。
              记得上周五有实现一个关于复选框支持批量删除的故事，然后我记得我当初想的是让用户在页面选中复选框，然后利用ASP.NET mvc内嵌的data binding这个功能，将每一个选中的复选框对应的curve的id传过来，也就是一个int[] 数组。为什么要这样做？ 我的想法是正如今晚有看过Eric Evans的&amp;lt;&amp;gt;有讲到一个分层的设计，Application这一层在UI层下面，它应该有free from依赖的它的上层的，我觉得这里便是这样不管UI的实现如何，至少我的应用层应该是一个接受一系列需要删除curve的id，然后我想想这个MVC它有没有这样的支持了，如果有的话，那我可就是很简单的就可以搞定;如果没有可能处理过程还要麻烦一点。当我在stackoverflow上搜时，我发现这个它里面说这个方案是可以的，但是到我那确实不可行，死活这个id都是null值。想了想，然后就方案&lt;a href=&quot;http://stackoverflow.com/questions/3291501/asp-net-mvc-maintain-state-of-a-dynamic-list-of-checkboxes/3298821#3298821&quot; target=&quot;_blank&quot;&gt;ASP.Net MVC maintain state of a dynamic list of checkboxes&lt;/a&gt;一点点放小，看看问题出在哪里.然后我尝试将Html.BeginForm()改为&amp;lt;form/&amp;gt;这样它居然能工作，然后我将表单的内容替换成真实需要的，它能工作，然后我将&amp;lt;form/&amp;gt;又重新换回去也没问题，这个令人发指啊。 不过这个“解决”问题的思路就是，一点点来，努力缩小问题出现的域，一步步向它逼近，如果复杂点它不能功能，那么换成最简单的形式，然后一点点往上面加东西，以便检查是否出现问题，这样子来定位问题的思路应该还是很正确的（尽管这个问题我没有从源头上理解它。。。。）。

        周末有看过NBC的Celebrity Apprentice 第九季的第七集，很喜欢Cyndi Lauper的个性和Bret的rock and roll的风格 ，当然Summer也很好，我觉得这一集Trumper没有裁人，真是有点令人吃惊，Sharon也就是American Got Talent的评委，一口标准的英国口音，很有才，这一集中Sharon作为队长，虽然24 workout fitness的策划实施非常的original，但是没有筹到比Holly更多的钱，一度以为她会被裁，Cyndi非常紧张，都说以后都没有fun可言了，她貌似跟Sharon非常合的来，因为两个都超有个性吧，心心相惜。Bret很有才华，力挺。

       周六去学校在自习室有看书，中午太困，躺在椅子上睡着了，朦胧中有人进来，我起身一看原来是大三教我《系统分析设计》的饶老师，他说他还记得我，这个，呵呵，受宠若惊啊，因为我一直跟老师不是非常熟，然后跟我巴拉巴拉的聊聊好一会问我还有没有坚持看英文书的习惯，说那是很好的习惯应该坚持等等。记得他上课时我当时拿着一本Robert C.Martin的书在底下看，可是没有给他面子啊，被他发现三次，呵呵，超尴尬，后来下课后有跟他聊过一阵子。 不过他人很好，现在看起来，当初自己实在是太年轻啊。

         这一个月我需要加紧将Eric Evan的DDD这本书像是挤海绵一样抽出时间开完，尽管里面作者写的有些句子非常awesome 以至于我都会停下来读两遍，但是这会严重影响我读书的节奏，而且这本书语言单词等等对我应该没有太多问题，通读起来应该还蛮ok的，不像另外一本书&amp;lt;&amp;lt;Freakonomics&amp;gt;&amp;gt;那样，特别是其中的现在看到的关于犯罪的那一块，那个生词，如果你想通读下去，还是有些困难的，不过一般都是会先通读，不懂的强调上下文推理，但是如果实在不知道，我觉得那就可能不是简单的单词不认识了或者怎么样，而是这个背后的背景知识我不知道，所以没有能完整的读懂，当然你如果完全读懂也没有意义，就是一个大概，知道作者想表达的意思就ok. 所以这个月有两本书需要读完，当然可能还有Spring Training的剩余部分需要继续完成，再一个便是要加强英语的学习。
</content>
 </entry>
 
 <entry>
   <title>实践中的Codinng Convention and Incremental Development一点体会</title>
   <link href="http://tuo.github.comcoding-conventions.html"/>
   <updated>2010-08-29T00:00:00+08:00</updated>
   <id>http:/tuo.github.com./code-convention</id>
   <content type="html">这一周的工作印象很深的第一件事是&lt;a href=&quot;http://www.iamhukai.com/&quot; target=&quot;_blank&quot;&gt;凯哥&lt;/a&gt;需要去添加页面，然后发现那个样式并没有应用上，在firebug上一看，原来是简单标记使用css的元素id不一致，在一个页面中你可以看到一部分是以hyphen - 连字符，另一部分却是underline _ 下划线，而且确是有混在一起使用，看起来怪怪的。早些的时候我原来有接触过这个页面，但当时我有看到这个问题，却并没有一下子潜进去去替换或怎么样，因为当时感觉虽然也有问题，但是还不是一个很大的deficiency缺点，直至到现在它已经不能work,而且非常的counter-intuitive. ps:尽管凯哥一直强调我写日志的时候需要考虑对象，但是从我的手指间不自觉的会流出这种风格. 已经是到了不得不改的时候了，so,which style u're gotta pick up , hyphen ,camelCase or underscore ? 凯哥在检查的时候使用的是连字符，那有没有说一种naming convention 或者 'best practice' 或者说无论哪种只是一个personal preference了?    W3C css 规范并没有提出太多的指示，而在StackOverflow上的一篇帖子&lt;a href=&quot;http://stackoverflow.com/questions/1686337/hyphens-or-underscores-in-css-and-html-identifiers&quot; target=&quot;_blank&quot;&gt;Hyphens or underscores in CSS and HTML identifiers?&lt;/a&gt; 和CSS-Tricks的问卷调查&lt;a href=&quot;http://css-tricks.com/new-poll-hyphens-or-dashes/&quot; target=&quot;_blank&quot;&gt;New Poll: Hyphens, Underscores, or camelCase&lt;/a&gt;? 大家都有提出自己的看法，连字符、下划线和camelcase都是可以的，仅仅是一个个人喜欢的问题，选择权is totally up to u. 当我们bla bla bla的将很多页面的涉及到的不符合命名规范的id都换成统一的风格时，我们发现这个改动实在是太痛苦了,手工的copy/paste，而且你还没办法去automate它，很多东西是如此的insidious，那可是花了一周折。这种机械的却又无法交给机器去自动化的东西，解决办法有一个，那就是从源头上截断它的产生。所以凯哥说这不是某一个coder的错误，而是当初项目的一个错误。因为当初并没有指定Code Standards，并且因为大家是如此有个性的coder,所以大家的风格没有办法去align，却要找不到一个guideline来balance，不同的风格并没有错，但是需要一个大家可以参考的baseline,你不能越过它，否则各种不同风格的代码的这种pile up，慢慢的这种维护或者修改就变得越来越难。这也就是XP一个practice  &quot;Coding Standards&quot; ,这个是一个非常重要的东东，在项目开始大家一起定制一个统一的guideline或者standards，并且在这个standards内能让coder的风格能发挥很大的自由却不会造成team mates中间的disagreement，因为这些都有在前面讨论过。引用James Shore的&lt;a href=&quot;http://books.google.com/books?id=g_ji7cRb--UC&amp;amp;printsec=frontcover&amp;amp;dq=art+of+agile&amp;amp;source=bl&amp;amp;ots=vlPvwuVzbB&amp;amp;sig=3Wg3MGDR-H8kKOmom89CiWEWzu0&amp;amp;hl=en&amp;amp;ei=bSV6TO20GI_6cPij4eIF&amp;amp;sa=X&amp;amp;oi=book_result&amp;amp;ct=result&amp;amp;resnum=5&amp;amp;ved=0CCsQ6AEwBA#v=onepage&amp;amp;q&amp;amp;f=false&quot; target=&quot;_blank&quot;&gt;The Art of Agile Development&lt;/a&gt; 关于Code Standards的99字总结:


&lt;blockquote&gt;
&lt;strong&gt;in 99 words&lt;/strong&gt;

In team software development, we create a collective work that is greater than any individual could create on his own. Arguing about style gets in the way.

When creating a coding standard, your most important achievement will be learning how to disagree constructively. To succeed, create the minimal set of standards you can live with. Focus on consistency and consensus over perfection. Remember that few decisions are irrevocable in agile development.

Assume your colleagues are professional and well-meaning. If they deviate from the standard, discuss reasons rather than placing blame. No coding standard can substitute for professional judgement.&lt;/blockquote&gt;

同样Jason Mawdsley关于这个话题也有一篇非常棒的文章 &lt;a href=&quot;http://www.drdobbs.com/architecture-and-design/193003844&quot; target=&quot;_blank&quot;&gt;Coding Conventions: Make Them Agile&lt;/a&gt; ，在文章中他提出“

&lt;blockquote&gt;&lt;span&gt; Documented coding conventions take the pain out of  development.&lt;/span&gt;&lt;/blockquote&gt;

&lt;span&gt; 很明显，documentation 在软件领域本身某些out-of-sync的性质使得大家对它比较进而远之的。文章中作者提出来自己对于agile coding convention的看法:
&lt;/span&gt;
&lt;blockquote&gt;&lt;h3&gt;The Agile Coding Convention&lt;/h3&gt;
Simple rules let your team deliver high-quality code as efficiently as  possible. With this in mind, my agile coding convention consists of these simple  rules:
&lt;ol&gt;
        &lt;li&gt;Make your code look like other people's code.&lt;/li&gt;
	&lt;li&gt;Use the simplest design possible.&lt;/li&gt;
	&lt;li&gt;Don't re-invent the wheel.&lt;/li&gt;
	&lt;li&gt;Document your code.&lt;/li&gt;
	&lt;li&gt;Keep security in mind.&lt;/li&gt;
	&lt;li&gt;Work in increments.&lt;/li&gt;
	&lt;li&gt;Work in iterations.&lt;/li&gt;
	&lt;li&gt;Have your code reviewed.&lt;/li&gt;
	&lt;li&gt;Don't stay blocked.&lt;/li&gt;
	&lt;li&gt;Do unto others as you would have them do unto you.&lt;/li&gt;
&lt;/ol&gt;&lt;/blockquote&gt;


注意其中有一条会跟我第二个话题有很大关系。

当然不同的语言环境下的code standards是不太一样的，这个链接可能可以给点提示&lt;a href=&quot;http://www.westborosystems.com/2010/02/coding-standard/&quot; target=&quot;_blank&quot;&gt;Some Specific Coding Standards&lt;/a&gt;，遵从这些convention(其实我也没分的很清楚Convention 和 Standards的区别，可能一个是大家默认的风俗，一个是官方建议的吧，不过我更喜欢convention)的好处是非常明显的，它可以帮助你写出别人舒服的代码，方便信息流通。(想起了一点CoC的观念，&lt;a href=&quot;http://en.wikipedia.org/wiki/Convention_over_configuration&quot; target=&quot;_blank&quot;&gt;Convention over Configuration&lt;/a&gt;,也称作Coding by Convention--比如Maven相对Ant在文件目录上的一个convention设置，大大方便了用户)。CoC现在可是很被广泛运用和接受的概念，对此Uncle Bob也有评论：

&lt;blockquote&gt;This is the problem with conventions - they have to be continually resold to  each developer. If the developer has not learned the convention, or does not  agree with it, then the convention will violated. And one violation can  compromise the whole structure.&quot; -Robert C. Martin&lt;/blockquote&gt;

任何事情有利有弊，like a double-edged sword or two sides of coin ,关键是看它应用的context。

题归正传，第二件事情比较深刻的是在实现一个由时间的转换的时候，因为C#中DateTime有一个属性是DateTimeKind,当我们存进去一个时间，然后再取出来的它的DateTimeKind就会是一个Local，而不是你存进去之前制定的，比如是utc等等，这就给我们造成了问题，所以这个解决方案就是使用NHibernate的UserType，在NullSafeGet的时候，将DateTimeKind指定后为UTC再将之返回，看起来应该是蛮straightforward吧，
&lt;pre  class=&quot;brush: csharp; &quot;&gt;
if (String.IsNullOrEmpty(value.ToString()))
{
return null;
}
var dataTimeInDb = DateTime.Parse(value.ToString());
return new DateTime(dataTimeInDb.Year, dataTimeInDb.Month, dataTimeInDb.Day, dataTimeInDb.Hour, dataTimeInDb.Minute, dataTimeInDb.Second,DateTimeKind.Utc);
&lt;/pre&gt;
     但是在我们将所有映射文件*.hbm中出现DateTime格式的property都将其type指定为自己实现的usertype后，跑整个Dao测试，失败，而且提示的错误信息没有，都是什么SqlClient什么的Timeout exception，我想了半天搞不定，一位是hibernate的session没有flush仍然占着数据库连接，然后后面的SqlClient尝试去保存东西时获取不到连接，在那里等然后超时，但问题是它们是不同的表。所以我这个忙了半天没头绪，后来凯哥说这个先把所有的更改都rollback掉，然后一点点的将usertype加回来，然后看测试通过没，结果加到一个EventSources类时发现了测试通过不了，然后就一点点的缩小问题的区域，后来发现在Nhibernate中的NullSafeGet居然不让返回Null的DateTime格式，但是相应的数据库和.hbml中都是可以为null的，晕了，真是what the fWORD!! 不过，这次解决问题的经历也让我明白incremental develop 的重要性，它可以帮助你快速的找到问题，而且提供及时的反馈，更重要的是降低了其他异常覆盖真正引起问题异常的几率，让我们更直白的spot问题在哪里发生，因为软件本身就是一个复杂的环境，所以这个开发方式将会有利于develop with confidence.

    这一周当然收获不止那么多，上面只是列举出其中两个比较深刻的例子，知识总是在实践中一点一点的加深，that's awesome.
 
</content>
 </entry>
 
 <entry>
   <title>Why it matters ?</title>
   <link href="http://tuo.github.com/why-it-matters"/>
   <updated>2010-08-24T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/why-it-matters</id>
   <content type="html">这个两个星期在项目的开发过程中，遇到了不少的问题，使我认识到自己某些方面的意识还不是很强烈，思维的方式还需要加强，为什么这么说了？ 我记得以前看书的时候，记得说需要创建一个对象是loo&lt;span&gt;se&lt;/span&gt;ly coupled,high cohe&lt;span&gt;s&lt;/span&gt;ion ,remove redundancy等等，说到底还是强调说你在思考的时候，多多从OO的角度出发去思考，尽管我觉得自己看过好几次，但是每当自己编程的时候看过自己的代码我都觉得当时的自己思考的仍然不到位。我记得上周编程的过程中，在&lt;span&gt;Se&lt;/span&gt;rvice层，我记得当时采用te&lt;span&gt;s&lt;/span&gt;t-fir&lt;span&gt;s&lt;/span&gt;t model，然后我开始blablabla的写完测试，然后开始写实现，让测试能通过，当然这个测试是针对某一个feature。它会首先获取所有的publi&lt;span&gt;s&lt;/span&gt;hedVer&lt;span&gt;s&lt;/span&gt;ion&lt;span&gt;s&lt;/span&gt;返回的是一个li&lt;span&gt;s&lt;/span&gt;t类型，然后判断是否这个li&lt;span&gt;s&lt;/span&gt;t为空，如果为空，那么直接返回；如果不是，那么取出li&lt;span&gt;s&lt;/span&gt;t中的第一个，然后检查是否u&lt;span&gt;se&lt;/span&gt;r拥有MarkA&lt;span&gt;s&lt;/span&gt;Depreated的权限，如果有那么就执行这个动作，当时写完后，测试都有通过，bingo! ,我觉得ah,it pa&lt;span&gt;s&lt;/span&gt;&lt;span&gt;se&lt;/span&gt;d,not bad at lea&lt;span&gt;s&lt;/span&gt;t，
&lt;h3&gt;Code Li&lt;span&gt;s&lt;/span&gt;t 1&lt;/h3&gt;
&lt;pre class=&quot;brush:csharp;&quot;&gt;private void HandleSourceDeprecationOn(..){
List&amp;lt;FormulaVersion&amp;gt; publishedVersions = formulaVersionsDao.GetAll(queryPublishedBySourceId);
if(pubshedVersions.Count == 0)
{
return;
}

FormulaVersion currentPublishedFormulaVersion = publishedVersions[0];
currentPublishedFormulaVersion.HasPermission(user, FormulaAction.MarkAsDeprecated);
currentPublishedFormulaVersion.MarkAsDeprecated();
}
&lt;/pre&gt;
但是后来凯哥review到这段代码时，显然他被pi&lt;span&gt;s&lt;/span&gt;&lt;span&gt;se&lt;/span&gt;d off，因为这段代码它的很多操作都是在集中在FormulaVer&lt;span&gt;s&lt;/span&gt;ion这个Domain对象上，而且它的加入使得&lt;span&gt;Se&lt;/span&gt;rvice层显得有点bloat膨胀，而且&lt;span&gt;Se&lt;/span&gt;rvice层应该说对于domain这个对象为什么需要如此low-level或者说detail-level的了解，所以第一眼可以很简单看到说我会将最后两句移到FormulaVer&lt;span&gt;s&lt;/span&gt;ion中来,很简单从re&lt;span&gt;s&lt;/span&gt;pon&lt;span&gt;s&lt;/span&gt;ibility来考虑的话，这个移动是非常直白的，然后就剩下FormulaVer&lt;span&gt;s&lt;/span&gt;ion这个li&lt;span&gt;s&lt;/span&gt;t啦，这个很low-level是因为它没有反射出&lt;span&gt;Se&lt;/span&gt;rvice希望它完成的任务(也就是&lt;span style=&quot;background-color: #ffd700;&quot;&gt;&lt;strong&gt;self-explanatory&lt;/strong&gt;&lt;/span&gt;))，所以你必须看了这几行然后说,en,这个原来是这目的，所以我把前几句都抽出来成为一个方法会下一步改成如下样子：
&lt;h3&gt;Code Li&lt;span&gt;s&lt;/span&gt;t 2&lt;/h3&gt;
&lt;pre class=&quot;brush:csharp;&quot;&gt; private void HandleSourceDeprecationOn(..){
     FormulaVersion currentPublishedFormulaVersion =GetLatestPublishedCurveBy(queryPublishedBySourceId);
     currentPublishedFormulaVersion.CheckPermissionAndMarkAsDeprecated()
         }
&lt;/pre&gt;
这次经过整理，首先，可以看到整个代码这一段会有比较高的一个抽象层次，现在可以说它是&lt;span style=&quot;background-color: #ffd700;&quot;&gt;&lt;strong&gt;self-explanatory&lt;/strong&gt;&lt;/span&gt;--很棒的词，我都找不到更适合的词,to &lt;span&gt;s&lt;/span&gt;ome extent,有点接近programming by intention，我觉得当时就没有根据intuition来写代码，所以导致代码过于detail，Matin Fowler在他的一本书&amp;lt;&amp;gt;中提到过三种Level of Per&lt;span&gt;s&lt;/span&gt;pective(有必要解释这三种per&lt;span&gt;s&lt;/span&gt;pective它不局限在UML，它更多是反映在De&lt;span&gt;s&lt;/span&gt;igning Object &lt;span&gt;S&lt;/span&gt;y&lt;span&gt;s&lt;/span&gt;tem&lt;span&gt;s&lt;/span&gt;--这是一本&lt;span&gt;S&lt;/span&gt;teve Cook和John Daniel&lt;span&gt;s&lt;/span&gt;写的书),第一种Conceptual--deal&lt;span&gt;s&lt;/span&gt; with the &lt;span&gt;s&lt;/span&gt;y&lt;span&gt;s&lt;/span&gt;tem object&lt;span&gt;s&lt;/span&gt;,like identify the domain model,entitie&lt;span&gt;s&lt;/span&gt;；第二种&lt;span&gt;S&lt;/span&gt;pecification--mean&lt;span&gt;s&lt;/span&gt; public method&lt;span&gt;s&lt;/span&gt; that form the interface of each object,but al&lt;span&gt;s&lt;/span&gt;o the private method&lt;span&gt;s&lt;/span&gt; to which they delegated；第三种:Implementation ---only concerned with the code that doe&lt;span&gt;s&lt;/span&gt;t the actual dirty work.
所以以这里我第一次万恶的代码&lt;strong&gt;Code Li&lt;span&gt;s&lt;/span&gt;t 1&lt;/strong&gt;为例，你可以看到它明显属于Implementation Per&lt;span&gt;s&lt;/span&gt;pective,And Why ?因为它的实现都是非常底层的，非常细节的，就比如上面我们使用的是Li&lt;span&gt;s&lt;/span&gt;t，如果后来DAO层签名返回类型改为了一个不是采用Count作为统计的字段，包括我还有可能使用的不是 GetAll或者是等等这些细节的变化并不会影响它carry out的功能，但是它的底层dirty job的性质使得它非常容易变化，所以你每一次的变化定位&lt;span&gt;s&lt;/span&gt;pot会带来很大的麻烦，因为你那个时候都你底层改变涉及到非常的引用时，所以你会运行测试看看是否broke anything,这个时候测试失败你只会关注这个测试是测试什么功能，所以这个时候你的思维是从抽象到具体，你想通过它需要完成功能再去定位你错误的地方，如果你采用的Code Li&lt;span&gt;s&lt;/span&gt;t 1这种方式，当然我的代码很短，有可能很容易，但是这个时候你必须迫使你重新将底层联合起来想它完成什么功能，如果稍微长一点，那么会非常不利于你快速定位你那个地方实现有问题。 所以总的来说它的缺陷是它逼迫你从代码实现细节来推理它真正carry out 的功能，而这种方式取决它本身功能是否容易明了同时取决于你的实现细节。 Ok,enough，对于第一段代码，我想说自己当时没有从高一点的层次来思考问题，而问题是我是先写测试的，那么它应该是有迫使你从&lt;span&gt;S&lt;/span&gt;pecification这个层次上去思考的，比如第一步我应该 blablabla..第二步我应该blablabla....，为什么会这样？ 首先我觉得当时自己当时应该有想清楚这些步骤，但是当然抱的想法是先让它过再说，这当然没错，但是....eh ....过了之后，居然无法从Implementation这个Per&lt;span&gt;s&lt;/span&gt;pective回到&lt;span&gt;S&lt;/span&gt;pecification这个层次，直接导致di&lt;span&gt;s&lt;/span&gt;a&lt;span&gt;s&lt;/span&gt;ter，同时自己在重构的时候没有花太多时间就是赶下一个feature，这是个问题。对于第二个，更是没有从&lt;span&gt;S&lt;/span&gt;RP(&lt;!--more--&gt;&lt;a href=&quot;http://www.objectmentor.com/resources/articles/srp.pdf &quot; target=&quot;_blank&quot;&gt;&lt;span&gt;S&lt;/span&gt;ingle Re&lt;span&gt;s&lt;/span&gt;pon&lt;span&gt;s&lt;/span&gt;ibility Principle&lt;/a&gt;)的角度出发，实际上也是当时我在写的时候处于Implementation的角度，怎么可能当时反应出来这些东西应该从Re&lt;span&gt;s&lt;/span&gt;pon&lt;span&gt;s&lt;/span&gt;ibility的角度来考虑，当时自己完全在树木里挣扎，怎么可能jump out of box而看到森林，或者说整个的big picture,而且自己后期写完测试之后的重构明显不到位，&lt;span&gt;s&lt;/span&gt;hame on u! 我觉得这个问题的发生第一个自己习惯不好，写测试的时候这个hat转换不过来，戴了Implementation的hat后，无法抽出来再去即是戴上&lt;span&gt;S&lt;/span&gt;pecification的hat ,第二个写测试的习惯不好，特别是实现，我们强调说按那个red-refactoring-green的rhyme来，一步一步incremental的使之更完善，但是在实现的时候如何保持脑袋里有这个big picture----那就是Programming by Intention--&lt;span&gt;s&lt;/span&gt;o FWORDing important ，这两个并不矛盾，比如上面，我写了测试案例，我第一步可能会在实现中先写上 第一步 GetLate&lt;span&gt;s&lt;/span&gt;tCuver() 第二步 CheckPermi&lt;span&gt;s&lt;/span&gt;&lt;span&gt;s&lt;/span&gt;ionAndMarkA&lt;span&gt;s&lt;/span&gt;Deprecate()的，一开始它们可能都是&lt;span&gt;s&lt;/span&gt;tub，但是有个好处它时刻提醒你你脑袋中需要有这么一个整体的思路，也许它们的不一定严格是这样，但是它帮助你按照你写测试和将来读测试的思路保持一致，这其实就是一个很好的从&lt;span&gt;S&lt;/span&gt;pecification Per&lt;span&gt;s&lt;/span&gt;pective思考的例子 。这个时候你在看&lt;strong&gt;Code Li&lt;span&gt;s&lt;/span&gt;t 2&lt;/strong&gt;，相对&lt;strong&gt;Code Li&lt;span&gt;s&lt;/span&gt;t 1&lt;/strong&gt; 不同在于Handle&lt;span&gt;S&lt;/span&gt;ourceDeprecationOn()这个方法它的抽象层次是相同的，我只需要的是看到,哦，两个步骤，第一步是干什么GetLate&lt;span&gt;s&lt;/span&gt;tPubli&lt;span&gt;s&lt;/span&gt;hedCurveBy()；第二步是干什么CheckPermi&lt;span&gt;s&lt;/span&gt;&lt;span&gt;s&lt;/span&gt;ionAndMarkA&lt;span&gt;s&lt;/span&gt;Deprecated，没有任何实现细节被包含，所以这个方法Handle&lt;span&gt;S&lt;/span&gt;ourceDeprecationOn()是一个完完全全的&lt;span&gt;S&lt;/span&gt;pecification Level的方法，具有非常高的&lt;span style=&quot;background-color: #ffd700;&quot;&gt;&lt;em&gt;self-explanatory&lt;/em&gt;&lt;/span&gt; ，因为为什么？
&lt;blockquote&gt;&lt;strong&gt;Handle&lt;span&gt;S&lt;/span&gt;ourceDeprecationOn() 这个方法i&lt;span&gt;s&lt;/span&gt; only concerned with What they(GetLate&lt;span&gt;s&lt;/span&gt;tPubli&lt;span&gt;s&lt;/span&gt;hedCurveBy and CheckPermi&lt;span&gt;s&lt;/span&gt;&lt;span&gt;s&lt;/span&gt;ionAndMarkA&lt;span&gt;s&lt;/span&gt;Deprecated) do ,how they are called and what they returned, but not how they do it . &lt;/strong&gt;&lt;/blockquote&gt;
这两个方法如何实现 i&lt;span&gt;s&lt;/span&gt; totally not the bizne&lt;span&gt;s&lt;/span&gt;&lt;span&gt;s&lt;/span&gt; of Handle&lt;span&gt;S&lt;/span&gt;ourceDeprecationOn() method----that '&lt;span&gt;s&lt;/span&gt; what Implementation Level doe&lt;span&gt;s&lt;/span&gt;.
然后come&lt;span&gt;s&lt;/span&gt; the third &lt;span&gt;s&lt;/span&gt;tep.这是关于Li&lt;span&gt;s&lt;/span&gt;t 和OO&lt;span&gt;s&lt;/span&gt;的一个关系，我听过凯歌讲过这个实例不下三遍，但有些时候自己还是没有想到，真是....... 这个经典的列子是你如果在DAO层返回一个Li&lt;span&gt;s&lt;/span&gt;t
，然后你可能会后来在&lt;span&gt;Se&lt;/span&gt;rvice层或者什么地方对于Li&lt;span&gt;s&lt;/span&gt;t
做一个操作，比如说是遍历这个li&lt;span&gt;s&lt;/span&gt;t找出所有年纪大于什么什么的，ok,很简单我们只要来个foreach在来个过滤(如何你hate linq的话)，但是随着你需要的增多，比如找出一群人中所有买不起房的人等等，比如对于这群人他们的behavior有需要慢慢增多，而后对于这群Li&lt;span&gt;s&lt;/span&gt;t上面的操作也越来越多，而且每次你都必须显示遍历li&lt;span&gt;s&lt;/span&gt;t。然后你会发现每一次需要这群人上面的某个操作，你需要重复，有可能你会抽取一个utility方法，专门来处理 Li&lt;span&gt;s&lt;/span&gt;t
。所以这个时候就是因为你没有从OO的角度去思考这个问题,in my humble opinon ，首先一群人也许应该抽出成为一个独立对象，这个对象上有着人群的一些behavior，这里比如说是People ,然后我说People.findCannotBuyHou&lt;span&gt;se&lt;/span&gt;() ，这个远远对于一个Li&lt;span&gt;s&lt;/span&gt;t
对遍历来得快，来的更加的&lt;strong&gt;&lt;span style=&quot;background-color: #ffd700;&quot;&gt;self-explanatory&lt;/span&gt;&lt;/strong&gt;，更直白，所以我有一个对象它记录着一些群体的behavior，而不需要离散得放在utility helper中，你可能说people不是一个li&lt;span&gt;s&lt;/span&gt;t ,wow ,that'&lt;span&gt;s&lt;/span&gt; true ,don't &lt;span&gt;s&lt;/span&gt;imply ju&lt;span&gt;s&lt;/span&gt;t apply &lt;strong&gt;&lt;em&gt;I&lt;span&gt;S&lt;/span&gt;-A&lt;/em&gt;&lt;/strong&gt; ,how about thinking in &quot;behavior&quot;? check out thi&lt;span&gt;s&lt;/span&gt;&lt;a href=&quot;http://www.objectmentor.com/resources/articles/lsp.pdf&quot; target=&quot;_blank&quot;&gt; The Li&lt;span&gt;s&lt;/span&gt;kov &lt;span&gt;S&lt;/span&gt;ub&lt;span&gt;s&lt;/span&gt;titution Principle&lt;/a&gt;；其次，这个其实也反应前面提到的Level of Per&lt;span&gt;s&lt;/span&gt;pective 的划分，对于Li&lt;span&gt;s&lt;/span&gt;t
，首先我们强迫了用户去知道在know how it doe&lt;span&gt;s&lt;/span&gt;,很明显用户不care这么底层实现的信息，它如何实现细节我不管；最后，对于Li&lt;span&gt;s&lt;/span&gt;t
它暴露的只是一个数据类型，用户care难道是li&lt;span&gt;s&lt;/span&gt;t形式的单个per&lt;span&gt;s&lt;/span&gt;on还是群体? it depend&lt;span&gt;s&lt;/span&gt;. 现在将代码贴上:
&lt;h3&gt;Code Li&lt;span&gt;s&lt;/span&gt;t 3&lt;/h3&gt;
&lt;pre class=&quot;brush:csharp;&quot;&gt;
 private void HandleSourceDeprecationOn(..){
     FormulaVersions publishedVersions = formulaVersionsDao.GetAll(queryPublishedBySourceId);
     var currentPublishedFormulaVersion = publishedVersions.DeprecateLatestVersion(user);
  }
&lt;/pre&gt;
可以看到这里GetAll返回的是一个FormulaVer&lt;span&gt;s&lt;/span&gt;ion&lt;span&gt;s&lt;/span&gt;对象，而非Li&lt;span&gt;s&lt;/span&gt;t,这里可以看到DAO中GetAll返回便是FormulaVer&lt;span&gt;s&lt;/span&gt;ion&lt;span&gt;s&lt;/span&gt;对象，而非Li&lt;span&gt;s&lt;/span&gt;t
，这样做的原因是迫使任何使用DAO的方法或者逻辑使用FormulaVer&lt;span&gt;s&lt;/span&gt;ion&lt;span&gt;s&lt;/span&gt;对象，而非Li&lt;span&gt;s&lt;/span&gt;t，使它们脱离出实现细节，这样做的另外的原因是在FormulaVer&lt;span&gt;s&lt;/span&gt;ion&lt;span&gt;s&lt;/span&gt;上确实是有很多关于群一级的behavior，避免了foreach Li&lt;span&gt;s&lt;/span&gt;t的泛滥，同时也因为这些behavior的存在要求使得它从Li&lt;span&gt;s&lt;/span&gt;t“升级”出来。这是不是一个&quot;Be&lt;span&gt;s&lt;/span&gt;t Practice&quot;了？有可能。 那要不要每一个都得这么做了？ 当然不是，这取决于它的context.
Check out Ted Neward'&lt;span&gt;s&lt;/span&gt; blog &quot;&lt;a href=&quot;http://blogs.tedneward.com/2010/08/10/Death+To+Best+Practices.aspx&quot; target=&quot;_blank&quot;&gt;Death to Be&lt;span&gt;s&lt;/span&gt;t Practice&lt;span&gt;s&lt;/span&gt;&lt;/a&gt;&quot;  里面提到了非常重要的一个概念context ,当然这个如果看过设计模式，这个context定会相当有感触，  引用&lt;span&gt;S&lt;/span&gt;cott L.Bain在&amp;lt;&amp;lt;&lt;a href=&quot;http://www.amazon.com/Emergent-Design-Evolutionary-Professional-Development/dp/0321509366&quot; target=&quot;_blank&quot;&gt;Emergent De&lt;span&gt;s&lt;/span&gt;ign&lt;/a&gt;&amp;gt;&amp;gt;的一段描述
&lt;blockquote&gt;Under&lt;span&gt;s&lt;/span&gt;tanding what pattern&lt;span&gt;s&lt;/span&gt; are not i&lt;span&gt;s&lt;/span&gt; almo&lt;span&gt;s&lt;/span&gt;t a&lt;span&gt;s&lt;/span&gt; important a&lt;span&gt;s&lt;/span&gt; under&lt;span&gt;s&lt;/span&gt;tanding what they are,becau&lt;span&gt;se&lt;/span&gt; mi&lt;span&gt;s&lt;/span&gt;under&lt;span&gt;s&lt;/span&gt;tanding their e&lt;span&gt;s&lt;/span&gt;&lt;span&gt;se&lt;/span&gt;ntial nature tend&lt;span&gt;s&lt;/span&gt; to cau&lt;span&gt;se&lt;/span&gt; them to be mi&lt;span&gt;s&lt;/span&gt;u&lt;span&gt;se&lt;/span&gt;d,overu&lt;span&gt;se&lt;/span&gt;d,and finally abandoned by tho&lt;span&gt;se&lt;/span&gt; who become fru&lt;span&gt;s&lt;/span&gt;trated with them.&lt;/blockquote&gt;
还有一句
&lt;blockquote&gt;&lt;strong&gt;Very few people con&lt;span&gt;s&lt;/span&gt;ider pattern&lt;span&gt;s&lt;/span&gt; a&lt;span&gt;s&lt;/span&gt; collection&lt;span&gt;s&lt;/span&gt; of force&lt;span&gt;s&lt;/span&gt;.&lt;/strong&gt;&lt;/blockquote&gt;
我觉得这就非常明显回答了这个问题，要不要把每一个Li&lt;span&gt;s&lt;/span&gt;t换成一个相对应的OO&lt;span&gt;s&lt;/span&gt;了？ 答案是it depend&lt;span&gt;s&lt;/span&gt;. 如果返回的Li&lt;span&gt;s&lt;/span&gt;t对象仅仅就是做一些关于li&lt;span&gt;s&lt;/span&gt;t的一些东西，比如count，或者说它对象的OO&lt;span&gt;s&lt;/span&gt;对象在整个程序中没有要求behavior，我觉得是可以直接用li&lt;span&gt;s&lt;/span&gt;t,因为盲目的去替换所有的li&lt;span&gt;s&lt;/span&gt;t为OO&lt;span&gt;s&lt;/span&gt;，正是忽略了它使用的context.我们需要考虑它所有的force&lt;span&gt;s&lt;/span&gt;，然后做出mo&lt;span&gt;s&lt;/span&gt;t outweighed的选择.
&lt;span&gt;S&lt;/span&gt;o,why it matter&lt;span&gt;s&lt;/span&gt;? and it matter&lt;span&gt;s&lt;/span&gt; what ? --Gotta &lt;span&gt;s&lt;/span&gt;ome clue&lt;span&gt;s&lt;/span&gt;?
</content>
 </entry>
 
 <entry>
   <title>Hello</title>
   <link href="http://tuo.github.com/hi"/>
   <updated>2010-08-23T00:00:00+08:00</updated>
   <id>http:/tuo.github.com/hi</id>
   <content type="html">终于有了自己的一个域名，&lt;a href=&quot;http://www.tuohuang.info&quot;&gt;www.tuohuang.info&lt;/a&gt;，得非常感谢凯哥和gigix的帮助，得以有自己一个可以workable的东西，再次感谢杰哥帮我在他的dreamhost上给了一个空间，同时这个月跟他的pair过程中，我学习到了很多东西，他强调跟我说对于技术人员保持写日志的习惯有多么重要，事实上我非常地赞同，写日志事情都没有理由不去坚持，如果这不能克服阻力坚持下去，没有理由你能办好其他的事情，听杰哥说他写日志有很多年的习惯，而且原来周末一写便是一下午，五六千字，我非常佩服。一个好的习惯是非常重要的，所以这里再次表示感谢，so appreciate。
我之前的日志一部分是放在了新浪上,一部分是放在了&lt;a href=&quot;http://clarkht.iteye.com/&quot; target=&quot;_blank&quot;&gt;http://clarkht.iteye.com/&lt;/a&gt;上.

我最近偶然看到一句话（从某位童鞋的分享的日志瞥见的）:
&lt;blockquote&gt;      What really distinguish u is that when they're on current step,they already have figure out what should do for next step,and ,esp,they know how every step are gonna fit to a big plan,and before all of these,they knew at the very beginning who they are and what the big plan is. So, only u know what u want ,then follow your soul,and that will lead u there undoubtfully. Remember what make u happy, and enjoy it , it's just so simple.&lt;/blockquote&gt;
</content>
 </entry>
 
</feed>
